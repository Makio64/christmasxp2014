var TWEEN=TWEEN||function(){var a=[];return{REVISION:"10",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){b=a.indexOf(b);-1!==b&&a.splice(b,1)},update:function(b){if(0===a.length)return!1;for(var c=0,d=a.length,b=void 0!==b?b:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();c<d;)a[c].update(b)?c++:(a.splice(c,1),d--);return!0}}}();
TWEEN.Tween=function(a){var b={},c={},d={},e=1E3,f=0,g=0,h=null,i=TWEEN.Easing.Linear.None,j=TWEEN.Interpolation.Linear,k=[],m=null,t=!1,o=null,q=null,u;for(u in a)b[u]=parseFloat(a[u],10);this.to=function(a,b){void 0!==b&&(e=b);c=a;return this};this.start=function(e){TWEEN.add(this);t=!1;h=void 0!==e?e:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();h+=g;for(var f in c){if(c[f]instanceof Array){if(0===c[f].length)continue;c[f]=[a[f]].concat(c[f])}b[f]=
a[f];!1===b[f]instanceof Array&&(b[f]*=1);d[f]=b[f]||0}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(a){g=a;return this};this.repeat=function(a){f=a;return this};this.easing=function(a){i=a;return this};this.interpolation=function(a){j=a;return this};this.chain=function(){k=arguments;return this};this.onStart=function(a){m=a;return this};this.onUpdate=function(a){o=a;return this};this.onComplete=function(a){q=a;return this};this.update=function(p){if(p<h)return!0;
!1===t&&(null!==m&&m.call(a),t=!0);var u=(p-h)/e,u=1<u?1:u;if(void 0==i)i=TWEEN.Easing.Linear.None;var z=i(u),v;for(v in c){var A=b[v]||0,n=c[v];n instanceof Array?a[v]=j(n,z):("string"===typeof n&&(n=A+parseFloat(n,10)),a[v]=A+(n-A)*z)}null!==o&&o.call(a,z);if(1==u)if(0<f){isFinite(f)&&f--;for(v in d)"string"===typeof c[v]&&(d[v]+=parseFloat(c[v],10)),b[v]=d[v];h=p+g}else{null!==q&&q.call(a);u=0;for(z=k.length;u<z;u++)k[u].start(p);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*a:0.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?0.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*
a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*a*a*a:0.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return 0.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?0.5*Math.pow(1024,a-1):0.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-
Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-0.5*(Math.sqrt(1-a*a)-1):0.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=0.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=0.1):b=0.4*Math.asin(1/c)/(2*Math.PI);return-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/0.4))},Out:function(a){var b,c=0.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=0.1):b=0.4*Math.asin(1/c)/(2*Math.PI);return c*Math.pow(2,-10*a)*Math.sin((a-b)*
2*Math.PI/0.4)+1},InOut:function(a){var b,c=0.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=0.1):b=0.4*Math.asin(1/c)/(2*Math.PI);return 1>(a*=2)?-0.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/0.4):0.5*c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*2*Math.PI/0.4)+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*(3.5949095*a-2.5949095):0.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-
TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},InOut:function(a){return 0.5>a?0.5*TWEEN.Easing.Bounce.In(2*a):0.5*TWEEN.Easing.Bounce.Out(2*a-1)+0.5}}};
TWEEN.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TWEEN.Interpolation.Utils.Linear;return 0>b?f(a[0],a[1],d):1<b?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)},Bezier:function(a,b){var c=0,d=a.length-1,e=Math.pow,f=TWEEN.Interpolation.Utils.Bernstein,g;for(g=0;g<=d;g++)c+=e(1-b,d-g)*e(b,g)*a[g]*f(d,g);return c},CatmullRom:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),f(a[(e-
1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):1<b?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[c<e+1?c:e+1],a[c<e+2?c:e+2],d-e)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c=1,d;if(a[b])return a[b];for(d=b;1<d;d--)c*=d;return a[b]=c}}(),CatmullRom:function(a,b,c,d,e){var a=0.5*(c-a),d=0.5*(d-b),f=
e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}}};glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;
var vec3={create:function(a){var b=new glMatrixArrayType(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},add:function(a,b,c){if(!c||a==c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(a,b,c){if(!c||a==c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,
b,c){if(!c||a==c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(f){if(1==f)return b[0]=c,b[1]=d,b[2]=e,b}else return b[0]=0,b[1]=0,b[2]=0,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;return b},cross:function(a,b,c){c||(c=a);var d=a[0],e=a[1],a=a[2],f=b[0],g=b[1],b=b[2];c[0]=e*b-a*g;c[1]=a*f-d*b;c[2]=d*g-e*f;return c},length:function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)},
dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],a=a[2]-b[2],b=Math.sqrt(d*d+e*e+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"}},mat3={create:function(a){var b=new glMatrixArrayType(9);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=
a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=d;a[7]=e;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},
toMat4:function(a,b){b||(b=mat4.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=0;b[4]=a[3];b[5]=a[4];b[6]=a[5];b[7]=0;b[8]=a[6];b[9]=a[7];b[10]=a[8];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},mat4={create:function(a){var b=new glMatrixArrayType(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=
a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];a[1]=a[4];a[2]=
a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=f;a[11]=a[14];a[12]=e;a[13]=g;a[14]=h;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],m=a[10],t=a[11],o=a[12],q=a[13],u=a[14],a=a[15];return o*k*h*e-j*q*h*e-o*g*m*e+f*q*m*e+j*g*u*e-f*k*u*e-o*k*d*i+j*q*d*i+
o*c*m*i-b*q*m*i-j*c*u*i+b*k*u*i+o*g*d*t-f*q*d*t-o*c*h*t+b*q*h*t+f*c*u*t-b*g*u*t-j*g*d*a+f*k*d*a+j*c*h*a-b*k*h*a-f*c*m*a+b*g*m*a},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],m=a[9],t=a[10],o=a[11],q=a[12],u=a[13],p=a[14],F=a[15],z=c*h-d*g,v=c*i-e*g,A=c*j-f*g,n=d*i-e*h,r=d*j-f*h,w=e*j-f*i,x=k*u-m*q,y=k*p-t*q,C=k*F-o*q,D=m*p-t*u,G=m*F-o*u,E=t*F-o*p,B=1/(z*E-v*G+A*D+n*C-r*y+w*x);b[0]=(h*E-i*G+j*D)*B;b[1]=(-d*E+e*G-f*D)*B;b[2]=(u*w-p*r+F*n)*B;b[3]=
(-m*w+t*r-o*n)*B;b[4]=(-g*E+i*C-j*y)*B;b[5]=(c*E-e*C+f*y)*B;b[6]=(-q*w+p*A-F*v)*B;b[7]=(k*w-t*A+o*v)*B;b[8]=(g*G-h*C+j*x)*B;b[9]=(-c*G+d*C-f*x)*B;b[10]=(q*r-u*A+F*z)*B;b[11]=(-k*r+m*A-o*z)*B;b[12]=(-g*D+h*y-i*x)*B;b[13]=(c*D-d*y+e*x)*B;b[14]=(-q*n+u*v-p*z)*B;b[15]=(k*n-m*v+t*z)*B;return b}};
mat4.toRotationMat=function(a,b){b||(b=mat4.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};mat4.toMat3=function(a,b){b||(b=mat3.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};
mat4.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],m=k*g-h*j,t=-k*f+h*i,o=j*f-g*i,q=c*m+d*t+e*o;if(!q)return null;q=1/q;b||(b=mat3.create());b[0]=m*q;b[1]=(-k*d+e*j)*q;b[2]=(h*d-e*g)*q;b[3]=t*q;b[4]=(k*c-e*i)*q;b[5]=(-h*c+e*f)*q;b[6]=o*q;b[7]=(-j*c+d*i)*q;b[8]=(g*c-d*f)*q;return b};
mat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],m=a[8],t=a[9],o=a[10],q=a[11],u=a[12],p=a[13],F=a[14],a=a[15],z=b[0],v=b[1],A=b[2],n=b[3],r=b[4],w=b[5],x=b[6],y=b[7],C=b[8],D=b[9],G=b[10],E=b[11],B=b[12],H=b[13],l=b[14],b=b[15];c[0]=z*d+v*h+A*m+n*u;c[1]=z*e+v*i+A*t+n*p;c[2]=z*f+v*j+A*o+n*F;c[3]=z*g+v*k+A*q+n*a;c[4]=r*d+w*h+x*m+y*u;c[5]=r*e+w*i+x*t+y*p;c[6]=r*f+w*j+x*o+y*F;c[7]=r*g+w*k+x*q+y*a;c[8]=C*d+D*h+G*m+E*u;c[9]=C*e+D*i+G*t+E*p;c[10]=C*f+D*
j+G*o+E*F;c[11]=C*g+D*k+G*q+E*a;c[12]=B*d+H*h+l*m+b*u;c[13]=B*e+H*i+l*t+b*p;c[14]=B*f+H*j+l*o+b*F;c[15]=B*g+H*k+l*q+b*a;return c};mat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c};
mat4.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b;return c};
mat4.translate=function(a,b,c){var d=b[0],e=b[1],b=b[2];if(!c||a==c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;var f=a[0],g=a[1],h=a[2],i=a[3],j=a[4],k=a[5],m=a[6],t=a[7],o=a[8],q=a[9],u=a[10],p=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=i;c[4]=j;c[5]=k;c[6]=m;c[7]=t;c[8]=o;c[9]=q;c[10]=u;c[11]=p;c[12]=f*d+j*e+o*b+a[12];c[13]=g*d+k*e+q*b+a[13];c[14]=h*d+m*e+u*b+a[14];c[15]=i*d+t*e+p*b+a[15];return c};
mat4.scale=function(a,b,c){var d=b[0],e=b[1],b=b[2];if(!c||a==c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};
mat4.rotate=function(a,b,c,d){var e=c[0],f=c[1],c=c[2],g=Math.sqrt(e*e+f*f+c*c);if(!g)return null;1!=g&&(g=1/g,e*=g,f*=g,c*=g);var h=Math.sin(b),i=Math.cos(b),j=1-i,b=a[0],g=a[1],k=a[2],m=a[3],t=a[4],o=a[5],q=a[6],u=a[7],p=a[8],F=a[9],z=a[10],v=a[11],A=e*e*j+i,n=f*e*j+c*h,r=c*e*j-f*h,w=e*f*j-c*h,x=f*f*j+i,y=c*f*j+e*h,C=e*c*j+f*h,e=f*c*j-e*h,f=c*c*j+i;d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*A+t*n+p*r;d[1]=g*A+o*n+F*r;d[2]=k*A+q*n+z*r;d[3]=m*A+u*n+v*r;d[4]=b*w+t*x+p*y;d[5]=
g*w+o*x+F*y;d[6]=k*w+q*x+z*y;d[7]=m*w+u*x+v*y;d[8]=b*C+t*e+p*f;d[9]=g*C+o*e+F*f;d[10]=k*C+q*e+z*f;d[11]=m*C+u*e+v*f;return d};mat4.rotateX=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[4],f=a[5],g=a[6],h=a[7],i=a[8],j=a[9],k=a[10],m=a[11];c?a!=c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+i*d;c[5]=f*b+j*d;c[6]=g*b+k*d;c[7]=h*b+m*d;c[8]=e*-d+i*b;c[9]=f*-d+j*b;c[10]=g*-d+k*b;c[11]=h*-d+m*b;return c};
mat4.rotateY=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],h=a[3],i=a[8],j=a[9],k=a[10],m=a[11];c?a!=c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+i*-d;c[1]=f*b+j*-d;c[2]=g*b+k*-d;c[3]=h*b+m*-d;c[8]=e*d+i*b;c[9]=f*d+j*b;c[10]=g*d+k*b;c[11]=h*d+m*b;return c};
mat4.rotateZ=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],m=a[7];c?a!=c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+i*d;c[1]=f*b+j*d;c[2]=g*b+k*d;c[3]=h*b+m*d;c[4]=e*-d+i*b;c[5]=f*-d+j*b;c[6]=g*-d+k*b;c[7]=h*-d+m*b;return c};
mat4.frustum=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;g[0]=2*e/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*e/i;g[6]=0;g[7]=0;g[8]=(b+a)/h;g[9]=(d+c)/i;g[10]=-(f+e)/j;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(2*f*e)/j;g[15]=0;return g};mat4.perspective=function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return mat4.frustum(-b,b,-a,a,c,d,e)};
mat4.ortho=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;g[0]=2/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2/i;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2/j;g[11]=0;g[12]=-(a+b)/h;g[13]=-(d+c)/i;g[14]=-(f+e)/j;g[15]=1;return g};
mat4.lookAt=function(a,b,c,d){d||(d=mat4.create());var e=a[0],f=a[1],a=a[2],g=c[0],h=c[1],i=c[2],c=b[1],j=b[2];if(e==b[0]&&f==c&&a==j)return mat4.identity(d);var k,m,t,o,c=e-b[0],j=f-b[1],b=a-b[2];o=1/Math.sqrt(c*c+j*j+b*b);c*=o;j*=o;b*=o;k=h*b-i*j;i=i*c-g*b;g=g*j-h*c;(o=Math.sqrt(k*k+i*i+g*g))?(o=1/o,k*=o,i*=o,g*=o):g=i=k=0;h=j*g-b*i;m=b*k-c*g;t=c*i-j*k;(o=Math.sqrt(h*h+m*m+t*t))?(o=1/o,h*=o,m*=o,t*=o):t=m=h=0;d[0]=k;d[1]=h;d[2]=c;d[3]=0;d[4]=i;d[5]=m;d[6]=j;d[7]=0;d[8]=g;d[9]=t;d[10]=b;d[11]=0;
d[12]=-(k*e+i*f+g*a);d[13]=-(h*e+m*f+t*a);d[14]=-(c*e+j*f+b*a);d[15]=1;return d};mat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};
quat4={create:function(a){var b=new glMatrixArrayType(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},calculateW:function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a==b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b},inverse:function(a,b){if(!b||a==b)return a[0]*=1,a[1]*=1,a[2]*=1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b},length:function(a){var b=
a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);if(0==g)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;b[3]=f*g;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3],g=b[0],h=b[1],i=b[2],b=b[3];c[0]=d*b+a*g+e*i-f*h;c[1]=e*b+a*h+f*g-d*i;c[2]=f*b+a*i+d*h-e*g;c[3]=a*b-d*g-e*h-f*i;return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],
b=a[0],g=a[1],h=a[2],a=a[3],i=a*d+g*f-h*e,j=a*e+h*d-b*f,k=a*f+b*e-g*d,d=-b*d-g*e-h*f;c[0]=i*a+d*-b+j*-h-k*-g;c[1]=j*a+d*-g+k*-b-i*-h;c[2]=k*a+d*-h+i*-g-j*-b;return c},toMat3:function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,c=c*i,m=d*h,d=d*i,e=e*i,g=f*g,h=f*h,f=f*i;b[0]=1-(m+e);b[1]=k-f;b[2]=c+h;b[3]=k+f;b[4]=1-(j+e);b[5]=d-g;b[6]=c-h;b[7]=d+g;b[8]=1-(j+m);return b},toMat4:function(a,b){b||(b=mat4.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,
i=e+e,j=c*g,k=c*h,c=c*i,m=d*h,d=d*i,e=e*i,g=f*g,h=f*h,f=f*i;b[0]=1-(m+e);b[1]=k-f;b[2]=c+h;b[3]=0;b[4]=k+f;b[5]=1-(j+e);b[6]=d-g;b[7]=0;b[8]=c-h;b[9]=d+g;b[10]=1-(j+m);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},slerp:function(a,b,c,d){d||(d=a);var e=c;0>a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]&&(e=-1*c);d[0]=1-c*a[0]+e*b[0];d[1]=1-c*a[1]+e*b[1];d[2]=1-c*a[2]+e*b[2];d[3]=1-c*a[3]+e*b[3];return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"},slerp:function(a,b,c,d){d||(d=
a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];if(1<=Math.abs(e))return d!=a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;var f=Math.acos(e),g=Math.sqrt(1-e*e);if(0.0010>Math.abs(g))return d[0]=0.5*a[0]+0.5*b[0],d[1]=0.5*a[1]+0.5*b[1],d[2]=0.5*a[2]+0.5*b[2],d[3]=0.5*a[3]+0.5*b[3],d;e=Math.sin((1-c)*f)/g;c=Math.sin(c*f)/g;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d},str:function(a){return"["+a[0].toFixed(4)+", "+a[1].toFixed(4)+", "+a[2].toFixed(4)+", "+a[3].toFixed(4)+
"]"}};if(!this.Perlin)var Perlin=function(){var a=Math,b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,
217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,
53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,
28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=1,d=0.5,e,f,g,h,i,j,k=function(){var a,b;e=[];f=[];for(var h=g=0;h<c;h++)a=Math.pow(2,h),b=Math.pow(d,h),g+=b,e.push(a),f.push(b);
g=1/g},m=function(){h=1*Math.floor(256*a.random());i=1*Math.floor(256*a.random());j=1*Math.floor(256*a.random())};m();k();return{noise:function(a,d,k){for(var m=0,p,F,z,v,A,n,r,w,x,y,C,D,G,E,B,H,l,J,a=(a||0)+h,d=(d||0)+i,k=(k||0)+j,I=0;I<c;I++)p=e[I],F=f[I],n=a*p,r=d*p,p*=k,z=Math.floor(n),v=Math.floor(r),A=Math.floor(p),C=Math.floor(z&255),D=Math.floor(v&255),G=Math.floor(A&255),n-=z,r-=v,p-=A,z=n*n*n*(n*(6*n-15)+10),v=r*r*r*(r*(6*r-15)+10),A=p*p*p*(p*(6*p-15)+10),E=Math.round(b[C])+D,B=Math.round(b[E])+
G,E=Math.round(b[Math.round(E+1)])+G,D=Math.round(b[Math.round(C+1)])+D,C=Math.round(b[D])+G,H=Math.round(b[Math.round(D+1)])+G,w=n-1,x=r-1,y=p-1,l=Math.round(b[Math.round(H+1)])&15,G=(0===(l&1)?8>l?w:x:8>l?-w:-x)+(0===(l&2)?4>l?x:12===l?w:y:4>l?-x:14===l?-w:-y),l=Math.round(b[Math.round(E+1)])&15,D=(0===(l&1)?8>l?n:x:8>l?-n:-x)+(0===(l&2)?4>l?x:12===l?n:y:4>l?-x:14===l?-n:-y),l=Math.round(b[Math.round(C+1)])&15,J=(0===(l&1)?8>l?w:r:8>l?-w:-r)+(0===(l&2)?4>l?r:12===l?w:y:4>l?-r:14===l?-w:-y),l=Math.round(b[Math.round(B+
1)])&15,y=(0===(l&1)?8>l?n:r:8>l?-n:-r)+(0===(l&2)?4>l?r:12===l?n:y:4>l?-r:14===l?-n:-y),l=Math.round(b[H])&15,H=(0===(l&1)?8>l?w:x:8>l?-w:-x)+(0===(l&2)?4>l?x:12===l?w:p:4>l?-x:14===l?-w:-p),l=Math.round(b[E])&15,E=(0===(l&1)?8>l?n:x:8>l?-n:-x)+(0===(l&2)?4>l?x:12===l?n:p:4>l?-x:14===l?-n:-p),l=Math.round(b[C])&15,C=(0===(l&1)?8>l?w:r:8>l?-w:-r)+(0===(l&2)?4>l?r:12===l?w:p:4>l?-r:14===l?-w:-p),l=Math.round(b[B])&15,n=(0===(l&1)?8>l?n:r:8>l?-n:-r)+(0===(l&2)?4>l?r:12===l?n:p:4>l?-r:14===l?-n:-p),
D+=z*(G-D),y+=z*(J-y),E+=z*(H-E),n+=z*(C-n),y+=v*(D-y),n+=v*(E-n),m+=(n+A*(y-n))*F;return 0.5*(m*g+1)},noiseDetail:function(a,b){c=a||c;d=b||d;k()},setRng:function(b){a=b;m();k()},toString:function(){return"[object Perlin "+c+" "+d+"]"},setOffset:function(a,b,c){h=a;i=b;j=c}}}();(function(){SimpleImageLoader=function(){this._imgs={};this._toLoadCount=this._loadedCount=0};var a=SimpleImageLoader.prototype;a.load=function(a,c,d){this._imgs={};this._loadedCount=0;this._toLoadCount=a.length;this._scope=c;this._callback=d;for(var e=this,c=0;c<a.length;c++){d=new Image;d.onload=function(){e._onImageLoaded()};var f=a[c],g=f.split("/");this._imgs[g[g.length-1].split(".")[0]]=d;d.src=f}};a._onImageLoaded=function(){this._loadedCount++;this._loadedCount==this._toLoadCount&&this._callback.call(this._scope,
this._imgs)}})();if(void 0==window.requestAnimFrame)window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();
(function(){var a;Scheduler=function(){a=this;this.FRAMERATE=60;this._delayTasks=[];this._nextTasks=[];this._deferTasks=[];this._highTasks=[];this._usurpTask=[];this._enterframeTasks=[];this._idTable=0;requestAnimFrame(this._loop)};var b=Scheduler.prototype;b._loop=function(){requestAnimFrame(a._loop);a._process()};b._process=function(){for(var a=0;a<this._enterframeTasks.length;a++){var b=this._enterframeTasks[a];null!=b&&void 0!=b&&b.func.apply(b.scope,b.params)}for(;0<this._highTasks.length;)b=
this._highTasks.pop(),b.func.call(b.scope,b.params);for(var e=(new Date).getTime(),a=0;a<this._delayTasks.length;a++)b=this._delayTasks[a],e-b.time>b.delay&&(b.func.call(b.scope,b.params),this._delayTasks.splice(a,1));e=(new Date).getTime();for(a=1E3/this.FRAMERATE;0<this._deferTasks.length;){var b=this._deferTasks.shift(),f=(new Date).getTime();if(f-e<a)b.func.apply(b.scope,b.params);else{this._deferTasks.unshift(b);break}}e=(new Date).getTime();for(a=1E3/this.FRAMERATE;0<this._usurpTask.length;)if(b=
this._usurpTask.shift(),f=(new Date).getTime(),f-e<a)b.func.apply(b.scope,b.params);else break;this._highTasks=this._highTasks.concat(this._nextTasks);this._nextTasks=[];this._usurpTask=[]};b.addEF=function(a,b,e){var f=this._idTable;this._enterframeTasks[f]={scope:a,func:b,params:e};this._idTable++;return f};b.removeEF=function(a){void 0!=this._enterframeTasks[a]&&(this._enterframeTasks[a]=null);return-1};b.delay=function(a,b,e,f){var g=(new Date).getTime();this._delayTasks.push({scope:a,func:b,
params:e,delay:f,time:g})};b.defer=function(a,b,e){this._deferTasks.push({scope:a,func:b,params:e})};b.next=function(a,b,e){this._nextTasks.push({scope:a,func:b,params:e})};b.usurp=function(a,b,e){this._usurpTask.push({scope:a,func:b,params:e})}})();(function(){var a=!0;try{document.createEvent("CustomEvent")}catch(b){a=!1}EventDispatcher=function(){this._eventListeners=null};var c=EventDispatcher.prototype;c.addEventListener=function(a,b){if(null===this._eventListeners)this._eventListeners={};this._eventListeners[a]||(this._eventListeners[a]=[]);this._eventListeners[a].push(b);return this};c.removeEventListener=function(a,b){if(null===this._eventListeners)this._eventListeners={};var c=this._eventListeners[a];if("undefined"===typeof c)return this;
for(var g=c.length,h=0;h<g;h++)c[h]===b&&(c.splice(h,1),h--,g--);return this};c.dispatchEvent=function(a){if(null===this._eventListeners)this._eventListeners={};var b=a.type;try{if(null===a.target)a.target=this;a.currentTarget=this}catch(c){return this.dispatchEvent({type:b,detail:a.detail,dispatcher:this})}b=this._eventListeners[b];if(null!==b&&void 0!==b)for(var b=this._copyArray(b),g=b.length,h=0;h<g;h++)b[h].call(this,a);return this};c.dispatchCustomEvent=function(b,c){var f;a?(f=document.createEvent("CustomEvent"),
f.dispatcher=this,f.initCustomEvent(b,!1,!1,c)):f={type:b,detail:c,dispatcher:this};return this.dispatchEvent(f)};c._destroy=function(){s._destroy.call(this);if(null!==this._eventListeners){for(var a in this._eventListeners){for(var b=this._eventListeners[a],c=b.length,g=0;g<c;g++)b[g]=null;delete this._eventListeners[a]}this._eventListeners=null}};c._copyArray=function(a){for(var b=Array(a.length),c=b.length,g=0;g<c;g++)b[g]=a[g];return b}})();(function(){ElementUtils=function(){};ElementUtils.addClass=function(a,b){if(void 0!=a)return ElementUtils.hasClass(a,b)||(a.className+=(a.className?" ":"")+b),a};ElementUtils.hasClass=function(a,b){try{return RegExp("(\\s|^)"+b+"(\\s|$)").test(a.className)}catch(c){console.error("ElementUtils.hasClass :: error : ",c)}return!1};ElementUtils.removeClass=function(a,b,c){if(0<parseFloat(c))b=ListenerFunctions.createListenerFunctionWithArguments(this,this.removeClass,[a,b]),setTimeout(b,c);else if(ElementUtils.hasClass(a,
b))a.className=a.className.replace(RegExp("(\\s|^)"+b+"(\\s|$)")," ").replace(/^\s+|\s+$/g,"");return a}})();GL={id:"GLTools"};GL.aspectRatio=window.innerWidth/window.innerHeight;GL.fieldOfView=45;GL.zNear=5;GL.zFar=3E3;
GL.init=function(a){this.canvas=a;this.gl=this.canvas.getContext("webgl",{antialias:!0})||this.canvas.getContext("experimental-webgl",{antialias:!0});this.resize();this._enabledVertexAttrib=[];this.gl.getParameter(this.gl.SAMPLES);this.gl.getContextAttributes();this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.CULL_FACE);this.gl.enable(this.gl.BLEND);this.gl.clearColor(0,0,0,1);this.gl.clearDepth(1);this.depthTextureExt=this.gl.getExtension("WEBKIT_WEBGL_depth_texture");
this.floatTextureExt=this.gl.getExtension("OES_texture_float");console.log("Extentions : ",this.depthTextureExt,this.floatTextureExt);this.matrix=mat4.create();mat4.identity(this.matrix);this.enableAlphaBlending();window.addEventListener("resize",function(){GL.resize()})};GL.setViewport=function(a,b,c,d){this.gl.viewport(a,b,c,d)};GL.setMatrices=function(a){this.camera=a};GL.rotate=function(a){mat4.set(a,this.matrix)};
GL.clear=function(a,b,c,d){this.gl.clearColor(a,b,c,d);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)};GL.render=function(){this.shaderProgram&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA))};GL.enableAlphaBlending=function(){this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};GL.enableAdditiveBlending=function(){this.gl.blendFunc(this.gl.ONE,this.gl.ONE)};
GL.draw=function(a){function b(a,b,c){if(void 0==b.cacheAttribLoc)b.cacheAttribLoc={};void 0==b.cacheAttribLoc[c]&&(b.cacheAttribLoc[c]=a.getAttribLocation(b,c));return b.cacheAttribLoc[c]}this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,this.camera.getMatrix());this.gl.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,this.matrix);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vBufferPos);var c=b(this.gl,this.shaderProgram,"aVertexPosition");this.gl.vertexAttribPointer(c,a.vBufferPos.itemSize,
this.gl.FLOAT,!1,0,0);-1==this._enabledVertexAttrib.indexOf(c)&&(this.gl.enableVertexAttribArray(c),this._enabledVertexAttrib.push(c));this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vBufferUV);c=b(this.gl,this.shaderProgram,"aTextureCoord");this.gl.vertexAttribPointer(c,a.vBufferUV.itemSize,this.gl.FLOAT,!1,0,0);-1==this._enabledVertexAttrib.indexOf(c)&&(this.gl.enableVertexAttribArray(c),this._enabledVertexAttrib.push(c));this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.iBuffer);for(c=0;c<a.extraAttributes.length;c++){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,
a.extraAttributes[c].buffer);var d=b(this.gl,this.shaderProgram,a.extraAttributes[c].name);this.gl.vertexAttribPointer(d,a.extraAttributes[c].itemSize,this.gl.FLOAT,!1,0,0);this.gl.enableVertexAttribArray(d);-1==this._enabledVertexAttrib.indexOf(d)&&(this.gl.enableVertexAttribArray(d),this._enabledVertexAttrib.push(d))}a.drawType==this.gl.POINTS?this.gl.drawArrays(a.drawType,0,a.vertexSize):this.gl.drawElements(a.drawType,a.iBuffer.numItems,this.gl.UNSIGNED_SHORT,0)};
GL.resize=function(){this.W=window.innerWidth;this.H=window.innerHeight;this.canvas.width=this.W;this.canvas.height=this.H;this.gl.viewportWidth=this.W;this.gl.viewportHeight=this.H;this.gl.viewport(0,0,this.W,this.H);this.aspectRatio=window.innerWidth/window.innerHeight;this.projection=mat4.perspective(this.fieldOfView,this.aspectRatio,this.zNear,this.zFar);this.render()};(function(){var a;GLShader=function(b,d){if(GL)a=GL.gl,this.idVertex=b,this.idFragment=d,this.getShader(this.idVertex,!0),this.getShader(this.idFragment,!1),this.parameters=[],this._isReady=!1};var b=GLShader.prototype;b.init=function(){this.shaderProgram=a.createProgram();a.attachShader(this.shaderProgram,this.vertexShader);a.attachShader(this.shaderProgram,this.fragmentShader);a.linkProgram(this.shaderProgram);this._isReady=!0};b.getShader=function(a,b){var e=new XMLHttpRequest;e.hasCompleted=!1;
var f=this;e.onreadystatechange=function(a){4==a.target.readyState&&f.createShaderProgram(a.target.responseText,b)};e.open("GET",a,!0);e.send(null)};b.createShaderProgram=function(b,d){var e=d?a.createShader(a.VERTEX_SHADER):a.createShader(a.FRAGMENT_SHADER);a.shaderSource(e,b);a.compileShader(e);if(!a.getShaderParameter(e,a.COMPILE_STATUS))return alert(a.getShaderInfoLog(e)),null;d?this.vertexShader=e:this.fragmentShader=e;void 0!=this.vertexShader&&void 0!=this.fragmentShader&&this.init()};b.bind=
function(){a.useProgram(this.shaderProgram);if(void 0==this.shaderProgram.pMatrixUniform)this.shaderProgram.pMatrixUniform=a.getUniformLocation(this.shaderProgram,"uPMatrix");if(void 0==this.shaderProgram.mvMatrixUniform)this.shaderProgram.mvMatrixUniform=a.getUniformLocation(this.shaderProgram,"uMVMatrix");GL.shader=this;GL.shaderProgram=this.shaderProgram;this.uniformTextures=[]};b.uniform=function(b,d,e){"texture"==d&&(d="uniform1i");for(var f=!1,g,h=0;h<this.parameters.length;h++)if(g=this.parameters[h],
g.name==b){g.value=e;f=!0;break}f?this.shaderProgram[b]=g.uniformLoc:(this.shaderProgram[b]=a.getUniformLocation(this.shaderProgram,b),this.parameters.push({name:b,type:d,value:e,uniformLoc:this.shaderProgram[b]}));if(-1==d.indexOf("Matrix"))a[d](this.shaderProgram[b],e);else a[d](this.shaderProgram[b],!1,e);"uniform1i"==d&&(this.uniformTextures[e]=this.shaderProgram[b])};b.unbind=function(){};b.isReady=function(){return this._isReady}})();(function(){var a;GLTexture=function(b,d){a=GL.gl;void 0==d?(this.texture=a.createTexture(),this._isVideo="VIDEO"==b.tagName,a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.MIRRORED_REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.MIRRORED_REPEAT),
a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null)):this.texture=b};var b=GLTexture.prototype;b.updateTexture=function(b){a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);this._isVideo?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.generateMipmap(a.TEXTURE_2D));a.bindTexture(a.TEXTURE_2D,null)};b.bind=function(b){void 0==b&&(b=0);a.activeTexture(a.TEXTURE0+b);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniform1i(GL.shader.uniformTextures[b],b);this._bindIndex=b};b.unbind=function(){a.bindTexture(a.TEXTURE_2D,null)}})();(function(){Camera=function(){this.matrix=mat4.create();mat4.identity(this.matrix)};var a=Camera.prototype;a.lookAt=function(a,c,d){mat4.identity(this.matrix);this.matrix=mat4.lookAt(a,c,d)};a.getMatrix=function(){return this.matrix}})();
(function(){CameraPersp=function(){Camera.call(this);this.projection=mat4.create();mat4.identity(this.projection);this.mtxFinal=mat4.create()};var a=CameraPersp.prototype=new Camera;a.setPerspective=function(a,c,d,e){this.projection=mat4.perspective(a,c,d,e)};a.getMatrix=function(){mat4.multiply(this.projection,this.matrix,this.mtxFinal);return this.mtxFinal}})();(function(){Mesh=function(a,c,d){if(void 0!=GL)this.gl=GL.gl,this.vertexSize=a,this.indexSize=c,this.drawType=d,this.extraAttributes=[],this._floatArrayVertex=void 0,this._init()};var a=Mesh.prototype;a._init=function(){};a.bufferVertex=function(a){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<a[d].length;e++)c.push(a[d][e]);if(void 0==this.vBufferPos)this.vBufferPos=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vBufferPos);if(void 0==this._floatArrayVertex)this._floatArrayVertex=
new Float32Array(c);else if(a.length!=this._floatArrayVertex.length)this._floatArrayVertex=new Float32Array(c);else for(d=0;d<a.length;d++)this._floatArrayVertex[d]=a[d];this.gl.bufferData(this.gl.ARRAY_BUFFER,this._floatArrayVertex,this.gl.STATIC_DRAW);this.vBufferPos.itemSize=3};a.bufferTexCoords=function(a){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<a[d].length;e++)c.push(a[d][e]);this.vBufferUV=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vBufferUV);this.gl.bufferData(this.gl.ARRAY_BUFFER,
new Float32Array(c),this.gl.STATIC_DRAW);this.vBufferUV.itemSize=2};a.bufferData=function(a,c,d){for(var e=-1,f=0;f<this.extraAttributes.length;f++)if(this.extraAttributes[f].name==c){this.extraAttributes[f].data=a;e=f;break}for(var g=[],f=0;f<a.length;f++)for(var h=0;h<a[f].length;h++)g.push(a[f][h]);if(-1==e)f=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,f),e=new Float32Array(g),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.extraAttributes.push({name:c,data:a,
itemSize:d,buffer:f,floatArray:e});else{f=this.extraAttributes[e].buffer;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,f);e=this.extraAttributes[e].floatArray;for(f=0;f<g.length;f++)e[f]=g[f];this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW)}};a.bufferIndices=function(a){this.iBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.iBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),this.gl.STATIC_DRAW);this.iBuffer.itemSize=1;this.iBuffer.numItems=
a.length}})();(function(){SceneRotation=function(a){void 0==a&&(a=document);this._isRotateZ=this._preZ=this._mouseZ=this._z=0;this.matrix=mat4.create();this.m=mat4.create();this._vZaxis=vec3.create([0,0,0]);this._zAxis=vec3.create([0,0,-1]);this.preMouse={x:0,y:0};this.mouse={x:0,y:0};this._isMouseDown=!1;this._rotation=quat4.create([1,0,0,0]);this.tempRotation=quat4.create([0,0,0,0]);this._currDiffY=this._currDiffX=this.diffY=this.diffX=this._rotateZMargin=0;this._offset=0.0040;this._easing=0.1;this._slerp=-1;
var b=this;a.addEventListener("mousedown",function(a){b._onMouseDown(a)});a.addEventListener("touchstart",function(a){b._onMouseDown(a)});a.addEventListener("mouseup",function(a){b._onMouseUp(a)});a.addEventListener("touchend",function(a){b._onMouseUp(a)});a.addEventListener("mousemove",function(a){b._onMouseMove(a)});a.addEventListener("touchmove",function(a){b._onMouseMove(a)});a.addEventListener("mousewheel",function(a){b._onMouseWheel(a)});a.addEventListener("DOMMouseScroll",function(a){b._onMouseWheel(a)})};
var a=SceneRotation.prototype,b=function(a){var b;void 0!=a.changedTouches?(b=a.changedTouches[0].pageX,a=a.changedTouches[0].pageY):(b=a.clientX,a=a.clientY);return{x:b,y:a}};a._onMouseDown=function(a){if(!this._isMouseDown){var a=b(a),d=quat4.create(this._rotation);this._updateRotation(d);this._rotation=d;this._isMouseDown=!0;this._isRotateZ=0;this.preMouse={x:a.x,y:a.y};if(a.y<this._rotateZMargin||a.y>window.innerHeight-this._rotateZMargin)this._isRotateZ=1;else if(a.x<this._rotateZMargin||a.x>
window.innerWidth-this._rotateZMargin)this._isRotateZ=2;this._z=this._preZ;this._currDiffY=this.diffY=this._currDiffX=this.diffX=0}};a._onMouseMove=function(a){this.mouse=b(a);a.touches&&a.preventDefault()};a._onMouseUp=function(){if(this._isMouseDown)this._isMouseDown=!1};a._onMouseWheel=function(a){a.preventDefault();var b=a.wheelDelta,a=a.detail,e=0;this._preZ-=5*(a?b?0<b/a/40*a?1:-1:-a/3:b/120)};a.setCameraPos=function(a){if(!(0<this._slerp)){var b=quat4.create(this._rotation);this._updateRotation(b);
this._rotation=quat4.create(b);this._currDiffY=this.diffY=this._currDiffX=this.diffX=0;this._isMouseDown=!1;this._isRotateZ=0;this._targetQuat=quat4.create(a);this._slerp=1}};a.resetQuat=function(){this._rotation=quat4.create([1,0,0,0]);this.tempRotation=quat4.create([0,0,0,0]);this._targetQuat=void 0;this._slerp=-1};a.update=function(){mat4.identity(this.m);void 0==this._targetQuat?(quat4.set(this._rotation,this.tempRotation),this._updateRotation(this.tempRotation)):(this._slerp+=0.05*(0-this._slerp),
0.0010>this._slerp?(quat4.set(this._targetQuat,this._rotation),this._targetQuat=void 0,this._slerp=-1):(quat4.set([0,0,0,0],this.tempRotation),quat4.slerp(this._targetQuat,this._rotation,this._slerp,this.tempRotation)));vec3.set([0,0,this._z],this._vZaxis);quat4.multiplyVec3(this.tempRotation,this._vZaxis);mat4.translate(this.m,this._vZaxis);this.matrix=quat4.toMat4(this.tempRotation);mat4.multiply(this.matrix,this.m)};a._updateRotation=function(a){if(this._isMouseDown&&!this._isLocked){this.diffX=
this.mouse.x-this.preMouse.x;this.diffY=-(this.mouse.y-this.preMouse.y);if(this._isInvert)this.diffX=-this.diffX;if(this._isInvert)this.diffY=-this.diffY}this._currDiffX+=(this.diffX-this._currDiffX)*this._easing;this._currDiffY+=(this.diffY-this._currDiffY)*this._easing;if(0<this._isRotateZ)if(1==this._isRotateZ)var b=-this._currDiffX*this._offset,b=b*(this.preMouse.y<this._rotateZMargin?-1:1),e=quat4.create([0,0,Math.sin(b),Math.cos(b)]);else b=-this._currDiffY*this._offset,b*=this.preMouse.x<this._rotateZMargin?
1:-1,e=quat4.create([0,0,Math.sin(b),Math.cos(b)]);else b=vec3.create([this._currDiffX,this._currDiffY,0]),e=vec3.create(),vec3.cross(b,this._zAxis,e),vec3.normalize(e),b=vec3.length(b)*this._offset,e=quat4.create([Math.sin(b)*e[0],Math.sin(b)*e[1],Math.sin(b)*e[2],Math.cos(b)]);quat4.multiply(a,e)}})();(function(){var a;Scene=function(){if(void 0!=GL)a=GL.gl,this._init()};var b=Scene.prototype;b._init=function(){this.camera=new CameraPersp;this.camera.setPerspective(45,window.innerWidth/window.innerHeight,5,3E3);var a=vec3.create([0,0,800]),b=vec3.create([0,0,0]),e=vec3.create([0,-1,0]);this.camera.lookAt(a,b,e);this.sceneRotation=new SceneRotation;this.rotationFront=mat4.create();mat4.identity(this.rotationFront);this.cameraOtho=new Camera;this._initTextures();this._initViews();window.addEventListener("resize",
this.resize.bind(this))};b._initTextures=function(){};b._initViews=function(){};b.loop=function(){this.update();this.render()};b.update=function(){a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);this.sceneRotation.update();GL.setMatrices(this.camera);GL.rotate(this.sceneRotation.matrix)};b.render=function(){};b.resize=function(){this.camera.setPerspective(45,window.innerWidth/window.innerHeight,5,3E3)}})();(function(){View=function(a,c){if(void 0!=a)this.shader=new GLShader(a,c),this._init()};var a=View.prototype;a._init=function(){};a.render=function(){}})();
(function(){ViewCopy=function(a,c){void 0==a&&(a="assets/shaders/copy.vert",c="assets/shaders/copy.frag");View.call(this,a,c)};var a=ViewCopy.prototype=new View;a._init=function(){var a=[],c=[];a.push([-1,-1,0]);a.push([1,-1,0]);a.push([1,1,0]);a.push([-1,1,0]);c.push([0,0]);c.push([1,0]);c.push([1,1]);c.push([0,1]);this.mesh=new Mesh(4,6,GL.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(c);this.mesh.bufferIndices([0,1,2,0,2,3])};a.render=function(a){this.shader.bind();this.shader.uniform("texture",
"uniform1i",0);a.bind(0);GL.draw(this.mesh)}})();(function(){var a;Framebuffer=function(b,d,e,f){if(GL)a=GL.gl,this.width=b,this.height=d,this.magFilter=void 0==e?a.LINEAR:e,this.minFilter=void 0==f?a.LINEAR:f,this._init()};var b=Framebuffer.prototype;b._init=function(){this.depthTextureExt=a.getExtension("WEBKIT_WEBGL_depth_texture");this.texture=a.createTexture();this.depthTexture=a.createTexture();this.glTexture=new GLTexture(this.texture,!0);this.glDepthTexture=new GLTexture(this.depthTexture,!0);this.frameBuffer=GL.gl.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,
this.frameBuffer);this.frameBuffer.width=this.width;this.frameBuffer.height=this.height;a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,this.magFilter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.minFilter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);this.magFilter==a.NEAREST&&this.minFilter==a.NEAREST?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.frameBuffer.width,this.frameBuffer.height,
0,a.RGBA,a.FLOAT,null):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.frameBuffer.width,this.frameBuffer.height,0,a.RGBA,a.UNSIGNED_BYTE,null);a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,this.depthTexture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);null!=this.depthTextureExt&&a.texImage2D(a.TEXTURE_2D,
0,a.DEPTH_COMPONENT,this.width,this.height,0,a.DEPTH_COMPONENT,a.UNSIGNED_SHORT,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);if(null==this.depthTextureExt){console.log("no depth texture");var b=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,b);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.frameBuffer.width,this.frameBuffer.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)}else a.framebufferTexture2D(a.FRAMEBUFFER,
a.DEPTH_ATTACHMENT,a.TEXTURE_2D,this.depthTexture,0);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null)};b.bind=function(){a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer)};b.unbind=function(){a.bindFramebuffer(a.FRAMEBUFFER,null)};b.getTexture=function(){return this.glTexture};b.getDepthTexture=function(){return this.glDepthTexture}})();(function(){Pass=function(a,c,d){if(void 0!=a)this.view="string"==typeof a?new ViewCopy("assets/shaders/copy.vert",a):a,this.width=void 0==c?512:c,this.height=void 0==d?512:d,this._init()};var a=Pass.prototype;a._init=function(){this.fbo=new Framebuffer(this.width,this.height);this.fbo.bind();GL.setViewport(0,0,this.fbo.width,this.fbo.height);GL.clear(0,0,0,0);this.fbo.unbind()};a.render=function(a){GL.setViewport(0,0,this.fbo.width,this.fbo.height);this.fbo.bind();GL.clear(0,0,0,0);this.view.render(a);
this.fbo.unbind();return this.fbo.getTexture()};a.getTexture=function(){return this.fbo.getTexture()}})();(function(){EffectComposer=function(){this._passes=[]};var a=EffectComposer.prototype=new Pass;a.addPass=function(a){this._passes.push(a)};a.render=function(a){this.texture=a;for(a=0;a<this._passes.length;a++)this.texture=this._passes[a].render(this.texture);return this.texture};a.getTexture=function(){return this.texture}})();(function(){function a(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("safari")&&!(-1<a.indexOf("chrome"))?!0:!1}function b(a,b,d,h){var i=a.createScriptProcessor(512);i.onaudioprocess=c;i.clipping=!1;i.lastClip=0;i.volume=0;i.clipLevel=b||0.98;i.averaging=d||0.95;i.clipLag=h||750;i.connect(a.destination);i.checkClipping=function(){if(!this.clipping)return!1;if(this.lastClip+this.clipLag<window.performance.now())this.clipping=!1;return this.clipping};i.shutdown=function(){this.disconnect();
this.onaudioprocess=null};return i}function c(a){for(var a=a.inputBuffer.getChannelData(0),b=a.length,c=0,d,i=0;i<b;i++){d=a[i];if(Math.abs(d)>=this.clipLevel)this.clipping=!0,this.lastClip=window.performance.now();c+=d*d}a=Math.sqrt(c/b);this.volume=Math.max(a,this.volume*this.averaging)}Microphone=function(){this.analyser=this.audioContext=void 0};var d=Microphone.prototype=new EventDispatcher;d.init=function(){if(a())console.debug("is safari"),this.dispatchCustomEvent("onMicroInit",{hasAudio:!1});
else{try{this.audioContext=new craicAudioContext}catch(b){console.debug("Web Audio API is not supported in this browser"),this.dispatchCustomEvent("onMicroInit",{hasAudio:void 0!=this.audioContext})}var c=this;try{navigator.getMedia({audio:!0},this.onStream.bind(this),function(){console.log("Error Getting media");c.dispatchCustomEvent("onMicroInit",{hasAudio:void 0!=this.audioContext})})}catch(d){console.debug("webkitGetUserMedia threw exception :"+d),this.dispatchCustomEvent("onMicroInit",{hasAudio:void 0!=
this.audioContext})}}};d.onStream=function(a){this.dispatchCustomEvent("onMicroInit",{hasAudio:void 0!=this.audioContext});a=this.audioContext.createMediaStreamSource(a);this.meter=b(this.audioContext);a.connect(this.meter);scheduler.addEF(this,this._loop,[])};d._loop=function(){var a=0,b=this.meter.volume;0.1<b&&(a=(b-0.1)/0.35,1<a&&(a=1),a=1-Math.cos(0.5*a*Math.PI),a=0.075*a*a);increase=0.25*a;params.targetAccOffset=0.0030+0.7*a;this.dispatchCustomEvent("onSound",{increase:increase})}})();(function(){ViewForce=function(){this.count=65535*Math.random();this.revealOffset=0.2;this.increase=0;View.call(this,"assets/shaders/copy.vert","assets/shaders/cal2.frag")};var a=ViewForce.prototype=new View;a._init=function(){var a=[],c=[],d=[0,1,2,0,2,3];a.push([-1,-1,0]);a.push([1,-1,0]);a.push([1,1,0]);a.push([-1,1,0]);c.push([0,0]);c.push([1,0]);c.push([1,1]);c.push([0,1]);this.mesh=new Mesh(a.length,d.length,GL.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(c);this.mesh.bufferIndices(d)};
a.reset=function(){this.revealOffset=0.2};a.render=function(a){this.shader.bind();this.shader.uniform("texture","uniform1i",0);this.shader.uniform("time","uniform1f",0.0010*this.count++);this.shader.uniform("velOffset","uniform1f",params.velOffset);this.shader.uniform("accOffset","uniform1f",params.accOffset);this.shader.uniform("posOffset","uniform1f",params.posOffset);this.shader.uniform("revealOffset","uniform1f",this.revealOffset);this.revealOffset+=0.5*this.increase;a.bind(0);GL.draw(this.mesh)}})();window.perlins=[];
(function(){ViewSave=function(a){this.particles=a;View.call(this,"assets/shaders/save.vert","assets/shaders/save.frag")};var a=ViewSave.prototype=new View;a._init=function(){for(var a=[],c=[],d=[],e=[],f=0,g=65535*Math.random(),h=Math.random(),i=Math.random(),j=0;j<this.particles.length;j++){var k=this.particles[j],m=Math.sqrt((h-k.u)*(h-k.u)+(i-k.v)*(i-k.v)),m=0.5*Perlin.noise(10*k.u,10*k.v,g)+m;a.push([k.u-1,k.v-1,0]);d.push([0,0]);e.push(f);c.push([k.u,0.05,k.v]);a.push([k.u-1,k.v,0]);d.push([0,
0]);e.push(f);c.push([k.fixed?0:0.3+0.7*Math.random(),0.95*Math.random()+0.5,m]);f++}this.mesh=new Mesh(a.length,e.length,GL.gl.POINTS);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(d);this.mesh.bufferIndices(e);this.mesh.bufferData(c,"aVertexColor",3)};a.updateParticles=function(a){this.particles=a;var a=[],c=65535*Math.random(),d=Math.random(),e=Math.random(),f=3<=window.perlins.length;perlin=f?window.perlins[Math.floor(3*Math.random())]:[];for(var g,h=0;h<this.particles.length;h++){var i=
this.particles[h],j=Math.sqrt((d-i.u)*(d-i.u)+(e-i.v)*(e-i.v));f?g=perlin[h]:(g=0.5*Perlin.noise(10*i.u,10*i.v,c),perlin.push(g));g+=j;a.push([i.u,0.05,i.v]);a.push([i.fixed?0:0.3+0.7*Math.random(),0.95*Math.random()+0.5,g])}f||window.perlins.push(perlin);this.mesh.bufferData(a,"aVertexColor",3)};a.render=function(){this.shader.bind();GL.draw(this.mesh)}})();(function(){ViewCard=function(){this.z=this.y=this.x=this.alpha=0;View.call(this,"assets/shaders/card.vert","assets/shaders/card.frag")};var a=ViewCard.prototype=new View;a._init=function(){var a=[],c=[],d=[],e=[],f=0,g=1024/896;a.push([-111,-117,126/g]);a.push([141,-117,126/g]);a.push([141,-117,-126/g]);a.push([-111,-117,-126/g]);c.push([1,1]);c.push([0,1]);c.push([0,0]);c.push([1,0]);d.push([1,1,1]);d.push([1,1,1]);d.push([1,1,1]);d.push([1,1,1]);e.push(4*f+0);e.push(4*f+1);e.push(4*f+3);e.push(4*
f+1);e.push(4*f+2);e.push(4*f+3);f++;a.push([141,-117,126/g]);a.push([-111,-117,126/g]);a.push([-111,-118,126/g]);a.push([141,-118,126/g]);c.push([0.1,0.1]);c.push([0.05,0.1]);c.push([0.05,0.05]);c.push([0.1,0.05]);d.push([0.8,0.8,0.8]);d.push([0.8,0.8,0.8]);d.push([0.8,0.8,0.8]);d.push([0.8,0.8,0.8]);e.push(4*f+0);e.push(4*f+1);e.push(4*f+3);e.push(4*f+1);e.push(4*f+2);e.push(4*f+3);f++;a.push([141,-117,-126/g]);a.push([141,-117,126/g]);a.push([141,-118,126/g]);a.push([141,-118,-126/g]);c.push([0.1,
0.1]);c.push([0.05,0.1]);c.push([0.05,0.05]);c.push([0.1,0.05]);d.push([0.9,0.9,0.9]);d.push([0.9,0.9,0.9]);d.push([0.9,0.9,0.9]);d.push([0.9,0.9,0.9]);e.push(4*f+0);e.push(4*f+1);e.push(4*f+3);e.push(4*f+1);e.push(4*f+2);e.push(4*f+3);f++;a.push([-111,-117,-126/g]);a.push([141,-117,-126/g]);a.push([141,-118,-126/g]);a.push([-111,-118,-126/g]);c.push([0.1,0.1]);c.push([0.05,0.1]);c.push([0.05,0.05]);c.push([0.1,0.05]);d.push([0.8,0.8,0.8]);d.push([0.8,0.8,0.8]);d.push([0.8,0.8,0.8]);d.push([0.8,0.8,
0.8]);e.push(4*f+0);e.push(4*f+1);e.push(4*f+3);e.push(4*f+1);e.push(4*f+2);e.push(4*f+3);f++;a.push([-111,-117,126/g]);a.push([-111,-117,-126/g]);a.push([-111,-118,-126/g]);a.push([-111,-118,126/g]);c.push([0.1,0.1]);c.push([0.05,0.1]);c.push([0.05,0.05]);c.push([0.1,0.05]);d.push([0.9,0.9,0.9]);d.push([0.9,0.9,0.9]);d.push([0.9,0.9,0.9]);d.push([0.9,0.9,0.9]);e.push(4*f+0);e.push(4*f+1);e.push(4*f+3);e.push(4*f+1);e.push(4*f+2);e.push(4*f+3);f++;a.push([141,-118,126/g]);a.push([-111,-118,126/g]);
a.push([-111,-118,-126/g]);a.push([141,-118,-126/g]);c.push([0.1,0.1]);c.push([0.05,0.1]);c.push([0.05,0.05]);c.push([0.1,0.05]);d.push([1,1,1]);d.push([1,1,1]);d.push([1,1,1]);d.push([1,1,1]);e.push(4*f+0);e.push(4*f+1);e.push(4*f+3);e.push(4*f+1);e.push(4*f+2);e.push(4*f+3);this.mesh=new Mesh(a.length,e.length,GL.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(c);this.mesh.bufferIndices(e);this.mesh.bufferData(d,"aVertexColor",3)};a.render=function(a){this.shader.isReady()&&(this.shader.bind(),
this.shader.uniform("position","uniform3fv",[this.x,this.y,this.z]),this.shader.uniform("texture","uniform1i",0),this.shader.uniform("alpha","uniform1f",this.alpha),a.bind(0),GL.draw(this.mesh))};a.intro=function(){this.tweenPos&&TWEEN.remove(this.tweenPos);this.x=200;this.y=-500;this.z=500;this.alpha=0;this.tweenPos=(new TWEEN.Tween(this)).to({x:0,y:0,z:0,alpha:1},params.openingDuration).easing(TWEEN.Easing.Sinusoidal.Out).start()};a.outro=function(){this.tweenPos&&TWEEN.remove(this.tweenPos);this.tweenPos=
(new TWEEN.Tween(this)).to({x:-100,y:-800,z:-500,alpha:0},params.closingDuration).easing(TWEEN.Easing.Sinusoidal.In).start()}})();(function(){ViewRender=function(a){this.alpha=1;this.z=this.y=this.x=0;this.particles=a;View.call(this,"assets/shaders/map.vert","assets/shaders/map.frag")};var a=ViewRender.prototype=new View;a._init=function(){for(var a=[],c=[],d=[],e=[],f=[],g=0;g<this.particles.length;g++){a.push([0,0,0]);var h=this.particles[g];c.push([0.5*h.u,0.5*h.v]);d.push(g);e.push([h.fixed?0:1,0.9*Math.random()+0.1,0]);f.push([h.r,h.g,h.b,h.a])}this.mesh=new Mesh(a.length,d.length,GL.gl.POINTS);this.mesh.bufferVertex(a);
this.mesh.bufferTexCoords(c);this.mesh.bufferIndices(d);this.mesh.bufferData(f,"aVertexColor",4)};a.render=function(a){this.shader.bind();this.shader.uniform("texture","uniform1i",0);this.shader.uniform("position","uniform3fv",[this.x,this.y,this.z]);this.shader.uniform("opacity","uniform1f",this.alpha);a.bind(0);GL.draw(this.mesh)};a.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.alpha=a.alpha}})();(function(){ViewBlur=function(a){View.call(this,"assets/shaders/copy.vert",a);this.blur=1/512};var a=ViewBlur.prototype=new View;a._init=function(){var a=[],c=[],d=[0,1,2,0,2,3];a.push([-1,-1,0]);a.push([1,-1,0]);a.push([1,1,0]);a.push([-1,1,0]);c.push([0,0]);c.push([1,0]);c.push([1,1]);c.push([0,1]);this.mesh=new Mesh(a.length,d.length,GL.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(c);this.mesh.bufferIndices(d)};a.render=function(a){this.shader.bind();this.shader.uniform("blur",
"uniform1f",this.blur);this.shader.uniform("texture","uniform1i",0);a.bind(0);GL.draw(this.mesh)}})();(function(){ViewBg=function(a,c){void 0==a&&(a="assets/shaders/copy.vert",c="assets/shaders/copy.frag");this.alpha=0;View.call(this,a,c)};var a=ViewBg.prototype=new View;a._init=function(){var a=[],c=[];a.push([-1,-1,0]);a.push([1,-1,0]);a.push([1,1,0]);a.push([-1,1,0]);c.push([0,0]);c.push([1,0]);c.push([1,1]);c.push([0,1]);this.mesh=new Mesh(4,6,GL.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(c);this.mesh.bufferIndices([0,1,2,0,2,3])};a.render=function(a){this.shader.isReady()&&
(this.shader.bind(),this.shader.uniform("alpha","uniform1f",this.alpha),this.shader.uniform("texture","uniform1i",0),a.bind(0),GL.draw(this.mesh))}})();
(function(){ViewShadow=function(a,c){void 0==a&&(a="assets/shaders/copy.vert",c="assets/shaders/shadow.frag");this.alpha=0;View.call(this,a,c)};var a=ViewShadow.prototype=new View;a._init=function(){var a=[],c=[];a.push([-1,-1,0.5]);a.push([1,-1,0.5]);a.push([1,1,0.5]);a.push([-1,1,0.5]);c.push([0,0]);c.push([1,0]);c.push([1,1]);c.push([0,1]);this.mesh=new Mesh(4,6,GL.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(c);this.mesh.bufferIndices([0,1,2,0,2,3])};a.render=function(a){this.shader.isReady()&&
(this.shader.bind(),this.shader.uniform("alpha","uniform1f",this.alpha),this.shader.uniform("texture","uniform1i",0),a.bind(0),GL.draw(this.mesh))}})();(function(){SceneSand=function(a){this.particles=a;Scene.call(this);this.camera.setPerspective(45,window.innerWidth/window.innerHeight,5,5E3);GL.gl.disable(GL.gl.DEPTH_TEST);this._isClosing=this._isCardReady=this.hasCard=this.hasSaved=!1};var a=SceneSand.prototype=new Scene;a._initTextures=function(){this.texBg=new GLTexture(images.bg);this.texCard=new GLTexture(images.card);this.fboCurrent=new Framebuffer(1024,1024,GL.gl.NEAREST,GL.gl.NEAREST);this.fboTarget=new Framebuffer(1024,1024,GL.gl.NEAREST,
GL.gl.NEAREST);this.fboCard=new Framebuffer(512,512)};a._initViews=function(){this._vCopy=new ViewCopy;this._vShadow=new ViewShadow;this._hBlur=new ViewBlur("assets/shaders/HBlur.frag");this._passHBlur=new Pass(this._hBlur,512,512);this._vBlur=new ViewBlur("assets/shaders/VBlur.frag");this._passVBlur=new Pass(this._vBlur,512,512);this._composer=new EffectComposer;this._composer.addPass(this._passHBlur);this._composer.addPass(this._passVBlur);scheduler.defer(this,this.createBg,[]);scheduler.defer(this,
this.createForce,[]);scheduler.defer(this,this.createCard,[])};a.createForce=function(){this._vCal=new ViewForce};a.createCard=function(){this._vCard=new ViewCard};a.createBg=function(){this._vBg=new ViewBg("assets/shaders/copy.vert","assets/shaders/copyWithAlpha.frag");(new TWEEN.Tween(this._vBg)).to({alpha:1},3E3).easing(TWEEN.Easing.Cubic.In).start()};a.setImagesData=function(a){this.particles=a;this.hasCard?this._hideCard():this._showCard()};a.toHide=function(){this._isClosing=!0};a._hideCard=
function(){this._vCard.outro();this.sceneRotation.setCameraPos([0.7958,0.195,-0.2651,-0.5083]);scheduler.delay(this,this._showCard,[],params.closingDuration)};a._showCard=function(){this._isClosing=this._isCardReady=this.hasSaved=!1;void 0==this._vSave?this._vSave=new ViewSave(this.particles):this._vSave.updateParticles(this.particles);if(void 0==this._vRender)this._vRender=new ViewRender(this.particles);this._vCal.reset();this._isCardReady=this.hasCard=!0;this._vCard.intro();this.sceneRotation.resetQuat();
this.sceneRotation.setCameraPos([0.9657,0.0065,-0.2068,-0.1566])};a.isCardReady=function(){return this._isClosing?!1:this._isCardReady};a.setIncrease=function(a){if(this._vCal)this._vCal.increase=a};a.render=function(){params.accOffset+=0.25*(params.targetAccOffset-params.accOffset);params.posOffset+=0.25*(params.targetPosOffset-params.posOffset);GL.gl.disable(GL.gl.DEPTH_TEST);!this.hasSaved&&this._isCardReady?(this.fboCurrent.bind(),GL.gl.viewport(0,0,this.fboCurrent.width,this.fboCurrent.height),
GL.clear(0.5,0.5,0.5,1),GL.setMatrices(this.cameraOtho),GL.rotate(this.rotationFront),this._vSave.render(),this.fboCurrent.unbind(),this.fboTarget.bind(),GL.clear(0.5,0.5,0.5,1),this.fboTarget.unbind(),GL.gl.viewport(0,0,window.innerWidth,window.innerHeight),this.hasSaved=!0):(this._isCardReady&&(GL.gl.viewport(0,0,this.fboCurrent.width,this.fboCurrent.height),GL.setMatrices(this.cameraOtho),GL.rotate(this.rotationFront),this.fboTarget.bind(),GL.clear(0.5,0.5,0.5,1),this._vCal.render(this.fboCurrent.getTexture()),
this.fboTarget.unbind()),GL.gl.viewport(0,0,window.innerWidth,window.innerHeight),GL.clear(0,0,0,0),GL.setMatrices(this.cameraOtho),GL.rotate(this.rotationFront),this._vBg&&this._vBg.render(this.texBg),this._vCard&&0<this._vCard.alpha&&(GL.setMatrices(this.camera),GL.rotate(this.sceneRotation.matrix),GL.gl.viewport(0,0,this.fboCard.width,this.fboCard.height),this.fboCard.bind(),GL.clear(0,0,0,0),this._vCard.render(this.texCard),this.fboCard.unbind(),GL.gl.viewport(0,0,512,512),GL.setMatrices(this.cameraOtho),
GL.rotate(this.rotationFront),this._composer.render(this.fboCard.getTexture()),GL.gl.viewport(0,0,window.innerWidth,window.innerHeight),this._vShadow.render(this._composer.getTexture())),this._isCardReady&&(GL.gl.enable(GL.gl.DEPTH_TEST),GL.setMatrices(this.camera),GL.rotate(this.sceneRotation.matrix),this._vCard.render(this.texCard),this._vRender.copy(this._vCard),this._vRender.render(this.fboTarget.getTexture()),this.swapFbos()))};a.swapFbos=function(){var a=this.fboTarget;this.fboTarget=this.fboCurrent;
this.fboCurrent=a}})();var main,scheduler,gui,images,params={offset:0,posOffset:2.5,targetPosOffset:2.5,velOffset:0.02,accOffset:0.0030,targetAccOffset:0.0030,timeOffset:0.0010,decreaseRate:0.9963,showForceMap:!1,showMap:!1,openingDuration:1500,closingDuration:1E3};
function init(){scheduler=new Scheduler;(new SimpleImageLoader).load("assets/bg.jpg,assets/card.jpg,assets/image0.jpg,assets/image1.jpg,assets/image2.jpg,assets/image3.jpg,assets/image4.jpg,assets/image5.jpg,assets/gold.jpg".split(","),this,this.onImageLoaded)}function onImageLoaded(a){images=a;main=new Main}window.craicAudioContext=function(){return window.webkitAudioContext||window.AudioContext}();
navigator.getMedia=navigator.mozGetUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia;function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}
(function(){Main=function(){this._init()};var a=Main.prototype;a._init=function(){this._canvas=document.createElement("canvas");document.body.appendChild(this._canvas);this._canvas.width=window.innerWidth;this._canvas.height=window.innerHeight;this._imageDatas=[];this._needCheckProgress=!1;this._images=[];GL.init(this._canvas);this.start();this.parseImages();this.scene=new SceneSand;this._btnRestart=document.body.querySelector(".btn_restart");this._btnRestart.addEventListener("click",this.playNextImage.bind(this));
this._msgLoading=document.body.querySelector(".msg_loading");this._msgBlowing=document.body.querySelector(".msg_blowing");this._microHint=document.body.querySelector(".micro_hint");this._message=this._msgBlowing;this._micro=new Microphone;this._micro.addEventListener("onMicroInit",this._onMicroInit.bind(this));this._micro.init();ElementUtils.addClass(this._msgLoading,"show");window.addEventListener("keypress",this._onKeyPress.bind(this));window.addEventListener("keyup",this._onKeyUp.bind(this))};
a._onMicroInit=function(a){ElementUtils.addClass(this._microHint,"hide");console.log("Has Audio : ",a.detail.hasAudio);a.detail.hasAudio&&this._micro.addEventListener("onSound",this._onSound.bind(this))};a._onSound=function(a){a=a.detail.increase;this.scene.setIncrease(a);params.targetPosOffset=2.5+150*a;this.scene.isCardReady()&&0<a&&(ElementUtils.removeClass(this._msgBlowing,"show"),scheduler.delay(this,this.showRestartButton,[],1E3))};a._onKeyPress=function(a){if(32==a.charCode)params.targetAccOffset=
0.05,params.targetPosOffset=5.5,increase=0.0125,this.scene.setIncrease(increase),ElementUtils.removeClass(this._message,"show"),scheduler.delay(this,this.showRestartButton,[],1E3)};a.showRestartButton=function(){ElementUtils.hasClass(this._btnRestart,"show")||ElementUtils.addClass(this._btnRestart,"show")};a.hideRestartButton=function(){ElementUtils.removeClass(this._btnRestart,"show")};a._onKeyUp=function(){this.scene.setIncrease(0);params.targetAccOffset=0.0030;params.targetPosOffset=2.5};a.parseImages=
function(){var a=images.gold,c=document.createElement("canvas");c.width=a.width;c.height=a.height;c=c.getContext("2d");c.drawImage(a,0,0);this.pixelsGold=c.getImageData(0,0,a.width,a.height).data;for(a=0;void 0!=images["image"+a];)this._images.push(images["image"+a]),a++;scheduler.delay(this,this.playNextImage,[],4E3)};a.getImageData=function(a){if(void 0!=a.particleData)return a.particleData;var c=document.createElement("canvas");c.width=a.width;c.height=a.height;c=c.getContext("2d");c.drawImage(a,
0,0);for(var c=c.getImageData(0,0,a.width,a.height).data,d=[],e=this.pixelsGold,f=0;f<c.length;f+=4){var g=f/4,h=g%512-256,i=Math.floor(g/512)-256;d.push({x:h,y:i,u:-h/512+0.5,v:1-(i/512+0.5),r:e[f]/255,g:e[f+1]/255,b:e[f+2]/255,a:1,fixed:220>c[4*g]})}return a.particleData=d};a._onImageDataParsed=function(){scheduler.delay(this,this.playNextImage,[],4E3)};a.playNextImage=function(){this.hideRestartButton();ElementUtils.removeClass(this._message,"show");ElementUtils.addClass(this._msgLoading,"show");
this._needCheckProgress=!0;this.scene.toHide();scheduler.delay(this,this.toPlayNextImg,[],500)};a.toPlayNextImg=function(){this.scene.setImagesData(this.getImageData(this._images[Math.floor(Math.random()*this._images.length)]))};a.start=function(){scheduler.addEF(this,this.render,[])};a.render=function(){this.scene.loop();TWEEN.update();if(this._needCheckProgress&&this.scene.isCardReady())this._needCheckProgress=!1,ElementUtils.removeClass(this._msgLoading,"show"),scheduler.delay(this,this.showHint,
[],params.openingDuration)};a.showHint=function(){ElementUtils.addClass(this._message,"show")}})();
