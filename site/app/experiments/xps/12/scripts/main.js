var BikeControls,__bind=function(a,b){return function(){return a.apply(b,arguments)}};BikeControls=function(){function a(a,b){this.object=a,this.initialSpeed=null!=b?b:0,this.update=__bind(this.update,this),this.onKeyUp=__bind(this.onKeyUp,this),this.onKeyDown=__bind(this.onKeyDown,this),this.reset=__bind(this.reset,this),this.keyFlags=0,this.velocity=new THREE.Vector3,this.movement=new THREE.Vector3,this.euler=new THREE.Euler,this.quaternion=new THREE.Quaternion,this.angleEuler=new THREE.Euler,this.angleQuaternion=new THREE.Quaternion,this.currentVelocity=this.velocity.clone(),this.speed=0,this.groundRefY=this.object.position.y,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}var b,c,d,e,f,g,h,i;return c=1,f=2,d=4,b=8,e=16,i=3,h=new THREE.Vector3(.01,.05,.01),g=-.81,a.prototype.reset=function(){this.keyFlags=0},a.prototype.onKeyDown=function(a){32===a.keyCode?this.keyFlags|=e:37===a.keyCode||65===a.keyCode?this.keyFlags|=c:38===a.keyCode||87===a.keyCode?this.keyFlags|=f:39===a.keyCode||68===a.keyCode?this.keyFlags|=d:(40===a.keyCode||83===a.keyCode)&&(this.keyFlags|=b)},a.prototype.onKeyUp=function(a){32===a.keyCode?this.keyFlags&=31-e:37===a.keyCode||65===a.keyCode?this.keyFlags&=31-c:38===a.keyCode||87===a.keyCode?this.keyFlags&=31-f:39===a.keyCode||68===a.keyCode?this.keyFlags&=31-d:(40===a.keyCode||83===a.keyCode)&&(this.keyFlags&=31-b)},a.prototype.update=function(a){this.keyFlags&d&&(this.euler.z+=h.z*a),this.keyFlags&c&&(this.euler.z-=h.z*a),this.keyFlags&d||this.keyFlags&c||(this.euler.z=0),this.velocity.set(0,0,this.initialSpeed*a),this.keyFlags&f&&(this.velocity.z+=i*a),this.keyFlags&b&&(this.velocity.z-=i*a),this.keyFlags&e?this.angleEuler.x-=h.x*a:this.object.position.y>this.groundRefY+20?(this.angleEuler.x%=2*Math.PI,this.angleEuler.x+=h.x*a):this.angleEuler.x=0,this.angleEuler.x>1&&(this.angleEuler.x=1),this.keyFlags&d&&(this.euler.y-=h.y*a),this.keyFlags&c&&(this.euler.y+=h.y*a),this.angleQuaternion.setFromEuler(this.angleEuler),this.quaternion.setFromEuler(this.euler),this.quaternion.multiply(this.angleQuaternion),this.object.quaternion.slerp(this.quaternion,.1*a),this.velocity.applyQuaternion(this.object.quaternion),this.currentVelocity.lerp(this.velocity,.1*a),this.object.position.y<this.groundRefY&&(this.object.position.y=this.groundRefY),this.object.position.y<this.groundRefY?this.object.position.y+=.1*(this.groundRefY-this.object.position.y)*a:this.object.position.y>this.groundRefY&&(this.velocity.y+=g),this.object.position.add(this.currentVelocity)},a}();var CameraControls,__bind=function(a,b){return function(){return a.apply(b,arguments)}};CameraControls=function(){function a(a,b){this.camera=a,this.object=b,this.update=__bind(this.update,this),this.offsetQuaternion=new THREE.Quaternion,this.offsetQuaternion.setFromEuler(new THREE.Euler(0,Math.PI,0)),this.tempQuaternion=new THREE.Quaternion,this.offsetAxis=new THREE.Vector3(0,4,10),this.tempOffsetAxis=new THREE.Vector3,this.tempPosition=new THREE.Vector3}return a.prototype.update=function(a){this.tempQuaternion.copy(this.object.quaternion),this.tempQuaternion.multiply(this.offsetQuaternion),this.camera.quaternion.slerp(this.tempQuaternion,.1*a),this.tempOffsetAxis.copy(this.offsetAxis),this.tempOffsetAxis.applyQuaternion(this.camera.quaternion),this.tempPosition.copy(this.object.position),this.tempPosition.add(this.tempOffsetAxis),this.camera.position.lerp(this.tempPosition,.2*a)},a}();var WorldShader;WorldShader=function(){function a(){this.uniforms={uResolution:{type:"v2",value:new THREE.Vector2},uNear:{type:"f",value:0},uFar:{type:"f",value:0},uFov:{type:"f",value:0},uTime:{type:"f",value:0},uProgress:{type:"f",value:0},uDirectionHotness:{type:"f",value:0},uLightPosition:{type:"v3",value:new THREE.Vector3},uSounds:{type:"fv1",value:[0,0,0,0,0]},uModelViewMatrix:{type:"m4",value:new THREE.Matrix4},uProjectionMatrix:{type:"m4",value:new THREE.Matrix4},uNoiseTexture:{type:"t",value:null}},this.vertexShader=document.querySelector("#world-shader-vertex").textContent,this.fragmentShader=[document.querySelector("#world-shader-fragment").textContent].join("\n")}return a}();var MixDepthShader;MixDepthShader=function(){function a(){this.uniforms={uTexture:{type:"t",value:null},uTextureDepth:{type:"t",value:null},uTextureAlphaDepth:{type:"t",value:null}},this.vertexShader=document.querySelector("#mix-depth-shader-vertex").textContent,this.fragmentShader=document.querySelector("#mix-depth-shader-fragment").textContent}return a}();var Bear,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Bear=function(a){function b(a){this.mesh=a,this.update=__bind(this.update,this),b.__super__.constructor.call(this),this.isLoaded=!1,this.prevTime=0,this.mesh=null,this.animation=null,this.loader=new THREE.JSONLoader,this.loader.load("models/bearBlack.js",function(a){return function(b){a.mesh=new THREE.MorphAnimMesh(b,new THREE.MeshPhongMaterial({color:14518408,morphTargets:!0})),a.add(a.mesh),a.isLoaded=!0,a.prevTime=Date.now()}}(this))}return __extends(b,a),b.prototype.update=function(){var a;this.isLoaded&&(a=Date.now(),this.mesh.updateAnimation(a-this.prevTime),this.prevTime=a)},b}(THREE.Object3D);var Bike,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Bike=function(a){function b(){var a;b.__super__.constructor.call(this),a=new THREE.JSONLoader,a.load("models/bike.json",function(b){return function(c,d){var e;e=new THREE.Mesh(c,new THREE.MeshFaceMaterial(d)),b.add(e),a.load("models/santa.json",function(a,c){b.santa=new THREE.Mesh(a,new THREE.MeshFaceMaterial(c)),b.add(b.santa)})}}(this))}return __extends(b,a),b.prototype.update=function(){this.santa&&(this.santa.rotation.z+=.2*-this.santa.rotation.z,this.santa.quaternion.slerp(this.quaternion,.2),this.santa.rotation.x=0,this.santa.rotation.y=0,Math.abs(this.santa.rotation.z)>.5&&(this.santa.rotation.z=this.santa.rotation.z<0?-.5:.5))},b}(THREE.Object3D);var Gift,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Gift=function(a){function b(){this.open=__bind(this.open,this);var a;b.__super__.constructor.call(this),this.opened=!1,a=new THREE.JSONLoader,a.load("models/gift2.json",function(a){return function(b,c){var d;d=new THREE.Mesh(b,new THREE.MeshFaceMaterial(c)),d.scale.set(15,15,15),a.add(d)}}(this))}return __extends(b,a),b.prototype.open=function(){TweenLite.to(this.scale,.5,{x:.2,y:.2,z:.2}),TweenLite.to(this.scale,.2,{x:20,y:20,z:20,delay:1}),this.opened=!0},b}(THREE.Object3D);var Tree,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Tree=function(a){function b(){var a;b.__super__.constructor.call(this),a=new THREE.JSONLoader,a.load("models/Tree.json",function(a){return function(b){var c;c=new THREE.Mesh(b,new THREE.MeshPhongMaterial({color:16777215})),a.add(c)}}(this))}return __extends(b,a),b}(THREE.Object3D);var SoundsMatrix,__bind=function(a,b){return function(){return a.apply(b,arguments)}};SoundsMatrix=function(){function a(a){var b,c,d;for(this.debugMode=a,this.onSoundLoad=__bind(this.onSoundLoad,this),this.toggleSoundAt=__bind(this.toggleSoundAt,this),this.setSoundAt=__bind(this.setSoundAt,this),this.removeSoundAt=__bind(this.removeSoundAt,this),this.setVolume=__bind(this.setVolume,this),this.volumeFade=__bind(this.volumeFade,this),this.loadSound=__bind(this.loadSound,this),this.width=64,this.height=0,this.volume=1,this.matrix=[],b=c=0,d=this.width;d>=0?d>c:c>d;b=d>=0?++c:--c)this.matrix[b]=[];this.onLoad=new signals.Signal,this.onProgress=new signals.Signal,this.context=new AudioContext,this.sounds=[],this.analysers=[],this.byteFrequenciesData=[],this.soundIds={},this.soundsLoaded=0,this.debugMode&&(this.CELL_SIZE=4,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width*this.CELL_SIZE,this.canvas.style.position="absolute",this.canvas.style.top=this.canvas.style.left=0,document.body.appendChild(this.canvas))}return a.prototype.COLORS=["red","green","blue","yellow","pink","cyan","magenta","gold","red","green","blue","yellow","pink","cyan","magenta","gold"],a.prototype.loadSound=function(a,b,c){var d,e,f,g,h,i,j,k;if(null==b&&(b=.5),null==c&&(c=!0),null==this.soundIds[a]){for(e=new Audio,g=Modernizr.audio.mp3?"mp3":"ogg",e.src="sounds/"+a+"."+g,e.addEventListener("canplaythrough",this.onSoundLoad),e.id=a,e.volume=b,this.sounds.push(e),c&&(d=this.context.createAnalyser(),d.fftSize=32,f=new Uint8Array(d.frequencyBinCount),i=this.context.createMediaElementSource(e),i.connect(d),d.connect(this.context.destination),this.analysers.push(d),this.byteFrequenciesData.push(f)),this.soundIds[a]=this.height,this.height=this.sounds.length,h=j=0,k=this.width;k>=0?k>j:j>k;h=k>=0?++j:--j)this.matrix[h][this.height-1]=!1;this.debugMode&&(this.canvas.height=this.height*this.CELL_SIZE)}},a.prototype.volumeFade=function(a){TweenLite.to(this,1,{volume:a,onUpdate:this.setVolume})},a.prototype.setVolume=function(){var a,b,c,d;for(d=this.sounds,b=0,c=d.length;c>b;b++)a=d[b],a.volume=this.volume},a.prototype.removeSoundAt=function(a,b){var c,d,e,f;for(d=this.soundIds[a],e=0,f=b.length;f>e;e++)c=b[e],this.matrix[c][d]=!1},a.prototype.setSoundAt=function(a,b){var c,d,e,f;for(d=this.soundIds[a],e=0,f=b.length;f>e;e++)c=b[e],this.matrix[c][d]=!0},a.prototype.toggleSoundAt=function(a,b){var c,d,e,f;for(d=this.soundIds[a],e=0,f=b.length;f>e;e++)c=b[e],this.matrix[c][d]=!this.matrix[c][d]},a.prototype.update=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(k=this.analysers,c=f=0,j=k.length;j>f;c=++f)b=k[c],b.getByteFrequencyData(this.byteFrequenciesData[c]);if(a=Date.now()%15e3/15e3,e=Math.floor(a*this.width),e!==this.playbackPosition){for(this.playbackPosition=e,c=g=0,l=this.height;l>=0?l>g:g>l;c=l>=0?++g:--g)this.matrix[this.playbackPosition][c]&&(this.sounds[c].currentTime=0,this.sounds[c].play());if(this.debugMode)for(this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="rgba(0, 0, 0, .5)",this.ctx.fillRect(a*this.canvas.width,0,this.CELL_SIZE,this.canvas.height),c=h=0,m=this.width;m>=0?m>h:h>m;c=m>=0?++h:--h)for(d=i=0,n=this.height;n>=0?n>i:i>n;d=n>=0?++i:--i)this.matrix[c][d]&&(this.ctx.fillStyle=this.COLORS[d],this.ctx.fillRect(c*this.CELL_SIZE,d*this.CELL_SIZE,this.CELL_SIZE,this.CELL_SIZE))}},a.prototype.onSoundLoad=function(){var a;this.soundsLoaded++,a=this.soundsLoaded/this.sounds.length,this.onProgress.dispatch(a),1===a&&this.onLoad.dispatch()},a}();var ProgressionHandler,__bind=function(a,b){return function(){return a.apply(b,arguments)}};ProgressionHandler=function(){function a(a,b,c){this.gifts=a,this.object=b,this.soundsMatrix=c,this.update=__bind(this.update,this),this.gotoLevel=__bind(this.gotoLevel,this),this.onKeyDown=__bind(this.onKeyDown,this),this.onChangeLevel=new signals.Signal,this.direction=new THREE.Vector3,this.objectDirection=new THREE.Vector3,this.hotness=0,this.level=0,this.progress=0,this.grabbedGift=null,window.addEventListener("keydown",this.onKeyDown)}return a.prototype.onKeyDown=function(a){var b;49<=(b=a.keyCode)&&57>=b?this.gotoLevel(a.keyCode-48):69===a.keyCode&&this.gotoLevel(this.level+1)},a.prototype.gotoLevel=function(a){this.level=a,this.onChangeLevel.dispatch(a)},a.prototype.update=function(a){var b,c,d,e;if(this.progress+=(this.level-this.progress)*Math.max(.1*a),this.grabbedGift)return this.grabbedGift.scale.x+=.8*(.1-this.grabbedGift.scale.x),this.grabbedGift.scale.y+=.8*(.1-this.grabbedGift.scale.y),this.grabbedGift.scale.z+=.8*(.1-this.grabbedGift.scale.z),this.grabbedGift.position.lerp(this.object.position,.5*a),this.grabbedGift.position.y+=3,this.grabbedGift.rotation.x+=.08,this.grabbedGift.rotation.y+=.06,this.grabbedGift.rotation.z+=.1,void(this.soundsMatrix.playbackPosition%16===15&&(this.grabbedGift.open(),this.grabbedGift=null,this.gotoLevel(this.level+1)));if(this.gifts.length)for(this.direction.subVectors(this.gifts[0].position,this.object.position).normalize(),this.objectDirection.set(0,0,1).applyQuaternion(this.object.quaternion),this.hotness=(this.direction.dot(this.objectDirection)+1)/2,e=this.gifts,c=0,d=e.length;d>c;c++)if(b=e[c],b.rotation.x+=.02,b.rotation.y+=.04,b.rotation.z+=.06,this.object.position.distanceTo(b.position)<100){this.gifts.splice(this.gifts.indexOf(b),1),this.grabbedGift=b;break}},a}();var World,__bind=function(a,b){return function(){return a.apply(b,arguments)}};World=function(){function a(a){this.canvas=a,this.update=__bind(this.update,this),this.resize=__bind(this.resize,this),this.onPointerMove=__bind(this.onPointerMove,this),this.onProgressionChangeLevel=__bind(this.onProgressionChangeLevel,this),this.initComposer=__bind(this.initComposer,this),this.addLights=__bind(this.addLights,this),this.addGifts=__bind(this.addGifts,this),this.addObjects=__bind(this.addObjects,this),this.stop=__bind(this.stop,this),this.start=__bind(this.start,this),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,this.canvas.offsetWidth/this.canvas.offsetHeight,.1,1e3),this.raf=null,this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,alpha:!0}),this.pointer={x:0,y:0},this.deltaTimesSum=0,this.deltaTimesNumber=0,this.onChangeLevel=new signals.Signal,this.quality=.5,this.soundsMatrix=new SoundsMatrix,this.soundsMatrix.loadSound("HO_BeatE128-17",.2,!1),this.soundsMatrix.loadSound("HO_FilPiano128E-02"),this.soundsMatrix.loadSound("HO_Chi Lead128E-04"),this.soundsMatrix.loadSound("HO_BrokeBass128B-05"),this.soundsMatrix.loadSound("HO_MesBass128C-05"),this.soundsMatrix.loadSound("HO_Chi Lead128E-01"),this.bike=new Bike,this.bike.position.y=10,this.camera.position.y=10,this.scene.add(this.bike),this.bikeControls=new BikeControls(this.bike,4),b?(this.camera.position.z=50,this.cameraControls=new THREE.TrackballControls(this.camera)):this.cameraControls=new CameraControls(this.camera,this.bike),this.initComposer(),this.addLights(),this.addObjects(),this.progressionHandler=new ProgressionHandler(this.addGifts(),this.bike,this.soundsMatrix),this.progressionHandler.onChangeLevel.add(this.onProgressionChangeLevel),this.resize(),window.addEventListener("resize",this.resize)}var b;return b=!1,a.prototype.start=function(){var a;if(null==this.raf){this.prevTime=Date.now(),this.soundsMatrix.setSoundAt(this.soundsMatrix.sounds[0].id,[0,16,32,48]);try{this.update()}catch(b){a=b,alert("Sorry your graphic card isn't supported yet, Santa and the Elves Team is hardly working on it ;)")}}},a.prototype.stop=function(){cancelAnimationFrame(this.raf),this.bikeControls.reset(),this.raf=null},a.prototype.addObjects=function(){this.helperPositionTarget=new THREE.Vector3,this.helper=new THREE.Mesh(new THREE.IcosahedronGeometry(10,1),new THREE.MeshPhongMaterial({emissive:13421772})),this.scene.add(this.helper)},a.prototype.addGifts=function(){var a,b,c,d,e;for(b=[],c=d=0,e=this.soundsMatrix.analysers.length;e>=0?e>d:d>e;c=e>=0?++d:--d)a=new Gift,a.position.set(8e3*Math.random()-4e3,30,8e3*Math.random()-4e3),b.push(a),this.scene.add(a);return b[0].position.x=0,b[0].position.z=2e3,b},a.prototype.addLights=function(){var a;a=new THREE.DirectionalLight(16777215,2),a.position.set(1,1,0),this.scene.add(a),a=new THREE.AmbientLight(3355443),this.scene.add(a),this.light=new THREE.PointLight(16764108,3),this.scene.add(this.light)},a.prototype.initComposer=function(){var a;this.worldShaderComposer=new THREE.EffectComposer(this.renderer,new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat})),this.worldShaderPass=new THREE.ShaderPass(new WorldShader),this.worldShaderPass.needsSwap=!1,this.worldShaderPass.uniforms.uNoiseTexture.value=THREE.ImageUtils.loadTexture("images/tex03.jpg"),this.worldShaderComposer.addPass(this.worldShaderPass),this.renderComposer=new THREE.EffectComposer(this.renderer,new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat})),a=new THREE.RenderPass(this.scene,this.camera),a.needsSwap=!0,this.renderComposer.addPass(a),a=new THREE.RenderPass(this.scene,this.camera,new THREE.MeshDepthMaterial),a.needsSwap=!1,this.renderComposer.addPass(a),this.composer=new THREE.EffectComposer(this.renderer,new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1})),this.mixDepthShaderPass=new THREE.ShaderPass(new MixDepthShader),this.composer.addPass(this.mixDepthShaderPass),this.fxaaShaderPass=new THREE.ShaderPass(THREE.FXAAShader),this.fxaaShaderPass.renderToScreen=!0,this.composer.addPass(this.fxaaShaderPass)},a.prototype.onProgressionChangeLevel=function(a){var b,c,d,e,f;if(this.onChangeLevel.dispatch(a),a>=this.soundsMatrix.sounds.length-1)return void this.soundsMatrix.volumeFade(a===this.soundsMatrix.sounds.length-1?.01:1);for(b=c=0,e=this.soundsMatrix.sounds.length;e>=0?e>c:c>e;b=e>=0?++c:--c)this.soundsMatrix.removeSoundAt(this.soundsMatrix.sounds[b].id,[0,16,32,48]);for(b=d=0,f=a+1;f>=0?f>d:d>f;b=f>=0?++d:--d)this.soundsMatrix.setSoundAt(this.soundsMatrix.sounds[b].id,[0,16,32,48])},a.prototype.onPointerMove=function(a){this.pointer.x=a.x,this.pointer.y=a.y},a.prototype.resize=function(a,b){var c,d,e;this.quality=null!=b?b:.5,this.camera.aspect=this.canvas.offsetWidth/this.canvas.offsetHeight,this.camera.updateProjectionMatrix(),c=window.devicePixelRatio||1,e=Math.floor(window.innerWidth),d=Math.floor(window.innerHeight),this.fxaaShaderPass.uniforms.resolution.value.set(1/(e*c),1/(d*c)),this.worldShaderPass.uniforms.uResolution.value.set(e*this.quality,d*this.quality),this.renderer.setSize(e,d),this.worldShaderComposer.setSize(e*this.quality,d*this.quality),this.renderComposer.setSize(e,d),this.composer.setSize(e*c,d*c),this.worldShaderPass.uniforms.uNear.value=20,this.worldShaderPass.uniforms.uFar.value=this.camera.far,this.worldShaderPass.uniforms.uFov.value=this.camera.fov,this.worldShaderPass.uniforms.uModelViewMatrix.value=this.camera.matrixWorldInverse,this.worldShaderPass.uniforms.uProjectionMatrix.value=this.camera.projectionMatrix,this.mixDepthShaderPass.uniforms.uTextureAlphaDepth.value=this.worldShaderComposer.renderTarget1,this.mixDepthShaderPass.uniforms.uTexture.value=this.renderComposer.renderTarget2,this.mixDepthShaderPass.uniforms.uTextureDepth.value=this.renderComposer.renderTarget1},a.prototype.update=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(this.raf=requestAnimationFrame(this.update),f=Date.now(),b=(f-this.prevTime)/1e3*60,this.deltaTimesSum+=b,this.deltaTimesNumber++,d=this.deltaTimesSum/this.deltaTimesNumber,this.soundsMatrix.update(),this.progressionHandler.update(d),this.bikeControls.update(d),this.cameraControls.update(d),this.bike.update(d),this.helperPositionTarget.copy(this.progressionHandler.direction),this.helperPositionTarget.multiplyScalar(500),this.helperPositionTarget.add(this.bike.position),this.helperPositionTarget.y+=10,this.helper.position.lerp(this.helperPositionTarget,.05*d),this.light.position.copy(this.helper.position),l=this.soundsMatrix.byteFrequenciesData,c=h=0,j=l.length;j>h;c=++h){for(a=l[c],e=0,i=0,k=a.length;k>i;i++)g=a[i],e+=g;e/=256*a.length,this.worldShaderPass.uniforms.uSounds.value[c]=e}this.worldShaderPass.uniforms.uTime.value+=b,this.worldShaderPass.uniforms.uProgress.value=this.progressionHandler.progress,this.worldShaderPass.uniforms.uDirectionHotness.value+=.1*(this.progressionHandler.hotness-this.worldShaderPass.uniforms.uDirectionHotness.value),this.worldShaderPass.uniforms.uLightPosition.value.copy(this.helper.position),this.worldShaderComposer.render(),this.renderComposer.render(),this.composer.render(),this.prevTime=f},a}();var button,buttons,onButtonClick,onChangeLevel,onSpaceDown,onWindowBlur,onWindowFocus,_i,_len;for(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.world=new World(document.getElementById("canvas")),buttons=document.body.querySelectorAll(".button"),window.chrome||document.body.querySelector("#intro .error-chrome").classList.remove("hide"),window.innerWidth<640&&document.body.querySelector("#error-mobile").classList.remove("hide"),onWindowFocus=function(){window.world.start()},onWindowBlur=function(){window.world.stop()},onButtonClick=function(a){a&&a.currentTarget.classList.contains("lq")&&window.world.resize(null,.25),window.world.start(),document.body.querySelector("#intro").classList.add("hide"),window.addEventListener("focus",onWindowFocus),window.addEventListener("blur",onWindowBlur)},onSpaceDown=function(a){32===a.keyCode&&(document.body.querySelector("#outro").classList.add("hide"),window.removeEventListener("keydown",onSpaceDown),window.world.progressionHandler.gotoLevel(window.world.progressionHandler.level+1),window.world.soundsMatrix.setSoundAt("HO_Chi Lead128E-01",[0,32]))},onChangeLevel=function(a){a>=window.world.soundsMatrix.sounds.length-1&&(window.world.onChangeLevel.remove(onChangeLevel),setTimeout(function(){document.body.querySelector("#outro").classList.remove("hide"),window.addEventListener("keydown",onSpaceDown)},1e3))},window.world.onChangeLevel.add(onChangeLevel),window.world.soundsMatrix.onLoad.add(function(){return function(){var a,b,c,d;for(document.body.querySelector("#intro .loading").classList.add("hide"),d=[],b=0,c=buttons.length;c>b;b++)a=buttons[b],d.push(a.classList.remove("hide"));return d}}(this)),_i=0,_len=buttons.length;_len>_i;_i++)button=buttons[_i],button.addEventListener("click",onButtonClick);