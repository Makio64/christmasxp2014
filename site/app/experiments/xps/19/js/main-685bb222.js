var Stage3d;Stage3d=function(){function t(){}return t.camera=null,t.cameraTarget=null,t.scene=null,t.renderer=null,t.init=function(t){var e,i,o,n;n=window.innerWidth,i=window.innerHeight,i*=.8,this.camera=new THREE.PerspectiveCamera(40,n/i,1,1e4),this.camera.position.z=15e3,this.cameraTarget=new THREE.Vector3(0,0,20),this.scene=new THREE.Scene,o=t.transparent||!1,e=t.antialias||!1,this.renderer=new THREE.WebGLRenderer({alpha:o,antialias:e}),this.renderer.setSize(n,i),this.renderer.setClearColor(0,0),this.renderer.autoClear=!1,document.body.appendChild(this.renderer.domElement),this.renderer.render(this.scene,this.camera)},t.add=function(t){this.scene.add(t)},t.addOclusion=function(t){this.postprocessing.oclScene.add(t)},t.remove=function(t){this.scene.remove(t)},t.render=function(){this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.postprocessing&&(this.renderer.clearTarget(this.postprocessing.rtTexture,!0,!0,!0),this.renderer.render(this.postprocessing.oclScene,this.camera,this.postprocessing.rtTexture),this.renderer.render(this.postprocessing.sceneVertical,this.postprocessing.orthographicCamera,this.postprocessing.rtTexture),this.renderer.render(this.postprocessing.sceneHorizontal,this.postprocessing.orthographicCamera,this.postprocessing.rtTexture),this.renderer.render(this.postprocessing.sceneVertical,this.postprocessing.orthographicCamera,this.postprocessing.rtTexture),this.renderer.render(this.postprocessing.sceneHorizontal,this.postprocessing.orthographicCamera,this.postprocessing.rtTexture),this.renderer.render(this.postprocessing.finalScene,this.postprocessing.orthographicCamera))},t.resize=function(){var t,e;this.renderer&&(e=window.innerWidth,t=window.innerHeight,t*=.8,this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t))},t.initPostprocessing=function(){var e,i,o,n;t.postprocessing={},t.postprocessing.oclScene=new THREE.Scene,t.postprocessing.sceneVertical=new THREE.Scene,t.postprocessing.sceneHorizontal=new THREE.Scene,t.postprocessing.oclScene=new THREE.Scene,t.postprocessing.finalScene=new THREE.Scene,t.postprocessing.orthographicCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),n=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n/=4,e/=4,t.postprocessing.rtTexture=new THREE.WebGLRenderTarget(n,e,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),i=new THREE.MeshBasicMaterial({color:16777215,blending:THREE.AdditiveBlending,map:t.postprocessing.rtTexture,transparent:!0,opacity:.6}),o=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),i),t.postprocessing.finalScene.add(o),i=new THREE.ShaderMaterial({vertexShader:Data.shaders.vBlur.vertex,fragmentShader:Data.shaders.vBlur.fragment,uniforms:{tDiffuse:{type:"t",value:t.postprocessing.rtTexture},v:{type:"f",value:2/window.innerHeight}},transparent:!0}),o=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),i),t.postprocessing.sceneHorizontal.add(o),i=new THREE.ShaderMaterial({vertexShader:Data.shaders.hBlur.vertex,fragmentShader:Data.shaders.hBlur.fragment,uniforms:{tDiffuse:{type:"t",value:t.postprocessing.rtTexture},v:{type:"f",value:2/window.innerWidth}},transparent:!0}),o=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),i),t.postprocessing.sceneHorizontal.add(o),t.postprocessing.blackMaterial=new THREE.MeshBasicMaterial({color:0})},t}();var Physics;Physics=function(){function t(){}return t.init=function(){var e,i,o,n;n=1/30,i=2,e=6,o=!0,this.world=new OIMO.World(n,i,e,o),this.world.gravity=new OIMO.Vec3(0,-9.8,0),this.world.worldscale(100),new OIMO.Body({type:"box",size:[300,50,300],pos:[0,-20,0],world:t.world,flat:!0}),new OIMO.Body({type:"box",size:[200,500,100],pos:[0,0,150],world:t.world}),new OIMO.Body({type:"box",size:[200,500,100],pos:[0,0,-150],world:t.world}),new OIMO.Body({type:"box",size:[100,500,200],pos:[150,0,0],world:t.world}),new OIMO.Body({type:"box",size:[100,500,200],pos:[-150,0,0],world:t.world})},t.update=function(){this.world.step()},t}();var Scene;Scene=function(){function t(){}return t.prototype.update=function(){},t.prototype.resize=function(){},t.prototype.transitionIn=function(){},t.prototype.transitionOut=function(){this.onTransitionOutComplete()},t.prototype.onTransitionInComplete=function(){},t.prototype.onTransitionOutComplete=function(){SceneTraveler.onTransitionOutComplete()},t.prototype.dispose=function(){},t}();var SceneTraveler;SceneTraveler=function(){function t(){}return t.currentScene=null,t.nextScene=null,t.init=function(){},t.to=function(t){this.nextScene=t,null!==this.currentScene?this.currentScene.transitionOut():this.onTransitionOutComplete()},t.update=function(t){return null!==this.currentScene?this.currentScene.update(t):void 0},t.onTransitionOutComplete=function(){this.currentScene=this.nextScene,this.currentScene.transitionIn()},t.resize=function(){null!==this.currentScene&&this.currentScene.resize(),null!==this.nextScene&&this.nextScene.resize()},t}();var ShaderLoader;ShaderLoader=function(){function t(){}return t.callback=null,t.queue=0,t.load=function(t,e){var i,o,n,s;for(this.callback=e||null,i=n=0,s=t.length;s>n;i=n+=1)o=t[i],this.loadFile(o)},t.onLoadComplete=function(t,e,i){Data.shaders[t]||(Data.shaders[t]={}),Data.shaders[t][e]=i.responseText,this.queue--,0===this.queue&&this.callback&&this.callback()},t.loadFile=function(e){var i,o;t.queue+=2,i=new XMLHttpRequest,i.onload=function(){return t.onLoadComplete(e,"vertex",i)},i.open("get","glsl/"+e+"Vertex.glsl",!0),i.send(),o=new XMLHttpRequest,o.onload=function(){return t.onLoadComplete(e,"fragment",o)},o.open("get","glsl/"+e+"Fragment.glsl",!0),o.send()},t.get=function(t){return this.shaders[t]},t}();var Data;Data=function(){function t(){}return t.textures={},t.geometries={},t.materials={},t.meshs={},t.sounds={},t.shaders={},t}();var LoaderScene,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};LoaderScene=function(t){function e(){this.onComplete=__bind(this.onComplete,this),this.onLoaded=__bind(this.onLoaded,this),this.loadTexture=__bind(this.loadTexture,this),this.queue=0,Title.show(),this.loadSound(),setTimeout(function(t){return function(){return ShaderLoader.load(["tree","source","temple","vBlur","hBlur"],t.loadTexture)}}(this),400)}return __extends(e,t),e.prototype.loadSound=function(){Data.sounds.music=new Howl({urls:["sounds/day1.mp3"],autoplay:!0,loop:!0,volume:.1,buffer:!0}),Data.sounds.nature=new Howl({urls:["sounds/wind.mp3"],autoplay:!1,loop:!0,volume:.4,buffer:!0}),Data.sounds.thunder=new Howl({urls:["sounds/thunder.mp3"],loop:!0,volume:0,autoplay:!0})},e.prototype.loadTexture=function(){var t,e,i,o,n;for(Title.setPercent(.3),Stage3d.initPostprocessing(),i=["textures/light.png","textures/ice01.jpg","textures/ice02.jpg","textures/particle_tex_01.jpg"],o=0,n=i.length;n>o;o++)e=i[o],this.queue++,t=this.getName(e),Data.textures[t]=THREE.ImageUtils.loadTexture(e,THREE.UVMapping,this.onLoaded)},e.prototype.onLoaded=function(){this.queue--,this.queue<=0&&this.onComplete()},e.prototype.onComplete=function(){var t,e,i;Title.setPercent(.7),e="textures/env01/",t=".jpg",i=[e+"posx"+t,e+"negx"+t,e+"posy"+t,e+"negy"+t,e+"posz"+t,e+"negz"+t],Data.textures.reflectionCube=THREE.ImageUtils.loadTextureCube(i),Data.textures.reflectionCube.format=THREE.RGBFormat,THREE.ImageUtils.loadTextureCube(i,THREE.CubeReflectionMapping,function(){return Title.setPercent(.99),SceneTraveler.to(new MainScene)})},e.prototype.getName=function(t){var e,i;return i=t.lastIndexOf("/")+1,e=t.substr(i)},e}(Scene);var MainScene,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};MainScene=function(t){function e(){this.onMouseMove=__bind(this.onMouseMove,this),this.onKeyUp=__bind(this.onKeyUp,this),this.onKeyDown=__bind(this.onKeyDown,this);var t,e,i,o,n,s,r,a,h,c,p,d,u,l,g,m,y,f,w,E,M,_,T,R,S,v,x,b,H,L,P;for(this.timeGolem=0,this.time=0,this.tickResetSound=0,Physics.init(),Stage3d.scene.fog=new THREE.FogExp2(0,.0025),Stage3d.postprocessing.oclScene.fog=Stage3d.scene.fog,t=new THREE.AmbientLight(1118486),l=new THREE.PointLight(13421823,3,120),l.position.set(0,100,0),Forest.init(),s=new Forest,Stage3d.add(s),Stage3d.add(t),Stage3d.add(l),r=new THREE.PlaneGeometry(600,2e3,50,50),M=r.vertices,c=2,a=_=0,b=M.length;b>_;a=_+=1)w=M[a],w.x+=(Math.random()-.5)*c,w.z+=(Math.random()-.5)*c,w.y+=(Math.random()-.5)*c;for(u=new THREE.Mesh(r,new THREE.MeshLambertMaterial({map:Data.textures["ice01.jpg"],envMap:Data.textures.reflectionMap,color:16777215})),u.rotation.x=-Math.PI/2,Stage3d.add(u),r=new THREE.PlaneGeometry(200,200,50,50),M=r.vertices,c=2,a=T=0,H=M.length;H>T;a=T+=1)w=M[a],w.x+=(Math.random()-.5)*c,w.z+=(Math.random()-.5)*c,w.y+=(Math.random()-.5)*c;for(u=new THREE.Mesh(r,new THREE.MeshLambertMaterial({map:Data.textures["ice01.jpg"],envMap:Data.textures.reflectionMap,color:16777215})),u.rotation.x=-Math.PI/2,Stage3d.add(u),this.lightAura=new LightAura,Stage3d.add(this.lightAura),m=.3,this.head=new Attractor3d(10*m,"head",1,2,0,5e-4,.3),this.head.basePosition.set(0,45*m,40*m),this.body=new Attractor3d(50*m,"body",100,1,10,5e-4,1),this.body.basePosition.set(0,25*m,0),this.shoulderLeft=new Attractor3d(5*m,"shoulderLeft",4,1.3,1.5,.001,1.5),this.shoulderLeft.basePosition.set(-50*m,50*m,0),this.shoulderRight=new Attractor3d(5*m,"shoulderRight",4,1.3,1.5,.001,1.5),this.shoulderRight.basePosition.set(50*m,50*m,0),this.handLeft=new Attractor3d(5*m,"handLeft",7,.8,2.5,1e-4,1),this.handLeft.basePosition.set(-75*m,-5*m,0),this.handRight=new Attractor3d(5*m,"handRight",7,.8,2.5,1e-4,1),this.handRight.basePosition.set(75*m,-5*m,0),this.elbowLeft=new Attractor3d(5*m,"elbowLeft",4,.6,1.4,1e-4,.7),this.elbowLeft.basePosition.set(-70*m,20*m,-5*m),this.elbowRight=new Attractor3d(5*m,"elbowRight",4,.6,1.4,1e-4,.7),this.elbowRight.basePosition.set(70*m,20*m,-5*m),this.bodies=[this.head,this.body,this.shoulderLeft,this.shoulderRight,this.handLeft,this.handRight,this.elbowRight,this.elbowLeft],this.stones=[],this.occlusionLights=[],this.occLightScale=.01,L=this.bodies,R=0,v=L.length;v>R;R++){for(i=L[R],i.calculateDistance(),Stage3d.add(i),i.update(0,1.4,0),h=S=0,P=i.stonesRequire;P>S;h=S+=1)e=2*Math.PI*Math.random(),g=40+100*Math.random(),y=new Stone(null,Math.cos(e)*g,0,Math.sin(e)*g,i.scaleStone),y.target=i.target,Stage3d.add(y),Stage3d.addOclusion(y.occlusion),y.scale.multiplyScalar(.4+.1*Math.random()),this.stones.push(y),i===this.head&&(y.material.depthWrite=!1);i.scaleLight>0&&(i.occlusionLight=new THREE.Mesh(new THREE.SphereGeometry(i.scaleLight,4),new THREE.MeshBasicMaterial({color:255})),i.occlusionLight.position.copy(i.position),Stage3d.addOclusion(i.occlusionLight),this.occlusionLights.push(i.occlusionLight))}for(n=new THREE.PointLight(16711680,3,3),n.position.set(-1.3,33,17),Stage3d.add(n),o=new THREE.PointLight(16711680,3,3),o.position.set(1.3,33,17),Stage3d.add(o),r=new THREE.SphereGeometry(.2),this.materialEye=new THREE.MeshBasicMaterial({transparent:!0,opacity:.7,color:2237081}),this.eyeLeft=new THREE.Mesh(r,this.materialEye),this.eyeLeft.position.copy(o.position),this.eyeLeft.position.z-=1,Stage3d.add(this.eyeLeft),this.eyeRight=new THREE.Mesh(r,this.materialEye),this.eyeRight.position.copy(n.position),this.eyeRight.position.z-=1,Stage3d.add(this.eyeRight),this.source=new Source,this.source.position.y=25,Stage3d.add(this.source),this.temple=new Temple,r=new THREE.Geometry,a=x=0;30>x;a=x+=1)E=new THREE.Vector3,d=Math.random()*Math.PI*2,f=Math.random()*Math.PI*2,g=90+40*Math.random(),E.x=g*Math.sin(d)*Math.cos(f),E.y=g*Math.cos(d),E.z=g*Math.sin(d)*Math.sin(f),r.vertices.push(E);p=new THREE.PointCloudMaterial({opacity:1,color:16777215,size:2,map:Data.textures["particle_tex_01.jpg"],blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0}),this.particles=new THREE.PointCloud(r,p),this.particles.rotation.y=6*Math.random(),Stage3d.add(this.particles),this.cameraFree=!1,Stage3d.camera.position.set(0,20,1e3),TweenLite.to(Stage3d.camera.position,7,{z:140,ease:Quad.easeOut,onComplete:function(t){return function(){return t.cameraFree=!0,Data.sounds.nature.play(),TweenLite.from(Data.sounds.nature,2.5,{volume:0}),Instruction.show()}}(this)}),this.mouse=new THREE.Vector2(window.innerWidth/2,window.innerHeight/2),this.angle=Math.PI/2,this.radius=140,window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mousedown",this.onKeyDown),window.addEventListener("mouseup",this.onKeyUp),window.addEventListener("touchstart",this.onKeyDown),window.addEventListener("touchend",this.onKeyUp),this.golem=!1,this.golemAngle=0,window.addEventListener("keyup",this.onKeyUp),window.addEventListener("keydown",this.onKeyDown),Physics.update(),Title.hide()}return __extends(e,t),e.prototype.onKeyDown=function(){this.cameraFree&&(this.golem=!0,Physics.world.gravity=new OIMO.Vec3(0,0,0))},e.prototype.onKeyUp=function(){this.cameraFree&&(this.golem=!1,Physics.world.gravity=new OIMO.Vec3(0,-0.098,0))},e.prototype.onMouseMove=function(t){this.mouse.x=t.clientX||t.x,this.mouse.y=t.clientY||t.y},e.prototype.update=function(t){var e,i,o,n,s,r,a,h,c,p,d,u,l;if(this.tickResetSound+=t,this.tickResetSound>250&&(this.tickResetSound=0,Stone.soundsPlay=0,console.log("reset")),!(t>100)){if(Physics.update(),this.time<250)return void(this.time+=t);for(this.cameraFree&&(this.angle-=.02*(this.mouse.x/window.innerWidth-.5),Stage3d.camera.position.x=Math.cos(this.angle)*this.radius,Stage3d.camera.position.z=Math.sin(this.angle)*this.radius,Stage3d.camera.rotation.y=Math.atan2(-Stage3d.camera.position.z,Stage3d.camera.position.x)+Math.PI/2,Stage3d.camera.rotation.x+=.03*(.3*(1-this.mouse.y/window.innerHeight)-.1-Stage3d.camera.rotation.x)),this.lightAura.update(t),this.source.update(t),d=this.bodies,s=0,h=d.length;h>s;s++)e=d[s],e.update(t,1.4,this.golemAngle),e.occlusionLight&&e.occlusionLight.position.copy(e.position);for(n=new THREE.Vector3(0,.25,0),u=this.stones,r=0,c=u.length;c>r;r++)o=u[r],o.update(t,this.golem);for(l=this.occlusionLights,a=0,p=l.length;p>a;a++)i=l[a],i.scale.set(this.occLightScale,this.occLightScale,this.occLightScale),this.materialEye.opacity=.7*this.occLightScale;this.golem?(this.timeGolem+=t,this.timeGolem>700&&(this.occLightScale+=.015*(1-this.occLightScale)),this.radius+=.01*(80-this.radius),Data.sounds.thunder.volume(.05*(2-Data.sounds.thunder.volume()))):(this.timeGolem=0,this.occLightScale+=.25*(0-this.occLightScale),this.radius+=.05*(140-this.radius),Data.sounds.thunder.volume(.15*(0-Data.sounds.thunder.volume()))),this.particles.rotation.y+=t/9e3,this.particles.rotation.z+=t/9e3}},e}(Scene);var TestLightScene,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};TestLightScene=function(t){function e(){this.update=__bind(this.update,this),this.positionLight=__bind(this.positionLight,this),this.generateLight=__bind(this.generateLight,this);var t;Stage3d.cameraTarget.z=200,Stage3d.cameraTarget.y=0,this.lightCount=10,this.lights=[],this.radius=100,this.ambient=new THREE.AmbientLight(1118481),this.targetLookAt=new THREE.Vector3(-Math.PI/2,.2,0),this.opacity=.3,this.offsetX=85,this.offsetY=280,Stage3d.camera.position.z=150,t=new dat.GUI,t.add(this,"lightCount",1,100).step(1).onChange(this.generateLight),t.add(this,"radius",1,1e3).step(1).onChange(this.generateLight),t.add(this.targetLookAt,"x",-Math.PI,Math.PI).step(.01),t.add(this.targetLookAt,"y",-Math.PI,Math.PI).step(.01),t.add(this.targetLookAt,"z",-Math.PI,Math.PI).step(.01),t.add(Stage3d.camera.position,"x",-200,400).step(.01),t.add(Stage3d.camera.position,"y",-200,400).step(.01),t.add(Stage3d.camera.position,"z",-200,400).step(.01),t.add(this,"offsetX",-500,500).step(1).onChange(this.generateLight),t.add(this,"offsetY",-500,500).step(1).onChange(this.generateLight),t.add(this,"opacity",0,1).step(.1),t.add(Stage3d.scene.rotation,"y",0,2*Math.PI),this.opacity,this.generateLight()}return __extends(e,t),e.prototype.generateLight=function(){for(var t,e,i,o;this.lights.length<this.lightCount;)t=new Light,this.lights.push(t),this.positionLight(t),Stage3d.add(t);for(;this.lights.length>this.lightCount;)t=this.lights.pop(),Stage3d.remove(t);for(o=this.lights,e=0,i=o.length;i>e;e++)t=o[e],this.positionLight(t)},e.prototype.positionLight=function(t){var e,i;e=Math.random()*Math.PI*2,i=this.radius*Math.random(),t.position.x=Math.cos(e)*i+this.offsetX,t.position.z=Math.sin(e)*i,t.position.y=this.offsetY},e.prototype.update=function(t){var e,i,o,n,s,r;for(i=new THREE.Quaternion,o=new THREE.Quaternion,i.setFromAxisAngle(new THREE.Vector3(1,0,0),this.targetLookAt.x),i.multiply(o),o.setFromAxisAngle(new THREE.Vector3(0,1,0),this.targetLookAt.y),i.multiply(o),o.setFromAxisAngle(new THREE.Vector3(0,0,1),this.targetLookAt.z),i.multiply(o),i.normalize(),r=this.lights,n=0,s=r.length;s>n;n++)e=r[n],e.update(t),e._opacity=this.opacity,e.setRotationFromQuaternion(i)},e}(Scene);var TestSkeletonScene,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};TestSkeletonScene=function(t){function e(){var t,e,i,o,n,s;for(i=new dat.GUI,Stage3d.camera.position.set(0,10,300),this.scaleY=1.4,i.add(this,"scaleY",.001,2).name("bodyScaleY"),i.add(Stage3d.scene.rotation,"y",0,10*Math.PI),this.head=new Attractor3d(10,"head"),this.head.basePosition.set(0,50,30),this.body=new Attractor3d(50,"body"),this.body.basePosition.set(0,25,0),this.shoulderLeft=new Attractor3d(5,"shoulderLeft"),this.shoulderLeft.basePosition.set(-50,50,0),this.shoulderRight=new Attractor3d(5,"shoulderRight"),this.shoulderRight.basePosition.set(50,50,0),this.handLeft=new Attractor3d(5,"handLeft"),this.handLeft.basePosition.set(-75,-5,0),this.handRight=new Attractor3d(5,"handRight"),this.handRight.basePosition.set(75,-5,0),this.elbowLeft=new Attractor3d(5,"elbowLeft"),this.elbowLeft.basePosition.set(-70,20,-5),this.elbowRight=new Attractor3d(5,"elbowRight"),this.elbowRight.basePosition.set(70,20,-5),this.bodies=[this.head,this.body,this.shoulderLeft,this.shoulderRight,this.handLeft,this.handRight,this.elbowRight,this.elbowLeft],s=this.bodies,o=0,n=s.length;n>o;o++)t=s[o],e=i.addFolder(t.name),e.add(t.basePosition,"x",-100,100).step(1).name("base x"),e.add(t.basePosition,"y",-100,100).step(1).name("base y"),e.add(t.basePosition,"z",-100,100).step(1).name("base z"),Stage3d.add(t),e.close()}return __extends(e,t),e.prototype.update=function(t){var e,i,o,n;for(n=this.bodies,i=0,o=n.length;o>i;i++)e=n[i],e.update(t,this.scaleY)},e}(Scene);var TestTreeScene,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};TestTreeScene=function(t){function e(){var t,e;Forest.init(),this.forest=new Forest,Stage3d.add(this.forest),this.windForce=10,this.iceFactor=0,this.time=0,t=new dat.GUI,t.add(this,"windForce",-200,200),t.add(this,"iceFactor",0,1),Stage3d.camera.position.set(0,400,330),Stage3d.camera.lookAt(new THREE.Vector3(0,0,0)),e=new THREE.Mesh(new THREE.BoxGeometry(100,100,6,2,2),new THREE.MeshBasicMaterial({color:1118481})),e.rotation.x=-Math.PI/2,e.position.y-=3,Stage3d.add(e)}return __extends(e,t),e.prototype.update=function(t){this.time+=t,this.forest.tree.material.uniforms.iceFactor.value=this.iceFactor,this.forest.tree.material.uniforms.windForce.value=this.windForce},e}(Scene);var Title;Title=function(){function t(){}return t.show=function(){TweenLite.to("#img",1,{force3D:!0,css:{opacity:"1"},ease:Quad.easeOut}),TweenLite.to(".loaderBg",.5,{force3D:!0,css:{scaleX:"1"},ease:Quad.expoEaseOut})},t.hide=function(){TweenLite.to("#img",1,{force3D:!0,css:{opacity:"0",delay:.2},ease:Quad.easeOut,onComplete:this.dispose}),TweenLite.to(".loaderBg",.5,{force3D:!0,css:{scaleX:"1.5",opacity:"0"},ease:Quad.expoEaseOut}),TweenLite.to(".loaderBar",.5,{force3D:!0,css:{scaleX:"1.5",opacity:"0"},ease:Quad.expoEaseOut})},t.setPercent=function(t){TweenLite.to(".loaderBar",.5,{css:{scaleX:t},ease:Quad.expoEaseOut})},t.dispose=function(){this.domContainer=document.getElementById("title"),this.domContainer.parentElement.removeChild(this.domContainer)},t}();var Instruction;Instruction=function(){function t(){}return t.show=function(){TweenLite.to(".instruction",1,{force3D:!0,css:{opacity:"1"},ease:Quad.easeOut})},t.hide=function(){TweenLite.to(".instruction",1,{force3D:!0,css:{opacity:"0"},ease:Quad.easeOut})},t}();var Temple,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Temple=function(t){function e(){var t,e,i,o;t=new THREE.PlaneGeometry(100,100,256,256),e=new THREE.Matrix4,e.makeRotationX(-Math.PI/2),t.applyMatrix(e),o={map:{type:"t",value:null},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:10}},o=THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,o]),i=new THREE.ShaderMaterial({uniforms:o,vertexShader:Data.shaders.temple.vertex,fragmentShader:Data.shaders.temple.fragment}),i.fog=!0,THREE.Mesh.call(this,t,i),this.position.y-=.1,o.bumpMap.value=Data.textures["temple.png"],o.bumpScale.value=4,o.map.value=Data.textures["water.jpg"]}return __extends(e,t),e}(THREE.Mesh);var Light,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Light=function(t){function e(){var t,i,o;t=e.geometry,o=Data.textures["light.png"],i=new THREE.MeshBasicMaterial({depthWrite:!1,depthTest:!1,map:o,color:8947967,wireframe:!1,transparent:!0}),i.blending=THREE.AdditiveBlending,i.side=THREE.DoubleSide,THREE.Mesh.call(this,t,i),this.time=1e4*Math.random(),this.randomOpacity=1056+750*Math.random(),this.randomScale=956+150*Math.random(),this.baseScale=.6+.4*Math.random(),this._opacity=1}return __extends(e,t),e.prototype.update=function(t){var e;this.time+=t,this.material.opacity=Math.abs(Math.sin(this.time/this.randomOpacity))*this._opacity,e=.9+.1*Math.abs(Math.sin(this.time/this.randomScale)),this.scale.set(e,e,e)},e.generateGeometry=function(){var t,e,i,o,n,s,r,a;return o=250+30*Math.random(),a=40,s=new THREE.Matrix4,s.makeTranslation(o/2,a/2,0),t=new THREE.PlaneGeometry(o,a),t.applyMatrix(s),e=new THREE.PlaneGeometry(o,a),n=new THREE.Matrix4,n.makeRotationX(Math.PI/3),e.applyMatrix(n),e.applyMatrix(s),i=new THREE.PlaneGeometry(o,a),n=new THREE.Matrix4,n.makeRotationX(-Math.PI/3),i.applyMatrix(n),i.applyMatrix(s),r=new THREE.Matrix4,r.makeRotationY(Math.PI/2),t.applyMatrix(r),e.applyMatrix(r),i.applyMatrix(r),t.merge(e),t.merge(i),t},e.geometry=e.generateGeometry(),e}(THREE.Mesh);var LightAura,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};LightAura=function(t){function e(){this.update=__bind(this.update,this),this.positionLight=__bind(this.positionLight,this),this.generateLight=__bind(this.generateLight,this),e.__super__.constructor.call(this),this.lightCount=50,this.lights=[],this.radius=120,this.ambient=new THREE.AmbientLight(1118481),this.targetLookAt=new THREE.Vector3(-Math.PI/2,.2,0),this.opacity=.3,this.offsetX=60,this.offsetY=250,this.generateLight()}return __extends(e,t),e.prototype.generateLight=function(){for(var t,e,i,o;this.lights.length<this.lightCount;)t=new Light,this.lights.push(t),this.positionLight(t),this.add(t);for(;this.lights.length>this.lightCount;)t=this.lights.pop(),this.remove(t);for(o=this.lights,e=0,i=o.length;i>e;e++)t=o[e],this.positionLight(t)},e.prototype.positionLight=function(t){var e,i;e=Math.random()*Math.PI*2,i=this.radius*Math.random(),t.position.x=Math.cos(e)*i+this.offsetX,t.position.z=Math.sin(e)*i,t.position.y=this.offsetY},e.prototype.update=function(t){var e,i,o,n,s,r;for(i=new THREE.Quaternion,o=new THREE.Quaternion,i.setFromAxisAngle(new THREE.Vector3(1,0,0),this.targetLookAt.x),i.multiply(o),o.setFromAxisAngle(new THREE.Vector3(0,1,0),this.targetLookAt.y),i.multiply(o),o.setFromAxisAngle(new THREE.Vector3(0,0,1),this.targetLookAt.z),i.multiply(o),i.normalize(),r=this.lights,n=0,s=r.length;s>n;n++)e=r[n],e.update(t/3),e._opacity=this.opacity,e.setRotationFromQuaternion(i)},e}(THREE.Object3D);var Smoke,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Smoke=function(t){function e(){}return __extends(e,t),e}(THREE.PointCloud);var Source,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Source=function(t){function e(){var t,e,i;t=new THREE.OctahedronGeometry(5,5),this.time=0,i={time:{type:"f",value:0},noisePower:{type:"f",value:1},anglePower:{type:"f",value:.3},anglePowerAmplification:{type:"f",value:0}},i=THREE.UniformsUtils.merge([i,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap]),e=new THREE.ShaderMaterial({uniforms:i,vertexShader:Data.shaders.source.vertex,fragmentShader:Data.shaders.source.fragment,transparent:!0,wireframe:!0}),e.fog=!0,e.lights=!0,THREE.Mesh.call(this,t,e)}return __extends(e,t),e.prototype.update=function(t){this.time+=t/1500,this.material.uniforms.time.value=this.time},e}(THREE.Mesh);var Light,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Light=function(t){function e(){var t,i,o;t=e.geometry,o=Data.textures["light.png"],i=new THREE.MeshBasicMaterial({depthWrite:!1,depthTest:!1,map:o,color:8947967,wireframe:!1,transparent:!0}),i.blending=THREE.AdditiveBlending,i.side=THREE.DoubleSide,THREE.Mesh.call(this,t,i),this.time=1e4*Math.random(),this.randomOpacity=1056+750*Math.random(),this.randomScale=956+150*Math.random(),this.baseScale=.6+.4*Math.random(),this._opacity=1}return __extends(e,t),e.prototype.update=function(t){var e;this.time+=t,this.material.opacity=Math.abs(Math.sin(this.time/this.randomOpacity))*this._opacity,e=.9+.1*Math.abs(Math.sin(this.time/this.randomScale)),this.scale.set(e,e,e)},e.generateGeometry=function(){var t,e,i,o,n,s,r,a;return o=250+30*Math.random(),a=40,s=new THREE.Matrix4,s.makeTranslation(o/2,a/2,0),t=new THREE.PlaneGeometry(o,a),t.applyMatrix(s),e=new THREE.PlaneGeometry(o,a),n=new THREE.Matrix4,n.makeRotationX(Math.PI/3),e.applyMatrix(n),e.applyMatrix(s),i=new THREE.PlaneGeometry(o,a),n=new THREE.Matrix4,n.makeRotationX(-Math.PI/3),i.applyMatrix(n),i.applyMatrix(s),r=new THREE.Matrix4,r.makeRotationY(Math.PI/2),t.applyMatrix(r),e.applyMatrix(r),i.applyMatrix(r),t.merge(e),t.merge(i),t},e.geometry=e.generateGeometry(),e}(THREE.Mesh);var Attractor3d,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Attractor3d=function(t){function e(t,e,i,o,n,s,r){var a,h;this.stonesRequire=i,this.scaleStone=o,this.scaleLight=n,this.oscilationSpeed=s,this.oscilationIntensity=r,this.update=__bind(this.update,this),this.time=0,a=new THREE.SphereGeometry(t),h=new THREE.MeshBasicMaterial({color:16777215,wireframe:!0,transparent:!0,opacity:0}),THREE.Mesh.call(this,a,h),this.basePosition=new THREE.Vector3,this.name=e,this.target=new THREE.Vector3,this.visible=!1}return __extends(e,t),e.prototype.calculateDistance=function(){var t,e;t=this.basePosition.x,e=this.basePosition.z,this.distance=Math.sqrt(t*t+e*e),this.originAngle=Math.atan2(e,t)},e.prototype.update=function(t,e,i){var o,n,s;this.time+=t,i+=this.originAngle,n=Math.cos(i)*this.distance,s=Math.sin(i)*this.distance,o=Math.abs(Math.sin(this.time*this.oscilationSpeed)*this.oscilationIntensity),this.position.set(n,this.basePosition.y*e+15+o,s),this.target.copy(this.position),this.target.multiplyScalar(.01)},e}(THREE.Mesh);var Stone,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Stone=function(t){function e(t,e,i,o,n){var s,r,a,c,p,d,u,l,g,m,y,f,E,M,_,T;switch(t=1,this.fly=!1,this.positionnated=!1,t){case 0:for(l=5.5*n,d={type:"box",size:[l,l,l],pos:[e,i,o],move:!0,world:Physics.world},s=new THREE.BoxGeometry(l,l,l,2,2,2),p=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1}),m=s.vertices,c=3,a=y=0,M=m.length;M>y;a=y+=1)g=m[a],g.x+=(Math.random()-.5)*c,g.z+=(Math.random()-.5)*c,g.y!==-l/2&&(g.y+=(Math.random()-.5)*c);break;case 1:for(u=5*n,d={type:"sphere",size:[.5*u,.5*u,.5*u],pos:[e,i,o],move:!0,world:Physics.world},s=new THREE.TetrahedronGeometry(u,2),p=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1}),m=s.vertices,c=u/2.5,a=f=0,_=m.length;_>f;a=f+=1)g=m[a],g.x+=(Math.random()-.5)*c,g.z+=(Math.random()-.5)*c,g.y+=(Math.random()-.5)*c;break;case 2:for(r=10,s=new THREE.CylinderGeometry(5,5,r,5,3,!1),p=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1}),m=s.vertices,c=.5,a=E=0,T=m.length;T>E;a=E+=1)g=m[a],g.y!==r/2&&(g.x+=(Math.random()-.5)*c,g.z+=(Math.random()-.5)*c,g.y+=(Math.random()-.5)*c);d={type:"cylinder",size:[w,h,w,w,h,w,w,h,w,w,h,w],pos:[e,i,o],rot:[0,0,0,0,45,0,0,22.5,0,0,-22.5,0],move:!0,world:Physics.world}}this.body=new OIMO.Body(d),this.body.body.linearVelocity.set(0,-10,0),this.body.body.mass=2+Math.random(),this.body.body.allowSleep=!1,p.envMap=Data.textures.reflectionCube,p.reflectivity=.7,p.transparent=!0,p.opacity=.8,p.fog=!0,p.combine=THREE.AddOperation,THREE.Mesh.call(this,s,p),this.occlusion=new THREE.Mesh(s,Stage3d.postprocessing.blackMaterial)}return __extends(e,t),e.soundsPlay=0,e.prototype.update=function(t,e){var i,o,n,s,r;return e&&(r=this.target,i=5,o=.75*(r.x-this.body.body.position.x),o>i?o=i:-i>o&&(o=-i),n=.75*(r.y-this.body.body.position.y),n>i?n=i:-i>n&&(n=-i),s=.75*(r.z-this.body.body.position.z),s>i?s=i:-i>s&&(s=-i),this.body.body.linearVelocity.set(o,n,s)),e&&this.body.getSleep()||(this.position.copy(this.body.getPosition()),this.quaternion.copy(this.body.getQuaternion())),this.occlusion.position.copy(this.position),this.occlusion.quaternion.copy(this.quaternion),this.occlusion.scale.copy(this.scale)},e}(THREE.Mesh);var Forest,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Forest=function(t){function e(){var t,i,o,n,s,r,a;for(THREE.Object3D.call(this),o=a=0;800>a;o=a+=1)i=e.geometry.clone(),n=new THREE.Matrix4,t=1.8*Math.PI/20*(o%20)+.3*Math.random()+Math.PI/2+.25,s=150+20*Math.floor(o/20),n.makeTranslation(Math.cos(t)*s,0,Math.sin(t)*s),i.applyMatrix(n),r?r.merge(i):r=i;this.tree=new THREE.Mesh(r,e.material),this.add(this.tree)
}return __extends(e,t),e.generateGeometry=function(t){var e,i,o,n;return o=new THREE.CylinderGeometry(0,15+t,100+2*t,10,10,!0),i=10-t,e=new THREE.CylinderGeometry(5+t,5+t,10-t,10,2,!0),n=new THREE.Matrix4,n.makeTranslation(0,i/2,0),e.applyMatrix(n),n=new THREE.Matrix4,n.makeTranslation(0,i+50+t,0),o.applyMatrix(n),e.merge(o),e},e.isInit=!1,e.init=function(){e.isInit||(e.isInit=!0,e.geometry=e.generateGeometry(0),e.material=new THREE.MeshLambertMaterial({color:{1118481:1118481}}))},e}(THREE.Object3D);var Main,main,__bind=function(t,e){return function(){return t.apply(e,arguments)}};main=null,Main=function(){function t(){this.resize=__bind(this.resize,this),this.update=__bind(this.update,this),this.pause=!1,this.lastTime=Date.now(),window.focus(),Stage3d.init({transparent:!1,antialias:!0,background:255}),SceneTraveler.to(new LoaderScene),requestAnimationFrame(this.update)}return t.prototype.dt=0,t.prototype.lastTime=0,t.prototype.pause=!1,t.prototype.update=function(){var t,e;e=Date.now(),t=e-this.lastTime,this.lastTime=e,this.pause||(SceneTraveler.update(t),Stage3d.render(),requestAnimationFrame(this.update))},t.prototype.resize=function(){var t,e;e=window.innerWidth,t=window.innerHeight,Stage3d.resize(),SceneTraveler.resize()},t}(),document.addEventListener("DOMContentLoaded",function(){main=new Main,window.onresize=function(){main.resize()}});