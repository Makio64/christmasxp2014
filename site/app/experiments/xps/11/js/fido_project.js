function hasCanvasSupport(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}define("com/fido/app/Fallback",["require","exports","module"],function(t,e,i){Fallback=function(t){t=t||document.body;var e={message:'<p>Uh-oh! It looks like you need to update your browser before you\'ll be able to play this game</p><p>In the meantime, check out <a href="#brand_url">this</a> or <a href="#cbeebies_games_url">this</a>.',brand_url:"http://www.someurl.tld/",games_url:"http://www.someurl.tld/",enabled:!0},i=e.message;i=i.replace("#brand_url",e.brand_url),i=i.replace("#games_url",e.games_url);var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href="assets/css/unsupported.css",document.getElementsByTagName("head")[0].appendChild(r),t.innerHTML=i},Fallback.constructor=Fallback,i.exports=Fallback}),function(t){var e,i,r,o,n,s=t.GreenSockGlobals||t,a=function(t){var e,i=t.split("."),r=s;for(e=0;i.length>e;e++)r[i[e]]=r=r[i[e]]||{};return r},h=a("com.greensock"),l=[].slice,u=function(){},c={},p=function(e,i,r,o){this.sc=c[e]?c[e].sc:[],c[e]=this,this.gsClass=null,this.func=r;var n=[];this.check=function(h){for(var l,u,d,f,m=i.length,v=m;--m>-1;)(l=c[i[m]]||new p(i[m],[])).gsClass?(n[m]=l.gsClass,v--):h&&l.sc.push(this);if(0===v&&r)for(u=("com.greensock."+e).split("."),d=u.pop(),f=a(u.join("."))[d]=this.gsClass=r.apply(r,n),o&&(s[d]=f,"function"==typeof define&&define.amd?define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+e.split(".").join("/"),[],function(){return f}):"undefined"!=typeof module&&module.exports&&(module.exports=f)),m=0;this.sc.length>m;m++)this.sc[m].check()},this.check(!0)},d=t._gsDefine=function(t,e,i,r){return new p(t,e,i,r)},f=h._class=function(t,e,i){return e=e||function(){},d(t,[],function(){return e},i),e};d.globals=s;var m=[0,0,1,1],v=[],g=f("easing.Ease",function(t,e,i,r){this._func=t,this._type=i||0,this._power=r||0,this._params=e?m.concat(e):m},!0),y=g.map={},x=g.register=function(t,e,i,r){for(var o,n,s,a,l=e.split(","),u=l.length,c=(i||"easeIn,easeOut,easeInOut").split(",");--u>-1;)for(n=l[u],o=r?f("easing."+n,null,!0):h.easing[n]||{},s=c.length;--s>-1;)a=c[s],y[n+"."+a]=y[a+n]=o[a]=t.getRatio?t:t[a]||new t};for(r=g.prototype,r._calcEnd=!1,r.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,r=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?r*=r:2===i?r*=r*r:3===i?r*=r*r*r:4===i&&(r*=r*r*r*r),1===e?1-r:2===e?r:.5>t?r/2:1-r/2},e=["Linear","Quad","Cubic","Quart","Quint,Strong"],i=e.length;--i>-1;)r=e[i]+",Power"+i,x(new g(null,null,1,i),r,"easeOut",!0),x(new g(null,null,2,i),r,"easeIn"+(0===i?",easeNone":"")),x(new g(null,null,3,i),r,"easeInOut");y.linear=h.easing.Linear.easeIn,y.swing=h.easing.Quad.easeInOut;var b=f("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});r=b.prototype,r.addEventListener=function(t,e,i,r,s){s=s||0;var a,h,l=this._listeners[t],u=0;for(null==l&&(this._listeners[t]=l=[]),h=l.length;--h>-1;)a=l[h],a.c===e&&a.s===i?l.splice(h,1):0===u&&s>a.pr&&(u=h+1);l.splice(u,0,{c:e,s:i,up:r,pr:s}),this!==o||n||o.wake()},r.removeEventListener=function(t,e){var i,r=this._listeners[t];if(r)for(i=r.length;--i>-1;)if(r[i].c===e)return void r.splice(i,1)},r.dispatchEvent=function(t){var e,i,r,o=this._listeners[t];if(o)for(e=o.length,i=this._eventTarget;--e>-1;)r=o[e],r.up?r.c.call(r.s||i,{type:t,target:i}):r.c.call(r.s||i)};var w=t.requestAnimationFrame,_=t.cancelAnimationFrame,T=Date.now||function(){return(new Date).getTime()},S=T();for(e=["ms","moz","webkit","o"],i=e.length;--i>-1&&!w;)w=t[e[i]+"RequestAnimationFrame"],_=t[e[i]+"CancelAnimationFrame"]||t[e[i]+"CancelRequestAnimationFrame"];f("Ticker",function(t,e){var i,r,s,a,h,l=this,c=T(),p=e!==!1&&w,d=function(t){S=T(),l.time=(S-c)/1e3;var e,o=l.time-h;(!i||o>0||t===!0)&&(l.frame++,h+=o+(o>=a?.004:a-o),e=!0),t!==!0&&(s=r(d)),e&&l.dispatchEvent("tick")};b.call(l),this.time=this.frame=0,this.tick=function(){d(!0)},this.sleep=function(){null!=s&&(p&&_?_(s):clearTimeout(s),r=u,s=null,l===o&&(n=!1))},this.wake=function(){null!==s&&l.sleep(),r=0===i?u:p&&w?w:function(t){return setTimeout(t,0|1e3*(h-l.time)+1)},l===o&&(n=!0),d(2)},this.fps=function(t){return arguments.length?(i=t,a=1/(i||60),h=this.time+a,void l.wake()):i},this.useRAF=function(t){return arguments.length?(l.sleep(),p=t,void l.fps(i)):p},l.fps(t),setTimeout(function(){p&&(!s||5>l.frame)&&l.useRAF(!1)},1500)}),r=h.Ticker.prototype=new h.events.EventDispatcher,r.constructor=h.Ticker;var A=f("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,N){n||o.wake();var i=this.vars.useFrames?k:N;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});o=A.ticker=new h.Ticker,r=A.prototype,r._dirty=r._gc=r._initted=r._paused=!1,r._totalTime=r._time=0,r._rawPrevTime=-1,r._next=r._last=r._onUpdate=r._timeline=r.timeline=null,r._paused=!1;var C=function(){T()-S>2e3&&o.wake(),setTimeout(C,2e3)};C(),r.play=function(t,e){return arguments.length&&this.seek(t,e),this.reversed(!1).paused(!1)},r.pause=function(t,e){return arguments.length&&this.seek(t,e),this.paused(!0)},r.resume=function(t,e){return arguments.length&&this.seek(t,e),this.paused(!1)},r.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},r.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},r.reverse=function(t,e){return arguments.length&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},r.render=function(){},r.invalidate=function(){return this},r._enabled=function(t,e){return n||o.wake(),this._gc=!t,this._active=t&&!this._paused&&this._totalTime>0&&this._totalTime<this._totalDuration,e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},r._kill=function(){return this._enabled(!1,!1)},r.kill=function(t,e){return this._kill(t,e),this},r._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},r._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},r.eventCallback=function(t,e,i,r){if("on"===(t||"").substr(0,2)){var o=this.vars;if(1===arguments.length)return o[t];null==e?delete o[t]:(o[t]=e,o[t+"Params"]=i instanceof Array&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,o[t+"Scope"]=r),"onUpdate"===t&&(this._onUpdate=e)}return this},r.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},r.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},r.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},r.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},r.totalTime=function(t,e,i){if(n||o.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var r=this._totalDuration,s=this._timeline;if(t>r&&!i&&(t=r),this._startTime=(this._paused?this._pauseTime:s._time)-(this._reversed?r-t:t)/this._timeScale,s._dirty||this._uncache(!1),s._timeline)for(;s._timeline;)s._timeline._time!==(s._startTime+s._totalTime)/s._timeScale&&s.totalTime(s._totalTime,!0),s=s._timeline}this._gc&&this._enabled(!0,!1),this._totalTime!==t&&this.render(t,e,!1)}return this},r.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},r.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||1e-6,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},r.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._totalTime,!0)),this):this._reversed},r.paused=function(t){if(!arguments.length)return this._paused;if(t!=this._paused&&this._timeline){n||t||o.wake();var e=this._timeline,i=e.rawTime(),r=i-this._pauseTime;!t&&e.smoothChildTiming&&(this._startTime+=r,this._uncache(!1)),this._pauseTime=t?i:null,this._paused=t,this._active=!t&&this._totalTime>0&&this._totalTime<this._totalDuration,t||0===r||0===this._duration||this.render(e.smoothChildTiming?this._totalTime:(i-this._startTime)/this._timeScale,!0,!0)}return this._gc&&!t&&this._enabled(!0,!1),this};var E=f("core.SimpleTimeline",function(t){A.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});r=E.prototype=new A,r.constructor=E,r.kill()._gc=!1,r._first=r._last=null,r._sortChildren=!1,r.add=r.insert=function(t,e){var i,r;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(r=t._startTime;i&&i._startTime>r;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._timeline&&this._uncache(!0),this},r._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t.timeline=null,t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),this._timeline&&this._uncache(!0)),this},r.render=function(t,e,i){var r,o=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;o;)r=o._next,(o._active||t>=o._startTime&&!o._paused)&&(o._reversed?o.render((o._dirty?o.totalDuration():o._totalDuration)-(t-o._startTime)*o._timeScale,e,i):o.render((t-o._startTime)*o._timeScale,e,i)),o=r},r.rawTime=function(){return n||o.wake(),this._totalTime};var M=f("TweenLite",function(e,i,r){if(A.call(this,i,r),this.render=M.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:M.selector(e)||e;var o,n,s,a=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),h=this.vars.overwrite;if(this._overwrite=h=null==h?D[M.defaultOverwrite]:"number"==typeof h?h>>0:D[h],(a||e instanceof Array)&&"number"!=typeof e[0])for(this._targets=s=l.call(e,0),this._propLookup=[],this._siblings=[],o=0;s.length>o;o++)n=s[o],n?"string"!=typeof n?n.length&&n!==t&&n[0]&&(n[0]===t||n[0].nodeType&&n[0].style&&!n.nodeType)?(s.splice(o--,1),this._targets=s=s.concat(l.call(n,0))):(this._siblings[o]=U(n,this,!1),1===h&&this._siblings[o].length>1&&G(n,this,null,1,this._siblings[o])):(n=s[o--]=M.selector(n),"string"==typeof n&&s.splice(o+1,1)):s.splice(o--,1);else this._propLookup={},this._siblings=U(e,this,!1),1===h&&this._siblings.length>1&&G(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&this.render(-this._delay,!1,!0)},!0),B=function(e){return e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},L=function(t,e){var i,r={};for(i in t)O[i]||i in e&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!R[i]||R[i]&&R[i]._autoCSS)||(r[i]=t[i],delete t[i]);t.css=r};r=M.prototype=new A,r.constructor=M,r.kill()._gc=!1,r.ratio=0,r._firstPT=r._targets=r._overwrittenProps=r._startAt=null,r._notifyPluginsOfEnabled=!1,M.version="1.10.2",M.defaultEase=r._ease=new g(null,null,1,1),M.defaultOverwrite="auto",M.ticker=o,M.autoSleep=!0,M.selector=t.$||t.jQuery||function(e){return t.$?(M.selector=t.$,t.$(e)):t.document?t.document.getElementById("#"===e.charAt(0)?e.substr(1):e):e};var P=M._internals={},R=M._plugins={},F=M._tweenLookup={},I=0,O=P.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1},D={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},k=A._rootFramesTimeline=new E,N=A._rootTimeline=new E;N._startTime=o.time,k._startTime=o.frame,N._active=k._active=!0,A._updateRoot=function(){if(N.render((o.time-N._startTime)*N._timeScale,!1,!1),k.render((o.frame-k._startTime)*k._timeScale,!1,!1),!(o.frame%120)){var t,e,i;for(i in F){for(e=F[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete F[i]}if(i=N._first,(!i||i._paused)&&M.autoSleep&&!k._first&&1===o._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||o.sleep()}}},o.addEventListener("tick",A._updateRoot);var U=function(t,e,i){var r,o,n=t._gsTweenID;if(F[n||(t._gsTweenID=n="t"+I++)]||(F[n]={target:t,tweens:[]}),e&&(r=F[n].tweens,r[o=r.length]=e,i))for(;--o>-1;)r[o]===e&&r.splice(o,1);return F[n].tweens},G=function(t,e,i,r,o){var n,s,a,h;if(1===r||r>=4){for(h=o.length,n=0;h>n;n++)if((a=o[n])!==e)a._gc||a._enabled(!1,!1)&&(s=!0);else if(5===r)break;return s}var l,u=e._startTime+1e-10,c=[],p=0,d=0===e._duration;for(n=o.length;--n>-1;)(a=o[n])===e||a._gc||a._paused||(a._timeline!==e._timeline?(l=l||q(e,0,d),0===q(a,l,d)&&(c[p++]=a)):u>=a._startTime&&a._startTime+a.totalDuration()/a._timeScale+1e-10>u&&((d||!a._initted)&&2e-10>=u-a._startTime||(c[p++]=a)));for(n=p;--n>-1;)a=c[n],2===r&&a._kill(i,t)&&(s=!0),(2!==r||!a._firstPT&&a._initted)&&a._enabled(!1,!1)&&(s=!0);return s},q=function(t,e,i){for(var r=t._timeline,o=r._timeScale,n=t._startTime,s=1e-10;r._timeline;){if(n+=r._startTime,o*=r._timeScale,r._paused)return-100;r=r._timeline}return n/=o,n>e?n-e:i&&n===e||!t._initted&&2*s>n-e?s:(n+=t.totalDuration()/t._timeScale/o)>e+s?0:n-e-s};r._init=function(){var t,e,i,r,o=this.vars,n=this._overwrittenProps,s=this._duration,a=o.immediateRender,h=o.ease;if(o.startAt){if(this._startAt&&this._startAt.render(-1,!0),o.startAt.overwrite=0,o.startAt.immediateRender=!0,this._startAt=M.to(this.target,0,o.startAt),a)if(this._time>0)this._startAt=null;else if(0!==s)return}else if(o.runBackwards&&o.immediateRender&&0!==s)if(this._startAt)this._startAt.render(-1,!0),this._startAt=null;else if(0===this._time){i={};for(r in o)O[r]&&"autoCSS"!==r||(i[r]=o[r]);return i.overwrite=0,void(this._startAt=M.to(this.target,0,i))}if(this._ease=h?h instanceof g?o.easeParams instanceof Array?h.config.apply(h,o.easeParams):h:"function"==typeof h?new g(h,o.easeParams):y[h]||M.defaultEase:M.defaultEase,this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(t=this._targets.length;--t>-1;)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],n?n[t]:null)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,n);if(e&&M._onPluginEvent("_onInitAllProps",this),n&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),o.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=o.onUpdate,this._initted=!0},r._initProps=function(e,i,r,o){var n,s,a,h,l,u;if(null==e)return!1;this.vars.css||e.style&&e!==t&&e.nodeType&&R.css&&this.vars.autoCSS!==!1&&L(this.vars,e);for(n in this.vars){if(u=this.vars[n],O[n])u instanceof Array&&-1!==u.join("").indexOf("{self}")&&(this.vars[n]=u=this._swapSelfInParams(u,this));else if(R[n]&&(h=new R[n])._onInitTween(e,this.vars[n],this)){for(this._firstPT=l={_next:this._firstPT,t:h,p:"setRatio",s:0,c:1,f:!0,n:n,pg:!0,pr:h._priority},s=h._overwriteProps.length;--s>-1;)i[h._overwriteProps[s]]=this._firstPT;(h._priority||h._onInitAllProps)&&(a=!0),(h._onDisable||h._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=i[n]=l={_next:this._firstPT,t:e,p:n,f:"function"==typeof e[n],n:n,pg:!1,pr:0},l.s=l.f?e[n.indexOf("set")||"function"!=typeof e["get"+n.substr(3)]?n:"get"+n.substr(3)]():parseFloat(e[n]),l.c="string"==typeof u&&"="===u.charAt(1)?parseInt(u.charAt(0)+"1",10)*Number(u.substr(2)):Number(u)-l.s||0;l&&l._next&&(l._next._prev=l)}return o&&this._kill(o,e)?this._initProps(e,i,r,o):this._overwrite>1&&this._firstPT&&r.length>1&&G(e,this,i,this._overwrite,r)?(this._kill(i,e),this._initProps(e,i,r,o)):a},r.render=function(t,e,i){var r,o,n,s=this._time;if(t>=this._duration)this._totalTime=this._time=this._duration,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(r=!0,o="onComplete"),0===this._duration&&((0===t||0>this._rawPrevTime)&&this._rawPrevTime!==t&&(i=!0,this._rawPrevTime>0&&(o="onReverseComplete",e&&(t=-1))),this._rawPrevTime=t);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==s||0===this._duration&&this._rawPrevTime>0)&&(o="onReverseComplete",r=this._reversed),0>t?(this._active=!1,0===this._duration&&(this._rawPrevTime>=0&&(i=!0),this._rawPrevTime=t)):this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var a=t/this._duration,h=this._easeType,l=this._easePower;(1===h||3===h&&a>=.5)&&(a=1-a),3===h&&(a*=2),1===l?a*=a:2===l?a*=a*a:3===l?a*=a*a*a:4===l&&(a*=a*a*a*a),this.ratio=1===h?1-a:2===h?a:.5>t/this._duration?a/2:1-a/2}else this.ratio=this._ease.getRatio(t/this._duration);if(this._time!==s||i){if(!this._initted){if(this._init(),!this._initted)return;this._time&&!r?this.ratio=this._ease.getRatio(this._time/this._duration):r&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._active||!this._paused&&this._time!==s&&t>=0&&(this._active=!0),0===s&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):o||(o="_dummyGS")),this.vars.onStart&&(0!==this._time||0===this._duration)&&(e||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||v))),n=this._firstPT;n;)n.f?n.t[n.p](n.c*this.ratio+n.s):n.t[n.p]=n.c*this.ratio+n.s,n=n._next;this._onUpdate&&(0>t&&this._startAt&&this._startAt.render(t,e,i),e||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||v)),o&&(this._gc||(0>t&&this._startAt&&!this._onUpdate&&this._startAt.render(t,e,i),r&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[o]&&this.vars[o].apply(this.vars[o+"Scope"]||this,this.vars[o+"Params"]||v)))}},r._kill=function(t,e){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:M.selector(e)||e;var i,r,o,n,s,a,h,l;if((e instanceof Array||B(e))&&"number"!=typeof e[0])for(i=e.length;--i>-1;)this._kill(t,e[i])&&(a=!0);else{if(this._targets){for(i=this._targets.length;--i>-1;)if(e===this._targets[i]){s=this._propLookup[i]||{},this._overwrittenProps=this._overwrittenProps||[],r=this._overwrittenProps[i]=t?this._overwrittenProps[i]||{}:"all";break}}else{if(e!==this.target)return!1;s=this._propLookup,r=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(s){h=t||s,l=t!==r&&"all"!==r&&t!==s&&(null==t||t._tempKill!==!0);for(o in h)(n=s[o])&&(n.pg&&n.t._kill(h)&&(a=!0),n.pg&&0!==n.t._overwriteProps.length||(n._prev?n._prev._next=n._next:n===this._firstPT&&(this._firstPT=n._next),n._next&&(n._next._prev=n._prev),n._next=n._prev=null),delete s[o]),l&&(r[o]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return a},r.invalidate=function(){return this._notifyPluginsOfEnabled&&M._onPluginEvent("_onDisable",this),this._firstPT=null,this._overwrittenProps=null,this._onUpdate=null,this._startAt=null,this._initted=this._active=this._notifyPluginsOfEnabled=!1,this._propLookup=this._targets?{}:[],this},r._enabled=function(t,e){if(n||o.wake(),t&&this._gc){var i,r=this._targets;if(r)for(i=r.length;--i>-1;)this._siblings[i]=U(r[i],this,!0);else this._siblings=U(this.target,this,!0)}return A.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?M._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},M.to=function(t,e,i){return new M(t,e,i)},M.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new M(t,e,i)},M.fromTo=function(t,e,i,r){return r.startAt=i,r.immediateRender=0!=r.immediateRender&&0!=i.immediateRender,new M(t,e,r)},M.delayedCall=function(t,e,i,r,o){return new M(e,0,{delay:t,onComplete:e,onCompleteParams:i,onCompleteScope:r,onReverseComplete:e,onReverseCompleteParams:i,onReverseCompleteScope:r,immediateRender:!1,useFrames:o,overwrite:0})},M.set=function(t,e){return new M(t,0,e)},M.killTweensOf=M.killDelayedCallsTo=function(t,e){for(var i=M.getTweensOf(t),r=i.length;--r>-1;)i[r]._kill(e,t)},M.getTweensOf=function(t){if(null==t)return[];t="string"!=typeof t?t:M.selector(t)||t;var e,i,r,o;if((t instanceof Array||B(t))&&"number"!=typeof t[0]){for(e=t.length,i=[];--e>-1;)i=i.concat(M.getTweensOf(t[e]));for(e=i.length;--e>-1;)for(o=i[e],r=e;--r>-1;)o===i[r]&&i.splice(e,1)}else for(i=U(t).concat(),e=i.length;--e>-1;)i[e]._gc&&i.splice(e,1);return i};var V=f("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=V.prototype},!0);if(r=V.prototype,V.version="1.10.1",V.API=2,r._firstPT=null,r._addTween=function(t,e,i,r,o,n){var s,a;return null!=r&&(s="number"==typeof r||"="!==r.charAt(1)?Number(r)-i:parseInt(r.charAt(0)+"1",10)*Number(r.substr(2)))?(this._firstPT=a={_next:this._firstPT,t:t,p:e,s:i,c:s,f:"function"==typeof t[e],n:o||e,r:n},a._next&&(a._next._prev=a),a):void 0},r.setRatio=function(t){for(var e,i=this._firstPT,r=1e-6;i;)e=i.c*t+i.s,i.r?e=0|e+(e>0?.5:-.5):r>e&&e>-r&&(e=0),i.f?i.t[i.p](e):i.t[i.p]=e,i=i._next},r._kill=function(t){var e,i=this._overwriteProps,r=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;r;)null!=t[r.n]&&(r._next&&(r._next._prev=r._prev),r._prev?(r._prev._next=r._next,r._prev=null):this._firstPT===r&&(this._firstPT=r._next)),r=r._next;return!1},r._roundProps=function(t,e){for(var i=this._firstPT;i;)(t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")])&&(i.r=e),i=i._next},M._onPluginEvent=function(t,e){var i,r,o,n,s,a=e._firstPT;if("_onInitAllProps"===t){for(;a;){for(s=a._next,r=o;r&&r.pr>a.pr;)r=r._next;(a._prev=r?r._prev:n)?a._prev._next=a:o=a,(a._next=r)?r._prev=a:n=a,a=s}a=e._firstPT=o}for(;a;)a.pg&&"function"==typeof a.t[t]&&a.t[t]()&&(i=!0),a=a._next;return i},V.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===V.API&&(R[(new t[e])._propName]=t[e]);return!0},d.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,r=t.priority||0,o=t.overwriteProps,n={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},s=f("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){V.call(this,i,r),this._overwriteProps=o||[]},t.global===!0),a=s.prototype=new V(i);a.constructor=s,s.API=t.API;for(e in n)"function"==typeof t[e]&&(a[n[e]]=t[e]);return s.version=t.version,V.activate([s]),s},e=t._gsQueue){for(i=0;e.length>i;i++)e[i]();for(r in c)c[r].func||t.console.log("GSAP encountered missing dependency: com.greensock."+r)}n=!1}(window),define("TWEEN",function(){}),(window._gsQueue||(window._gsQueue=[])).push(function(){window._gsDefine("easing.Back",["easing.Ease"],function(t){var e,i,r,o=window.GreenSockGlobals||window,n=o.com.greensock,s=2*Math.PI,a=Math.PI/2,h=n._class,l=function(e,i){var r=h("easing."+e,function(){},!0),o=r.prototype=new t;return o.constructor=r,o.getRatio=i,r},u=t.register||function(){},c=function(t,e,i,r){var o=h("easing."+t,{easeOut:new e,easeIn:new i,easeInOut:new r},!0);return u(o,t),o},p=function(t,e,i){this.t=t,this.v=e,i&&(this.next=i,i.prev=this,this.c=i.v-e,this.gap=i.t-t)},d=function(e,i){var r=h("easing."+e,function(t){this._p1=t||0===t?t:1.70158,this._p2=1.525*this._p1},!0),o=r.prototype=new t;return o.constructor=r,o.getRatio=i,o.config=function(t){return new r(t)},r},f=c("Back",d("BackOut",function(t){return(t-=1)*t*((this._p1+1)*t+this._p1)+1}),d("BackIn",function(t){return t*t*((this._p1+1)*t-this._p1)}),d("BackInOut",function(t){return 1>(t*=2)?.5*t*t*((this._p2+1)*t-this._p2):.5*((t-=2)*t*((this._p2+1)*t+this._p2)+2)})),m=h("easing.SlowMo",function(t,e,i){e=e||0===e?e:.7,null==t?t=.7:t>1&&(t=1),this._p=1!==t?e:0,this._p1=(1-t)/2,this._p2=t,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),v=m.prototype=new t;return v.constructor=m,v.getRatio=function(t){var e=t+(.5-t)*this._p;return this._p1>t?this._calcEnd?1-(t=1-t/this._p1)*t:e-(t=1-t/this._p1)*t*t*t*e:t>this._p3?this._calcEnd?1-(t=(t-this._p3)/this._p1)*t:e+(t-e)*(t=(t-this._p3)/this._p1)*t*t*t:this._calcEnd?1:e},m.ease=new m(.7,.7),v.config=m.config=function(t,e,i){return new m(t,e,i)},e=h("easing.SteppedEase",function(t){t=t||1,this._p1=1/t,this._p2=t+1},!0),v=e.prototype=new t,v.constructor=e,v.getRatio=function(t){return 0>t?t=0:t>=1&&(t=.999999999),(this._p2*t>>0)*this._p1},v.config=e.config=function(t){return new e(t)},i=h("easing.RoughEase",function(e){e=e||{};for(var i,r,o,n,s,a,h=e.taper||"none",l=[],u=0,c=0|(e.points||20),d=c,f=e.randomize!==!1,m=e.clamp===!0,v=e.template instanceof t?e.template:null,g="number"==typeof e.strength?.4*e.strength:.4;--d>-1;)i=f?Math.random():1/c*d,r=v?v.getRatio(i):i,"none"===h?o=g:"out"===h?(n=1-i,o=n*n*g):"in"===h?o=i*i*g:.5>i?(n=2*i,o=.5*n*n*g):(n=2*(1-i),o=.5*n*n*g),f?r+=Math.random()*o-.5*o:d%2?r+=.5*o:r-=.5*o,m&&(r>1?r=1:0>r&&(r=0)),l[u++]={x:i,y:r};for(l.sort(function(t,e){return t.x-e.x}),a=new p(1,1,null),d=c;--d>-1;)s=l[d],a=new p(s.x,s.y,a);this._prev=new p(0,0,0!==a.t?a:a.next)},!0),v=i.prototype=new t,v.constructor=i,v.getRatio=function(t){var e=this._prev;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&e.t>=t;)e=e.prev;return this._prev=e,e.v+(t-e.t)/e.gap*e.c},v.config=function(t){return new i(t)},i.ease=new i,c("Bounce",l("BounceOut",function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}),l("BounceIn",function(t){return 1/2.75>(t=1-t)?1-7.5625*t*t:2/2.75>t?1-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}),l("BounceInOut",function(t){var e=.5>t;return t=e?1-2*t:2*t-1,t=1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5})),c("Circ",l("CircOut",function(t){return Math.sqrt(1-(t-=1)*t)}),l("CircIn",function(t){return-(Math.sqrt(1-t*t)-1)}),l("CircInOut",function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)})),r=function(e,i,r){var o=h("easing."+e,function(t,e){this._p1=t||1,this._p2=e||r,this._p3=this._p2/s*(Math.asin(1/this._p1)||0)},!0),n=o.prototype=new t;return n.constructor=o,n.getRatio=i,n.config=function(t,e){return new o(t,e)},o},c("Elastic",r("ElasticOut",function(t){return this._p1*Math.pow(2,-10*t)*Math.sin((t-this._p3)*s/this._p2)+1},.3),r("ElasticIn",function(t){return-(this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*s/this._p2))},.3),r("ElasticInOut",function(t){return 1>(t*=2)?-.5*this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*s/this._p2):.5*this._p1*Math.pow(2,-10*(t-=1))*Math.sin((t-this._p3)*s/this._p2)+1},.45)),c("Expo",l("ExpoOut",function(t){return 1-Math.pow(2,-10*t)}),l("ExpoIn",function(t){return Math.pow(2,10*(t-1))-.001}),l("ExpoInOut",function(t){return 1>(t*=2)?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))})),c("Sine",l("SineOut",function(t){return Math.sin(t*a)}),l("SineIn",function(t){return-Math.cos(t*a)+1}),l("SineInOut",function(t){return-.5*(Math.cos(Math.PI*t)-1)})),h("easing.EaseLookup",{find:function(e){return t.map[e]}},!0),u(o.SlowMo,"SlowMo","ease,"),u(i,"RoughEase","ease,"),u(e,"SteppedEase","ease,"),f},!0)}),window._gsDefine&&window._gsQueue.pop()(),define("EASEPACK",function(){}),(window._gsQueue||(window._gsQueue=[])).push(function(){window._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(t,e){var i,r,o,n,s=function(){t.call(this,"css"),this._overwriteProps.length=0},a={},h=s.prototype=new t("css");h.constructor=s,s.version="1.9.6",s.API=2,s.defaultTransformPerspective=0,h="px",s.suffixMap={top:h,right:h,bottom:h,left:h,width:h,height:h,fontSize:h,padding:h,margin:h,perspective:h};var l,u,c,p,d,f,m=/(?:\d|\-\d|\.\d|\-\.\d)+/g,v=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,g=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,y=/[^\d\-\.]/g,x=/(?:\d|\-|\+|=|#|\.)*/g,b=/opacity *= *([^)]*)/,w=/opacity:([^;]*)/,_=/alpha\(opacity *=.+?\)/i,T=/^(rgb|hsl)/,S=/([A-Z])/g,A=/-([a-z])/gi,C=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,E=function(t,e){return e.toUpperCase()},M=/(?:Left|Right|Width)/i,B=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,L=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,P=/,(?=[^\)]*(?:\(|$))/gi,R=Math.PI/180,F=180/Math.PI,I={},O=document,D=O.createElement("div"),k=O.createElement("img"),N=s._internals={_specialProps:a},U=navigator.userAgent,G=function(){var t,e=U.indexOf("Android"),i=O.createElement("div");return c=-1!==U.indexOf("Safari")&&-1===U.indexOf("Chrome")&&(-1===e||Number(U.substr(e+8,1))>3),d=c&&6>Number(U.substr(U.indexOf("Version/")+8,1)),p=-1!==U.indexOf("Firefox"),/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(U),f=parseFloat(RegExp.$1),i.innerHTML="<a style='top:1px;opacity:.55;'>a</a>",t=i.getElementsByTagName("a")[0],t?/^0.55/.test(t.style.opacity):!1}(),q=function(t){return b.test("string"==typeof t?t:(t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100:1},V=function(t){window.console&&void 0},j="",X="",W=function(t,e){e=e||D;var i,r,o=e.style;if(void 0!==o[t])return t;for(t=t.charAt(0).toUpperCase()+t.substr(1),i=["O","Moz","ms","Ms","Webkit"],r=5;--r>-1&&void 0===o[i[r]+t];);return r>=0?(X=3===r?"ms":i[r],j="-"+X.toLowerCase()+"-",X+t):null},Y=O.defaultView?O.defaultView.getComputedStyle:function(){},z=s.getStyle=function(t,e,i,r,o){var n;return G||"opacity"!==e?(!r&&t.style[e]?n=t.style[e]:(i=i||Y(t,null))?(t=i.getPropertyValue(e.replace(S,"-$1").toLowerCase()),n=t||i.length?t:i[e]):t.currentStyle&&(i=t.currentStyle,n=i[e]),null==o||n&&"none"!==n&&"auto"!==n&&"auto auto"!==n?n:o):q(t)},H=function(t,e,i,r,o){if("px"===r||!r)return i;if("auto"===r||!i)return 0;var n,s=M.test(e),a=t,h=D.style,l=0>i;return l&&(i=-i),"%"===r&&-1!==e.indexOf("border")?n=i/100*(s?t.clientWidth:t.clientHeight):(h.cssText="border-style:solid; border-width:0; position:absolute; line-height:0;","%"!==r&&a.appendChild?h[s?"borderLeftWidth":"borderTopWidth"]=i+r:(a=t.parentNode||O.body,h[s?"width":"height"]=i+r),a.appendChild(D),n=parseFloat(D[s?"offsetWidth":"offsetHeight"]),a.removeChild(D),0!==n||o||(n=H(t,e,i,r,!0))),l?-n:n},K=function(t,e,i){if("absolute"!==z(t,"position",i))return 0;var r="left"===e?"Left":"Top",o=z(t,"margin"+r,i);return t["offset"+r]-(H(t,e,parseFloat(o),o.replace(x,""))||0)},J=function(t,e){var i,r,o={};if(e=e||Y(t,null))if(i=e.length)for(;--i>-1;)o[e[i].replace(A,E)]=e.getPropertyValue(e[i]);else for(i in e)o[i]=e[i];else if(e=t.currentStyle||t.style)for(i in e)o[i.replace(A,E)]=e[i];return G||(o.opacity=q(t)),r=Te(t,e,!1),o.rotation=r.rotation*F,o.skewX=r.skewX*F,o.scaleX=r.scaleX,o.scaleY=r.scaleY,o.x=r.x,o.y=r.y,_e&&(o.z=r.z,o.rotationX=r.rotationX*F,o.rotationY=r.rotationY*F,o.scaleZ=r.scaleZ),o.filters&&delete o.filters,o},Z=function(t,e,i,r,o){var n,s,a,h={},l=t.style;for(s in i)"cssText"!==s&&"length"!==s&&isNaN(s)&&(e[s]!==(n=i[s])||o&&o[s])&&-1===s.indexOf("Origin")&&("number"==typeof n||"string"==typeof n)&&(h[s]="auto"!==n||"left"!==s&&"top"!==s?""!==n&&"auto"!==n&&"none"!==n||"string"!=typeof e[s]||""===e[s].replace(y,"")?n:0:K(t,s),void 0!==l[s]&&(a=new ce(l,s,l[s],a)));
if(r)for(s in r)"className"!==s&&(h[s]=r[s]);return{difs:h,firstMPT:a}},$={width:["Left","Right"],height:["Top","Bottom"]},Q=["marginLeft","marginRight","marginTop","marginBottom"],te=function(t,e,i){var r=parseFloat("width"===e?t.offsetWidth:t.offsetHeight),o=$[e],n=o.length;for(i=i||Y(t,null);--n>-1;)r-=parseFloat(z(t,"padding"+o[n],i,!0))||0,r-=parseFloat(z(t,"border"+o[n]+"Width",i,!0))||0;return r},ee=function(t,e){(null==t||""===t||"auto"===t||"auto auto"===t)&&(t="0 0");var i=t.split(" "),r=-1!==t.indexOf("left")?"0%":-1!==t.indexOf("right")?"100%":i[0],o=-1!==t.indexOf("top")?"0%":-1!==t.indexOf("bottom")?"100%":i[1];return null==o?o="0":"center"===o&&(o="50%"),("center"===r||isNaN(parseFloat(r)))&&(r="50%"),e&&(e.oxp=-1!==r.indexOf("%"),e.oyp=-1!==o.indexOf("%"),e.oxr="="===r.charAt(1),e.oyr="="===o.charAt(1),e.ox=parseFloat(r.replace(y,"")),e.oy=parseFloat(o.replace(y,""))),r+" "+o+(i.length>2?" "+i[2]:"")},ie=function(t,e){return"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2)):parseFloat(t)-parseFloat(e)},re=function(t,e){return null==t?e:"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*Number(t.substr(2))+e:parseFloat(t)},oe=function(t,e,i,r){var o,n,s,a,h=1e-6;return null==t?a=e:"number"==typeof t?a=t*R:(o=2*Math.PI,n=t.split("_"),s=Number(n[0].replace(y,""))*(-1===t.indexOf("rad")?R:1)-("="===t.charAt(1)?0:e),n.length&&(r&&(r[i]=e+s),-1!==t.indexOf("short")&&(s%=o,s!==s%(o/2)&&(s=0>s?s+o:s-o)),-1!==t.indexOf("_cw")&&0>s?s=(s+9999999999*o)%o-(0|s/o)*o:-1!==t.indexOf("ccw")&&s>0&&(s=(s-9999999999*o)%o-(0|s/o)*o)),a=e+s),h>a&&a>-h&&(a=0),a},ne={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},se=function(t,e,i){return t=0>t?t+1:t>1?t-1:t,0|255*(1>6*t?e+6*(i-e)*t:.5>t?i:2>3*t?e+6*(i-e)*(2/3-t):e)+.5},ae=function(t){var e,i,r,o,n,s;return t&&""!==t?"number"==typeof t?[t>>16,255&t>>8,255&t]:(","===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),ne[t]?ne[t]:"#"===t.charAt(0)?(4===t.length&&(e=t.charAt(1),i=t.charAt(2),r=t.charAt(3),t="#"+e+e+i+i+r+r),t=parseInt(t.substr(1),16),[t>>16,255&t>>8,255&t]):"hsl"===t.substr(0,3)?(t=t.match(m),o=Number(t[0])%360/360,n=Number(t[1])/100,s=Number(t[2])/100,i=.5>=s?s*(n+1):s+n-s*n,e=2*s-i,t.length>3&&(t[3]=Number(t[3])),t[0]=se(o+1/3,e,i),t[1]=se(o,e,i),t[2]=se(o-1/3,e,i),t):(t=t.match(m)||ne.transparent,t[0]=Number(t[0]),t[1]=Number(t[1]),t[2]=Number(t[2]),t.length>3&&(t[3]=Number(t[3])),t)):ne.black},he="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(h in ne)he+="|"+h+"\\b";he=RegExp(he+")","gi");var le=function(t,e,i,r){if(null==t)return function(t){return t};var o,n=e?(t.match(he)||[""])[0]:"",s=t.split(n).join("").match(g)||[],a=t.substr(0,t.indexOf(s[0])),h=")"===t.charAt(t.length-1)?")":"",l=-1!==t.indexOf(" ")?" ":",",u=s.length,c=u>0?s[0].replace(m,""):"";return u?o=e?function(t){var e,p,d,f;if("number"==typeof t)t+=c;else if(r&&P.test(t)){for(f=t.replace(P,"|").split("|"),d=0;f.length>d;d++)f[d]=o(f[d]);return f.join(",")}if(e=(t.match(he)||[n])[0],p=t.split(e).join("").match(g)||[],d=p.length,u>d--)for(;u>++d;)p[d]=i?p[0|(d-1)/2]:s[d];return a+p.join(l)+l+e+h+(-1!==t.indexOf("inset")?" inset":"")}:function(t){var e,n,p;if("number"==typeof t)t+=c;else if(r&&P.test(t)){for(n=t.replace(P,"|").split("|"),p=0;n.length>p;p++)n[p]=o(n[p]);return n.join(",")}if(e=t.match(g)||[],p=e.length,u>p--)for(;u>++p;)e[p]=i?e[0|(p-1)/2]:s[p];return a+e.join(l)+h}:function(t){return t}},ue=function(t){return t=t.split(","),function(e,i,r,o,n,s,a){var h,l=(i+"").split(" ");for(a={},h=0;4>h;h++)a[t[h]]=l[h]=l[h]||l[(h-1)/2>>0];return o.parse(e,a,n,s)}},ce=(N._setPluginRatio=function(t){this.plugin.setRatio(t);for(var e,i,r,o,n=this.data,s=n.proxy,a=n.firstMPT,h=1e-6;a;)e=s[a.v],a.r?e=e>0?0|e+.5:0|e-.5:h>e&&e>-h&&(e=0),a.t[a.p]=e,a=a._next;if(n.autoRotate&&(n.autoRotate.rotation=s.rotation),1===t)for(a=n.firstMPT;a;){if(i=a.t,i.type){if(1===i.type){for(o=i.xs0+i.s+i.xs1,r=1;i.l>r;r++)o+=i["xn"+r]+i["xs"+(r+1)];i.e=o}}else i.e=i.s+i.xs0;a=a._next}},function(t,e,i,r,o){this.t=t,this.p=e,this.v=i,this.r=o,r&&(r._prev=this,this._next=r)}),pe=(N._parseToProxy=function(t,e,i,r,o,n){var s,a,h,l,u,c=r,p={},d={},f=i._transform,m=I;for(i._transform=null,I=e,r=u=i.parse(t,e,r,o),I=m,n&&(i._transform=f,c&&(c._prev=null,c._prev&&(c._prev._next=null)));r&&r!==c;){if(1>=r.type&&(a=r.p,d[a]=r.s+r.c,p[a]=r.s,n||(l=new ce(r,"s",a,l,r.r),r.c=0),1===r.type))for(s=r.l;--s>0;)h="xn"+s,a=r.p+"_"+h,d[a]=r.data[h],p[a]=r[h],n||(l=new ce(r,h,a,l,r.rxp[h]));r=r._next}return{proxy:p,end:d,firstMPT:l,pt:u}},N.CSSPropTween=function(t,e,r,o,s,a,h,l,u,c,p){this.t=t,this.p=e,this.s=r,this.c=o,this.n=h||"css_"+e,t instanceof pe||n.push(this.n),this.r=l,this.type=a||0,u&&(this.pr=u,i=!0),this.b=void 0===c?r:c,this.e=void 0===p?r+o:p,s&&(this._next=s,s._prev=this)}),de=s.parseComplex=function(t,e,i,r,o,n,s,a,h,u){s=new pe(t,e,0,0,s,u?2:1,null,!1,a,i,r),r+="";var c,p,d,f,g,y,x,b,w,_,S,A,C=i.split(", ").join(",").split(" "),E=r.split(", ").join(",").split(" "),M=C.length,B=l!==!1;for((-1!==r.indexOf(",")||-1!==i.indexOf(","))&&(C=C.join(" ").replace(P,", ").split(" "),E=E.join(" ").replace(P,", ").split(" "),M=C.length),M!==E.length&&(C=(n||"").split(" "),M=C.length),s.plugin=h,s.setRatio=u,c=0;M>c;c++)if(f=C[c],g=E[c],b=parseFloat(f),b||0===b)s.appendXtra("",b,ie(g,b),g.replace(v,""),B&&-1!==g.indexOf("px"),!0);else if(o&&("#"===f.charAt(0)||ne[f]||T.test(f)))A=","===g.charAt(g.length-1)?"),":")",f=ae(f),g=ae(g),w=f.length+g.length>6,w&&!G&&0===g[3]?(s["xs"+s.l]+=s.l?" transparent":"transparent",s.e=s.e.split(E[c]).join("transparent")):(G||(w=!1),s.appendXtra(w?"rgba(":"rgb(",f[0],g[0]-f[0],",",!0,!0).appendXtra("",f[1],g[1]-f[1],",",!0).appendXtra("",f[2],g[2]-f[2],w?",":A,!0),w&&(f=4>f.length?1:f[3],s.appendXtra("",f,(4>g.length?1:g[3])-f,A,!1)));else if(y=f.match(m)){if(x=g.match(v),!x||x.length!==y.length)return s;for(d=0,p=0;y.length>p;p++)S=y[p],_=f.indexOf(S,d),s.appendXtra(f.substr(d,_-d),Number(S),ie(x[p],S),"",B&&"px"===f.substr(_+S.length,2),0===p),d=_+S.length;s["xs"+s.l]+=f.substr(d)}else s["xs"+s.l]+=s.l?" "+f:f;if(-1!==r.indexOf("=")&&s.data){for(A=s.xs0+s.data.s,c=1;s.l>c;c++)A+=s["xs"+c]+s.data["xn"+c];s.e=A+s["xs"+c]}return s.l||(s.type=-1,s.xs0=s.e),s.xfirst||s},fe=9;for(h=pe.prototype,h.l=h.pr=0;--fe>0;)h["xn"+fe]=0,h["xs"+fe]="";h.xs0="",h._next=h._prev=h.xfirst=h.data=h.plugin=h.setRatio=h.rxp=null,h.appendXtra=function(t,e,i,r,o,n){var s=this,a=s.l;return s["xs"+a]+=n&&a?" "+t:t||"",i||0===a||s.plugin?(s.l++,s.type=s.setRatio?2:1,s["xs"+s.l]=r||"",a>0?(s.data["xn"+a]=e+i,s.rxp["xn"+a]=o,s["xn"+a]=e,s.plugin||(s.xfirst=new pe(s,"xn"+a,e,i,s.xfirst||s,0,s.n,o,s.pr),s.xfirst.xs0=0),s):(s.data={s:e+i},s.rxp={},s.s=e,s.c=i,s.r=o,s)):(s["xs"+a]+=e+(r||""),s)};var me=function(t,e){e=e||{},this.p=e.prefix?W(t)||t:t,a[t]=a[this.p]=this,this.format=e.formatter||le(e.defaultValue,e.color,e.collapsible,e.multi),e.parser&&(this.parse=e.parser),this.clrs=e.color,this.multi=e.multi,this.keyword=e.keyword,this.dflt=e.defaultValue,this.pr=e.priority||0},ve=N._registerComplexSpecialProp=function(t,e,i){"object"!=typeof e&&(e={parser:i});var r,o,n=t.split(","),s=e.defaultValue;for(i=i||[s],r=0;n.length>r;r++)e.prefix=0===r&&e.prefix,e.defaultValue=i[r]||s,o=new me(n[r],e)},ge=function(t){if(!a[t]){var e=t.charAt(0).toUpperCase()+t.substr(1)+"Plugin";ve(t,{parser:function(t,i,r,o,n,s,h){var l=(window.GreenSockGlobals||window).com.greensock.plugins[e];return l?(l._cssRegister(),a[r].parse(t,i,r,o,n,s,h)):(V("Error: "+e+" js file not loaded."),n)}})}};h=me.prototype,h.parseComplex=function(t,e,i,r,o,n){var s,a,h,l,u,c,p=this.keyword;if(this.multi&&(P.test(i)||P.test(e)?(a=e.replace(P,"|").split("|"),h=i.replace(P,"|").split("|")):p&&(a=[e],h=[i])),h){for(l=h.length>a.length?h.length:a.length,s=0;l>s;s++)e=a[s]=a[s]||this.dflt,i=h[s]=h[s]||this.dflt,p&&(u=e.indexOf(p),c=i.indexOf(p),u!==c&&(i=-1===c?h:a,i[s]+=" "+p));e=a.join(", "),i=h.join(", ")}return de(t,this.p,e,i,this.clrs,this.dflt,r,this.pr,o,n)},h.parse=function(t,e,i,r,n,s){return this.parseComplex(t.style,this.format(z(t,this.p,o,!1,this.dflt)),this.format(e),n,s)},s.registerSpecialProp=function(t,e,i){ve(t,{parser:function(t,r,o,n,s,a){var h=new pe(t,o,0,0,s,2,o,!1,i);return h.plugin=a,h.setRatio=e(t,r,n._tween,o),h},priority:i})};var ye="scaleX,scaleY,scaleZ,x,y,z,skewX,rotation,rotationX,rotationY,perspective".split(","),xe=W("transform"),be=j+"transform",we=W("transformOrigin"),_e=null!==W("perspective"),Te=function(t,e,i){var r,o,n,a,h,l,u,c,p,d,f,m,v,g=i?t._gsTransform||{skewY:0}:{skewY:0},y=0>g.scaleX,x=2e-5,b=1e5,w=-Math.PI+1e-4,_=Math.PI-1e-4,T=_e?parseFloat(z(t,we,e,!1,"0 0 0").split(" ")[2])||g.zOrigin||0:0;if(xe)r=z(t,be,e,!0);else if(t.currentStyle)if(r=t.currentStyle.filter.match(B),r&&4===r.length)r=[r[0].substr(4),Number(r[2].substr(4)),Number(r[1].substr(4)),r[3].substr(4),g.x||0,g.y||0].join(",");else{if(null!=g.x)return g;r=""}for(o=(r||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],n=o.length;--n>-1;)a=Number(o[n]),o[n]=(h=a-(a|=0))?(0|h*b+(0>h?-.5:.5))/b+a:a;if(16===o.length){var S=o[8],A=o[9],C=o[10],E=o[12],M=o[13],L=o[14];if(g.zOrigin&&(L=-g.zOrigin,E=S*L-o[12],M=A*L-o[13],L=C*L+g.zOrigin-o[14]),!i||null==g.rotationX){var P,R,F,I,O,D,k,N=o[0],U=o[1],G=o[2],q=o[3],V=o[4],j=o[5],X=o[6],W=o[7],Y=o[11],H=g.rotationX=Math.atan2(X,C),K=w>H||H>_;H&&(I=Math.cos(-H),O=Math.sin(-H),P=V*I+S*O,R=j*I+A*O,F=X*I+C*O,S=V*-O+S*I,A=j*-O+A*I,C=X*-O+C*I,Y=W*-O+Y*I,V=P,j=R,X=F),H=g.rotationY=Math.atan2(S,N),H&&(D=w>H||H>_,I=Math.cos(-H),O=Math.sin(-H),P=N*I-S*O,R=U*I-A*O,F=G*I-C*O,A=U*O+A*I,C=G*O+C*I,Y=q*O+Y*I,N=P,U=R,G=F),H=g.rotation=Math.atan2(U,j),H&&(k=w>H||H>_,I=Math.cos(-H),O=Math.sin(-H),N=N*I+V*O,R=U*I+j*O,j=U*-O+j*I,X=G*-O+X*I,U=R),k&&K?g.rotation=g.rotationX=0:k&&D?g.rotation=g.rotationY=0:D&&K&&(g.rotationY=g.rotationX=0),g.scaleX=(0|Math.sqrt(N*N+U*U)*b+.5)/b,g.scaleY=(0|Math.sqrt(j*j+A*A)*b+.5)/b,g.scaleZ=(0|Math.sqrt(X*X+C*C)*b+.5)/b,g.skewX=0,g.perspective=Y?1/(0>Y?-Y:Y):0,g.x=E,g.y=M,g.z=L}}else if(!(_e&&0!==o.length&&g.x===o[4]&&g.y===o[5]&&(g.rotationX||g.rotationY)||void 0!==g.x&&"none"===z(t,"display",e))){var J=o.length>=6,Z=J?o[0]:1,$=o[1]||0,Q=o[2]||0,te=J?o[3]:1;g.x=o[4]||0,g.y=o[5]||0,l=Math.sqrt(Z*Z+$*$),u=Math.sqrt(te*te+Q*Q),c=Z||$?Math.atan2($,Z):g.rotation||0,p=Q||te?Math.atan2(Q,te)+c:g.skewX||0,d=l-Math.abs(g.scaleX||0),f=u-Math.abs(g.scaleY||0),Math.abs(p)>Math.PI/2&&Math.abs(p)<1.5*Math.PI&&(y?(l*=-1,p+=0>=c?Math.PI:-Math.PI,c+=0>=c?Math.PI:-Math.PI):(u*=-1,p+=0>=p?Math.PI:-Math.PI)),m=(c-g.rotation)%Math.PI,v=(p-g.skewX)%Math.PI,(void 0===g.skewX||d>x||-x>d||f>x||-x>f||m>w&&_>m&&!1|m*b||v>w&&_>v&&!1|v*b)&&(g.scaleX=l,g.scaleY=u,g.rotation=c,g.skewX=p),_e&&(g.rotationX=g.rotationY=g.z=0,g.perspective=parseFloat(s.defaultTransformPerspective)||0,g.scaleZ=1)}g.zOrigin=T;for(n in g)x>g[n]&&g[n]>-x&&(g[n]=0);return i&&(t._gsTransform=g),g},Se=function(t){var e,i,r=this.data,o=-r.rotation,n=o+r.skewX,s=1e5,a=(0|Math.cos(o)*r.scaleX*s)/s,h=(0|Math.sin(o)*r.scaleX*s)/s,l=(0|Math.sin(n)*-r.scaleY*s)/s,u=(0|Math.cos(n)*r.scaleY*s)/s,c=this.t.style,p=this.t.currentStyle;if(p){i=h,h=-l,l=-i,e=p.filter,c.filter="";var d,m,v=this.t.offsetWidth,g=this.t.offsetHeight,y="absolute"!==p.position,w="progid:DXImageTransform.Microsoft.Matrix(M11="+a+", M12="+h+", M21="+l+", M22="+u,_=r.x,T=r.y;if(null!=r.ox&&(d=(r.oxp?.01*v*r.ox:r.ox)-v/2,m=(r.oyp?.01*g*r.oy:r.oy)-g/2,_+=d-(d*a+m*h),T+=m-(d*l+m*u)),y)d=v/2,m=g/2,w+=", Dx="+(d-(d*a+m*h)+_)+", Dy="+(m-(d*l+m*u)+T)+")";else{var S,A,C,E=8>f?1:-1;for(d=r.ieOffsetX||0,m=r.ieOffsetY||0,r.ieOffsetX=Math.round((v-((0>a?-a:a)*v+(0>h?-h:h)*g))/2+_),r.ieOffsetY=Math.round((g-((0>u?-u:u)*g+(0>l?-l:l)*v))/2+T),fe=0;4>fe;fe++)A=Q[fe],S=p[A],i=-1!==S.indexOf("px")?parseFloat(S):H(this.t,A,parseFloat(S),S.replace(x,""))||0,C=i!==r[A]?2>fe?-r.ieOffsetX:-r.ieOffsetY:2>fe?d-r.ieOffsetX:m-r.ieOffsetY,c[A]=(r[A]=Math.round(i-C*(0===fe||2===fe?1:E)))+"px";w+=", sizingMethod='auto expand')"}c.filter=-1!==e.indexOf("DXImageTransform.Microsoft.Matrix(")?e.replace(L,w):w+" "+e,(0===t||1===t)&&1===a&&0===h&&0===l&&1===u&&(y&&-1===w.indexOf("Dx=0, Dy=0")||b.test(e)&&100!==parseFloat(RegExp.$1)||-1===e.indexOf("gradient(")&&c.removeAttribute("filter"))}},Ae=function(){var t,e,i,r,o,n,s,a,h,l=this.data,u=this.t.style,c=l.perspective,d=l.scaleX,f=0,m=0,v=0,g=0,y=l.scaleY,x=0,b=0,w=0,_=0,T=l.scaleZ,S=0,A=0,C=0,E=c?-1/c:0,M=l.rotation,B=l.zOrigin,L=1e5;p&&(s=u.top?"top":u.bottom?"bottom":parseFloat(z(this.t,"top",null,!1))?"bottom":"top",i=z(this.t,s,null,!1),a=parseFloat(i)||0,h=i.substr((a+"").length)||"px",l._ffFix=!l._ffFix,u[s]=(l._ffFix?a+.05:a-.05)+h),(M||l.skewX)&&(i=d*Math.cos(M),r=y*Math.sin(M),M-=l.skewX,f=d*-Math.sin(M),y*=Math.cos(M),d=i,g=r),M=l.rotationY,M&&(t=Math.cos(M),e=Math.sin(M),i=d*t,r=g*t,o=T*-e,n=E*-e,m=d*e,x=g*e,T*=t,E*=t,d=i,g=r,w=o,A=n),M=l.rotationX,M&&(t=Math.cos(M),e=Math.sin(M),i=f*t+m*e,r=y*t+x*e,o=_*t+T*e,n=C*t+E*e,m=f*-e+m*t,x=y*-e+x*t,T=_*-e+T*t,E=C*-e+E*t,f=i,y=r,_=o,C=n),B&&(S-=B,v=m*S,b=x*S,S=T*S+B),v=(i=(v+=l.x)-(v|=0))?(0|i*L+(0>i?-.5:.5))/L+v:v,b=(i=(b+=l.y)-(b|=0))?(0|i*L+(0>i?-.5:.5))/L+b:b,S=(i=(S+=l.z)-(S|=0))?(0|i*L+(0>i?-.5:.5))/L+S:S,u[xe]="matrix3d("+[(0|d*L)/L,(0|g*L)/L,(0|w*L)/L,(0|A*L)/L,(0|f*L)/L,(0|y*L)/L,(0|_*L)/L,(0|C*L)/L,(0|m*L)/L,(0|x*L)/L,(0|T*L)/L,(0|E*L)/L,v,b,S,c?1+-S/c:1].join(",")+")"},Ce=function(){var t,e,i,r,o,n,s,a,h,l=this.data,u=this.t,c=u.style;p&&(t=c.top?"top":c.bottom?"bottom":parseFloat(z(u,"top",null,!1))?"bottom":"top",e=z(u,t,null,!1),i=parseFloat(e)||0,r=e.substr((i+"").length)||"px",l._ffFix=!l._ffFix,c[t]=(l._ffFix?i+.05:i-.05)+r),l.rotation||l.skewX?(o=l.rotation,n=o-l.skewX,s=1e5,a=l.scaleX*s,h=l.scaleY*s,c[xe]="matrix("+(0|Math.cos(o)*a)/s+","+(0|Math.sin(o)*a)/s+","+(0|Math.sin(n)*-h)/s+","+(0|Math.cos(n)*h)/s+","+l.x+","+l.y+")"):c[xe]="matrix("+l.scaleX+",0,0,"+l.scaleY+","+l.x+","+l.y+")"};ve("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation",{parser:function(t,e,i,r,n,s,a){if(r._transform)return n;var h,l,u,c,p,d,f,m=r._transform=Te(t,o,!0),v=t.style,g=1e-6,y=ye.length,x=a,b={};if("string"==typeof x.transform&&xe)u=v.cssText,v[xe]=x.transform,v.display="block",h=Te(t,null,!1),v.cssText=u;else if("object"==typeof x){if(h={scaleX:re(null!=x.scaleX?x.scaleX:x.scale,m.scaleX),scaleY:re(null!=x.scaleY?x.scaleY:x.scale,m.scaleY),scaleZ:re(null!=x.scaleZ?x.scaleZ:x.scale,m.scaleZ),x:re(x.x,m.x),y:re(x.y,m.y),z:re(x.z,m.z),perspective:re(x.transformPerspective,m.perspective)},f=x.directionalRotation,null!=f)if("object"==typeof f)for(u in f)x[u]=f[u];else x.rotation=f;h.rotation=oe("rotation"in x?x.rotation:"shortRotation"in x?x.shortRotation+"_short":"rotationZ"in x?x.rotationZ:m.rotation*F,m.rotation,"rotation",b),_e&&(h.rotationX=oe("rotationX"in x?x.rotationX:"shortRotationX"in x?x.shortRotationX+"_short":m.rotationX*F||0,m.rotationX,"rotationX",b),h.rotationY=oe("rotationY"in x?x.rotationY:"shortRotationY"in x?x.shortRotationY+"_short":m.rotationY*F||0,m.rotationY,"rotationY",b)),h.skewX=null==x.skewX?m.skewX:oe(x.skewX,m.skewX),h.skewY=null==x.skewY?m.skewY:oe(x.skewY,m.skewY),(l=h.skewY-m.skewY)&&(h.skewX+=l,h.rotation+=l)}for(p=m.z||m.rotationX||m.rotationY||h.z||h.rotationX||h.rotationY||h.perspective,p||null==x.scale||(h.scaleZ=1);--y>-1;)i=ye[y],c=h[i]-m[i],(c>g||-g>c||null!=I[i])&&(d=!0,n=new pe(m,i,m[i],c,n),i in b&&(n.e=b[i]),n.xs0=0,n.plugin=s,r._overwriteProps.push(n.n));return c=x.transformOrigin,(c||_e&&p&&m.zOrigin)&&(xe?(d=!0,c=(c||z(t,i,o,!1,"50% 50%"))+"",i=we,n=new pe(v,i,0,0,n,-1,"css_transformOrigin"),n.b=v[i],n.plugin=s,_e?(u=m.zOrigin,c=c.split(" "),m.zOrigin=(c.length>2?parseFloat(c[2]):u)||0,n.xs0=n.e=v[i]=c[0]+" "+(c[1]||"50%")+" 0px",n=new pe(m,"zOrigin",0,0,n,-1,n.n),n.b=u,n.xs0=n.e=m.zOrigin):n.xs0=n.e=v[i]=c):ee(c+"",m)),d&&(r._transformType=p||3===this._transformType?3:2),n},prefix:!0}),ve("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),ve("borderRadius",{defaultValue:"0px",parser:function(t,e,i,n,s){e=this.format(e);var a,h,l,u,c,p,d,f,m,v,g,y,x,b,w,_,T=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],S=t.style;for(m=parseFloat(t.offsetWidth),v=parseFloat(t.offsetHeight),a=e.split(" "),h=0;T.length>h;h++)this.p.indexOf("border")&&(T[h]=W(T[h])),c=u=z(t,T[h],o,!1,"0px"),-1!==c.indexOf(" ")&&(u=c.split(" "),c=u[0],u=u[1]),p=l=a[h],d=parseFloat(c),y=c.substr((d+"").length),x="="===p.charAt(1),x?(f=parseInt(p.charAt(0)+"1",10),p=p.substr(2),f*=parseFloat(p),g=p.substr((f+"").length-(0>f?1:0))||""):(f=parseFloat(p),g=p.substr((f+"").length)),""===g&&(g=r[i]||y),g!==y&&(b=H(t,"borderLeft",d,y),w=H(t,"borderTop",d,y),"%"===g?(c=100*(b/m)+"%",u=100*(w/v)+"%"):"em"===g?(_=H(t,"borderLeft",1,"em"),c=b/_+"em",u=w/_+"em"):(c=b+"px",u=w+"px"),x&&(p=parseFloat(c)+f+g,l=parseFloat(u)+f+g)),s=de(S,T[h],c+" "+u,p+" "+l,!1,"0px",s);return s},prefix:!0,formatter:le("0px 0px 0px 0px",!1,!0)}),ve("backgroundPosition",{defaultValue:"0 0",parser:function(t,e,i,r,n,s){var a,h,l,u,c,p,d="background-position",m=o||Y(t,null),v=this.format((m?f?m.getPropertyValue(d+"-x")+" "+m.getPropertyValue(d+"-y"):m.getPropertyValue(d):t.currentStyle.backgroundPositionX+" "+t.currentStyle.backgroundPositionY)||"0 0"),g=this.format(e);if(-1!==v.indexOf("%")!=(-1!==g.indexOf("%"))&&(p=z(t,"backgroundImage").replace(C,""),p&&"none"!==p)){for(a=v.split(" "),h=g.split(" "),k.setAttribute("src",p),l=2;--l>-1;)v=a[l],u=-1!==v.indexOf("%"),u!==(-1!==h[l].indexOf("%"))&&(c=0===l?t.offsetWidth-k.width:t.offsetHeight-k.height,a[l]=u?parseFloat(v)/100*c+"px":100*(parseFloat(v)/c)+"%");v=a.join(" ")}return this.parseComplex(t.style,v,g,n,s)},formatter:ee}),ve("backgroundSize",{defaultValue:"0 0",formatter:ee}),ve("perspective",{defaultValue:"0px",prefix:!0}),ve("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),ve("transformStyle",{prefix:!0}),ve("backfaceVisibility",{prefix:!0}),ve("margin",{parser:ue("marginTop,marginRight,marginBottom,marginLeft")}),ve("padding",{parser:ue("paddingTop,paddingRight,paddingBottom,paddingLeft")}),ve("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(t,e,i,r,n,s){var a,h,l;return 9>f?(h=t.currentStyle,l=8>f?" ":",",a="rect("+h.clipTop+l+h.clipRight+l+h.clipBottom+l+h.clipLeft+")",e=this.format(e).split(",").join(l)):(a=this.format(z(t,this.p,o,!1,this.dflt)),e=this.format(e)),this.parseComplex(t.style,a,e,n,s)}}),ve("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),ve("autoRound,strictUnits",{parser:function(t,e,i,r,o){return o}}),ve("border",{defaultValue:"0px solid #000",parser:function(t,e,i,r,n,s){return this.parseComplex(t.style,this.format(z(t,"borderTopWidth",o,!1,"0px")+" "+z(t,"borderTopStyle",o,!1,"solid")+" "+z(t,"borderTopColor",o,!1,"#000")),this.format(e),n,s)},color:!0,formatter:function(t){var e=t.split(" ");return e[0]+" "+(e[1]||"solid")+" "+(t.match(he)||["#000"])[0]}}),ve("float,cssFloat,styleFloat",{parser:function(t,e,i,r,o){var n=t.style,s="cssFloat"in n?"cssFloat":"styleFloat";return new pe(n,s,0,0,o,-1,i,!1,0,n[s],e)}});var Ee=function(t){var e,i=this.t,r=i.filter,o=0|this.s+this.c*t;100===o&&(-1===r.indexOf("atrix(")&&-1===r.indexOf("radient(")?(i.removeAttribute("filter"),e=!z(this.data,"filter")):(i.filter=r.replace(_,""),e=!0)),e||(this.xn1&&(i.filter=r=r||"alpha(opacity=100)"),-1===r.indexOf("opacity")?i.filter+=" alpha(opacity="+o+")":i.filter=r.replace(b,"opacity="+o))};ve("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(t,e,i,r,n,s){var a,h=parseFloat(z(t,"opacity",o,!1,"1")),l=t.style;return e=parseFloat(e),"autoAlpha"===i&&(a=z(t,"visibility",o),1===h&&"hidden"===a&&0!==e&&(h=0),n=new pe(l,"visibility",0,0,n,-1,null,!1,0,0!==h?"visible":"hidden",0===e?"hidden":"visible"),n.xs0="visible",r._overwriteProps.push(n.n)),G?n=new pe(l,"opacity",h,e-h,n):(n=new pe(l,"opacity",100*h,100*(e-h),n),n.xn1="autoAlpha"===i?1:0,l.zoom=1,n.type=2,n.b="alpha(opacity="+n.s+")",n.e="alpha(opacity="+(n.s+n.c)+")",n.data=t,n.plugin=s,n.setRatio=Ee),n}});var Me=function(t,e){e&&(t.removeProperty?t.removeProperty(e.replace(S,"-$1").toLowerCase()):t.removeAttribute(e))},Be=function(t){if(this.t._gsClassPT=this,1===t||0===t){this.t.className=0===t?this.b:this.e;for(var e=this.data,i=this.t.style;e;)e.v?i[e.p]=e.v:Me(i,e.p),e=e._next;1===t&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.className!==this.e&&(this.t.className=this.e)};ve("className",{parser:function(t,e,r,n,s,a,h){var l,u,c,p,d,f=t.className,m=t.style.cssText;if(s=n._classNamePT=new pe(t,r,0,0,s,2),s.setRatio=Be,s.pr=-11,i=!0,s.b=f,u=J(t,o),c=t._gsClassPT){for(p={},d=c.data;d;)p[d.p]=1,d=d._next;c.setRatio(1)}return t._gsClassPT=s,s.e="="!==e.charAt(1)?e:f.replace(RegExp("\\s*\\b"+e.substr(2)+"\\b"),"")+("+"===e.charAt(0)?" "+e.substr(2):""),n._tween._duration&&(t.className=s.e,l=Z(t,u,J(t),h,p),t.className=f,s.data=l.firstMPT,t.style.cssText=m,s=s.xfirst=n.parse(t,l.difs,s,a)),s}});var Le=function(t){if((1===t||0===t)&&this.data._totalTime===this.data._totalDuration)for(var e,i="all"===this.e,r=this.t.style,o=i?r.cssText.split(";"):this.e.split(","),n=o.length,s=a.transform.parse;--n>-1;)e=o[n],i&&(e=e.substr(0,e.indexOf(":")).split(" ").join("")),a[e]&&(e=a[e].parse===s?xe:a[e].p),Me(r,e)};for(ve("clearProps",{parser:function(t,e,r,o,n){return n=new pe(t,r,0,0,n,2),n.setRatio=Le,n.e=e,n.pr=-10,n.data=o._tween,i=!0,n}}),h="bezier,throwProps,physicsProps,physics2D".split(","),fe=h.length;fe--;)ge(h[fe]);h=s.prototype,h._firstPT=null,h._onInitTween=function(t,e,a){if(!t.nodeType)return!1;this._target=t,this._tween=a,this._vars=e,l=e.autoRound,i=!1,r=e.suffixMap||s.suffixMap,o=Y(t,""),n=this._overwriteProps;var h,p,f,m,v,g,y,x,b,_=t.style;if(u&&""===_.zIndex&&(h=z(t,"zIndex",o),("auto"===h||""===h)&&(_.zIndex=0)),"string"==typeof e&&(m=_.cssText,h=J(t,o),_.cssText=m+";"+e,h=Z(t,h,J(t)).difs,!G&&w.test(e)&&(h.opacity=parseFloat(RegExp.$1)),e=h,_.cssText=m),this._firstPT=p=this.parse(t,e,null),this._transformType){for(b=3===this._transformType,xe?c&&(u=!0,""===_.zIndex&&(y=z(t,"zIndex",o),("auto"===y||""===y)&&(_.zIndex=0)),d&&(_.WebkitBackfaceVisibility=this._vars.WebkitBackfaceVisibility||(b?"visible":"hidden"))):_.zoom=1,f=p;f&&f._next;)f=f._next;x=new pe(t,"transform",0,0,null,2),this._linkCSSP(x,null,f),x.setRatio=b&&_e?Ae:xe?Ce:Se,x.data=this._transform||Te(t,o,!0),n.pop()}if(i){for(;p;){for(g=p._next,f=m;f&&f.pr>p.pr;)f=f._next;(p._prev=f?f._prev:v)?p._prev._next=p:m=p,(p._next=f)?f._prev=p:v=p,p=g}this._firstPT=m}return!0},h.parse=function(t,e,i,n){var s,h,u,c,p,d,f,m,v,g,y=t.style;for(s in e)d=e[s],h=a[s],h?i=h.parse(t,d,s,this,i,n,e):(p=z(t,s,o)+"",v="string"==typeof d,"color"===s||"fill"===s||"stroke"===s||-1!==s.indexOf("Color")||v&&T.test(d)?(v||(d=ae(d),d=(d.length>3?"rgba(":"rgb(")+d.join(",")+")"),i=de(y,s,p,d,!0,"transparent",i,0,n)):!v||-1===d.indexOf(" ")&&-1===d.indexOf(",")?(u=parseFloat(p),f=u||0===u?p.substr((u+"").length):"",(""===p||"auto"===p)&&("width"===s||"height"===s?(u=te(t,s,o),f="px"):"left"===s||"top"===s?(u=K(t,s,o),f="px"):(u="opacity"!==s?0:1,f="")),g=v&&"="===d.charAt(1),g?(c=parseInt(d.charAt(0)+"1",10),d=d.substr(2),c*=parseFloat(d),m=d.replace(x,"")):(c=parseFloat(d),m=v?d.substr((c+"").length)||"":""),""===m&&(m=r[s]||f),d=c||0===c?(g?c+u:c)+m:e[s],f!==m&&""!==m&&(c||0===c)&&(u||0===u)&&(u=H(t,s,u,f),"%"===m?(u/=H(t,s,100,"%")/100,u>100&&(u=100),e.strictUnits!==!0&&(p=u+"%")):"em"===m?u/=H(t,s,1,"em"):(c=H(t,s,c,m),m="px"),g&&(c||0===c)&&(d=c+u+m)),g&&(c+=u),!u&&0!==u||!c&&0!==c?d||"NaN"!=d+""&&null!=d?(i=new pe(y,s,c||u||0,0,i,-1,"css_"+s,!1,0,p,d),i.xs0="none"!==d||"display"!==s&&-1===s.indexOf("Style")?d:p):V("invalid "+s+" tween value: "+e[s]):(i=new pe(y,s,u,c-u,i,0,"css_"+s,l!==!1&&("px"===m||"zIndex"===s),0,p,d),i.xs0=m)):i=de(y,s,p,d,!0,null,i,0,n)),n&&i&&!i.plugin&&(i.plugin=n);return i},h.setRatio=function(t){var e,i,r,o=this._firstPT,n=1e-6;if(1!==t||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(t||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;o;){if(e=o.c*t+o.s,o.r?e=e>0?0|e+.5:0|e-.5:n>e&&e>-n&&(e=0),o.type)if(1===o.type)if(r=o.l,2===r)o.t[o.p]=o.xs0+e+o.xs1+o.xn1+o.xs2;else if(3===r)o.t[o.p]=o.xs0+e+o.xs1+o.xn1+o.xs2+o.xn2+o.xs3;else if(4===r)o.t[o.p]=o.xs0+e+o.xs1+o.xn1+o.xs2+o.xn2+o.xs3+o.xn3+o.xs4;else if(5===r)o.t[o.p]=o.xs0+e+o.xs1+o.xn1+o.xs2+o.xn2+o.xs3+o.xn3+o.xs4+o.xn4+o.xs5;else{for(i=o.xs0+e+o.xs1,r=1;o.l>r;r++)i+=o["xn"+r]+o["xs"+(r+1)];o.t[o.p]=i}else-1===o.type?o.t[o.p]=o.xs0:o.setRatio&&o.setRatio(t);else o.t[o.p]=e+o.xs0;o=o._next}else for(;o;)2!==o.type?o.t[o.p]=o.b:o.setRatio(t),o=o._next;else for(;o;)2!==o.type?o.t[o.p]=o.e:o.setRatio(t),o=o._next},h._enableTransforms=function(t){this._transformType=t||3===this._transformType?3:2},h._linkCSSP=function(t,e,i,r){return t&&(e&&(e._prev=t),t._next&&(t._next._prev=t._prev),i?i._next=t:r||null!==this._firstPT||(this._firstPT=t),t._prev?t._prev._next=t._next:this._firstPT===t&&(this._firstPT=t._next),t._next=e,t._prev=i),t},h._kill=function(e){var i,r,o,n=e;if(e.css_autoAlpha||e.css_alpha){n={};for(r in e)n[r]=e[r];n.css_opacity=1,n.css_autoAlpha&&(n.css_visibility=1)}return e.css_className&&(i=this._classNamePT)&&(o=i.xfirst,o&&o._prev?this._linkCSSP(o._prev,i._next,o._prev._prev):o===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,o._prev),this._classNamePT=null),t.prototype._kill.call(this,n)};var Pe=function(t,e,i){var r,o,n,s;if(t.slice)for(o=t.length;--o>-1;)Pe(t[o],e,i);else for(r=t.childNodes,o=r.length;--o>-1;)n=r[o],s=n.type,n.style&&(e.push(J(n)),i&&i.push(n)),1!==s&&9!==s&&11!==s||!n.childNodes.length||Pe(n,e,i)};return s.cascadeTo=function(t,i,r){var o,n,s,a=e.to(t,i,r),h=[a],l=[],u=[],c=[],p=e._internals.reservedProps;for(t=a._targets||a.target,Pe(t,l,c),a.render(i,!0),Pe(t,u),a.render(0,!0),a._enabled(!0),o=c.length;--o>-1;)if(n=Z(c[o],l[o],u[o]),n.firstMPT){n=n.difs;for(s in r)p[s]&&(n[s]=r[s]);h.push(e.to(c[o],i,n))}return h},t.activate([s]),s},!0)}),window._gsDefine&&window._gsQueue.pop()(),define("CSSPACK",function(){}),!function(){var t={},e=null,i=!0,r=!1;if("undefined"!=typeof AudioContext)e=new AudioContext;else if("undefined"!=typeof webkitAudioContext)e=new webkitAudioContext;else if("undefined"!=typeof Audio){i=!1;try{new Audio}catch(o){r=!0}}else i=!1,r=!0;if(i){var n=void 0===e.createGain?e.createGainNode():e.createGain();n.gain.value=1,n.connect(e.destination)}var s=function(){this._volume=1,this._muted=!1,this.usingWebAudio=i,this._howls=[]};s.prototype={volume:function(t){var e=this;if(t=parseFloat(t),t&&t>=0&&1>=t){e._volume=t,i&&(n.gain.value=t);for(var r in e._howls)if(e._howls.hasOwnProperty(r)&&e._howls[r]._webAudio===!1)for(var o=0;o<e._howls[r]._audioNode.length;o++)e._howls[r]._audioNode[o].volume=e._howls[r]._volume*e._volume;return e}return i?n.gain.value:e._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(t){var e=this;e._muted=t,i&&(n.gain.value=t?0:e._volume);for(var r in e._howls)if(e._howls.hasOwnProperty(r)&&e._howls[r]._webAudio===!1)for(var o=0;o<e._howls[r]._audioNode.length;o++)e._howls[r]._audioNode[o].muted=t}};var a=new s,h=null;if(!r){h=new Audio;var l={mp3:!!h.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!h.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var u=function(t){var e=this;e._autoplay=t.autoplay||!1,e._buffer=t.buffer||!1,e._duration=t.duration||0,e._format=t.format||null,e._loop=t.loop||!1,e._loaded=!1,e._sprite=t.sprite||{},e._src=t.src||"",e._pos3d=t.pos3d||[0,0,-.5],e._volume=t.volume||1,e._urls=t.urls||[],e._rate=t.rate||1,e._onload=[t.onload||function(){}],e._onloaderror=[t.onloaderror||function(){}],e._onend=[t.onend||function(){}],e._onpause=[t.onpause||function(){}],e._onplay=[t.onplay||function(){}],e._onendTimer=[],e._webAudio=i&&!e._buffer,e._audioNode=[],e._webAudio&&e._setupAudioNode(),a._howls.push(e),e.load()};if(u.prototype={load:function(){var e=this,i=null;if(r)return void e.on("loaderror");for(var o=0;o<e._urls.length;o++){var n,s;if(e._format)n=e._format;else{if(s=e._urls[o].toLowerCase().split("?")[0],n=s.match(/.+\.([^?]+)(\?|$)/),n=n&&n.length>=2?n:s.match(/data\:audio\/([^?]+);/),!n)return void e.on("loaderror");n=n[1]}if(l[n]){i=e._urls[o];break}}if(!i)return void e.on("loaderror");if(e._src=i,e._webAudio)c(e,i);else{var h=new Audio;e._audioNode.push(h),h.src=i,h._pos=0,h.preload="auto",h.volume=a._muted?0:e._volume*a.volume(),t[i]=e;var u=function(){e._duration=h.duration,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play(),h.removeEventListener("canplaythrough",u,!1)};h.addEventListener("canplaythrough",u,!1),h.load()}return e},urls:function(t){var e=this;return t?(e.stop(),e._urls="string"==typeof t?[t]:t,e._loaded=!1,e.load(),e):e._urls},play:function(t,i){var r=this;return"function"==typeof t&&(i=t),t&&"function"!=typeof t||(t="_default"),r._loaded?r._sprite[t]?(r._inactiveNode(function(o){o._sprite=t;var n,s=o._pos>0?o._pos:r._sprite[t][0]/1e3,h=r._sprite[t][1]/1e3-o._pos,l=!(!r._loop&&!r._sprite[t][2]),u="string"==typeof i?i:Math.round(Date.now()*Math.random())+"";if(function(){var e={id:u,sprite:t,loop:l};n=setTimeout(function(){!r._webAudio&&l&&r.stop(e.id,e.timer).play(t,e.id),r._webAudio&&!l&&(r._nodeById(e.id).paused=!0),r._webAudio||l||r.stop(e.id,e.timer),r.on("end",u)},1e3*h),r._onendTimer.push(n),e.timer=r._onendTimer[r._onendTimer.length-1]}(),r._webAudio){var c=r._sprite[t][0]/1e3,p=r._sprite[t][1]/1e3;o.id=u,o.paused=!1,d(r,[l,c,p],u),r._playStart=e.currentTime,o.gain.value=r._volume,void 0===o.bufferSource.start?o.bufferSource.noteGrainOn(0,s,h):o.bufferSource.start(0,s,h)}else{if(4!==o.readyState)return r._clearEndTimer(n),function(){var e=r,n=t,s=i,a=o,h=function(){e.play(n,s),a.removeEventListener("canplaythrough",h,!1)};a.addEventListener("canplaythrough",h,!1)}(),r;o.id=u,o.currentTime=s,o.muted=a._muted,o.volume=r._volume*a.volume(),setTimeout(function(){o.play()},0)}return r.on("play"),"function"==typeof i&&i(u),r}),r):("function"==typeof i&&i(),r):(r.on("load",function(){r.play(t,i)}),r)},pause:function(t,e){var i=this;if(!i._loaded)return i.on("play",function(){i.pause(t)}),i;i._clearEndTimer(e||0);var r=t?i._nodeById(t):i._activeNode();if(r)if(r._pos=i.pos(null,t),i._webAudio){if(!r.bufferSource)return i;r.paused=!0,void 0===r.bufferSource.stop?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r.pause();return i.on("pause"),i},stop:function(t,e){var i=this;if(!i._loaded)return i.on("play",function(){i.stop(t)}),i;i._clearEndTimer(e||0);var r=t?i._nodeById(t):i._activeNode();if(r)if(r._pos=0,i._webAudio){if(!r.bufferSource)return i;r.paused=!0,void 0===r.bufferSource.stop?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r.pause(),r.currentTime=0;return i},mute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.mute(t)}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=0:i.volume=0),e},unmute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.unmute(t)
}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=e._volume:i.volume=e._volume),e},volume:function(t,e){var i=this;if(t=parseFloat(t),t>=0&&1>=t){if(i._volume=t,!i._loaded)return i.on("play",function(){i.volume(t,e)}),i;var r=e?i._nodeById(e):i._activeNode();return r&&(i._webAudio?r.gain.value=t:r.volume=t*a.volume()),i}return i._volume},loop:function(t){var e=this;return"boolean"==typeof t?(e._loop=t,e):e._loop},sprite:function(t){var e=this;return"object"==typeof t?(e._sprite=t,e):e._sprite},pos:function(t,i){var r=this;if(!r._loaded)return r.on("load",function(){r.pos(t)}),"number"==typeof t?r:r._pos||0;t=parseFloat(t);var o=i?r._nodeById(i):r._activeNode();if(o)return r._webAudio?t>=0?(o._pos=t,r.pause(i).play(o._sprite,i),r):o._pos+(e.currentTime-r._playStart):t>=0?(o.currentTime=t,r):o.currentTime;if(t>=0)return r;for(var n=0;n<r._audioNode.length;n++)if(r._audioNode[n].paused&&4===r._audioNode[n].readyState)return r._webAudio?r._audioNode[n]._pos:r._audioNode[n].currentTime},pos3d:function(t,e,i,r){var o=this;if(e=void 0!==e&&e?e:0,i=void 0!==i&&i?i:-.5,!o._loaded)return o.on("play",function(){o.pos3d(t,e,i,r)}),o;if(!(t>=0||0>t))return o._pos3d;if(o._webAudio){var n=r?o._nodeById(r):o._activeNode();n&&(o._pos3d=[t,e,i],n.panner.setPosition(t,e,i))}return o},fade:function(t,e,i,r,o){var n=this,s=Math.abs(t-e),a=t>e?"down":"up",h=s/.01,l=i/h;if(!n._loaded)return n.on("load",function(){n.fade(t,e,i,r,o)}),n;n.volume(t,o);for(var u=1;h>=u;u++)!function(){var t=n._volume+("up"===a?.01:-.01)*u,i=Math.round(1e3*t)/1e3,s=e;setTimeout(function(){n.volume(i,o),i===s&&r&&r()},l*u)}()},fadeIn:function(t,e,i){return this.volume(0).play().fade(0,t,e,i)},fadeOut:function(t,e,i,r){var o=this;return o.fade(o._volume,t,e,function(){i&&i(),o.pause(r),o.on("end")},r)},_nodeById:function(t){for(var e=this,i=e._audioNode[0],r=0;r<e._audioNode.length;r++)if(e._audioNode[r].id===t){i=e._audioNode[r];break}return i},_activeNode:function(){for(var t=this,e=null,i=0;i<t._audioNode.length;i++)if(!t._audioNode[i].paused){e=t._audioNode[i];break}return t._drainPool(),e},_inactiveNode:function(t){for(var e=this,i=null,r=0;r<e._audioNode.length;r++)if(e._audioNode[r].paused&&4===e._audioNode[r].readyState){t(e._audioNode[r]),i=!0;break}if(e._drainPool(),!i){var o;e._webAudio?(o=e._setupAudioNode(),t(o)):(e.load(),o=e._audioNode[e._audioNode.length-1],o.addEventListener("loadedmetadata",function(){t(o)}))}},_drainPool:function(){var t,e=this,i=0;for(t=0;t<e._audioNode.length;t++)e._audioNode[t].paused&&i++;for(t=e._audioNode.length-1;t>=0&&!(5>=i);t--)e._audioNode[t].paused&&(e._webAudio&&e._audioNode[t].disconnect(0),i--,e._audioNode.splice(t,1))},_clearEndTimer:function(t){var e=this,i=e._onendTimer.indexOf(t);i=i>=0?i:0,e._onendTimer[i]&&(clearTimeout(e._onendTimer[i]),e._onendTimer.splice(i,1))},_setupAudioNode:function(){var t=this,i=t._audioNode,r=t._audioNode.length;return i[r]=void 0===e.createGain?e.createGainNode():e.createGain(),i[r].gain.value=t._volume,i[r].paused=!0,i[r]._pos=0,i[r].readyState=4,i[r].connect(n),i[r].panner=e.createPanner(),i[r].panner.setPosition(t._pos3d[0],t._pos3d[1],t._pos3d[2]),i[r].panner.connect(i[r]),i[r]},on:function(t,e){var i=this,r=i["_on"+t];if("function"==typeof e)r.push(e);else for(var o=0;o<r.length;o++)e?r[o].call(i,e):r[o].call(i);return i},off:function(t,e){for(var i=this,r=i["_on"+t],o=""+e,n=0;n<r.length;n++)if(o===""+r[n]){r.splice(n,1);break}return i},unload:function(){for(var e=this,i=e._audioNode,r=0;r<e._audioNode.length;r++)e.stop(i[r].id),e._webAudio?i[r].disconnect(0):i[r].src="";var o=a._howls.indexOf(e);o&&a._howls.splice(o,1),delete t[e._src],e=null}},i)var c=function(i,r){if(r in t)i._duration=t[r].duration,p(i);else{var o=new XMLHttpRequest;o.open("GET",r,!0),o.responseType="arraybuffer",o.onload=function(){e.decodeAudioData(o.response,function(e){e&&(t[r]=e,p(i,e))})},o.onerror=function(){i._webAudio&&(i._buffer=!0,i._webAudio=!1,i._audioNode=[],delete i._gainNode,i.load())};try{o.send()}catch(n){o.onerror()}}},p=function(t,e){t._duration=e?e.duration:t._duration,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play()},d=function(i,r,o){var n=i._nodeById(o);n.bufferSource=e.createBufferSource(),n.bufferSource.buffer=t[i._src],n.bufferSource.connect(n.panner),n.bufferSource.loop=r[0],r[0]&&(n.bufferSource.loopStart=r[1],n.bufferSource.loopEnd=r[1]+r[2]),n.bufferSource.playbackRate.value=i._rate};"function"==typeof define&&define.amd&&define("HOWLER",[],function(){return{Howler:a,Howl:u}}),window.Howler=a,window.Howl=u}(),function(){var t=this,e=e||{};e.WEBGL_RENDERER=0,e.CANVAS_RENDERER=1,e.VERSION="v2.2.0",e.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},e.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},e._UID=0,"undefined"!=typeof Float32Array?(e.Float32Array=Float32Array,e.Uint16Array=Uint16Array,e.Uint32Array=Uint32Array,e.ArrayBuffer=ArrayBuffer):(e.Float32Array=Array,e.Uint16Array=Array),e.INTERACTION_FREQUENCY=30,e.AUTO_PREVENT_DEFAULT=!0,e.PI_2=2*Math.PI,e.RAD_TO_DEG=180/Math.PI,e.DEG_TO_RAD=Math.PI/180,e.RETINA_PREFIX="@2x",e.dontSayHello=!1,e.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},e.sayHello=function(t){if(!e.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+e.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c %c%c ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console;e.dontSayHello=!0}},e.Point=function(t,e){this.x=t||0,this.y=e||0},e.Point.prototype.clone=function(){return new e.Point(this.x,this.y)},e.Point.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},e.Point.prototype.constructor=e.Point,e.Rectangle=function(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0},e.Rectangle.prototype.clone=function(){return new e.Rectangle(this.x,this.y,this.width,this.height)},e.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height)return!0}return!1},e.Rectangle.prototype.constructor=e.Rectangle,e.EmptyRectangle=new e.Rectangle(0,0,0,0),e.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),t[0]instanceof e.Point){for(var i=[],r=0,o=t.length;o>r;r++)i.push(t[r].x,t[r].y);t=i}this.closed=!0,this.points=t},e.Polygon.prototype.clone=function(){var t=this.points.slice();return new e.Polygon(t)},e.Polygon.prototype.contains=function(t,e){for(var i=!1,r=this.points.length/2,o=0,n=r-1;r>o;n=o++){var s=this.points[2*o],a=this.points[2*o+1],h=this.points[2*n],l=this.points[2*n+1],u=a>e!=l>e&&(h-s)*(e-a)/(l-a)+s>t;u&&(i=!i)}return i},e.Polygon.prototype.constructor=e.Polygon,e.Circle=function(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0},e.Circle.prototype.clone=function(){return new e.Circle(this.x,this.y,this.radius)},e.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,r=this.y-e,o=this.radius*this.radius;return i*=i,r*=r,o>=i+r},e.Circle.prototype.getBounds=function(){return new e.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},e.Circle.prototype.constructor=e.Circle,e.Ellipse=function(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0},e.Ellipse.prototype.clone=function(){return new e.Ellipse(this.x,this.y,this.width,this.height)},e.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,r=(e-this.y)/this.height;return i*=i,r*=r,1>=i+r},e.Ellipse.prototype.getBounds=function(){return new e.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},e.Ellipse.prototype.constructor=e.Ellipse,e.RoundedRectangle=function(t,e,i,r,o){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0,this.radius=o||20},e.RoundedRectangle.prototype.clone=function(){return new e.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},e.RoundedRectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height)return!0}return!1},e.RoundedRectangle.prototype.constructor=e.RoundedRectangle,e.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},e.Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},e.Matrix.prototype.toArray=function(t){this.array||(this.array=new e.Float32Array(9));var i=this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},e.Matrix.prototype.apply=function(t,i){return i=i||new e.Point,i.x=this.a*t.x+this.c*t.y+this.tx,i.y=this.b*t.x+this.d*t.y+this.ty,i},e.Matrix.prototype.applyInverse=function(t,i){i=i||new e.Point;var r=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*r*t.x+-this.c*r*t.y+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*t.y+-this.b*r*t.x+(-this.ty*this.a+this.tx*this.b)*r,i},e.Matrix.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.Matrix.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},e.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,o=this.c,n=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=o*e-this.d*i,this.d=o*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this},e.Matrix.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,o=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*o,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*o,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*o+this.ty,this},e.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},e.identityMatrix=new e.Matrix,e.DisplayObject=function(){this.position=new e.Point,this.scale=new e.Point(1,1),this.pivot=new e.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new e.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new e.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},e.DisplayObject.prototype.constructor=e.DisplayObject,Object.defineProperty(e.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(e.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(e.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(e.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){for(var e=[],i=0;i<t.length;i++)for(var r=t[i].passes,o=0;o<r.length;o++)e.push(r[o]);this._filterBlock={target:this,filterPasses:e}}this._filters=t}}),Object.defineProperty(e.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),e.DisplayObject.prototype.updateTransform=function(){var t,i,r,o,n,s,a=this.parent.worldTransform,h=this.worldTransform;this.rotation%e.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-this._sr*this.scale.y,o=this._cr*this.scale.y,n=this.position.x,s=this.position.y,(this.pivot.x||this.pivot.y)&&(n-=this.pivot.x*t+this.pivot.y*r,s-=this.pivot.x*i+this.pivot.y*o),h.a=t*a.a+i*a.c,h.b=t*a.b+i*a.d,h.c=r*a.a+o*a.c,h.d=r*a.b+o*a.d,h.tx=n*a.a+s*a.c+a.tx,h.ty=n*a.b+s*a.d+a.ty):(t=this.scale.x,o=this.scale.y,n=this.position.x-this.pivot.x*t,s=this.position.y-this.pivot.y*o,h.a=t*a.a,h.b=t*a.b,h.c=o*a.c,h.d=o*a.d,h.tx=n*a.a+s*a.c+a.tx,h.ty=n*a.b+s*a.d+a.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.DisplayObject.prototype.displayObjectUpdateTransform=e.DisplayObject.prototype.updateTransform,e.DisplayObject.prototype.getBounds=function(t){return t=t,e.EmptyRectangle},e.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(e.identityMatrix)},e.DisplayObject.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0)},e.DisplayObject.prototype.generateTexture=function(t,i,r){var o=this.getLocalBounds(),n=new e.RenderTexture(0|o.width,0|o.height,r,i,t);return e.DisplayObject._tempMatrix.tx=-o.x,e.DisplayObject._tempMatrix.ty=-o.y,n.render(this,e.DisplayObject._tempMatrix),n},e.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},e.DisplayObject.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},e.DisplayObject.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},e.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},e.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|t.width,0|t.height);else{var i=new e.RenderTexture(0|t.width,0|t.height);this._cachedSprite=new e.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var r=this._filters;this._filters=null,this._cachedSprite.filters=r,e.DisplayObject._tempMatrix.tx=-t.x,e.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._filters=r,this._cacheAsBitmap=!0},e.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},e.DisplayObject.prototype._renderWebGL=function(t){t=t},e.DisplayObject.prototype._renderCanvas=function(t){t=t},e.DisplayObject._tempMatrix=new e.Matrix,Object.defineProperty(e.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(e.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),e.DisplayObjectContainer=function(){e.DisplayObject.call(this),this.children=[]},e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype),e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer,Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),e.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},e.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},e.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(0>i||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[r]=t}},e.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(0>e||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},e.DisplayObjectContainer.prototype.getChildAt=function(t){if(0>t||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},e.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},e.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(t,1),e},e.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,r="number"==typeof e?e:this.children.length,o=r-i;if(o>0&&r>=o){for(var n=this.children.splice(i,o),s=0;s<n.length;s++){var a=n[s];this.stage&&a.removeStageReference(),a.parent=void 0}return n}if(0===o&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},e.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform()},e.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=e.DisplayObjectContainer.prototype.updateTransform,e.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return e.EmptyRectangle;for(var t,i,r,o=1/0,n=1/0,s=-1/0,a=-1/0,h=!1,l=0,u=this.children.length;u>l;l++){var c=this.children[l];c.visible&&(h=!0,t=this.children[l].getBounds(),o=o<t.x?o:t.x,n=n<t.y?n:t.y,i=t.width+t.x,r=t.height+t.y,s=s>i?s:i,a=a>r?a:r)}if(!h)return e.EmptyRectangle;var p=this._bounds;return p.x=o,p.y=n,p.width=s-o,p.height=a-n,p},e.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=e.identityMatrix;for(var i=0,r=this.children.length;r>i;i++)this.children[i].updateTransform();var o=this.getBounds();return this.worldTransform=t,o},e.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0);for(var e=0,i=this.children.length;i>e;e++){var r=this.children[e];r.setStageReference(t)}},e.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0,e=this.children.length;e>t;t++){var i=this.children[t];i.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},e.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);var e,i;if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t)}},e.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;i>e;e++){var r=this.children[e];r._renderCanvas(t)}this._mask&&t.maskManager.popMask(t)}},e.Sprite=function(t){e.DisplayObjectContainer.call(this),this.anchor=new e.Point,this.texture=t||e.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=e.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this)),this.renderable=!0},e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Sprite.prototype.constructor=e.Sprite,Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),e.Sprite.prototype.setTexture=function(t){this.texture=t,this.cachedTint=16777215},e.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},e.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,r=e*(1-this.anchor.x),o=e*-this.anchor.x,n=i*(1-this.anchor.y),s=i*-this.anchor.y,a=t||this.worldTransform,h=a.a,l=a.b,u=a.c,c=a.d,p=a.tx,d=a.ty,f=-1/0,m=-1/0,v=1/0,g=1/0;if(0===l&&0===u)0>h&&(h*=-1),0>c&&(c*=-1),v=h*o+p,f=h*r+p,g=c*s+d,m=c*n+d;else{var y=h*o+u*s+p,x=c*s+l*o+d,b=h*r+u*s+p,w=c*s+l*r+d,_=h*r+u*n+p,T=c*n+l*r+d,S=h*o+u*n+p,A=c*n+l*o+d;v=v>y?y:v,v=v>b?b:v,v=v>_?_:v,v=v>S?S:v,g=g>x?x:g,g=g>w?w:g,g=g>T?T:g,g=g>A?A:g,f=y>f?y:f,f=b>f?b:f,f=_>f?_:f,f=S>f?S:f,m=x>m?x:m,m=w>m?w:m,m=T>m?T:m,m=A>m?A:m}var C=this._bounds;return C.x=v,C.width=f-v,C.y=g,C.height=m-g,this._currentBounds=C,C},e.Sprite.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){var e,i;if(this._mask||this._filters){var r=t.spriteBatch;for(this._filters&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),t.maskManager.pushMask(this.mask,t),r.start()),r.render(this),e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t);r.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),r.start()}else for(t.spriteBatch.render(this),e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t)}},e.Sprite.prototype._renderCanvas=function(t){if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var i=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===e.scaleModes.LINEAR);var r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,o=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),r=0|r,o=0|o):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r/i,o/i,this.texture.crop.width/i,this.texture.crop.height/i)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r/i,o/i,this.texture.crop.width/i,this.texture.crop.height/i)}for(var n=0,s=this.children.length;s>n;n++)this.children[n]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.Sprite.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new e.Sprite(i)},e.Sprite.fromImage=function(t,i,r){var o=e.Texture.fromImage(t,i,r);return new e.Sprite(o)},e.SpriteBatch=function(t){e.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype),e.SpriteBatch.prototype.constructor=e.SpriteBatch,e.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(t),this.ready=!0},e.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},e.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},e.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,r=!0,o=0;o<this.children.length;o++){var n=this.children[o];if(n.visible){var s=n.texture,a=s.frame;if(e.globalAlpha=this.worldAlpha*n.alpha,n.rotation%(2*Math.PI)===0)r&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),r=!1),e.drawImage(s.baseTexture.source,a.x,a.y,a.width,a.height,n.anchor.x*-a.width*n.scale.x+n.position.x+.5|0,n.anchor.y*-a.height*n.scale.y+n.position.y+.5|0,a.width*n.scale.x,a.height*n.scale.y);else{r||(r=!0),n.displayObjectUpdateTransform();var h=n.worldTransform;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,0|h.tx,0|h.ty):e.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty),e.drawImage(s.baseTexture.source,a.x,a.y,a.width,a.height,n.anchor.x*-a.width+.5|0,n.anchor.y*-a.height+.5|0,a.width,a.height)}}}}},e.MovieClip=function(t){e.Sprite.call(this,t[0]),this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},e.MovieClip.prototype=Object.create(e.Sprite.prototype),e.MovieClip.prototype.constructor=e.MovieClip,Object.defineProperty(e.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),e.MovieClip.prototype.stop=function(){this.playing=!1},e.MovieClip.prototype.play=function(){this.playing=!0},e.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=this.currentFrame+.5|0;this.setTexture(this.textures[e%this.textures.length])},e.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},e.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},e.MovieClip.fromFrames=function(t){for(var i=[],r=0;r<t.length;r++)i.push(new e.Texture.fromFrame(t[r]));return new e.MovieClip(i)},e.MovieClip.fromImages=function(t){for(var i=[],r=0;r<t.length;r++)i.push(new e.Texture.fromImage(t[r]));return new e.MovieClip(i)},e.FilterBlock=function(){this.visible=!0,this.renderable=!0},e.FilterBlock.prototype.constructor=e.FilterBlock,e.Text=function(t,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,e.Sprite.call(this,e.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(i)},e.Text.prototype=Object.create(e.Sprite.prototype),e.Text.prototype.constructor=e.Text,Object.defineProperty(e.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(e.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),e.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||4,t.dropShadowColor=t.dropShadowColor||"black",this.style=t,this.dirty=!0},e.Text.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],r=0,o=this.determineFontProperties(this.style.font),n=0;n<e.length;n++){var s=this.context.measureText(e[n]).width;i[n]=s,r=Math.max(r,s)}var a=r+this.style.strokeThickness;this.style.dropShadow&&(a+=this.style.dropShadowDistance),this.canvas.width=(a+this.context.lineWidth)*this.resolution;var h=o.fontSize+this.style.strokeThickness,l=h*e.length;this.style.dropShadow&&(l+=this.style.dropShadowDistance),this.canvas.height=l*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic";var u,c;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var p=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,d=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(n=0;n<e.length;n++)u=this.style.strokeThickness/2,c=this.style.strokeThickness/2+n*h+o.ascent,"right"===this.style.align?u+=r-i[n]:"center"===this.style.align&&(u+=(r-i[n])/2),this.style.fill&&this.context.fillText(e[n],u+p,c+d)}for(this.context.fillStyle=this.style.fill,n=0;n<e.length;n++)u=this.style.strokeThickness/2,c=this.style.strokeThickness/2+n*h+o.ascent,"right"===this.style.align?u+=r-i[n]:"center"===this.style.align&&(u+=(r-i[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[n],u,c),this.style.fill&&this.context.fillText(e[n],u,c);this.updateTexture()},e.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},e.Text.prototype._renderWebGL=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),e.Sprite.prototype._renderWebGL.call(this,t)},e.Text.prototype._renderCanvas=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),e.Sprite.prototype._renderCanvas.call(this,t)
},e.Text.prototype.determineFontProperties=function(t){var i=e.Text.fontPropertiesCache[t];if(!i){i={};var r=e.Text.fontPropertiesCanvas,o=e.Text.fontPropertiesContext;o.font=t;var n=Math.ceil(o.measureText("|Mq").width),s=Math.ceil(o.measureText("M").width),a=2*s;s=1.4*s|0,r.width=n,r.height=a,o.fillStyle="#f00",o.fillRect(0,0,n,a),o.font=t,o.textBaseline="alphabetic",o.fillStyle="#000",o.fillText("|Mq",0,s);var h,l,u=o.getImageData(0,0,n,a).data,c=u.length,p=4*n,d=0,f=!1;for(h=0;s>h;h++){for(l=0;p>l;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d+=p}for(i.ascent=s-h,d=c-p,f=!1,h=a;h>s;h--){for(l=0;p>l;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d-=p}i.descent=h-s,i.descent+=6,i.fontSize=i.ascent+i.descent,e.Text.fontPropertiesCache[t]=i}return i},e.Text.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),r=0;r<i.length;r++){for(var o=this.style.wordWrapWidth,n=i[r].split(" "),s=0;s<n.length;s++){var a=this.context.measureText(n[s]).width,h=a+this.context.measureText(" ").width;0===s||h>o?(s>0&&(e+="\n"),e+=n[s],o=this.style.wordWrapWidth-a):(o-=h,e+=" "+n[s])}r<i.length-1&&(e+="\n")}return e},e.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),e.Sprite.prototype.getBounds.call(this,t)},e.Text.prototype.destroy=function(t){this.context=null,this.canvas=null,this.texture.destroy(void 0===t?!0:t)},e.Text.fontPropertiesCache={},e.Text.fontPropertiesCanvas=document.createElement("canvas"),e.Text.fontPropertiesContext=e.Text.fontPropertiesCanvas.getContext("2d"),e.BitmapText=function(t,i){e.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(t),this.setStyle(i),this.updateText(),this.dirty=!1},e.BitmapText.prototype=Object.create(e.DisplayObjectContainer.prototype),e.BitmapText.prototype.constructor=e.BitmapText,e.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},e.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):e.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=t.tint},e.BitmapText.prototype.updateText=function(){for(var t=e.BitmapText.fonts[this.fontName],i=new e.Point,r=null,o=[],n=0,s=[],a=0,h=this.fontSize/t.size,l=0;l<this.text.length;l++){var u=this.text.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l)))s.push(i.x),n=Math.max(n,i.x),a++,i.x=0,i.y+=t.lineHeight,r=null;else{var c=t.chars[u];c&&(r&&c.kerning[r]&&(i.x+=c.kerning[r]),o.push({texture:c.texture,line:a,charCode:u,position:new e.Point(i.x+c.xOffset,i.y+c.yOffset)}),i.x+=c.xAdvance,r=u)}}s.push(i.x),n=Math.max(n,i.x);var p=[];for(l=0;a>=l;l++){var d=0;"right"===this.style.align?d=n-s[l]:"center"===this.style.align&&(d=(n-s[l])/2),p.push(d)}var f=this.children.length,m=o.length,v=this.tint||16777215;for(l=0;m>l;l++){var g=f>l?this.children[l]:this._pool.pop();g?g.setTexture(o[l].texture):g=new e.Sprite(o[l].texture),g.position.x=(o[l].position.x+p[o[l].line])*h,g.position.y=o[l].position.y*h,g.scale.x=g.scale.y=h,g.tint=v,g.parent||this.addChild(g)}for(;this.children.length>m;){var y=this.getChildAt(this.children.length-1);this._pool.push(y),this.removeChild(y)}this.textWidth=n*h,this.textHeight=(i.y+t.lineHeight)*h},e.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),e.DisplayObjectContainer.prototype.updateTransform.call(this)},e.BitmapText.fonts={},e.InteractionData=function(){this.global=new e.Point,this.target=null,this.originalEvent=null},e.InteractionData.prototype.getLocalPosition=function(t,i){var r=t.worldTransform,o=this.global,n=r.a,s=r.c,a=r.tx,h=r.b,l=r.d,u=r.ty,c=1/(n*l+s*-h);return i=i||new e.Point,i.x=l*c*o.x+-s*c*o.y+(u*s-a*l)*c,i.y=n*c*o.y+-h*c*o.x+(-u*n+a*h)*c,i},e.InteractionData.prototype.constructor=e.InteractionData,e.InteractionManager=function(t){this.stage=t,this.mouse=new e.InteractionData,this.touches={},this.tempPoint=new e.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1,this._tempPoint=new e.Point},e.InteractionManager.prototype.constructor=e.InteractionManager,e.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var i=t.children,r=i.length,o=r-1;o>=0;o--){var n=i[o];n._interactive?(e.interactiveChildren=!0,this.interactiveItems.push(n),n.children.length>0&&this.collectInteractiveSprite(n,n)):(n.__iParent=null,n.children.length>0&&this.collectInteractiveSprite(n,e))}},e.InteractionManager.prototype.setTarget=function(t){this.target=t,this.resolution=t.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(t.view)},e.InteractionManager.prototype.setTargetDomElement=function(t){this.removeEvents(),window.navigator.msPointerEnabled&&(t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none"),this.interactionDOMElement=t,t.addEventListener("mousemove",this.onMouseMove,!0),t.addEventListener("mousedown",this.onMouseDown,!0),t.addEventListener("mouseout",this.onMouseOut,!0),t.addEventListener("touchstart",this.onTouchStart,!0),t.addEventListener("touchend",this.onTouchEnd,!0),t.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},e.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},e.InteractionManager.prototype.update=function(){if(this.target){var t=Date.now(),i=t-this.last;if(i=i*e.INTERACTION_FREQUENCY/1e3,!(1>i)){this.last=t;var r=0;this.dirty&&this.rebuildInteractiveGraph();var o=this.interactiveItems.length,n="inherit",s=!1;for(r=0;o>r;r++){var a=this.interactiveItems[r];a.__hit=this.hitTest(a,this.mouse),this.mouse.target=a,a.__hit&&!s?(a.buttonMode&&(n=a.defaultCursor),a.interactiveChildren||(s=!0),a.__isOver||(a.mouseover&&a.mouseover(this.mouse),a.__isOver=!0)):a.__isOver&&(a.mouseout&&a.mouseout(this.mouse),a.__isOver=!1)}this.currentCursorStyle!==n&&(this.currentCursorStyle=n,this.interactionDOMElement.style.cursor=n)}}},e.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,e=0;t>e;e++)this.interactiveItems[e].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},e.InteractionManager.prototype.onMouseMove=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width)/this.resolution,this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height)/this.resolution;for(var i=this.interactiveItems.length,r=0;i>r;r++){var o=this.interactiveItems[r];o.mousemove&&o.mousemove(this.mouse)}},e.InteractionManager.prototype.onMouseDown=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t,e.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var i=this.interactiveItems.length,r=this.mouse.originalEvent,o=2===r.button||3===r.which,n=o?"rightdown":"mousedown",s=o?"rightclick":"click",a=o?"__rightIsDown":"__mouseIsDown",h=o?"__isRightDown":"__isDown",l=0;i>l;l++){var u=this.interactiveItems[l];if((u[n]||u[s])&&(u[a]=!0,u.__hit=this.hitTest(u,this.mouse),u.__hit&&(u[n]&&u[n](this.mouse),u[h]=!0,!u.interactiveChildren)))break}},e.InteractionManager.prototype.onMouseOut=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var i=0;e>i;i++){var r=this.interactiveItems[i];r.__isOver&&(this.mouse.target=r,r.mouseout&&r.mouseout(this.mouse),r.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},e.InteractionManager.prototype.onMouseUp=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;for(var e=this.interactiveItems.length,i=!1,r=this.mouse.originalEvent,o=2===r.button||3===r.which,n=o?"rightup":"mouseup",s=o?"rightclick":"click",a=o?"rightupoutside":"mouseupoutside",h=o?"__isRightDown":"__isDown",l=0;e>l;l++){var u=this.interactiveItems[l];(u[s]||u[n]||u[a])&&(u.__hit=this.hitTest(u,this.mouse),u.__hit&&!i?(u[n]&&u[n](this.mouse),u[h]&&u[s]&&u[s](this.mouse),u.interactiveChildren||(i=!0)):u[h]&&u[a]&&u[a](this.mouse),u[h]=!1)}},e.InteractionManager.prototype.hitTest=function(t,i){var r=i.global;if(!t.worldVisible)return!1;t.worldTransform.applyInverse(r,this._tempPoint);var o,n=this._tempPoint.x,s=this._tempPoint.y;if(i.target=t,t.hitArea&&t.hitArea.contains)return t.hitArea.contains(n,s);if(t instanceof e.Sprite){var a,h=t.texture.frame.width,l=t.texture.frame.height,u=-h*t.anchor.x;if(n>u&&u+h>n&&(a=-l*t.anchor.y,s>a&&a+l>s))return!0}else if(t instanceof e.Graphics){var c=t.graphicsData;for(o=0;o<c.length;o++){var p=c[o];if(p.fill&&p.shape&&p.shape.contains(n,s))return!0}}var d=t.children.length;for(o=0;d>o;o++){var f=t.children[o],m=this.hitTest(f,i);if(m)return i.target=t,!0}return!1},e.InteractionManager.prototype.onTouchMove=function(t){this.dirty&&this.rebuildInteractiveGraph();var e,i=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,o=0;for(o=0;o<r.length;o++){var n=r[o];e=this.touches[n.identifier],e.originalEvent=t,e.global.x=(n.clientX-i.left)*(this.target.width/i.width)/this.resolution,e.global.y=(n.clientY-i.top)*(this.target.height/i.height)/this.resolution,!navigator.isCocoonJS||i.left||i.top||t.target.style.width||t.target.style.height||(e.global.x=n.clientX,e.global.y=n.clientY);for(var s=0;s<this.interactiveItems.length;s++){var a=this.interactiveItems[s];a.touchmove&&a.__touchData&&a.__touchData[n.identifier]&&a.touchmove(e)}}},e.InteractionManager.prototype.onTouchStart=function(t){this.dirty&&this.rebuildInteractiveGraph();var i=this.interactionDOMElement.getBoundingClientRect();e.AUTO_PREVENT_DEFAULT&&t.preventDefault();for(var r=t.changedTouches,o=0;o<r.length;o++){var n=r[o],s=this.pool.pop();s||(s=new e.InteractionData),s.originalEvent=t,this.touches[n.identifier]=s,s.global.x=(n.clientX-i.left)*(this.target.width/i.width)/this.resolution,s.global.y=(n.clientY-i.top)*(this.target.height/i.height)/this.resolution,!navigator.isCocoonJS||i.left||i.top||t.target.style.width||t.target.style.height||(s.global.x=n.clientX,s.global.y=n.clientY);for(var a=this.interactiveItems.length,h=0;a>h;h++){var l=this.interactiveItems[h];if((l.touchstart||l.tap)&&(l.__hit=this.hitTest(l,s),l.__hit&&(l.touchstart&&l.touchstart(s),l.__isDown=!0,l.__touchData=l.__touchData||{},l.__touchData[n.identifier]=s,!l.interactiveChildren)))break}}},e.InteractionManager.prototype.onTouchEnd=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e=this.interactionDOMElement.getBoundingClientRect(),i=t.changedTouches,r=0;r<i.length;r++){var o=i[r],n=this.touches[o.identifier],s=!1;n.global.x=(o.clientX-e.left)*(this.target.width/e.width)/this.resolution,n.global.y=(o.clientY-e.top)*(this.target.height/e.height)/this.resolution,!navigator.isCocoonJS||e.left||e.top||t.target.style.width||t.target.style.height||(n.global.x=o.clientX,n.global.y=o.clientY);for(var a=this.interactiveItems.length,h=0;a>h;h++){var l=this.interactiveItems[h];l.__touchData&&l.__touchData[o.identifier]&&(l.__hit=this.hitTest(l,l.__touchData[o.identifier]),n.originalEvent=t,(l.touchend||l.tap)&&(l.__hit&&!s?(l.touchend&&l.touchend(n),l.__isDown&&l.tap&&l.tap(n),l.interactiveChildren||(s=!0)):l.__isDown&&l.touchendoutside&&l.touchendoutside(n),l.__isDown=!1),l.__touchData[o.identifier]=null)}this.pool.push(n),this.touches[o.identifier]=null}},e.Stage=function(t){e.DisplayObjectContainer.call(this),this.worldTransform=new e.Matrix,this.interactive=!0,this.interactionManager=new e.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new e.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(t)},e.Stage.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Stage.prototype.constructor=e.Stage,e.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)},e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},e.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0,this.backgroundColorSplit=e.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},e.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(t){for(var e=0,i=["ms","moz","webkit","o"],r=0;r<i.length&&!t.requestAnimationFrame;++r)t.requestAnimationFrame=t[i[r]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[r]+"CancelAnimationFrame"]||t[i[r]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i){var r=(new Date).getTime(),o=Math.max(0,16-(r-e)),n=t.setTimeout(function(){i(r+o)},o);return e=r+o,n}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),t.requestAnimFrame=t.requestAnimationFrame}(this),e.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(t){function e(){for(var r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];return n=o.concat(n),i.apply(this instanceof e?this:t,n)}var i=this,r=arguments.length-1,o=[];if(r>0)for(o.length=r;r--;)o[r]=arguments[r+1];if("function"!=typeof i)throw new TypeError;return e.prototype=function n(t){return t&&(n.prototype=t),this instanceof n?void 0:new n}(i.prototype),e}}()),e.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(i){}},e.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply",e.fillStyle="#fff",e.fillRect(0,0,1,1),0===e.getImageData(0,0,1,1).data[0]},e.getNextPowerOfTwo=function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;t>e;)e<<=1;return e},e.isPowerOfTwo=function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},e.EventTarget={call:function(t){t&&(t=t.prototype||t,e.EventTarget.mixin(t))},mixin:function(t){t.listeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?this._listeners[t].slice():[]},t.emit=t.dispatchEvent=function(t,i){if(this._listeners=this._listeners||{},"object"==typeof t&&(i=t,t=t.type),i&&i.__isEventObject===!0||(i=new e.Event(this,t,i)),this._listeners&&this._listeners[t]){var r,o=this._listeners[t].slice(0),n=o.length,s=o[0];for(r=0;n>r;s=o[++r])if(s.call(this,i),i.stoppedImmediate)return this;if(i.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,t,i),this},t.on=t.addEventListener=function(t,e){return this._listeners=this._listeners||{},(this._listeners[t]=this._listeners[t]||[]).push(e),this},t.once=function(t,e){function i(){e.apply(r.off(t,i),arguments)}this._listeners=this._listeners||{};var r=this;return i._originalHandler=e,this.on(t,i)},t.off=t.removeEventListener=function(t,e){if(this._listeners=this._listeners||{},!this._listeners[t])return this;for(var i=this._listeners[t],r=e?i.length:0;r-->0;)(i[r]===e||i[r]._originalHandler===e)&&i.splice(r,1);return 0===i.length&&delete this._listeners[t],this},t.removeAllListeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?(delete this._listeners[t],this):this}}},e.Event=function(t,e,i){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=t,this.type=e,this.data=i,this.content=i,this.timeStamp=Date.now()},e.Event.prototype.stopPropagation=function(){this.stopped=!0},e.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},e.autoDetectRenderer=function(t,i,r){t||(t=800),i||(i=600);var o=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(e){return!1}}();return o?new e.WebGLRenderer(t,i,r):new e.CanvasRenderer(t,i,r)},e.autoDetectRecommendedRenderer=function(t,i,r){t||(t=800),i||(i=600);var o=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(e){return!1}}(),n=/Android/i.test(navigator.userAgent);return o&&!n?new e.WebGLRenderer(t,i,r):new e.CanvasRenderer(t,i,r)},e.PolyK={},e.PolyK.Triangulate=function(t){var i=!0,r=t.length>>1;if(3>r)return[];for(var o=[],n=[],s=0;r>s;s++)n.push(s);s=0;for(var a=r;a>3;){var h=n[(s+0)%a],l=n[(s+1)%a],u=n[(s+2)%a],c=t[2*h],p=t[2*h+1],d=t[2*l],f=t[2*l+1],m=t[2*u],v=t[2*u+1],g=!1;if(e.PolyK._convex(c,p,d,f,m,v,i)){g=!0;for(var y=0;a>y;y++){var x=n[y];if(x!==h&&x!==l&&x!==u&&e.PolyK._PointInTriangle(t[2*x],t[2*x+1],c,p,d,f,m,v)){g=!1;break}}}if(g)o.push(h,l,u),n.splice((s+1)%a,1),a--,s=0;else if(s++>3*a){if(!i)return null;for(o=[],n=[],s=0;r>s;s++)n.push(s);s=0,a=r,i=!1}}return o.push(n[0],n[1],n[2]),o},e.PolyK._PointInTriangle=function(t,e,i,r,o,n,s,a){var h=s-i,l=a-r,u=o-i,c=n-r,p=t-i,d=e-r,f=h*h+l*l,m=h*u+l*c,v=h*p+l*d,g=u*u+c*c,y=u*p+c*d,x=1/(f*g-m*m),b=(g*v-m*y)*x,w=(f*y-m*v)*x;return b>=0&&w>=0&&1>b+w},e.PolyK._convex=function(t,e,i,r,o,n,s){return(e-r)*(o-i)+(i-t)*(n-r)>=0===s},e.initDefaultShaders=function(){},e.CompileVertexShader=function(t,i){return e._CompileShader(t,i,t.VERTEX_SHADER)},e.CompileFragmentShader=function(t,i){return e._CompileShader(t,i,t.FRAGMENT_SHADER)},e._CompileShader=function(t,e,i){var r=e.join("\n"),o=t.createShader(i);return t.shaderSource(o,r),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(window.console.log(t.getShaderInfoLog(o)),null)},e.compileProgram=function(t,i,r){var o=e.CompileFragmentShader(t,r),n=e.CompileVertexShader(t,i),s=t.createProgram();return t.attachShader(s,n),t.attachShader(s,o),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),s},e.PixiShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},e.PixiShader.prototype.constructor=e.PixiShader,e.PixiShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms(),this.program=i},e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];var r=t.type;"sampler2D"===r?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===r||"mat3"===r||"mat4"===r?(t.glMatrix=!0,t.glValueLength=1,"mat2"===r?t.glFunc=e.uniformMatrix2fv:"mat3"===r?t.glFunc=e.uniformMatrix3fv:"mat4"===r&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+r],t.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1)}},e.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,r=i.magFilter?i.magFilter:e.LINEAR,o=i.minFilter?i.minFilter:e.LINEAR,n=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,s=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,a=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(n=e.REPEAT,s=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var h=i.width?i.width:512,l=i.height?i.height:2,u=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,a,h,l,u,a,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,i=this.gl;for(var r in this.uniforms)t=this.uniforms[r],1===t.glValueLength?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?e.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform float flipY;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 finalV = aVertexPosition + offsetVector;","   gl_Position = vec4( finalV.x / projectionVector.x -1.0, (finalV.y / projectionVector.y * +flipY ) + flipY , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],e.PixiFastShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},e.PixiFastShader.prototype.constructor=e.PixiFastShader,e.PixiFastShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.uMatrix=t.getUniformLocation(i,"uMatrix"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord"),this.aScale=t.getAttribLocation(i,"aScale"),this.aRotation=t.getAttribLocation(i,"aRotation"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.StripShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},e.StripShader.prototype.constructor=e.StripShader,e.StripShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.PrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},e.PrimitiveShader.prototype.constructor=e.PrimitiveShader,e.PrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.ComplexPrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader,e.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.color=t.getUniformLocation(i,"color"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.WebGLGraphics=function(){},e.WebGLGraphics.renderGraphics=function(t,i){var r,o=i.gl,n=i.projection,s=i.offset,a=i.shaderManager.primitiveShader;t.dirty&&e.WebGLGraphics.updateGraphics(t,o);for(var h=t._webGL[o.id],l=0;l<h.data.length;l++)1===h.data[l].mode?(r=h.data[l],i.stencilManager.pushStencil(t,r,i),o.drawElements(o.TRIANGLE_FAN,4,o.UNSIGNED_SHORT,2*(r.indices.length-4)),i.stencilManager.popStencil(t,r,i)):(r=h.data[l],i.shaderManager.setShader(a),a=i.shaderManager.primitiveShader,o.uniformMatrix3fv(a.translationMatrix,!1,t.worldTransform.toArray(!0)),o.uniform1f(a.flipY,1),o.uniform2f(a.projectionVector,n.x,-n.y),o.uniform2f(a.offsetVector,-s.x,-s.y),o.uniform3fv(a.tintColor,e.hex2rgb(t.tint)),o.uniform1f(a.alpha,t.worldAlpha),o.bindBuffer(o.ARRAY_BUFFER,r.buffer),o.vertexAttribPointer(a.aVertexPosition,2,o.FLOAT,!1,24,0),o.vertexAttribPointer(a.colorAttribute,4,o.FLOAT,!1,24,8),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r.indexBuffer),o.drawElements(o.TRIANGLE_STRIP,r.indices.length,o.UNSIGNED_SHORT,0))},e.WebGLGraphics.updateGraphics=function(t,i){var r=t._webGL[i.id];
r||(r=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1;var o;if(t.clearDirty){for(t.clearDirty=!1,o=0;o<r.data.length;o++){var n=r.data[o];n.reset(),e.WebGLGraphics.graphicsDataPool.push(n)}r.data=[],r.lastIndex=0}var s;for(o=r.lastIndex;o<t.graphicsData.length;o++){var a=t.graphicsData[o];if(a.type===e.Graphics.POLY){if(a.points=a.shape.points.slice(),a.shape.closed&&(a.points[0]!==a.points[a.points.length-2]||a.points[1]!==a.points[a.points.length-1])&&a.points.push(a.points[0],a.points[1]),a.fill&&a.points.length>=6)if(a.points.length<12){s=e.WebGLGraphics.switchMode(r,0);var h=e.WebGLGraphics.buildPoly(a,s);h||(s=e.WebGLGraphics.switchMode(r,1),e.WebGLGraphics.buildComplexPoly(a,s))}else s=e.WebGLGraphics.switchMode(r,1),e.WebGLGraphics.buildComplexPoly(a,s);a.lineWidth>0&&(s=e.WebGLGraphics.switchMode(r,0),e.WebGLGraphics.buildLine(a,s))}else s=e.WebGLGraphics.switchMode(r,0),a.type===e.Graphics.RECT?e.WebGLGraphics.buildRectangle(a,s):a.type===e.Graphics.CIRC||a.type===e.Graphics.ELIP?e.WebGLGraphics.buildCircle(a,s):a.type===e.Graphics.RREC&&e.WebGLGraphics.buildRoundedRectangle(a,s);r.lastIndex++}for(o=0;o<r.data.length;o++)s=r.data[o],s.dirty&&s.upload()},e.WebGLGraphics.switchMode=function(t,i){var r;return t.data.length?(r=t.data[t.data.length-1],(r.mode!==i||1===i)&&(r=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r))):(r=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r)),r.dirty=!0,r},e.WebGLGraphics.buildRectangle=function(t,i){var r=t.shape,o=r.x,n=r.y,s=r.width,a=r.height;if(t.fill){var h=e.hex2rgb(t.fillColor),l=t.fillAlpha,u=h[0]*l,c=h[1]*l,p=h[2]*l,d=i.points,f=i.indices,m=d.length/6;d.push(o,n),d.push(u,c,p,l),d.push(o+s,n),d.push(u,c,p,l),d.push(o,n+a),d.push(u,c,p,l),d.push(o+s,n+a),d.push(u,c,p,l),f.push(m,m,m+1,m+2,m+3,m+3)}if(t.lineWidth){var v=t.points;t.points=[o,n,o+s,n,o+s,n+a,o,n+a,o,n],e.WebGLGraphics.buildLine(t,i),t.points=v}},e.WebGLGraphics.buildRoundedRectangle=function(t,i){var r=t.shape,o=r.x,n=r.y,s=r.width,a=r.height,h=r.radius,l=[];if(l.push(o,n+h),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(o,n+a-h,o,n+a,o+h,n+a)),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(o+s-h,n+a,o+s,n+a,o+s,n+a-h)),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(o+s,n+h,o+s,n,o+s-h,n)),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(o+h,n,o,n,o,n+h)),t.fill){var u=e.hex2rgb(t.fillColor),c=t.fillAlpha,p=u[0]*c,d=u[1]*c,f=u[2]*c,m=i.points,v=i.indices,g=m.length/6,y=e.PolyK.Triangulate(l),x=0;for(x=0;x<y.length;x+=3)v.push(y[x]+g),v.push(y[x]+g),v.push(y[x+1]+g),v.push(y[x+2]+g),v.push(y[x+2]+g);for(x=0;x<l.length;x++)m.push(l[x],l[++x],p,d,f,c)}if(t.lineWidth){var b=t.points;t.points=l,e.WebGLGraphics.buildLine(t,i),t.points=b}},e.WebGLGraphics.quadraticBezierCurve=function(t,e,i,r,o,n){function s(t,e,i){var r=e-t;return t+r*i}for(var a,h,l,u,c,p,d=20,f=[],m=0,v=0;d>=v;v++)m=v/d,a=s(t,i,m),h=s(e,r,m),l=s(i,o,m),u=s(r,n,m),c=s(a,l,m),p=s(h,u,m),f.push(c,p);return f},e.WebGLGraphics.buildCircle=function(t,i){var r,o,n=t.shape,s=n.x,a=n.y;t.type===e.Graphics.CIRC?(r=n.radius,o=n.radius):(r=n.width,o=n.height);var h=40,l=2*Math.PI/h,u=0;if(t.fill){var c=e.hex2rgb(t.fillColor),p=t.fillAlpha,d=c[0]*p,f=c[1]*p,m=c[2]*p,v=i.points,g=i.indices,y=v.length/6;for(g.push(y),u=0;h+1>u;u++)v.push(s,a,d,f,m,p),v.push(s+Math.sin(l*u)*r,a+Math.cos(l*u)*o,d,f,m,p),g.push(y++,y++);g.push(y-1)}if(t.lineWidth){var x=t.points;for(t.points=[],u=0;h+1>u;u++)t.points.push(s+Math.sin(l*u)*r,a+Math.cos(l*u)*o);e.WebGLGraphics.buildLine(t,i),t.points=x}},e.WebGLGraphics.buildLine=function(t,i){var r=0,o=t.points;if(0!==o.length){if(t.lineWidth%2)for(r=0;r<o.length;r++)o[r]+=.5;var n=new e.Point(o[0],o[1]),s=new e.Point(o[o.length-2],o[o.length-1]);if(n.x===s.x&&n.y===s.y){o=o.slice(),o.pop(),o.pop(),s=new e.Point(o[o.length-2],o[o.length-1]);var a=s.x+.5*(n.x-s.x),h=s.y+.5*(n.y-s.y);o.unshift(a,h),o.push(a,h)}var l,u,c,p,d,f,m,v,g,y,x,b,w,_,T,S,A,C,E,M,B,L,P,R=i.points,F=i.indices,I=o.length/2,O=o.length,D=R.length/6,k=t.lineWidth/2,N=e.hex2rgb(t.lineColor),U=t.lineAlpha,G=N[0]*U,q=N[1]*U,V=N[2]*U;for(c=o[0],p=o[1],d=o[2],f=o[3],g=-(p-f),y=c-d,P=Math.sqrt(g*g+y*y),g/=P,y/=P,g*=k,y*=k,R.push(c-g,p-y,G,q,V,U),R.push(c+g,p+y,G,q,V,U),r=1;I-1>r;r++)c=o[2*(r-1)],p=o[2*(r-1)+1],d=o[2*r],f=o[2*r+1],m=o[2*(r+1)],v=o[2*(r+1)+1],g=-(p-f),y=c-d,P=Math.sqrt(g*g+y*y),g/=P,y/=P,g*=k,y*=k,x=-(f-v),b=d-m,P=Math.sqrt(x*x+b*b),x/=P,b/=P,x*=k,b*=k,T=-y+p-(-y+f),S=-g+d-(-g+c),A=(-g+c)*(-y+f)-(-g+d)*(-y+p),C=-b+v-(-b+f),E=-x+d-(-x+m),M=(-x+m)*(-b+f)-(-x+d)*(-b+v),B=T*E-C*S,Math.abs(B)<.1?(B+=10.1,R.push(d-g,f-y,G,q,V,U),R.push(d+g,f+y,G,q,V,U)):(l=(S*M-E*A)/B,u=(C*A-T*M)/B,L=(l-d)*(l-d)+(u-f)+(u-f),L>19600?(w=g-x,_=y-b,P=Math.sqrt(w*w+_*_),w/=P,_/=P,w*=k,_*=k,R.push(d-w,f-_),R.push(G,q,V,U),R.push(d+w,f+_),R.push(G,q,V,U),R.push(d-w,f-_),R.push(G,q,V,U),O++):(R.push(l,u),R.push(G,q,V,U),R.push(d-(l-d),f-(u-f)),R.push(G,q,V,U)));for(c=o[2*(I-2)],p=o[2*(I-2)+1],d=o[2*(I-1)],f=o[2*(I-1)+1],g=-(p-f),y=c-d,P=Math.sqrt(g*g+y*y),g/=P,y/=P,g*=k,y*=k,R.push(d-g,f-y),R.push(G,q,V,U),R.push(d+g,f+y),R.push(G,q,V,U),F.push(D),r=0;O>r;r++)F.push(D++);F.push(D-1)}},e.WebGLGraphics.buildComplexPoly=function(t,i){var r=t.points.slice();if(!(r.length<6)){var o=i.indices;i.points=r,i.alpha=t.fillAlpha,i.color=e.hex2rgb(t.fillColor);for(var n,s,a=1/0,h=-1/0,l=1/0,u=-1/0,c=0;c<r.length;c+=2)n=r[c],s=r[c+1],a=a>n?n:a,h=n>h?n:h,l=l>s?s:l,u=s>u?s:u;r.push(a,l,h,l,h,u,a,u);var p=r.length/2;for(c=0;p>c;c++)o.push(c)}},e.WebGLGraphics.buildPoly=function(t,i){var r=t.points;if(!(r.length<6)){var o=i.points,n=i.indices,s=r.length/2,a=e.hex2rgb(t.fillColor),h=t.fillAlpha,l=a[0]*h,u=a[1]*h,c=a[2]*h,p=e.PolyK.Triangulate(r);if(!p)return!1;var d=o.length/6,f=0;for(f=0;f<p.length;f+=3)n.push(p[f]+d),n.push(p[f]+d),n.push(p[f+1]+d),n.push(p[f+2]+d),n.push(p[f+2]+d);for(f=0;s>f;f++)o.push(r[2*f],r[2*f+1],l,u,c,h);return!0}},e.WebGLGraphics.graphicsDataPool=[],e.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},e.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},e.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new e.Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new e.Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},e.glContexts=[],e.instances=[],e.WebGLRenderer=function(t,i,r){if(r)for(var o in e.defaultRenderOptions)"undefined"==typeof r[o]&&(r[o]=e.defaultRenderOptions[o]);else r=e.defaultRenderOptions;e.defaultRenderer||(e.sayHello("webGL"),e.defaultRenderer=this),this.type=e.WEBGL_RENDERER,this.resolution=r.resolution,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.preserveDrawingBuffer=r.preserveDrawingBuffer,this.clearBeforeRender=r.clearBeforeRender,this.width=t||800,this.height=i||600,this.view=r.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer},this.projection=new e.Point,this.offset=new e.Point(0,0),this.shaderManager=new e.WebGLShaderManager,this.spriteBatch=new e.WebGLSpriteBatch,this.maskManager=new e.WebGLMaskManager,this.filterManager=new e.WebGLFilterManager,this.stencilManager=new e.WebGLStencilManager,this.blendModeManager=new e.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},e.WebGLRenderer.prototype.constructor=e.WebGLRenderer,e.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=e.WebGLRenderer.glContextId++,e.glContexts[this.glContextId]=t,e.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},e.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t),t.updateTransform();var e=this.gl;t._interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this)),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}},e.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=r?-1:1,this.renderSession.buffer=r,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),t._renderWebGL(this.renderSession),this.spriteBatch.end()},e.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},e.WebGLRenderer.prototype.updateTexture=function(t){if(t.hasLoaded){var i=this.gl;t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST);var r=e.isPowerOfTwo(t.width,t.height);return t.mipmap&&r?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST),r?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,t._glTextures[i.id]}},e.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},e.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var t in e.TextureCache){var i=e.TextureCache[t].baseTexture;i._glTextures=[]}this.contextLost=!1},e.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),e.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},e.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;e.blendModesWebGL||(e.blendModesWebGL=[],e.blendModesWebGL[e.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],e.blendModesWebGL[e.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE],e.blendModesWebGL[e.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA])},e.WebGLRenderer.glContextId=0,e.WebGLBlendModeManager=function(){this.currentBlendMode=99999},e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager,e.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},e.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=e.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},e.WebGLMaskManager=function(){},e.WebGLMaskManager.prototype.constructor=e.WebGLMaskManager,e.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},e.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;t.dirty&&e.WebGLGraphics.updateGraphics(t,r),t._webGL[r.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)},e.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},e.WebGLMaskManager.prototype.destroy=function(){this.gl=null},e.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},e.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},e.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var r=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var o=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===e.mode?(r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-o,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(o+1),255):r.stencilFunc(r.EQUAL,o+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-o,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o+1,255):r.stencilFunc(r.EQUAL,255-(o+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},e.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var o,n=this.gl,s=r.projection,a=r.offset;1===i.mode?(o=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(o),n.uniform1f(o.flipY,r.flipY),n.uniformMatrix3fv(o.translationMatrix,!1,t.worldTransform.toArray(!0)),n.uniform2f(o.projectionVector,s.x,-s.y),n.uniform2f(o.offsetVector,-a.x,-a.y),n.uniform3fv(o.tintColor,e.hex2rgb(t.tint)),n.uniform3fv(o.color,i.color),n.uniform1f(o.alpha,t.worldAlpha*i.alpha),n.bindBuffer(n.ARRAY_BUFFER,i.buffer),n.vertexAttribPointer(o.aVertexPosition,2,n.FLOAT,!1,8,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(o=r.shaderManager.primitiveShader,r.shaderManager.setShader(o),n.uniformMatrix3fv(o.translationMatrix,!1,t.worldTransform.toArray(!0)),n.uniform1f(o.flipY,r.flipY),n.uniform2f(o.projectionVector,s.x,-s.y),n.uniform2f(o.offsetVector,-a.x,-a.y),n.uniform3fv(o.tintColor,e.hex2rgb(t.tint)),n.uniform1f(o.alpha,t.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,i.buffer),n.vertexAttribPointer(o.aVertexPosition,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(o.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},e.WebGLStencilManager.prototype.popStencil=function(t,e,i){var r=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var o=this.count;this.bindGraphics(t,e,i),r.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(o+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o,255):r.stencilFunc(r.EQUAL,255-o,255)):(this.reverse?(r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(o+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o,255):r.stencilFunc(r.EQUAL,255-o,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},e.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},e.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager,e.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new e.PrimitiveShader(t),this.complexPrimitiveShader=new e.ComplexPrimitiveShader(t),this.defaultShader=new e.PixiShader(t),this.fastShader=new e.PixiFastShader(t),this.stripShader=new e.StripShader(t),this.setShader(this.defaultShader)},e.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var r=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?r.enableVertexAttribArray(e):r.disableVertexAttribArray(e))},e.WebGLShaderManager.prototype.setShader=function(t){return this._currentId===t._UID?!1:(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},e.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var t=4*this.size*4*this.vertSize,i=6*this.size;this.vertices=new e.ArrayBuffer(t),this.positions=new e.Float32Array(this.vertices),this.colors=new e.Uint32Array(this.vertices),this.indices=new e.Uint16Array(i),this.lastIndexCount=0;for(var r=0,o=0;i>r;r+=6,o+=4)this.indices[r+0]=o+0,this.indices[r+1]=o+1,this.indices[r+2]=o+2,this.indices[r+3]=o+0,this.indices[r+4]=o+2,this.indices[r+5]=o+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new e.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},e.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new e.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[t.id]=i},e.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},e.WebGLSpriteBatch.prototype.end=function(){this.flush()},e.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var i=e._uvs;if(i){var r,o,n,s,a=t.anchor.x,h=t.anchor.y;if(e.trim){var l=e.trim;o=l.x-a*l.width,r=o+e.crop.width,s=l.y-h*l.height,n=s+e.crop.height}else r=e.frame.width*(1-a),o=e.frame.width*-a,n=e.frame.height*(1-h),s=e.frame.height*-h;var u=4*this.currentBatchSize*this.vertSize,c=e.baseTexture.resolution,p=t.worldTransform,d=p.a/c,f=p.b/c,m=p.c/c,v=p.d/c,g=p.tx,y=p.ty,x=this.colors,b=this.positions;this.renderSession.roundPixels?(b[u]=d*o+m*s+g|0,b[u+1]=v*s+f*o+y|0,b[u+5]=d*r+m*s+g|0,b[u+6]=v*s+f*r+y|0,b[u+10]=d*r+m*n+g|0,b[u+11]=v*n+f*r+y|0,b[u+15]=d*o+m*n+g|0,b[u+16]=v*n+f*o+y|0):(b[u]=d*o+m*s+g,b[u+1]=v*s+f*o+y,b[u+5]=d*r+m*s+g,b[u+6]=v*s+f*r+y,b[u+10]=d*r+m*n+g,b[u+11]=v*n+f*r+y,b[u+15]=d*o+m*n+g,b[u+16]=v*n+f*o+y),b[u+2]=i.x0,b[u+3]=i.y0,b[u+7]=i.x1,b[u+8]=i.y1,b[u+12]=i.x2,b[u+13]=i.y2,b[u+17]=i.x3,b[u+18]=i.y3;var w=t.tint;x[u+4]=x[u+9]=x[u+14]=x[u+19]=(w>>16)+(65280&w)+((255&w)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},e.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var i=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture),t._uvs||(t._uvs=new e.TextureUvs);var r=t._uvs;t.tilePosition.x%=i.baseTexture.width*t.tileScaleOffset.x,t.tilePosition.y%=i.baseTexture.height*t.tileScaleOffset.y;var o=t.tilePosition.x/(i.baseTexture.width*t.tileScaleOffset.x),n=t.tilePosition.y/(i.baseTexture.height*t.tileScaleOffset.y),s=t.width/i.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),a=t.height/i.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);r.x0=0-o,r.y0=0-n,r.x1=1*s-o,r.y1=0-n,r.x2=1*s-o,r.y2=1*a-n,r.x3=0-o,r.y3=1*a-n;var h=t.tint,l=(h>>16)+(65280&h)+((255&h)<<16)+(255*t.alpha<<24),u=this.positions,c=this.colors,p=t.width,d=t.height,f=t.anchor.x,m=t.anchor.y,v=p*(1-f),g=p*-f,y=d*(1-m),x=d*-m,b=4*this.currentBatchSize*this.vertSize,w=i.baseTexture.resolution,_=t.worldTransform,T=_.a/w,S=_.b/w,A=_.c/w,C=_.d/w,E=_.tx,M=_.ty;u[b++]=T*g+A*x+E,u[b++]=C*x+S*g+M,u[b++]=r.x0,u[b++]=r.y0,c[b++]=l,u[b++]=T*v+A*x+E,u[b++]=C*x+S*v+M,u[b++]=r.x1,u[b++]=r.y1,c[b++]=l,u[b++]=T*v+A*y+E,u[b++]=C*y+S*v+M,u[b++]=r.x2,u[b++]=r.y2,c[b++]=l,u[b++]=T*g+A*y+E,u[b++]=C*y+S*g+M,u[b++]=r.x3,u[b++]=r.y3,c[b++]=l,this.sprites[this.currentBatchSize++]=t},e.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,i=this.gl;if(this.dirty){this.dirty=!1,i.activeTexture(i.TEXTURE0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[i.id];var r=4*this.vertSize;i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,r,0),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,r,8),i.vertexAttribPointer(t.colorAttribute,4,i.UNSIGNED_BYTE,!0,r,16)}if(this.currentBatchSize>.5*this.size)i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices);else{var o=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);i.bufferSubData(i.ARRAY_BUFFER,0,o)}for(var n,s,a,h,l=0,u=0,c=null,p=this.renderSession.blendModeManager.currentBlendMode,d=null,f=!1,m=!1,v=0,g=this.currentBatchSize;g>v;v++){if(h=this.sprites[v],n=h.texture.baseTexture,s=h.blendMode,a=h.shader||this.defaultShader,f=p!==s,m=d!==a,(c!==n||f||m)&&(this.renderBatch(c,l,u),u=v,l=0,c=n,f&&(p=s,this.renderSession.blendModeManager.setBlendMode(p)),m)){d=a,t=d.shaders[i.id],t||(t=new e.PixiShader(i),t.fragmentSrc=d.fragmentSrc,t.uniforms=d.uniforms,t.init(),d.shaders[i.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var y=this.renderSession.projection;i.uniform2f(t.projectionVector,y.x,y.y);var x=this.renderSession.offset;i.uniform2f(t.offsetVector,x.x,x.y),i.uniform1f(t.flipY,this.renderSession.flipY)}l++}this.renderBatch(c,l,u),this.currentBatchSize=0}},e.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;t._dirty[r.id]?this.renderSession.renderer.updateTexture(t):r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]),r.drawElements(r.TRIANGLES,6*e,r.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},e.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},e.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},e.WebGLFastSpriteBatch=function(t){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var i=4*this.size*this.vertSize,r=6*this.maxSize;this.vertices=new e.Float32Array(i),this.indices=new e.Uint16Array(r),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var o=0,n=0;r>o;o+=6,n+=4)this.indices[o+0]=n+0,this.indices[o+1]=n+1,this.indices[o+2]=n+2,this.indices[o+3]=n+0,this.indices[o+4]=n+2,this.indices[o+5]=n+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},e.WebGLFastSpriteBatch.prototype.constructor=e.WebGLFastSpriteBatch,e.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},e.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var r=0,o=e.length;o>r;r++)this.renderSprite(e[r]);this.flush()}},e.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,i,r,o,n,s,a,h,l=this.vertices;if(e=t.texture._uvs,i=t.texture.frame.width,r=t.texture.frame.height,t.texture.trim){var u=t.texture.trim;n=u.x-t.anchor.x*u.width,o=n+t.texture.crop.width,a=u.y-t.anchor.y*u.height,s=a+t.texture.crop.height}else o=t.texture.frame.width*(1-t.anchor.x),n=t.texture.frame.width*-t.anchor.x,s=t.texture.frame.height*(1-t.anchor.y),a=t.texture.frame.height*-t.anchor.y;h=4*this.currentBatchSize*this.vertSize,l[h++]=n,l[h++]=a,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x0,l[h++]=e.y1,l[h++]=t.alpha,l[h++]=o,l[h++]=a,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x1,l[h++]=e.y1,l[h++]=t.alpha,l[h++]=o,l[h++]=s,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x2,l[h++]=e.y2,l[h++]=t.alpha,l[h++]=n,l[h++]=s,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x3,l[h++]=e.y3,l[h++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},e.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)},e.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager,e.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},e.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},e.WebGLFilterManager.prototype.pushFilter=function(t){var i=this.gl,r=this.renderSession.projection,o=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),this.filterStack.push(t);var n=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var s=this.texturePool.pop();s?s.resize(this.width,this.height):s=new e.FilterTexture(this.gl,this.width,this.height),i.bindTexture(i.TEXTURE_2D,s.texture);var a=t._filterArea,h=n.padding;a.x-=h,a.y-=h,a.width+=2*h,a.height+=2*h,a.x<0&&(a.x=0),a.width>this.width&&(a.width=this.width),a.y<0&&(a.y=0),a.height>this.height&&(a.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,s.frameBuffer),i.viewport(0,0,a.width,a.height),r.x=a.width/2,r.y=-a.height/2,o.x=-a.x,o.y=-a.y,i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),t._glFilterTexture=s},e.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,i=this.filterStack.pop(),r=i._filterArea,o=i._glFilterTexture,n=this.renderSession.projection,s=this.renderSession.offset;
if(i.filterPasses.length>1){t.viewport(0,0,r.width,r.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=r.height,this.vertexArray[2]=r.width,this.vertexArray[3]=r.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=r.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=o,h=this.texturePool.pop();h||(h=new e.FilterTexture(this.gl,this.width,this.height)),h.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var l=0;l<i.filterPasses.length-1;l++){var u=i.filterPasses[l];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a.texture),this.applyFilterPass(u,r,r.width,r.height);var c=a;a=h,h=c}t.enable(t.BLEND),o=a,this.texturePool.push(h)}var p=i.filterPasses[i.filterPasses.length-1];this.offsetX-=r.x,this.offsetY-=r.y;var d=this.width,f=this.height,m=0,v=0,g=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var y=this.filterStack[this.filterStack.length-1];r=y._filterArea,d=r.width,f=r.height,m=r.x,v=r.y,g=y._glFilterTexture.frameBuffer}n.x=d/2,n.y=-f/2,s.x=m,s.y=v,r=i._filterArea;var x=r.x-m,b=r.y-v;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=x,this.vertexArray[1]=b+r.height,this.vertexArray[2]=x+r.width,this.vertexArray[3]=b+r.height,this.vertexArray[4]=x,this.vertexArray[5]=b,this.vertexArray[6]=x+r.width,this.vertexArray[7]=b,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,d,f),t.bindFramebuffer(t.FRAMEBUFFER,g),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.texture),this.applyFilterPass(p,r,d,f),this.texturePool.push(o),i._glFilterTexture=null},e.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,o){var n=this.gl,s=t.shaders[n.id];s||(s=new e.PixiShader(n),s.fragmentSrc=t.fragmentSrc,s.uniforms=t.uniforms,s.init(),t.shaders[n.id]=s),this.renderSession.shaderManager.setShader(s),n.uniform2f(s.projectionVector,r/2,-o/2),n.uniform2f(s.offsetVector,0,0),n.uniform1f(s.flipY,1),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),s.syncUniforms(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),n.vertexAttribPointer(s.colorAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),this.renderSession.drawCount++},e.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new e.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new e.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new e.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},e.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},e.FilterTexture=function(t,i,r,o){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),o=o||e.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,o===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(i,r)},e.FilterTexture.prototype.constructor=e.FilterTexture,e.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},e.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},e.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},e.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},e.CanvasBuffer.prototype.constructor=e.CanvasBuffer,e.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},e.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},e.CanvasMaskManager=function(){},e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager,e.CanvasMaskManager.prototype.pushMask=function(t,i){var r=i.context;r.save();var o=t.alpha,n=t.worldTransform,s=i.resolution;r.setTransform(n.a*s,n.b*s,n.c*s,n.d*s,n.tx*s,n.ty*s),e.CanvasGraphics.renderGraphicsMask(t,r),r.clip(),t.worldAlpha=o},e.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},e.CanvasTinter=function(){},e.CanvasTinter.getTintedTexture=function(t,i){var r=t.texture;i=e.CanvasTinter.roundColor(i);var o="#"+("00000"+(0|i).toString(16)).substr(-6);if(r.tintCache=r.tintCache||{},r.tintCache[o])return r.tintCache[o];var n=e.CanvasTinter.canvas||document.createElement("canvas");if(e.CanvasTinter.tintMethod(r,i,n),e.CanvasTinter.convertTintToImage){var s=new Image;s.src=n.toDataURL(),r.tintCache[o]=s}else r.tintCache[o]=n,e.CanvasTinter.canvas=null;return n},e.CanvasTinter.tintWithMultiply=function(t,e,i){var r=i.getContext("2d"),o=t.crop;i.width=o.width,i.height=o.height,r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="multiply",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height)},e.CanvasTinter.tintWithOverlay=function(t,e,i){var r=i.getContext("2d"),o=t.crop;i.width=o.width,i.height=o.height,r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height)},e.CanvasTinter.tintWithPerPixel=function(t,i,r){var o=r.getContext("2d"),n=t.crop;r.width=n.width,r.height=n.height,o.globalCompositeOperation="copy",o.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height);for(var s=e.hex2rgb(i),a=s[0],h=s[1],l=s[2],u=o.getImageData(0,0,n.width,n.height),c=u.data,p=0;p<c.length;p+=4)c[p+0]*=a,c[p+1]*=h,c[p+2]*=l;o.putImageData(u,0,0)},e.CanvasTinter.roundColor=function(t){var i=e.CanvasTinter.cacheStepsPerColorChannel,r=e.hex2rgb(t);return r[0]=Math.min(255,r[0]/i*i),r[1]=Math.min(255,r[1]/i*i),r[2]=Math.min(255,r[2]/i*i),e.rgb2hex(r)},e.CanvasTinter.cacheStepsPerColorChannel=8,e.CanvasTinter.convertTintToImage=!1,e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes(),e.CanvasTinter.tintMethod=e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel,e.CanvasRenderer=function(t,i,r){if(r)for(var o in e.defaultRenderOptions)"undefined"==typeof r[o]&&(r[o]=e.defaultRenderOptions[o]);else r=e.defaultRenderOptions;e.defaultRenderer||(e.sayHello("Canvas"),e.defaultRenderer=this),this.type=e.CANVAS_RENDERER,this.resolution=r.resolution,this.clearBeforeRender=r.clearBeforeRender,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.width=t||800,this.height=i||600,this.width*=this.resolution,this.height*=this.resolution,this.view=r.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new e.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(t,i),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},e.CanvasRenderer.prototype.constructor=e.CanvasRenderer,e.CanvasRenderer.prototype.render=function(t){t.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=e.blendModes.NORMAL,this.context.globalCompositeOperation=e.blendModesCanvas[e.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)))},e.CanvasRenderer.prototype.destroy=function(t){"undefined"==typeof t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},e.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},e.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession)},e.CanvasRenderer.prototype.mapBlendModes=function(){e.blendModesCanvas||(e.blendModesCanvas=[],e.canUseNewCanvasBlendModes()?(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]="multiply",e.blendModesCanvas[e.blendModes.SCREEN]="screen",e.blendModesCanvas[e.blendModes.OVERLAY]="overlay",e.blendModesCanvas[e.blendModes.DARKEN]="darken",e.blendModesCanvas[e.blendModes.LIGHTEN]="lighten",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="color-dodge",e.blendModesCanvas[e.blendModes.COLOR_BURN]="color-burn",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="hard-light",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="soft-light",e.blendModesCanvas[e.blendModes.DIFFERENCE]="difference",e.blendModesCanvas[e.blendModes.EXCLUSION]="exclusion",e.blendModesCanvas[e.blendModes.HUE]="hue",e.blendModesCanvas[e.blendModes.SATURATION]="saturation",e.blendModesCanvas[e.blendModes.COLOR]="color",e.blendModesCanvas[e.blendModes.LUMINOSITY]="luminosity"):(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]="source-over",e.blendModesCanvas[e.blendModes.SCREEN]="source-over",e.blendModesCanvas[e.blendModes.OVERLAY]="source-over",e.blendModesCanvas[e.blendModes.DARKEN]="source-over",e.blendModesCanvas[e.blendModes.LIGHTEN]="source-over",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="source-over",e.blendModesCanvas[e.blendModes.COLOR_BURN]="source-over",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.DIFFERENCE]="source-over",e.blendModesCanvas[e.blendModes.EXCLUSION]="source-over",e.blendModesCanvas[e.blendModes.HUE]="source-over",e.blendModesCanvas[e.blendModes.SATURATION]="source-over",e.blendModesCanvas[e.blendModes.COLOR]="source-over",e.blendModesCanvas[e.blendModes.LUMINOSITY]="source-over"))},e.CanvasGraphics=function(){},e.CanvasGraphics.renderGraphics=function(t,i){var r=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var o=0;o<t.graphicsData.length;o++){var n=t.graphicsData[o],s=n.shape,a=n._fillTint,h=n._lineTint;if(i.lineWidth=n.lineWidth,n.type===e.Graphics.POLY){i.beginPath();var l=s.points;i.moveTo(l[0],l[1]);for(var u=1;u<l.length/2;u++)i.lineTo(l[2*u],l[2*u+1]);s.closed&&i.lineTo(l[0],l[1]),l[0]===l[l.length-2]&&l[1]===l[l.length-1]&&i.closePath(),n.fill&&(i.globalAlpha=n.fillAlpha*r,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),n.lineWidth&&(i.globalAlpha=n.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke())}else if(n.type===e.Graphics.RECT)(n.fillColor||0===n.fillColor)&&(i.globalAlpha=n.fillAlpha*r,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fillRect(s.x,s.y,s.width,s.height)),n.lineWidth&&(i.globalAlpha=n.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.strokeRect(s.x,s.y,s.width,s.height));else if(n.type===e.Graphics.CIRC)i.beginPath(),i.arc(s.x,s.y,s.radius,0,2*Math.PI),i.closePath(),n.fill&&(i.globalAlpha=n.fillAlpha*r,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),n.lineWidth&&(i.globalAlpha=n.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke());else if(n.type===e.Graphics.ELIP){var c=2*s.width,p=2*s.height,d=s.x-c/2,f=s.y-p/2;i.beginPath();var m=.5522848,v=c/2*m,g=p/2*m,y=d+c,x=f+p,b=d+c/2,w=f+p/2;i.moveTo(d,w),i.bezierCurveTo(d,w-g,b-v,f,b,f),i.bezierCurveTo(b+v,f,y,w-g,y,w),i.bezierCurveTo(y,w+g,b+v,x,b,x),i.bezierCurveTo(b-v,x,d,w+g,d,w),i.closePath(),n.fill&&(i.globalAlpha=n.fillAlpha*r,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),n.lineWidth&&(i.globalAlpha=n.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke())}else if(n.type===e.Graphics.RREC){var _=s.x,T=s.y,S=s.width,A=s.height,C=s.radius,E=Math.min(S,A)/2|0;C=C>E?E:C,i.beginPath(),i.moveTo(_,T+C),i.lineTo(_,T+A-C),i.quadraticCurveTo(_,T+A,_+C,T+A),i.lineTo(_+S-C,T+A),i.quadraticCurveTo(_+S,T+A,_+S,T+A-C),i.lineTo(_+S,T+C),i.quadraticCurveTo(_+S,T,_+S-C,T),i.lineTo(_+C,T),i.quadraticCurveTo(_,T,_,T+C),i.closePath(),(n.fillColor||0===n.fillColor)&&(i.globalAlpha=n.fillAlpha*r,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),n.lineWidth&&(i.globalAlpha=n.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke())}}},e.CanvasGraphics.renderGraphicsMask=function(t,i){var r=t.graphicsData.length;if(0!==r){r>1&&(r=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var o=0;1>o;o++){var n=t.graphicsData[o],s=n.shape;if(n.type===e.Graphics.POLY){i.beginPath();var a=s.points;i.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)i.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&i.closePath()}else if(n.type===e.Graphics.RECT)i.beginPath(),i.rect(s.x,s.y,s.width,s.height),i.closePath();else if(n.type===e.Graphics.CIRC)i.beginPath(),i.arc(s.x,s.y,s.radius,0,2*Math.PI),i.closePath();else if(n.type===e.Graphics.ELIP){var l=2*s.width,u=2*s.height,c=s.x-l/2,p=s.y-u/2;i.beginPath();var d=.5522848,f=l/2*d,m=u/2*d,v=c+l,g=p+u,y=c+l/2,x=p+u/2;i.moveTo(c,x),i.bezierCurveTo(c,x-m,y-f,p,y,p),i.bezierCurveTo(y+f,p,v,x-m,v,x),i.bezierCurveTo(v,x+m,y+f,g,y,g),i.bezierCurveTo(y-f,g,c,x+m,c,x),i.closePath()}else if(n.type===e.Graphics.RREC){var b=s.points,w=b[0],_=b[1],T=b[2],S=b[3],A=b[4],C=Math.min(T,S)/2|0;A=A>C?C:A,i.beginPath(),i.moveTo(w,_+A),i.lineTo(w,_+S-A),i.quadraticCurveTo(w,_+S,w+A,_+S),i.lineTo(w+T-A,_+S),i.quadraticCurveTo(w+T,_+S,w+T,_+S-A),i.lineTo(w+T,_+A),i.quadraticCurveTo(w+T,_,w+T-A,_),i.lineTo(w+A,_),i.quadraticCurveTo(w,_,w,_+A),i.closePath()}}}},e.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,r=(255&t.tint)/255,o=0;o<t.graphicsData.length;o++){var n=t.graphicsData[o],s=0|n.fillColor,a=0|n.lineColor;n._fillTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*i*255<<8)+(255&s)/255*r*255,n._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*r*255}},e.Graphics=function(){e.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=e.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new e.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},e.Graphics.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Graphics.prototype.constructor=e.Graphics,Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),e.Graphics.prototype.lineStyle=function(t,i,r){if(this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:r,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new e.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},e.Graphics.prototype.moveTo=function(t,i){return this.drawShape(new e.Polygon([t,i])),this},e.Graphics.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},e.Graphics.prototype.quadraticCurveTo=function(t,e,i,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var o,n,s=20,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var h=a[a.length-2],l=a[a.length-1],u=0,c=1;s>=c;c++)u=c/s,o=h+(t-h)*u,n=l+(e-l)*u,a.push(o+(t+(i-t)*u-o)*u,n+(e+(r-e)*u-n)*u);return this.dirty=!0,this},e.Graphics.prototype.bezierCurveTo=function(t,e,i,r,o,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var s,a,h,l,u,c=20,p=this.currentPath.shape.points,d=p[p.length-2],f=p[p.length-1],m=0,v=1;c>=v;v++)m=v/c,s=1-m,a=s*s,h=a*s,l=m*m,u=l*m,p.push(h*d+3*a*m*t+3*s*l*i+u*o,h*f+3*a*m*e+3*s*l*r+u*n);return this.dirty=!0,this},e.Graphics.prototype.arcTo=function(t,e,i,r,o){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var n=this.currentPath.shape.points,s=n[n.length-2],a=n[n.length-1],h=a-e,l=s-t,u=r-e,c=i-t,p=Math.abs(h*c-l*u);if(1e-8>p||0===o)(n[n.length-2]!==t||n[n.length-1]!==e)&&n.push(t,e);else{var d=h*h+l*l,f=u*u+c*c,m=h*u+l*c,v=o*Math.sqrt(d)/p,g=o*Math.sqrt(f)/p,y=v*m/d,x=g*m/f,b=v*c+g*l,w=v*u+g*h,_=l*(g+y),T=h*(g+y),S=c*(v+x),A=u*(v+x),C=Math.atan2(T-w,_-b),E=Math.atan2(A-w,S-b);this.arc(b+t,w+e,o,C,E,l*u>c*h)}return this.dirty=!0,this},e.Graphics.prototype.arc=function(t,e,i,r,o,n){var s,a=t+Math.cos(r)*i,h=e+Math.sin(r)*i;if(this.currentPath?(s=this.currentPath.shape.points,0===s.length?s.push(a,h):(s[s.length-2]!==a||s[s.length-1]!==h)&&s.push(a,h)):(this.moveTo(a,h),s=this.currentPath.shape.points),r===o)return this;!n&&r>=o?o+=2*Math.PI:n&&o>=r&&(r+=2*Math.PI);var l=n?-1*(r-o):o-r,u=Math.abs(l)/(2*Math.PI)*40;if(0===l)return this;for(var c=l/(2*u),p=2*c,d=Math.cos(c),f=Math.sin(c),m=u-1,v=m%1/m,g=0;m>=g;g++){var y=g+v*g,x=c+r+p*y,b=Math.cos(x),w=-Math.sin(x);s.push((d*b+f*w)*i+t,(d*-w+f*b)*i+e)}return this.dirty=!0,this},e.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},e.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},e.Graphics.prototype.drawRect=function(t,i,r,o){return this.drawShape(new e.Rectangle(t,i,r,o)),this},e.Graphics.prototype.drawRoundedRect=function(t,i,r,o,n){return this.drawShape(new e.RoundedRectangle(t,i,r,o,n)),this},e.Graphics.prototype.drawCircle=function(t,i,r){return this.drawShape(new e.Circle(t,i,r)),this},e.Graphics.prototype.drawEllipse=function(t,i,r,o){return this.drawShape(new e.Ellipse(t,i,r,o)),this},e.Graphics.prototype.drawPolygon=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments)),this.drawShape(new e.Polygon(t)),this},e.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},e.Graphics.prototype.generateTexture=function(t,i){t=t||1;var r=this.getBounds(),o=new e.CanvasBuffer(r.width*t,r.height*t),n=e.Texture.fromCanvas(o.canvas,i);return n.baseTexture.resolution=t,o.context.scale(t,t),o.context.translate(-r.x,-r.y),e.CanvasGraphics.renderGraphics(this,o.context),n},e.Graphics.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var i=e.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(i[0],i[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),e.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var r=0,o=this.children.length;o>r;r++)this.children[r]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},e.Graphics.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);var i=t.context,r=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var o=t.resolution;i.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*o,r.ty*o),e.CanvasGraphics.renderGraphics(this,i);for(var n=0,s=this.children.length;s>n;n++)this.children[n]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.Graphics.prototype.getBounds=function(t){if(this.isMask)return e.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var i=this._localBounds,r=i.x,o=i.width+i.x,n=i.y,s=i.height+i.y,a=t||this.worldTransform,h=a.a,l=a.b,u=a.c,c=a.d,p=a.tx,d=a.ty,f=h*o+u*s+p,m=c*s+l*o+d,v=h*r+u*s+p,g=c*s+l*r+d,y=h*r+u*n+p,x=c*n+l*r+d,b=h*o+u*n+p,w=c*n+l*o+d,_=f,T=m,S=f,A=m;return S=S>v?v:S,S=S>y?y:S,S=S>b?b:S,A=A>g?g:A,A=A>x?x:A,A=A>w?w:A,_=v>_?v:_,_=y>_?y:_,_=b>_?b:_,T=g>T?g:T,T=x>T?x:T,T=w>T?w:T,this._bounds.x=S,this._bounds.width=_-S,this._bounds.y=A,this._bounds.height=T-A,this._bounds},e.Graphics.prototype.updateLocalBounds=function(){var t=1/0,i=-1/0,r=1/0,o=-1/0;if(this.graphicsData.length)for(var n,s,a,h,l,u,c=0;c<this.graphicsData.length;c++){var p=this.graphicsData[c],d=p.type,f=p.lineWidth;if(n=p.shape,d===e.Graphics.RECT||d===e.Graphics.RREC)a=n.x-f/2,h=n.y-f/2,l=n.width+f,u=n.height+f,t=t>a?a:t,i=a+l>i?a+l:i,r=r>h?h:r,o=h+u>o?h+u:o;else if(d===e.Graphics.CIRC)a=n.x,h=n.y,l=n.radius+f/2,u=n.radius+f/2,t=t>a-l?a-l:t,i=a+l>i?a+l:i,r=r>h-u?h-u:r,o=h+u>o?h+u:o;else if(d===e.Graphics.ELIP)a=n.x,h=n.y,l=n.width+f/2,u=n.height+f/2,t=t>a-l?a-l:t,i=a+l>i?a+l:i,r=r>h-u?h-u:r,o=h+u>o?h+u:o;else{s=n.points;for(var m=0;m<s.length;m+=2)a=s[m],h=s[m+1],t=t>a-f?a-f:t,i=a+f>i?a+f:i,r=r>h-f?h-f:r,o=h+f>o?h+f:o}}else t=0,i=0,r=0,o=0;var v=this.boundsPadding;this._localBounds.x=t-v,this._localBounds.width=i-t+2*v,this._localBounds.y=r-v,this._localBounds.height=o-r+2*v},e.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(t.width,t.height);else{var i=new e.CanvasBuffer(t.width,t.height),r=e.Texture.fromCanvas(i.canvas);this._cachedSprite=new e.Sprite(r),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._cachedSprite.buffer.context.translate(-t.x,-t.y),this.worldAlpha=1,e.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},e.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},e.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var i=new e.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(i),i.type===e.Graphics.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i},e.GraphicsData=function(t,e,i,r,o,n,s){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=r,this.fillAlpha=o,this._fillTint=r,this.fill=n,this.shape=s,this.type=s.type},e.Graphics.POLY=0,e.Graphics.RECT=1,e.Graphics.CIRC=2,e.Graphics.ELIP=3,e.Graphics.RREC=4,e.Polygon.prototype.type=e.Graphics.POLY,e.Rectangle.prototype.type=e.Graphics.RECT,e.Circle.prototype.type=e.Graphics.CIRC,e.Ellipse.prototype.type=e.Graphics.ELIP,e.RoundedRectangle.prototype.type=e.Graphics.RREC,e.Strip=function(t){e.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new e.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new e.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new e.Float32Array([1,1,1,1]),this.indices=new e.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=e.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=e.Strip.DrawModes.TRIANGLE_STRIP},e.Strip.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Strip.prototype.constructor=e.Strip,e.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},e.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},e.Strip.prototype._renderStrip=function(t){var i=t.gl,r=t.projection,o=t.offset,n=t.shaderManager.stripShader,s=this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),i.uniformMatrix3fv(n.translationMatrix,!1,this.worldTransform.toArray(!0)),i.uniform2f(n.projectionVector,r.x,-r.y),i.uniform2f(n.offsetVector,-o.x,-o.y),i.uniform1f(n.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(n.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(n.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),i.drawElements(s,this.indices.length,i.UNSIGNED_SHORT,0)},e.Strip.prototype._renderCanvas=function(t){var i=t.context,r=this.worldTransform;t.roundPixels?i.setTransform(r.a,r.b,r.c,r.d,0|r.tx,0|r.ty):i.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(i):this._renderCanvasTriangles(i)},e.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,r=e.length/2;this.count++;for(var o=0;r-2>o;o++){var n=2*o;this._renderCanvasDrawTriangle(t,e,i,n,n+2,n+4)}},e.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,r=this.indices,o=r.length;this.count++;for(var n=0;o>n;n+=3){var s=2*r[n],a=2*r[n+1],h=2*r[n+2];this._renderCanvasDrawTriangle(t,e,i,s,a,h)}},e.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,r,o,n){var s=this.texture.baseTexture.source,a=this.texture.width,h=this.texture.height,l=e[r],u=e[o],c=e[n],p=e[r+1],d=e[o+1],f=e[n+1],m=i[r]*a,v=i[o]*a,g=i[n]*a,y=i[r+1]*h,x=i[o+1]*h,b=i[n+1]*h;
if(this.canvasPadding>0){var w=this.canvasPadding/this.worldTransform.a,_=this.canvasPadding/this.worldTransform.d,T=(l+u+c)/3,S=(p+d+f)/3,A=l-T,C=p-S,E=Math.sqrt(A*A+C*C);l=T+A/E*(E+w),p=S+C/E*(E+_),A=u-T,C=d-S,E=Math.sqrt(A*A+C*C),u=T+A/E*(E+w),d=S+C/E*(E+_),A=c-T,C=f-S,E=Math.sqrt(A*A+C*C),c=T+A/E*(E+w),f=S+C/E*(E+_)}t.save(),t.beginPath(),t.moveTo(l,p),t.lineTo(u,d),t.lineTo(c,f),t.closePath(),t.clip();var M=m*x+y*g+v*b-x*g-y*v-m*b,B=l*x+y*c+u*b-x*c-y*u-l*b,L=m*u+l*g+v*c-u*g-l*v-m*c,P=m*x*c+y*u*g+l*v*b-l*x*g-y*v*c-m*u*b,R=p*x+y*f+d*b-x*f-y*d-p*b,F=m*d+p*g+v*f-d*g-p*v-m*f,I=m*x*f+y*d*g+p*v*b-p*x*g-y*v*f-m*d*b;t.transform(B/M,R/M,L/M,F/M,P/M,I/M),t.drawImage(s,0,0),t.restore()},e.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,r=i.length/2;this.count++,e.beginPath();for(var o=1;r-2>o;o++){var n=2*o,s=i[n],a=i[n+2],h=i[n+4],l=i[n+1],u=i[n+3],c=i[n+5];e.moveTo(s,l),e.lineTo(a,u),e.lineTo(h,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},e.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},e.Strip.prototype.getBounds=function(t){for(var i=t||this.worldTransform,r=i.a,o=i.b,n=i.c,s=i.d,a=i.tx,h=i.ty,l=-1/0,u=-1/0,c=1/0,p=1/0,d=this.vertices,f=0,m=d.length;m>f;f+=2){var v=d[f],g=d[f+1],y=r*v+n*g+a,x=s*g+o*v+h;c=c>y?y:c,p=p>x?x:p,l=y>l?y:l,u=x>u?x:u}if(c===-1/0||1/0===u)return e.EmptyRectangle;var b=this._bounds;return b.x=c,b.width=l-c,b.y=p,b.height=u-p,this._currentBounds=b,b},e.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},e.Rope=function(t,i){e.Strip.call(this,t),this.points=i,this.vertices=new e.Float32Array(4*i.length),this.uvs=new e.Float32Array(4*i.length),this.colors=new e.Float32Array(2*i.length),this.indices=new e.Uint16Array(2*i.length),this.refresh()},e.Rope.prototype=Object.create(e.Strip.prototype),e.Rope.prototype.constructor=e.Rope,e.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=t[0],r=this.indices,o=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,o[0]=1,o[1]=1,r[0]=0,r[1]=1;for(var n,s,a,h=t.length,l=1;h>l;l++)n=t[l],s=4*l,a=l/(h-1),l%2?(e[s]=a,e[s+1]=0,e[s+2]=a,e[s+3]=1):(e[s]=a,e[s+1]=0,e[s+2]=a,e[s+3]=1),s=2*l,o[s]=1,o[s+1]=1,s=2*l,r[s]=s,r[s+1]=s+1,i=n}},e.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var i,r=t[0],o={x:0,y:0};this.count-=.2;for(var n,s,a,h,l,u=this.vertices,c=t.length,p=0;c>p;p++)n=t[p],s=4*p,i=p<t.length-1?t[p+1]:n,o.y=-(i.x-r.x),o.x=i.y-r.y,a=10*(1-p/(c-1)),a>1&&(a=1),h=Math.sqrt(o.x*o.x+o.y*o.y),l=this.texture.height/2,o.x/=h,o.y/=h,o.x*=l,o.y*=l,u[s]=n.x+o.x,u[s+1]=n.y+o.y,u[s+2]=n.x-o.x,u[s+3]=n.y-o.y,r=n;e.DisplayObjectContainer.prototype.updateTransform.call(this)}},e.Rope.prototype.setTexture=function(t){this.texture=t},e.TilingSprite=function(t,i,r){e.Sprite.call(this,t),this._width=i||100,this._height=r||100,this.tileScale=new e.Point(1,1),this.tileScaleOffset=new e.Point(1,1),this.tilePosition=new e.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=e.blendModes.NORMAL},e.TilingSprite.prototype=Object.create(e.Sprite.prototype),e.TilingSprite.prototype.constructor=e.TilingSprite,Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),e.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},e.TilingSprite.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha){var i,r;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(e.updateWebGLTexture(this.tilingTexture.baseTexture,t.gl),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),i=0,r=this.children.length;r>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},e.TilingSprite.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha){var i=t.context;this._mask&&t.maskManager.pushMask(this._mask,i),i.globalAlpha=this.worldAlpha;var r,o,n=this.worldTransform,s=t.resolution;if(i.setTransform(n.a*s,n.b*s,n.c*s,n.d*s,n.tx*s,n.ty*s),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]);var a=this.tilePosition,h=this.tileScale;for(a.x%=this.tilingTexture.baseTexture.width,a.y%=this.tilingTexture.baseTexture.height,i.scale(h.x,h.y),i.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-a.x,-a.y,this._width/h.x,this._height/h.y),i.scale(1/h.x,1/h.y),i.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t.context),r=0,o=this.children.length;o>r;r++)this.children[r]._renderCanvas(t)}},e.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),r=t*-this.anchor.x,o=e*(1-this.anchor.y),n=e*-this.anchor.y,s=this.worldTransform,a=s.a,h=s.b,l=s.c,u=s.d,c=s.tx,p=s.ty,d=a*r+l*n+c,f=u*n+h*r+p,m=a*i+l*n+c,v=u*n+h*i+p,g=a*i+l*o+c,y=u*o+h*i+p,x=a*r+l*o+c,b=u*o+h*r+p,w=-1/0,_=-1/0,T=1/0,S=1/0;T=T>d?d:T,T=T>m?m:T,T=T>g?g:T,T=T>x?x:T,S=S>f?f:S,S=S>v?v:S,S=S>y?y:S,S=S>b?b:S,w=d>w?d:w,w=m>w?m:w,w=g>w?g:w,w=x>w?x:w,_=f>_?f:_,_=v>_?v:_,_=y>_?y:_,_=b>_?b:_;var A=this._bounds;return A.x=T,A.width=w-T,A.y=S,A.height=_-S,this._currentBounds=A,A},e.TilingSprite.prototype.onTextureUpdate=function(){},e.TilingSprite.prototype.generateTilingTexture=function(t){if(this.texture.baseTexture.hasLoaded){var i,r,o=this.originalTexture||this.texture,n=o.frame,s=n.width!==o.baseTexture.width||n.height!==o.baseTexture.height,a=!1;if(t?(i=e.getNextPowerOfTwo(n.width),r=e.getNextPowerOfTwo(n.height),(n.width!==i||n.height!==r||o.baseTexture.width!==i||o.baseTexture.height||r)&&(a=!0)):s&&(i=n.width,r=n.height,a=!0),a){var h;this.tilingTexture&&this.tilingTexture.isTiling?(h=this.tilingTexture.canvasBuffer,h.resize(i,r),this.tilingTexture.baseTexture.width=i,this.tilingTexture.baseTexture.height=r,this.tilingTexture.needsUpdate=!0):(h=new e.CanvasBuffer(i,r),this.tilingTexture=e.Texture.fromCanvas(h.canvas),this.tilingTexture.canvasBuffer=h,this.tilingTexture.isTiling=!0),h.context.drawImage(o.baseTexture.source,o.crop.x,o.crop.y,o.crop.width,o.crop.height,0,0,i,r),this.tileScaleOffset.x=n.width/i,this.tileScaleOffset.y=n.height/r}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=o;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}};var i={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};i.BoneData=function(t,e){this.name=t,this.parent=e},i.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},i.SlotData=function(t,e){this.name=t,this.boneData=e},i.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},i.IkConstraintData=function(t){this.name=t,this.bones=[]},i.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},i.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},i.Bone.yDown=!1,i.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var e=this.skeleton.flipX,r=this.skeleton.flipY;this.worldX=e?-this.x:this.x,this.worldY=r!=i.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=e!=this.flipX,this.worldFlipY=r!=this.flipY}var o=this.worldRotation*i.degRad,n=Math.cos(o),s=Math.sin(o);this.worldFlipX?(this.m00=-n*this.worldScaleX,this.m01=s*this.worldScaleY):(this.m00=n*this.worldScaleX,this.m01=-s*this.worldScaleY),this.worldFlipY!=i.Bone.yDown?(this.m10=-s*this.worldScaleX,this.m11=-n*this.worldScaleY):(this.m10=s*this.worldScaleX,this.m11=n*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,r=t[1]-this.worldY,o=this.m00,n=this.m10,s=this.m01,a=this.m11;this.worldFlipX!=(this.worldFlipY!=i.Bone.yDown)&&(o=-o,a=-a);var h=1/(o*a-s*n);t[0]=e*o*h-r*s*h,t[1]=r*a*h-e*n*h},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},i.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},i.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,i=0,r=e.length;r>i;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},i.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,r=t.bones.length;r>i;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},i.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:i.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:i.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},i.IkConstraint.apply1=function(t,e,r,o){var n=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,s=t.rotation,a=Math.atan2(r-t.worldY,e-t.worldX)*i.radDeg-n;t.rotationIK=s+(a-s)*o},i.IkConstraint.apply2=function(t,e,r,o,n,s){var a=e.rotation,h=t.rotation;if(!s)return e.rotationIK=a,void(t.rotationIK=h);var l,u,c=i.temp,p=t.parent;p?(c[0]=r,c[1]=o,p.worldToLocal(c),r=(c[0]-t.x)*p.worldScaleX,o=(c[1]-t.y)*p.worldScaleY):(r-=t.x,o-=t.y),e.parent==t?(l=e.x,u=e.y):(c[0]=e.x,c[1]=e.y,e.parent.localToWorld(c),t.worldToLocal(c),l=c[0],u=c[1]);var d=l*t.worldScaleX,f=u*t.worldScaleY,m=Math.atan2(f,d),v=Math.sqrt(d*d+f*f),g=e.data.length*e.worldScaleX,y=2*v*g;if(1e-4>y)return void(e.rotationIK=a+(Math.atan2(o,r)*i.radDeg-h-a)*s);var x=(r*r+o*o-v*v-g*g)/y;-1>x?x=-1:x>1&&(x=1);var b=Math.acos(x)*n,w=v+g*x,_=g*Math.sin(b),T=Math.atan2(o*w-r*_,r*w+o*_),S=(T-m)*i.radDeg-h;S>180?S-=360:-180>S&&(S+=360),t.rotationIK=h+S*s,S=(b+m)*i.radDeg-a,S>180?S-=360:-180>S&&(S+=360),e.rotationIK=a+(S+t.worldRotation-e.parent.worldRotation)*s},i.Skin=function(t){this.name=t,this.attachments={}},i.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var r=i.indexOf(":"),o=parseInt(i.substring(0,r)),n=i.substring(r+1),s=t.slots[o];if(s.attachment&&s.attachment.name==n){var a=this.getAttachment(o,n);a&&s.setAttachment(a)}}}},i.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},i.Animation.prototype={apply:function(t,e,i,r,o){r&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var n=this.timelines,s=0,a=n.length;a>s;s++)n[s].apply(t,e,i,o,1)},mix:function(t,e,i,r,o,n){r&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var s=this.timelines,a=0,h=s.length;h>a;a++)s[a].apply(t,e,i,o,n)}},i.Animation.binarySearch=function(t,e,i){var r=0,o=Math.floor(t.length/i)-2;if(!o)return i;for(var n=o>>>1;;){if(t[(n+1)*i]<=e?r=n+1:o=n,r==o)return(r+1)*i;n=r+o>>>1}},i.Animation.binarySearch1=function(t,e){var i=0,r=t.length-2;if(!r)return 1;for(var o=r>>>1;;){if(t[o+1]<=e?i=o+1:r=o,i==r)return i+1;o=i+r>>>1}},i.Animation.linearSearch=function(t,e,i){for(var r=0,o=t.length-i;o>=r;r+=i)if(t[r]>e)return r;return-1},i.Curves=function(){this.curves=[]},i.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,r,o){var n=.1,s=n*n,a=s*n,h=3*n,l=3*s,u=6*s,c=6*a,p=2*-e+r,d=2*-i+o,f=3*(e-r)+1,m=3*(i-o)+1,v=e*h+p*l+f*a,g=i*h+d*l+m*a,y=p*u+f*c,x=d*u+m*c,b=f*c,w=m*c,_=19*t,T=this.curves;T[_++]=2;for(var S=v,A=g,C=_+19-1;C>_;_+=2)T[_]=S,T[_+1]=A,v+=y,g+=x,y+=b,x+=w,S+=v,A+=g},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=this.curves,r=19*t,o=i[r];if(0===o)return e;if(1==o)return 0;r++;for(var n=0,s=r,a=r+19-1;a>r;r+=2)if(n=i[r],n>=e){var h,l;return r==s?(h=0,l=0):(h=i[r-2],l=i[r-1]),l+(i[r+1]-l)*(e-h)/(n-h)}var u=i[r-1];return u+(1-u)*(e-n)/(1-n)}},i.RotateTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=2*t},i.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,r,o,n){var s=this.frames;if(!(r<s[0])){var a=t.bones[this.boneIndex];if(r>=s[s.length-2]){for(var h=a.data.rotation+s[s.length-1]-a.rotation;h>180;)h-=360;for(;-180>h;)h+=360;return void(a.rotation+=h*n)}var l=i.Animation.binarySearch(s,r,2),u=s[l-1],c=s[l],p=1-(r-c)/(s[l-2]-c);p=this.curves.getCurvePercent(l/2-1,p);for(var h=s[l+1]-u;h>180;)h-=360;for(;-180>h;)h+=360;for(h=a.data.rotation+(u+h*p)-a.rotation;h>180;)h-=360;for(;-180>h;)h+=360;a.rotation+=h*n}}},i.TranslateTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=3*t},i.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r},apply:function(t,e,r,o,n){var s=this.frames;if(!(r<s[0])){var a=t.bones[this.boneIndex];if(r>=s[s.length-3])return a.x+=(a.data.x+s[s.length-2]-a.x)*n,void(a.y+=(a.data.y+s[s.length-1]-a.y)*n);var h=i.Animation.binarySearch(s,r,3),l=s[h-2],u=s[h-1],c=s[h],p=1-(r-c)/(s[h+-3]-c);p=this.curves.getCurvePercent(h/3-1,p),a.x+=(a.data.x+l+(s[h+1]-l)*p-a.x)*n,a.y+=(a.data.y+u+(s[h+2]-u)*p-a.y)*n}}},i.ScaleTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=3*t},i.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r},apply:function(t,e,r,o,n){var s=this.frames;if(!(r<s[0])){var a=t.bones[this.boneIndex];if(r>=s[s.length-3])return a.scaleX+=(a.data.scaleX*s[s.length-2]-a.scaleX)*n,void(a.scaleY+=(a.data.scaleY*s[s.length-1]-a.scaleY)*n);var h=i.Animation.binarySearch(s,r,3),l=s[h-2],u=s[h-1],c=s[h],p=1-(r-c)/(s[h+-3]-c);p=this.curves.getCurvePercent(h/3-1,p),a.scaleX+=(a.data.scaleX*(l+(s[h+1]-l)*p)-a.scaleX)*n,a.scaleY+=(a.data.scaleY*(u+(s[h+2]-u)*p)-a.scaleY)*n}}},i.ColorTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=5*t},i.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,r,o,n){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r,this.frames[t+3]=o,this.frames[t+4]=n},apply:function(t,e,r,o,n){var s=this.frames;if(!(r<s[0])){var a,h,l,u;if(r>=s[s.length-5]){var c=s.length-1;a=s[c-3],h=s[c-2],l=s[c-1],u=s[c]}else{var p=i.Animation.binarySearch(s,r,5),d=s[p-4],f=s[p-3],m=s[p-2],v=s[p-1],g=s[p],y=1-(r-g)/(s[p-5]-g);y=this.curves.getCurvePercent(p/5-1,y),a=d+(s[p+1]-d)*y,h=f+(s[p+2]-f)*y,l=m+(s[p+3]-m)*y,u=v+(s[p+4]-v)*y}var x=t.slots[this.slotIndex];1>n?(x.r+=(a-x.r)*n,x.g+=(h-x.g)*n,x.b+=(l-x.b)*n,x.a+=(u-x.a)*n):(x.r=a,x.g=h,x.b=l,x.a=u)}}},i.AttachmentTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},i.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e,r){var o=this.frames;if(r<o[0])return void(e>r&&this.apply(t,e,Number.MAX_VALUE,null,0));e>r&&(e=-1);var n=r>=o[o.length-1]?o.length-1:i.Animation.binarySearch1(o,r)-1;if(!(o[n]<e)){var s=this.attachmentNames[n];t.slots[this.slotIndex].setAttachment(s?t.getAttachmentBySlotIndex(this.slotIndex,s):null)}}},i.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},i.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,e,r,o,n){if(o){var s=this.frames,a=s.length;if(e>r)this.apply(t,e,Number.MAX_VALUE,o,n),e=-1;else if(e>=s[a-1])return;if(!(r<s[0])){var h;if(e<s[0])h=0;else{h=i.Animation.binarySearch1(s,e);for(var l=s[h];h>0&&s[h-1]==l;)h--}for(var u=this.events;a>h&&r>=s[h];h++)o.push(u[h])}}}},i.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},i.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,e,r){var o=this.frames;if(!(r<o[0])){var n;n=r>=o[o.length-1]?o.length-1:i.Animation.binarySearch1(o,r)-1;var s=t.drawOrder,a=t.slots,h=this.drawOrders[n];if(h)for(var l=0,u=h.length;u>l;l++)s[l]=t.slots[h[l]];else for(var l=0,u=a.length;u>l;l++)s[l]=a[l]}}},i.FfdTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},i.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,e,r,o,n){var s=t.slots[this.slotIndex];if(s.attachment==this.attachment){var a=this.frames;if(!(r<a[0])){var h=this.frameVertices,l=h[0].length,u=s.attachmentVertices;if(u.length!=l&&(n=1),u.length=l,r>=a[a.length-1]){var c=h[a.length-1];if(1>n)for(var p=0;l>p;p++)u[p]+=(c[p]-u[p])*n;else for(var p=0;l>p;p++)u[p]=c[p]}else{var d=i.Animation.binarySearch1(a,r),f=a[d],m=1-(r-f)/(a[d-1]-f);m=this.curves.getCurvePercent(d-1,0>m?0:m>1?1:m);var v=h[d-1],g=h[d];if(1>n)for(var p=0;l>p;p++){var y=v[p];u[p]+=(y+(g[p]-y)*m-u[p])*n}else for(var p=0;l>p;p++){var y=v[p];u[p]=y+(g[p]-y)*m}}}}}},i.IkConstraintTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=3*t},i.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r},apply:function(t,e,r,o,n){var s=this.frames;if(!(r<s[0])){var a=t.ikConstraints[this.ikConstraintIndex];if(r>=s[s.length-3])return a.mix+=(s[s.length-2]-a.mix)*n,void(a.bendDirection=s[s.length-1]);var h=i.Animation.binarySearch(s,r,3),l=s[h+-2],u=s[h],c=1-(r-u)/(s[h+-3]-u);c=this.curves.getCurvePercent(h/3-1,c);var p=l+(s[h+1]-l)*c;a.mix+=(p-a.mix)*n,a.bendDirection=s[h+-1]}}},i.FlipXTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=2*t},i.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,r){var o=this.frames;if(r<o[0])return void(e>r&&this.apply(t,e,Number.MAX_VALUE,null,0));e>r&&(e=-1);var n=(r>=o[o.length-2]?o.length:i.Animation.binarySearch(o,r,2))-2;o[n]<e||(t.bones[boneIndex].flipX=0!=o[n+1])}},i.FlipYTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=2*t},i.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,r){var o=this.frames;if(r<o[0])return void(e>r&&this.apply(t,e,Number.MAX_VALUE,null,0));e>r&&(e=-1);var n=(r>=o[o.length-2]?o.length:i.Animation.binarySearch(o,r,2))-2;o[n]<e||(t.bones[boneIndex].flipY=0!=o[n+1])}},i.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},i.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null}},i.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,r=t.bones.length;r>e;e++){var o=t.bones[e],n=o.parent?this.bones[t.bones.indexOf(o.parent)]:null;this.bones.push(new i.Bone(o,this,n))}this.slots=[],this.drawOrder=[];for(var e=0,r=t.slots.length;r>e;e++){var s=t.slots[e],a=this.bones[t.bones.indexOf(s.boneData)],h=new i.Slot(s,a);this.slots.push(h),this.drawOrder.push(h)}this.ikConstraints=[];for(var e=0,r=t.ikConstraints.length;r>e;e++)this.ikConstraints.push(new i.IkConstraint(t.ikConstraints[e],this));this.boneCache=[],this.updateCache()},i.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,r=this.boneCache;r.length>i&&(r.length=i);for(var o=0,n=r.length;n>o;o++)r[o].length=0;for(;r.length<i;)r[r.length]=[];var s=r[0],a=this.bones;t:for(var o=0,n=a.length;n>o;o++){var h=a[o],l=h;do{for(var u=0;e>u;u++)for(var c=t[u],p=c.bones[0],d=c.bones[c.bones.length-1];;){if(l==d){r[u].push(h),r[u+1].push(h);continue t}if(d==p)break;d=d.parent}l=l.parent}while(l);s[s.length]=h}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++){var r=t[e];r.rotationIK=r.rotation}for(var e=0,o=this.boneCache.length-1;;){for(var n=this.boneCache[e],s=0,a=n.length;a>s;s++)n[s].updateWorldTransform();if(e==o)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose();for(var r=this.ikConstraints,e=0,i=r.length;i>e;e++){var o=r[e];o.bendDirection=o.data.bendDirection,o.mix=o.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=this.drawOrder,i=0,r=t.length;r>i;i++)e[i]=t[i],t[i].setToSetupPose(i)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,r=e.length;r>i;i++){var o=e[i],n=o.data.attachmentName;if(n){var s=t.getAttachment(i,n);s&&o.setAttachment(s)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,r=0,o=i.length;o>r;r++){var n=i[r];if(n.data.name==t){var s=null;if(e&&(s=this.getAttachmentBySlotIndex(r,e),!s))throw"Attachment not found: "+e+", for slot: "+t;return void n.setAttachment(s)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}},i.EventData=function(t){this.name=t},i.EventData.prototype={intValue:0,floatValue:0,stringValue:null},i.Event=function(t){this.data=t},i.Event.prototype={intValue:0,floatValue:0,stringValue:null},i.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},i.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},i.RegionAttachment.prototype={type:i.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,r,o){var n=this.uvs;o?(n[2]=t,n[3]=r,n[4]=t,n[5]=e,n[6]=i,n[7]=e,n[0]=i,n[1]=r):(n[0]=t,n[1]=r,n[2]=t,n[3]=e,n[4]=i,n[5]=e,n[6]=i,n[7]=r)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.regionOffsetX*t,o=-this.height/2*this.scaleY+this.regionOffsetY*e,n=r+this.regionWidth*t,s=o+this.regionHeight*e,a=this.rotation*i.degRad,h=Math.cos(a),l=Math.sin(a),u=r*h+this.x,c=r*l,p=o*h+this.y,d=o*l,f=n*h+this.x,m=n*l,v=s*h+this.y,g=s*l,y=this.offset;y[0]=u-d,y[1]=p+c,y[2]=u-g,y[3]=v+c,y[4]=f-g,y[5]=v+m,y[6]=f-d,y[7]=p+m},computeVertices:function(t,e,i,r){t+=i.worldX,e+=i.worldY;var o=i.m00,n=i.m01,s=i.m10,a=i.m11,h=this.offset;r[0]=h[0]*o+h[1]*n+t,r[1]=h[0]*s+h[1]*a+e,r[2]=h[2]*o+h[3]*n+t,r[3]=h[2]*s+h[3]*a+e,r[4]=h[4]*o+h[5]*n+t,r[5]=h[4]*s+h[5]*a+e,r[6]=h[6]*o+h[7]*n+t,r[7]=h[6]*s+h[7]*a+e}},i.MeshAttachment=function(t){this.name=t},i.MeshAttachment.prototype={type:i.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,r=this.regionUVs.length;if(this.uvs&&this.uvs.length==r||(this.uvs=new i.Float32Array(r)),this.regionRotate)for(var o=0;r>o;o+=2)this.uvs[o]=this.regionU+this.regionUVs[o+1]*t,this.uvs[o+1]=this.regionV+e-this.regionUVs[o]*e;else for(var o=0;r>o;o+=2)this.uvs[o]=this.regionU+this.regionUVs[o]*t,this.uvs[o+1]=this.regionV+this.regionUVs[o+1]*e},computeWorldVertices:function(t,e,i,r){var o=i.bone;t+=o.worldX,e+=o.worldY;var n=o.m00,s=o.m01,a=o.m10,h=o.m11,l=this.vertices,u=l.length;i.attachmentVertices.length==u&&(l=i.attachmentVertices);for(var c=0;u>c;c+=2){var p=l[c],d=l[c+1];r[c]=p*n+d*s+t,r[c+1]=p*a+d*h+e}}},i.SkinnedMeshAttachment=function(t){this.name=t},i.SkinnedMeshAttachment.prototype={type:i.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,r=this.regionUVs.length;if(this.uvs&&this.uvs.length==r||(this.uvs=new i.Float32Array(r)),this.regionRotate)for(var o=0;r>o;o+=2)this.uvs[o]=this.regionU+this.regionUVs[o+1]*t,this.uvs[o+1]=this.regionV+e-this.regionUVs[o]*e;else for(var o=0;r>o;o+=2)this.uvs[o]=this.regionU+this.regionUVs[o]*t,this.uvs[o+1]=this.regionV+this.regionUVs[o+1]*e},computeWorldVertices:function(t,e,i,r){var o,n,s,a,h,l,u,c=i.bone.skeleton.bones,p=this.weights,d=this.bones,f=0,m=0,v=0,g=0,y=d.length;if(i.attachmentVertices.length)for(var x=i.attachmentVertices;y>m;f+=2){for(n=0,s=0,o=d[m++]+m;o>m;m++,v+=3,g+=2)a=c[d[m]],h=p[v]+x[g],l=p[v+1]+x[g+1],u=p[v+2],n+=(h*a.m00+l*a.m01+a.worldX)*u,s+=(h*a.m10+l*a.m11+a.worldY)*u;r[f]=n+t,r[f+1]=s+e}else for(;y>m;f+=2){for(n=0,s=0,o=d[m++]+m;o>m;m++,v+=3)a=c[d[m]],h=p[v],l=p[v+1],u=p[v+2],n+=(h*a.m00+l*a.m01+a.worldX)*u,s+=(h*a.m10+l*a.m11+a.worldY)*u;r[f]=n+t,r[f+1]=s+e}}},i.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},i.BoundingBoxAttachment.prototype={type:i.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,r){t+=i.worldX,e+=i.worldY;for(var o=i.m00,n=i.m01,s=i.m10,a=i.m11,h=this.vertices,l=0,u=h.length;u>l;l+=2){var c=h[l],p=h[l+1];r[l]=c*o+p*n+t,r[l+1]=c*s+p*a+e}}},i.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},i.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var r=this.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;var o=this.skeletonData.findAnimation(e);if(!o)throw"Animation not found: "+e;this.setMix(r,o,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},i.TrackEntry=function(){},i.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},i.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},i.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var r=t*i.previous.timeScale;i.previous.time+=r,i.mixTime+=r}var o=i.next;o?(o.time=i.lastTime-o.delay,o.time>=0&&this.setCurrent(e,o)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var r=i.time,o=i.lastTime,n=i.endTime,s=i.loop;!s&&r>n&&(r=n);var a=i.previous;if(a){var h=a.time;!a.loop&&h>a.endTime&&(h=a.endTime),a.animation.apply(t,h,h,a.loop,null);var l=i.mixTime/i.mixDuration*i.mix;l>=1&&(l=1,i.previous=null),i.animation.mix(t,i.lastTime,r,s,this.events,l)}else 1==i.mix?i.animation.apply(t,i.lastTime,r,s,this.events):i.animation.mix(t,i.lastTime,r,s,this.events,i.mix);for(var u=0,c=this.events.length;c>u;u++){var p=this.events[u];i.onEvent&&i.onEvent(e,p),this.onEvent&&this.onEvent(e,p)
}if(s?o%n>r%n:n>o&&r>=n){var d=Math.floor(r/n);i.onComplete&&i.onComplete(e,d),this.onComplete&&this.onComplete(e,d)}i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;e>t;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var r=i.previous;i.previous=null,i.onEnd&&i.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,e.previous=r&&i.mixTime/i.mixDuration<.5?r:i)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.setAnimation(t,r,i)},setAnimation:function(t,e,r){var o=new i.TrackEntry;return o.animation=e,o.loop=r,o.endTime=e.duration,this.setCurrent(t,o),o},addAnimationByName:function(t,e,i,r){var o=this.data.skeletonData.findAnimation(e);if(!o)throw"Animation not found: "+e;return this.addAnimation(t,o,i,r)},addAnimation:function(t,e,r,o){var n=new i.TrackEntry;n.animation=e,n.loop=r,n.endTime=e.duration;var s=this._expandToIndex(t);if(s){for(;s.next;)s=s.next;s.next=n}else this.tracks[t]=n;return 0>=o&&(s?o+=s.endTime-this.data.getMix(s.animation,e):o=0),n.delay=o,n},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},i.SkeletonJson=function(t){this.attachmentLoader=t},i.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var r=new i.SkeletonData;r.name=e;var o=t.skeleton;o&&(r.hash=o.hash,r.version=o.spine,r.width=o.width||0,r.height=o.height||0);for(var n=t.bones,s=0,a=n.length;a>s;s++){var h=n[s],l=null;if(h.parent&&(l=r.findBone(h.parent),!l))throw"Parent bone not found: "+h.parent;var u=new i.BoneData(h.name,l);u.length=(h.length||0)*this.scale,u.x=(h.x||0)*this.scale,u.y=(h.y||0)*this.scale,u.rotation=h.rotation||0,u.scaleX=h.hasOwnProperty("scaleX")?h.scaleX:1,u.scaleY=h.hasOwnProperty("scaleY")?h.scaleY:1,u.inheritScale=h.hasOwnProperty("inheritScale")?h.inheritScale:!0,u.inheritRotation=h.hasOwnProperty("inheritRotation")?h.inheritRotation:!0,r.bones.push(u)}var c=t.ik;if(c)for(var s=0,a=c.length;a>s;s++){for(var p=c[s],d=new i.IkConstraintData(p.name),n=p.bones,f=0,m=n.length;m>f;f++){var v=r.findBone(n[f]);if(!v)throw"IK bone not found: "+n[f];d.bones.push(v)}if(d.target=r.findBone(p.target),!d.target)throw"Target bone not found: "+p.target;d.bendDirection=!p.hasOwnProperty("bendPositive")||p.bendPositive?1:-1,d.mix=p.hasOwnProperty("mix")?p.mix:1,r.ikConstraints.push(d)}for(var g=t.slots,s=0,a=g.length;a>s;s++){var y=g[s],u=r.findBone(y.bone);if(!u)throw"Slot bone not found: "+y.bone;var x=new i.SlotData(y.name,u),b=y.color;b&&(x.r=this.toColor(b,0),x.g=this.toColor(b,1),x.b=this.toColor(b,2),x.a=this.toColor(b,3)),x.attachmentName=y.attachment,x.additiveBlending=y.additive&&"true"==y.additive,r.slots.push(x)}var w=t.skins;for(var _ in w)if(w.hasOwnProperty(_)){var T=w[_],S=new i.Skin(_);for(var A in T)if(T.hasOwnProperty(A)){var C=r.findSlotIndex(A),E=T[A];for(var M in E)if(E.hasOwnProperty(M)){var B=this.readAttachment(S,M,E[M]);B&&S.addAttachment(C,M,B)}}r.skins.push(S),"default"==S.name&&(r.defaultSkin=S)}var L=t.events;for(var P in L)if(L.hasOwnProperty(P)){var R=L[P],F=new i.EventData(P);F.intValue=R["int"]||0,F.floatValue=R["float"]||0,F.stringValue=R.string||null,r.events.push(F)}var I=t.animations;for(var O in I)I.hasOwnProperty(O)&&this.readAnimation(O,I[O],r);return r},readAttachment:function(t,e,r){e=r.name||e;var o=i.AttachmentType[r.type||"region"],n=r.path||e,s=this.scale;if(o==i.AttachmentType.region){var a=this.attachmentLoader.newRegionAttachment(t,e,n);if(!a)return null;a.path=n,a.x=(r.x||0)*s,a.y=(r.y||0)*s,a.scaleX=r.hasOwnProperty("scaleX")?r.scaleX:1,a.scaleY=r.hasOwnProperty("scaleY")?r.scaleY:1,a.rotation=r.rotation||0,a.width=(r.width||0)*s,a.height=(r.height||0)*s;var h=r.color;return h&&(a.r=this.toColor(h,0),a.g=this.toColor(h,1),a.b=this.toColor(h,2),a.a=this.toColor(h,3)),a.updateOffset(),a}if(o==i.AttachmentType.mesh){var l=this.attachmentLoader.newMeshAttachment(t,e,n);return l?(l.path=n,l.vertices=this.getFloatArray(r,"vertices",s),l.triangles=this.getIntArray(r,"triangles"),l.regionUVs=this.getFloatArray(r,"uvs",1),l.updateUVs(),h=r.color,h&&(l.r=this.toColor(h,0),l.g=this.toColor(h,1),l.b=this.toColor(h,2),l.a=this.toColor(h,3)),l.hullLength=2*(r.hull||0),r.edges&&(l.edges=this.getIntArray(r,"edges")),l.width=(r.width||0)*s,l.height=(r.height||0)*s,l):null}if(o==i.AttachmentType.skinnedmesh){var l=this.attachmentLoader.newSkinnedMeshAttachment(t,e,n);if(!l)return null;l.path=n;for(var u=this.getFloatArray(r,"uvs",1),c=this.getFloatArray(r,"vertices",1),p=[],d=[],f=0,m=c.length;m>f;){var v=0|c[f++];d[d.length]=v;for(var g=f+4*v;g>f;)d[d.length]=c[f],p[p.length]=c[f+1]*s,p[p.length]=c[f+2]*s,p[p.length]=c[f+3],f+=4}return l.bones=d,l.weights=p,l.triangles=this.getIntArray(r,"triangles"),l.regionUVs=u,l.updateUVs(),h=r.color,h&&(l.r=this.toColor(h,0),l.g=this.toColor(h,1),l.b=this.toColor(h,2),l.a=this.toColor(h,3)),l.hullLength=2*(r.hull||0),r.edges&&(l.edges=this.getIntArray(r,"edges")),l.width=(r.width||0)*s,l.height=(r.height||0)*s,l}if(o==i.AttachmentType.boundingbox){for(var y=this.attachmentLoader.newBoundingBoxAttachment(t,e),c=r.vertices,f=0,m=c.length;m>f;f++)y.vertices.push(c[f]*s);return y}throw"Unknown attachment type: "+o},readAnimation:function(t,e,r){var o=[],n=0,s=e.slots;for(var a in s)if(s.hasOwnProperty(a)){var h=s[a],l=r.findSlotIndex(a);for(var u in h)if(h.hasOwnProperty(u)){var c=h[u];if("color"==u){var p=new i.ColorTimeline(c.length);p.slotIndex=l;for(var d=0,f=0,m=c.length;m>f;f++){var v=c[f],g=v.color,y=this.toColor(g,0),x=this.toColor(g,1),b=this.toColor(g,2),w=this.toColor(g,3);p.setFrame(d,v.time,y,x,b,w),this.readCurve(p,d,v),d++}o.push(p),n=Math.max(n,p.frames[5*p.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+a+")";var p=new i.AttachmentTimeline(c.length);p.slotIndex=l;for(var d=0,f=0,m=c.length;m>f;f++){var v=c[f];p.setFrame(d++,v.time,v.name)}o.push(p),n=Math.max(n,p.frames[p.getFrameCount()-1])}}}var _=e.bones;for(var T in _)if(_.hasOwnProperty(T)){var S=r.findBoneIndex(T);if(-1==S)throw"Bone not found: "+T;var A=_[T];for(var u in A)if(A.hasOwnProperty(u)){var c=A[u];if("rotate"==u){var p=new i.RotateTimeline(c.length);p.boneIndex=S;for(var d=0,f=0,m=c.length;m>f;f++){var v=c[f];p.setFrame(d,v.time,v.angle),this.readCurve(p,d,v),d++}o.push(p),n=Math.max(n,p.frames[2*p.getFrameCount()-2])}else if("translate"==u||"scale"==u){var p,C=1;"scale"==u?p=new i.ScaleTimeline(c.length):(p=new i.TranslateTimeline(c.length),C=this.scale),p.boneIndex=S;for(var d=0,f=0,m=c.length;m>f;f++){var v=c[f],E=(v.x||0)*C,M=(v.y||0)*C;p.setFrame(d,v.time,E,M),this.readCurve(p,d,v),d++}o.push(p),n=Math.max(n,p.frames[3*p.getFrameCount()-3])}else{if("flipX"!=u&&"flipY"!=u)throw"Invalid timeline type for a bone: "+u+" ("+T+")";var E="flipX"==u,p=E?new i.FlipXTimeline(c.length):new i.FlipYTimeline(c.length);p.boneIndex=S;for(var B=E?"x":"y",d=0,f=0,m=c.length;m>f;f++){var v=c[f];p.setFrame(d,v.time,v[B]||!1),d++}o.push(p),n=Math.max(n,p.frames[2*p.getFrameCount()-2])}}}var L=e.ik;for(var P in L)if(L.hasOwnProperty(P)){var R=r.findIkConstraint(P),c=L[P],p=new i.IkConstraintTimeline(c.length);p.ikConstraintIndex=r.ikConstraints.indexOf(R);for(var d=0,f=0,m=c.length;m>f;f++){var v=c[f],F=v.hasOwnProperty("mix")?v.mix:1,I=!v.hasOwnProperty("bendPositive")||v.bendPositive?1:-1;p.setFrame(d,v.time,F,I),this.readCurve(p,d,v),d++}o.push(p),n=Math.max(n,p.frames[3*p.frameCount-3])}var O=e.ffd;for(var D in O){var k=r.findSkin(D),h=O[D];for(a in h){var l=r.findSlotIndex(a),N=h[a];for(var U in N){var c=N[U],p=new i.FfdTimeline(c.length),G=k.getAttachment(l,U);if(!G)throw"FFD attachment not found: "+U;p.slotIndex=l,p.attachment=G;var q,V=G.type==i.AttachmentType.mesh;q=V?G.vertices.length:G.weights.length/3*2;for(var d=0,f=0,m=c.length;m>f;f++){var j,v=c[f];if(v.vertices){var X=v.vertices,j=[];j.length=q;var W=v.offset||0,Y=X.length;if(1==this.scale)for(var z=0;Y>z;z++)j[z+W]=X[z];else for(var z=0;Y>z;z++)j[z+W]=X[z]*this.scale;if(V)for(var H=G.vertices,z=0,Y=j.length;Y>z;z++)j[z]+=H[z]}else V?j=G.vertices:(j=[],j.length=q);p.setFrame(d,v.time,j),this.readCurve(p,d,v),d++}o[o.length]=p,n=Math.max(n,p.frames[p.frameCount-1])}}}var K=e.drawOrder;if(K||(K=e.draworder),K){for(var p=new i.DrawOrderTimeline(K.length),J=r.slots.length,d=0,f=0,m=K.length;m>f;f++){var Z=K[f],$=null;if(Z.offsets){$=[],$.length=J;for(var z=J-1;z>=0;z--)$[z]=-1;var Q=Z.offsets,te=[];te.length=J-Q.length;for(var ee=0,ie=0,z=0,Y=Q.length;Y>z;z++){var re=Q[z],l=r.findSlotIndex(re.slot);if(-1==l)throw"Slot not found: "+re.slot;for(;ee!=l;)te[ie++]=ee++;$[ee+re.offset]=ee++}for(;J>ee;)te[ie++]=ee++;for(var z=J-1;z>=0;z--)-1==$[z]&&($[z]=te[--ie])}p.setFrame(d++,Z.time,$)}o.push(p),n=Math.max(n,p.frames[p.getFrameCount()-1])}var oe=e.events;if(oe){for(var p=new i.EventTimeline(oe.length),d=0,f=0,m=oe.length;m>f;f++){var ne=oe[f],se=r.findEvent(ne.name);if(!se)throw"Event not found: "+ne.name;var ae=new i.Event(se);ae.intValue=ne.hasOwnProperty("int")?ne["int"]:se.intValue,ae.floatValue=ne.hasOwnProperty("float")?ne["float"]:se.floatValue,ae.stringValue=ne.hasOwnProperty("string")?ne.string:se.stringValue,p.setFrame(d++,ne.time,ae)}o.push(p),n=Math.max(n,p.frames[p.getFrameCount()-1])}r.animations.push(new i.Animation(t,o,n))},readCurve:function(t,e,i){var r=i.curve;r?"stepped"==r?t.curves.setStepped(e):r instanceof Array&&t.curves.setCurve(e,r[0],r[1],r[2],r[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,e,r){var o=t[e],n=new i.Float32Array(o.length),s=0,a=o.length;if(1==r)for(;a>s;s++)n[s]=o[s];else for(;a>s;s++)n[s]=o[s]*r;return n},getIntArray:function(t,e){for(var r=t[e],o=new i.Uint16Array(r.length),n=0,s=r.length;s>n;n++)o[n]=0|r[n];return o}},i.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var r=new i.AtlasReader(t),o=[];o.length=4;for(var n=null;;){var s=r.readLine();if(null===s)break;if(s=r.trim(s),s.length)if(n){var a=new i.AtlasRegion;a.name=s,a.page=n,a.rotate="true"==r.readValue(),r.readTuple(o);var h=parseInt(o[0]),l=parseInt(o[1]);r.readTuple(o);var u=parseInt(o[0]),c=parseInt(o[1]);a.u=h/n.width,a.v=l/n.height,a.rotate?(a.u2=(h+c)/n.width,a.v2=(l+u)/n.height):(a.u2=(h+u)/n.width,a.v2=(l+c)/n.height),a.x=h,a.y=l,a.width=Math.abs(u),a.height=Math.abs(c),4==r.readTuple(o)&&(a.splits=[parseInt(o[0]),parseInt(o[1]),parseInt(o[2]),parseInt(o[3])],4==r.readTuple(o)&&(a.pads=[parseInt(o[0]),parseInt(o[1]),parseInt(o[2]),parseInt(o[3])],r.readTuple(o))),a.originalWidth=parseInt(o[0]),a.originalHeight=parseInt(o[1]),r.readTuple(o),a.offsetX=parseInt(o[0]),a.offsetY=parseInt(o[1]),a.index=parseInt(r.readValue()),this.regions.push(a)}else{n=new i.AtlasPage,n.name=s,2==r.readTuple(o)&&(n.width=parseInt(o[0]),n.height=parseInt(o[1]),r.readTuple(o)),n.format=i.Atlas.Format[o[0]],r.readTuple(o),n.minFilter=i.Atlas.TextureFilter[o[0]],n.magFilter=i.Atlas.TextureFilter[o[1]];var p=r.readValue();n.uWrap=i.Atlas.TextureWrap.clampToEdge,n.vWrap=i.Atlas.TextureWrap.clampToEdge,"x"==p?n.uWrap=i.Atlas.TextureWrap.repeat:"y"==p?n.vWrap=i.Atlas.TextureWrap.repeat:"xy"==p&&(n.uWrap=n.vWrap=i.Atlas.TextureWrap.repeat),e.load(n,s,this),this.pages.push(n)}else n=null}},i.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++){var o=e[i];o.page==t&&(o.u=o.x/t.width,o.v=o.y/t.height,o.rotate?(o.u2=(o.x+o.height)/t.width,o.v2=(o.y+o.width)/t.height):(o.u2=(o.x+o.width)/t.width,o.v2=(o.y+o.height)/t.height))}}},i.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},i.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},i.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},i.AtlasPage=function(){},i.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},i.AtlasRegion=function(){},i.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},i.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},i.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var r=0,o=i+1;3>r;r++){var n=e.indexOf(",",o);if(-1==n)break;t[r]=this.trim(e.substr(o,n-o)),o=n+1}return t[r]=this.trim(e.substring(o)),r+1}},i.AtlasAttachmentLoader=function(t){this.atlas=t},i.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,r){var o=this.atlas.findRegion(r);if(!o)throw"Region not found in atlas: "+r+" (region attachment: "+e+")";var n=new i.RegionAttachment(e);return n.rendererObject=o,n.setUVs(o.u,o.v,o.u2,o.v2,o.rotate),n.regionOffsetX=o.offsetX,n.regionOffsetY=o.offsetY,n.regionWidth=o.width,n.regionHeight=o.height,n.regionOriginalWidth=o.originalWidth,n.regionOriginalHeight=o.originalHeight,n},newMeshAttachment:function(t,e,r){var o=this.atlas.findRegion(r);if(!o)throw"Region not found in atlas: "+r+" (mesh attachment: "+e+")";var n=new i.MeshAttachment(e);return n.rendererObject=o,n.regionU=o.u,n.regionV=o.v,n.regionU2=o.u2,n.regionV2=o.v2,n.regionRotate=o.rotate,n.regionOffsetX=o.offsetX,n.regionOffsetY=o.offsetY,n.regionWidth=o.width,n.regionHeight=o.height,n.regionOriginalWidth=o.originalWidth,n.regionOriginalHeight=o.originalHeight,n},newSkinnedMeshAttachment:function(t,e,r){var o=this.atlas.findRegion(r);if(!o)throw"Region not found in atlas: "+r+" (skinned mesh attachment: "+e+")";var n=new i.SkinnedMeshAttachment(e);return n.rendererObject=o,n.regionU=o.u,n.regionV=o.v,n.regionU2=o.u2,n.regionV2=o.v2,n.regionRotate=o.rotate,n.regionOffsetX=o.offsetX,n.regionOffsetY=o.offsetY,n.regionWidth=o.width,n.regionHeight=o.height,n.regionOriginalWidth=o.originalWidth,n.regionOriginalHeight=o.originalHeight,n},newBoundingBoxAttachment:function(t,e){return new i.BoundingBoxAttachment(e)}},i.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},i.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var r=t.slots,o=r.length,n=t.x,s=t.y,a=this.boundingBoxes,h=this.polygonPool,l=this.polygons;a.length=0;for(var u=0,c=l.length;c>u;u++)h.push(l[u]);l.length=0;for(var u=0;o>u;u++){var p=r[u],d=p.attachment;if(d.type==i.AttachmentType.boundingbox){a.push(d);var f,m=h.length;m>0?(f=h[m-1],h.splice(m-1,1)):f=[],l.push(f),f.length=d.vertices.length,d.computeWorldVertices(n,s,p.bone,f)}}e&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,r=Number.MIN_VALUE,o=Number.MIN_VALUE,n=0,s=t.length;s>n;n++)for(var a=t[n],h=0,l=a.length;l>h;h+=2){var u=a[h],c=a[h+1];e=Math.min(e,u),i=Math.min(i,c),r=Math.max(r,u),o=Math.max(o,c)}this.minX=e,this.minY=i,this.maxX=r,this.maxY=o},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,r){var o=this.minX,n=this.minY,s=this.maxX,a=this.maxY;if(o>=t&&o>=i||n>=e&&n>=r||t>=s&&i>=s||e>=a&&r>=a)return!1;var h=(r-e)/(i-t),l=h*(o-t)+e;if(l>n&&a>l)return!0;if(l=h*(s-t)+e,l>n&&a>l)return!0;var u=(n-e)/h+t;return u>o&&s>u?!0:(u=(a-e)/h+t,u>o&&s>u?!0:!1)},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,r=0,o=i.length;o>r;r++)if(this.polygonContainsPoint(i[r],t,e))return this.boundingBoxes[r];return null},intersectsSegment:function(t,e,i,r){for(var o=this.polygons,n=0,s=o.length;s>n;n++)if(o[n].intersectsSegment(t,e,i,r))return this.boundingBoxes[n];return null},polygonContainsPoint:function(t,e,i){for(var r=t.length,o=r-2,n=!1,s=0;r>s;s+=2){var a=t[s+1],h=t[o+1];if(i>a&&h>=i||i>h&&a>=i){var l=t[s];l+(i-a)/(h-a)*(t[o]-l)<e&&(n=!n)}o=s}return n},polygonIntersectsSegment:function(t,e,i,r,o){for(var n=t.length,s=e-r,a=i-o,h=e*o-i*r,l=t[n-2],u=t[n-1],c=0;n>c;c+=2){var p=t[c],d=t[c+1],f=l*d-u*p,m=l-p,v=u-d,g=s*v-a*m,y=(h*m-s*f)/g;if((y>=l&&p>=y||y>=p&&l>=y)&&(y>=e&&r>=y||y>=r&&e>=y)){var x=(h*v-a*f)/g;if((x>=u&&d>=x||x>=d&&u>=x)&&(x>=i&&o>=x||x>=o&&i>=x))return!0}l=p,u=d}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},i.Bone.yDown=!0,e.AnimCache={},e.SpineTextureLoader=function(t,i){e.EventTarget.call(this),this.basePath=t,this.crossorigin=i,this.loadingCount=0},e.SpineTextureLoader.prototype=e.SpineTextureLoader,e.SpineTextureLoader.prototype.load=function(t,i){if(t.rendererObject=e.BaseTexture.fromImage(this.basePath+"/"+i,this.crossorigin),!t.rendererObject.hasLoaded){var r=this;++r.loadingCount,t.rendererObject.addEventListener("loaded",function(){--r.loadingCount,r.dispatchEvent({type:"loadedBaseTexture",content:r})})}},e.SpineTextureLoader.prototype.unload=function(t){t.destroy(!0)},e.Spine=function(t){if(e.DisplayObjectContainer.call(this),this.spineData=e.AnimCache[t],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.skeleton=new i.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new i.AnimationStateData(this.spineData),this.state=new i.AnimationState(this.stateData),this.slotContainers=[];for(var r=0,o=this.skeleton.drawOrder.length;o>r;r++){var n=this.skeleton.drawOrder[r],s=n.attachment,a=new e.DisplayObjectContainer;if(this.slotContainers.push(a),this.addChild(a),s instanceof i.RegionAttachment){var h=s.rendererObject.name,l=this.createSprite(n,s);n.currentSprite=l,n.currentSpriteName=h,a.addChild(l)}else{if(!(s instanceof i.MeshAttachment))continue;var u=this.createMesh(n,s);n.currentMesh=u,n.currentMeshName=s.name,a.addChild(u)}}this.autoUpdate=!0},e.Spine.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Spine.prototype.constructor=e.Spine,Object.defineProperty(e.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===e.Spine.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?e.Spine.prototype.autoUpdateTransform:e.DisplayObjectContainer.prototype.updateTransform}}),e.Spine.prototype.update=function(t){this.state.update(t),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var r=this.skeleton.drawOrder,o=0,n=r.length;n>o;o++){var s=r[o],a=s.attachment,h=this.slotContainers[o];if(a){var l=a.type;if(l===i.AttachmentType.region){if(a.rendererObject&&(!s.currentSpriteName||s.currentSpriteName!==a.name)){var u=a.rendererObject.name;if(void 0!==s.currentSprite&&(s.currentSprite.visible=!1),s.sprites=s.sprites||{},void 0!==s.sprites[u])s.sprites[u].visible=!0;else{var c=this.createSprite(s,a);h.addChild(c)}s.currentSprite=s.sprites[u],s.currentSpriteName=u}var p=s.bone;h.position.x=p.worldX+a.x*p.m00+a.y*p.m01,h.position.y=p.worldY+a.x*p.m10+a.y*p.m11,h.scale.x=p.worldScaleX,h.scale.y=p.worldScaleY,h.rotation=-(s.bone.worldRotation*i.degRad),s.currentSprite.tint=e.rgb2hex([s.r,s.g,s.b])}else{if(l!==i.AttachmentType.skinnedmesh){h.visible=!1;continue}if(!s.currentMeshName||s.currentMeshName!==a.name){var d=a.name;if(void 0!==s.currentMesh&&(s.currentMesh.visible=!1),s.meshes=s.meshes||{},void 0!==s.meshes[d])s.meshes[d].visible=!0;else{var f=this.createMesh(s,a);h.addChild(f)}s.currentMesh=s.meshes[d],s.currentMeshName=d}a.computeWorldVertices(s.bone.skeleton.x,s.bone.skeleton.y,s,s.currentMesh.vertices)}h.visible=!0,h.alpha=s.a}else h.visible=!1}},e.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t),e.DisplayObjectContainer.prototype.updateTransform.call(this)},e.Spine.prototype.createSprite=function(t,r){var o=r.rendererObject,n=o.page.rendererObject,s=new e.Rectangle(o.x,o.y,o.rotate?o.height:o.width,o.rotate?o.width:o.height),a=new e.Texture(n,s),h=new e.Sprite(a),l=o.rotate?.5*Math.PI:0;return h.scale.set(o.width/o.originalWidth,o.height/o.originalHeight),h.rotation=l-r.rotation*i.degRad,h.anchor.x=h.anchor.y=.5,t.sprites=t.sprites||{},t.sprites[o.name]=h,h},e.Spine.prototype.createMesh=function(t,i){var r=i.rendererObject,o=r.page.rendererObject,n=new e.Texture(o),s=new e.Strip(n);return s.drawMode=e.Strip.DrawModes.TRIANGLES,s.canvasPadding=1.5,s.vertices=new e.Float32Array(i.uvs.length),s.uvs=i.uvs,s.indices=i.triangles,t.meshes=t.meshes||{},t.meshes[i.name]=s,s},e.BaseTextureCache={},e.BaseTextureCacheIdGenerator=0,e.BaseTexture=function(t,i){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||e.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this._UID=e._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var r=this;this.source.onload=function(){r.hasLoaded=!0,r.width=r.source.naturalWidth||r.source.width,r.height=r.source.naturalHeight||r.source.height,r.dirty(),r.dispatchEvent({type:"loaded",content:r})},this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null,this._powerOf2=!1}},e.BaseTexture.prototype.constructor=e.BaseTexture,e.EventTarget.mixin(e.BaseTexture.prototype),e.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete e.BaseTextureCache[this.imageUrl],delete e.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete e.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},e.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=!1,this.source.src=null,this.source.src=t},e.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},e.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var i=this._glTextures[t],r=e.glContexts[t];r&&i&&r.deleteTexture(i)}this._glTextures.length=0,this.dirty()},e.BaseTexture.fromImage=function(t,i,r){var o=e.BaseTextureCache[t];if(void 0===i&&-1===t.indexOf("data:")&&(i=!0),!o){var n=new Image;i&&(n.crossOrigin=""),n.src=t,o=new e.BaseTexture(n,r),o.imageUrl=t,e.BaseTextureCache[t]=o,-1!==t.indexOf(e.RETINA_PREFIX+".")&&(o.resolution=2)}return o},e.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+e.TextureCacheIdGenerator++);var r=e.BaseTextureCache[t._pixiId];return r||(r=new e.BaseTexture(t,i),e.BaseTextureCache[t._pixiId]=r),r},e.TextureCache={},e.FrameCache={},e.TextureCacheIdGenerator=0,e.Texture=function(t,i,r,o){this.noFrame=!1,i||(this.noFrame=!0,i=new e.Rectangle(0,0,1,1)),t instanceof e.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=i,this.trim=o,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=r||new e.Rectangle(0,0,1,1),t.hasLoaded?(this.noFrame&&(i=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(i)):t.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},e.Texture.prototype.constructor=e.Texture,e.EventTarget.mixin(e.Texture.prototype),e.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},e.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},e.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},e.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new e.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i,this._uvs.y0=t.y/r,this._uvs.x1=(t.x+t.width)/i,this._uvs.y1=t.y/r,this._uvs.x2=(t.x+t.width)/i,this._uvs.y2=(t.y+t.height)/r,this._uvs.x3=t.x/i,this._uvs.y3=(t.y+t.height)/r},e.Texture.fromImage=function(t,i,r){var o=e.TextureCache[t];return o||(o=new e.Texture(e.BaseTexture.fromImage(t,i,r)),e.TextureCache[t]=o),o},e.Texture.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i},e.Texture.fromCanvas=function(t,i){var r=e.BaseTexture.fromCanvas(t,i);return new e.Texture(r)},e.Texture.addTextureToCache=function(t,i){e.TextureCache[i]=t},e.Texture.removeTextureFromCache=function(t){var i=e.TextureCache[t];return delete e.TextureCache[t],delete e.BaseTextureCache[t],i},e.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},e.Texture.emptyTexture=new e.Texture(new e.BaseTexture),e.RenderTexture=function(t,i,r,o,n){if(this.width=t||100,this.height=i||100,this.resolution=n||1,this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new e.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=o||e.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,e.Texture.call(this,this.baseTexture,new e.Rectangle(0,0,this.width,this.height)),this.renderer=r||e.defaultRenderer,this.renderer.type===e.WEBGL_RENDERER){var s=this.renderer.gl;this.baseTexture._dirty[s.id]=!1,this.textureBuffer=new e.FilterTexture(s,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode),this.baseTexture._glTextures[s.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new e.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new e.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},e.RenderTexture.prototype=Object.create(e.Texture.prototype),e.RenderTexture.prototype.constructor=e.RenderTexture,e.RenderTexture.prototype.resize=function(t,i,r){(t!==this.width||i!==this.height)&&(this.valid=t>0&&i>0,this.width=this.frame.width=this.crop.width=t,this.height=this.frame.height=this.crop.height=i,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===e.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))},e.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===e.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},e.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){var r=t.worldTransform;r.identity(),e&&r.append(e),t.worldAlpha=1;for(var o=t.children,n=0,s=o.length;s>n;n++)o[n].updateTransform();var a=this.renderer.gl;a.viewport(0,0,this.width*this.resolution,this.height*this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},e.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var r=t.worldTransform;r.identity(),e&&r.append(e),t.worldAlpha=1;for(var o=t.children,n=0,s=o.length;s>n;n++)o[n].updateTransform();i&&this.textureBuffer.clear();var a=this.textureBuffer.context,h=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,a),this.renderer.resolution=h}},e.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},e.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},e.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===e.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,r=this.textureBuffer.height,o=new Uint8Array(4*i*r);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,o),t.bindFramebuffer(t.FRAMEBUFFER,null);var n=new e.CanvasBuffer(i,r),s=n.context.getImageData(0,0,i,r);return s.data.set(o),n.context.putImageData(s,0,0),n.canvas}return this.textureBuffer.canvas},e.RenderTexture.tempMatrix=new e.Matrix,e.VideoTexture=function(t,i){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),e.BaseTexture.call(this,t,i),this.autoUpdate=!1,this.updateBound=this._onUpdate.bind(this),t.complete||(this._onCanPlay=this.onCanPlay.bind(this),t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("play",this.onPlayStart.bind(this)),t.addEventListener("pause",this.onPlayStop.bind(this)))},e.VideoTexture.prototype=Object.create(e.BaseTexture.prototype),e.VideoTexture.constructor=e.VideoTexture,e.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())},e.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)},e.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1},e.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.dispatchEvent({type:"loaded",content:this}))))},e.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(e.BaseTextureCache[this.source._pixiId]=null,delete e.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId),e.BaseTexture.prototype.destroy.call(this)},e.VideoTexture.baseTextureFromVideo=function(t,i){t._pixiId||(t._pixiId="video_"+e.TextureCacheIdGenerator++);var r=e.BaseTextureCache[t._pixiId];
return r||(r=new e.VideoTexture(t,i),e.BaseTextureCache[t._pixiId]=r),r},e.VideoTexture.textureFromVideo=function(t,i){var r=e.VideoTexture.baseTextureFromVideo(t,i);return new e.Texture(r)},e.VideoTexture.fromUrl=function(t,i){var r=document.createElement("video");return r.src=t,r.autoPlay=!0,r.play(),e.VideoTexture.textureFromVideo(r,i)},e.AssetLoader=function(t,i){this.assetURLs=t,this.crossorigin=i,this.loadersByType={jpg:e.ImageLoader,jpeg:e.ImageLoader,png:e.ImageLoader,gif:e.ImageLoader,webp:e.ImageLoader,json:e.JsonLoader,atlas:e.AtlasLoader,anim:e.SpineLoader,xml:e.BitmapFontLoader,fnt:e.BitmapFontLoader}},e.EventTarget.mixin(e.AssetLoader.prototype),e.AssetLoader.prototype.constructor=e.AssetLoader,e.AssetLoader.prototype._getDataType=function(t){var e="data:",i=t.slice(0,e.length).toLowerCase();if(i===e){var r=t.slice(e.length),o=r.indexOf(",");if(-1===o)return null;var n=r.slice(0,o).split(";")[0];return n&&"text/plain"!==n.toLowerCase()?n.split("/").pop().toLowerCase():"txt"}return null},e.AssetLoader.prototype.load=function(){function t(t){e.onAssetLoaded(t.data.content)}var e=this;this.loadCount=this.assetURLs.length;for(var i=0;i<this.assetURLs.length;i++){var r=this.assetURLs[i],o=this._getDataType(r);o||(o=r.split("?").shift().split(".").pop().toLowerCase());var n=this.loadersByType[o];if(!n)throw new Error(o+" is an unsupported file type");var s=new n(r,this.crossorigin);s.on("loaded",t),s.load()}},e.AssetLoader.prototype.onAssetLoaded=function(t){this.loadCount--,this.emit("onProgress",{content:this,loader:t}),this.onProgress&&this.onProgress(t),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},e.JsonLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},e.JsonLoader.prototype.constructor=e.JsonLoader,e.EventTarget.mixin(e.JsonLoader.prototype),e.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},e.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()},e.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var t=this.baseUrl+this.json.meta.image,r=new e.ImageLoader(t,this.crossorigin),o=this.json.frames;this.texture=r.texture.baseTexture,r.addEventListener("loaded",this.onLoaded.bind(this));for(var n in o){var s=o[n].frame;if(s){var a=new e.Rectangle(s.x,s.y,s.w,s.h),h=a.clone(),l=null;if(o[n].trimmed){var u=o[n].sourceSize,c=o[n].spriteSourceSize;l=new e.Rectangle(c.x,c.y,u.w,u.h)}e.TextureCache[n]=new e.Texture(this.texture,a,h,l)}}r.load()}else if(this.json.bones)if(e.AnimCache[this.url])this.onLoaded();else{var p=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",d=new e.JsonLoader(p,this.crossorigin),f=this;d.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();var t=new e.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),r=new i.Atlas(this.ajaxRequest.responseText,t),o=new i.AtlasAttachmentLoader(r),n=new i.SkeletonJson(o),s=n.readSkeletonData(f.json);e.AnimCache[f.url]=s,f.spine=s,f.spineAtlas=r,f.spineAtlasLoader=d,t.loadingCount>0?t.addEventListener("loadedBaseTexture",function(t){t.content.content.loadingCount<=0&&f.onLoaded()}):f.onLoaded()},d.load()}else this.onLoaded()},e.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},e.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},e.AtlasLoader=function(t,e){this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=e,this.loaded=!1},e.AtlasLoader.constructor=e.AtlasLoader,e.EventTarget.mixin(e.AtlasLoader.prototype),e.AtlasLoader.prototype.load=function(){this.ajaxRequest=new e.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},e.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var t=this.ajaxRequest.responseText.split(/\r?\n/),i=-3,r=0,o=null,n=!1,s=0,a=0,h=this.onLoaded.bind(this);for(s=0;s<t.length;s++)if(t[s]=t[s].replace(/^\s+|\s+$/g,""),""===t[s]&&(n=s+1),t[s].length>0){if(n===s)this.atlas.meta.image.push(t[s]),r=this.atlas.meta.image.length-1,this.atlas.frames.push({}),i=-3;else if(i>0)if(i%7===1)null!=o&&(this.atlas.frames[r][o.name]=o),o={name:t[s],frame:{}};else{var l=t[s].split(" ");if(i%7===3)o.frame.x=Number(l[1].replace(",","")),o.frame.y=Number(l[2]);else if(i%7===4)o.frame.w=Number(l[1].replace(",","")),o.frame.h=Number(l[2]);else if(i%7===5){var u={x:0,y:0,w:Number(l[1].replace(",","")),h:Number(l[2])};u.w>o.frame.w||u.h>o.frame.h?(o.trimmed=!0,o.realSize=u):o.trimmed=!1}}i++}if(null!=o&&(this.atlas.frames[r][o.name]=o),this.atlas.meta.image.length>0){for(this.images=[],a=0;a<this.atlas.meta.image.length;a++){var c=this.baseUrl+this.atlas.meta.image[a],p=this.atlas.frames[a];this.images.push(new e.ImageLoader(c,this.crossorigin));for(s in p){var d=p[s].frame;d&&(e.TextureCache[s]=new e.Texture(this.images[a].texture.baseTexture,{x:d.x,y:d.y,width:d.w,height:d.h}),p[s].trimmed&&(e.TextureCache[s].realSize=p[s].realSize,e.TextureCache[s].trim.x=0,e.TextureCache[s].trim.y=0))}}for(this.currentImageId=0,a=0;a<this.images.length;a++)this.images[a].on("loaded",h);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},e.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},e.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},e.SpriteSheetLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},e.SpriteSheetLoader.prototype.constructor=e.SpriteSheetLoader,e.EventTarget.mixin(e.SpriteSheetLoader.prototype),e.SpriteSheetLoader.prototype.load=function(){var t=this,i=new e.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(e){t.json=e.data.content.json,t.onLoaded()}),i.load()},e.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},e.ImageLoader=function(t,i){this.texture=e.Texture.fromImage(t,i),this.frames=[]},e.ImageLoader.prototype.constructor=e.ImageLoader,e.EventTarget.mixin(e.ImageLoader.prototype),e.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},e.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},e.ImageLoader.prototype.loadFramedSpriteSheet=function(t,i,r){this.frames=[];for(var o=Math.floor(this.texture.width/t),n=Math.floor(this.texture.height/i),s=0,a=0;n>a;a++)for(var h=0;o>h;h++,s++){var l=new e.Texture(this.texture.baseTexture,{x:h*t,y:a*i,width:t,height:i});this.frames.push(l),r&&(e.TextureCache[r+"-"+s]=l)}this.load()},e.BitmapFontLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},e.BitmapFontLoader.prototype.constructor=e.BitmapFontLoader,e.EventTarget.mixin(e.BitmapFontLoader.prototype),e.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new e.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},e.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var t=this.ajaxRequest.responseXML;if(!t||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var i=new DOMParser;t=i.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var r=document.createElement("div");r.innerHTML=this.ajaxRequest.responseText,t=r}var o=this.baseUrl+t.getElementsByTagName("page")[0].getAttribute("file"),n=new e.ImageLoader(o,this.crossorigin);this.texture=n.texture.baseTexture;var s={},a=t.getElementsByTagName("info")[0],h=t.getElementsByTagName("common")[0];s.font=a.getAttribute("face"),s.size=parseInt(a.getAttribute("size"),10),s.lineHeight=parseInt(h.getAttribute("lineHeight"),10),s.chars={};for(var l=t.getElementsByTagName("char"),u=0;u<l.length;u++){var c=parseInt(l[u].getAttribute("id"),10),p=new e.Rectangle(parseInt(l[u].getAttribute("x"),10),parseInt(l[u].getAttribute("y"),10),parseInt(l[u].getAttribute("width"),10),parseInt(l[u].getAttribute("height"),10));s.chars[c]={xOffset:parseInt(l[u].getAttribute("xoffset"),10),yOffset:parseInt(l[u].getAttribute("yoffset"),10),xAdvance:parseInt(l[u].getAttribute("xadvance"),10),kerning:{},texture:e.TextureCache[c]=new e.Texture(this.texture,p)}}var d=t.getElementsByTagName("kerning");for(u=0;u<d.length;u++){var f=parseInt(d[u].getAttribute("first"),10),m=parseInt(d[u].getAttribute("second"),10),v=parseInt(d[u].getAttribute("amount"),10);s.chars[m].kerning[f]=v}e.BitmapText.fonts[s.font]=s,n.addEventListener("loaded",this.onLoaded.bind(this)),n.load()}},e.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},e.SpineLoader=function(t,e){this.url=t,this.crossorigin=e,this.loaded=!1},e.SpineLoader.prototype.constructor=e.SpineLoader,e.EventTarget.mixin(e.SpineLoader.prototype),e.SpineLoader.prototype.load=function(){var t=this,i=new e.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(e){t.json=e.data.content.json,t.onLoaded()}),i.load()},e.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},e.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},e.AbstractFilter.prototype.constructor=e.AbstractFilter,e.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;e>t;t++)this.shaders[t].dirty=!0},e.AlphaMaskFilter=function(t){e.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:t},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mask.value.x=t.width,this.uniforms.mask.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},e.AlphaMaskFilter.prototype=Object.create(e.AbstractFilter.prototype),e.AlphaMaskFilter.prototype.constructor=e.AlphaMaskFilter,e.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(e.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}}),e.ColorMatrixFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},e.ColorMatrixFilter.prototype=Object.create(e.AbstractFilter.prototype),e.ColorMatrixFilter.prototype.constructor=e.ColorMatrixFilter,Object.defineProperty(e.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=t}}),e.GrayFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},e.GrayFilter.prototype=Object.create(e.AbstractFilter.prototype),e.GrayFilter.prototype.constructor=e.GrayFilter,Object.defineProperty(e.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}}),e.DisplacementFilter=function(t){e.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=t.width,this.uniforms.mapDimensions.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},e.DisplacementFilter.prototype=Object.create(e.AbstractFilter.prototype),e.DisplacementFilter.prototype.constructor=e.DisplacementFilter,e.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(e.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(e.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),Object.defineProperty(e.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}),e.PixelateFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new e.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},e.PixelateFilter.prototype=Object.create(e.AbstractFilter.prototype),e.PixelateFilter.prototype.constructor=e.PixelateFilter,Object.defineProperty(e.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.dirty=!0,this.uniforms.pixelSize.value=t}}),e.BlurXFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},e.BlurXFilter.prototype=Object.create(e.AbstractFilter.prototype),e.BlurXFilter.prototype.constructor=e.BlurXFilter,Object.defineProperty(e.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.dirty=!0,this.uniforms.blur.value=1/7e3*t}}),e.BlurYFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},e.BlurYFilter.prototype=Object.create(e.AbstractFilter.prototype),e.BlurYFilter.prototype.constructor=e.BlurYFilter,Object.defineProperty(e.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),e.BlurFilter=function(){this.blurXFilter=new e.BlurXFilter,this.blurYFilter=new e.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},e.BlurFilter.prototype=Object.create(e.AbstractFilter.prototype),e.BlurFilter.prototype.constructor=e.BlurFilter,Object.defineProperty(e.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}}),Object.defineProperty(e.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}}),Object.defineProperty(e.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}),e.InvertFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},e.InvertFilter.prototype=Object.create(e.AbstractFilter.prototype),e.InvertFilter.prototype.constructor=e.InvertFilter,Object.defineProperty(e.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}}),e.SepiaFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},e.SepiaFilter.prototype=Object.create(e.AbstractFilter.prototype),e.SepiaFilter.prototype.constructor=e.SepiaFilter,Object.defineProperty(e.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}}),e.TwistFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},e.TwistFilter.prototype=Object.create(e.AbstractFilter.prototype),e.TwistFilter.prototype.constructor=e.TwistFilter,Object.defineProperty(e.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.dirty=!0,this.uniforms.offset.value=t}}),Object.defineProperty(e.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(t){this.dirty=!0,this.uniforms.radius.value=t}}),Object.defineProperty(e.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),e.ColorStepFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},e.ColorStepFilter.prototype=Object.create(e.AbstractFilter.prototype),e.ColorStepFilter.prototype.constructor=e.ColorStepFilter,Object.defineProperty(e.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t}}),e.DotScreenFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},e.DotScreenFilter.prototype=Object.create(e.AbstractFilter.prototype),e.DotScreenFilter.prototype.constructor=e.DotScreenFilter,Object.defineProperty(e.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.dirty=!0,this.uniforms.scale.value=t}}),Object.defineProperty(e.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),e.CrossHatchFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},e.CrossHatchFilter.prototype=Object.create(e.AbstractFilter.prototype),e.CrossHatchFilter.prototype.constructor=e.CrossHatchFilter,Object.defineProperty(e.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),e.RGBSplitFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},e.RGBSplitFilter.prototype=Object.create(e.AbstractFilter.prototype),e.RGBSplitFilter.prototype.constructor=e.RGBSplitFilter,Object.defineProperty(e.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}}),Object.defineProperty(e.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}}),Object.defineProperty(e.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.PIXI=e):"undefined"!=typeof define&&define.amd?define("PIXI",e):t.PIXI=e}.call(this),function(t){function e(t,e,i,r,o){this._listener=e,this._isOnce=i,this.context=r,this._signal=t,this._priority=o||0}function i(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function r(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){r.prototype.dispatch.apply(t,arguments)}}e.prototype={active:!0,params:null,execute:function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,i),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,i,r,o){var n,s=this._indexOfListener(t,r);if(-1!==s){if(n=this._bindings[s],n.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else n=new e(this,t,i,r,o),this._addBinding(n);return this.memorize&&this._prevParams&&n.execute(this._prevParams),n},_addBinding:function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var i,r=this._bindings.length;r--;)if(i=this._bindings[r],i._listener===t&&i.context===e)return r;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,r){return i(t,"add"),this._registerListener(t,!1,e,r)},addOnce:function(t,e,r){return i(t,"addOnce"),this._registerListener(t,!0,e,r)},remove:function(t,e){i(t,"remove");var r=this._indexOfListener(t,e);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i){t=this._bindings.slice(),this._shouldPropagate=!0;do i--;while(t[i]&&this._shouldPropagate&&t[i].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=r;o.Signal=r,"function"==typeof define&&define.amd?define("signals",[],function(){return o}):"undefined"!=typeof module&&module.exports?module.exports=o:t.signals=o}(this),define("com/fido/loader/Cache",["require","exports","module"],function(t,e,i){var r=function(){this._json={},this._text={}};r.prototype.addJson=function(t,e){this._json[e]=t},r.prototype.addText=function(t,e){this._text[e]=t
},r.prototype.getJson=function(t){return this._json[t]?this._json[t]:void 0},r.prototype.getText=function(t){return this._text[t]?this._text[t]:void 0},i.exports=new r}),define("com/fido/loader/Loader",["require","exports","module","PIXI","signals","com/fido/loader/Cache"],function(t,e,i){var r=t("PIXI"),o=t("signals"),n=t("com/fido/loader/Cache"),s=function(){this.crossdomain=!1,window.XDomainRequest&&this.crossdomain?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=function(){},this.ajaxRequest.ontimeout=function(){},this.ajaxRequest.onprogress=function(){}):window.XMLHttpRequest&&(this.ajaxRequest=new window.XMLHttpRequest),this.ajaxRequest.onload=this._onFileLoaded.bind(this),this.ajaxRequest.onreadystatechange=function(){},this.fileCount=0,this.filesToLoad=[],this.fontsToLoad=[],this.pixiAssetsToLoad=[],this.soundsToLoad=[],this.customToLoad=[],this.onComplete=new o,this.onProgress=new o};s.prototype.addFonts=function(t){this.fontsToLoad=this.fontsToLoad.concat(t)},s.prototype.addText=function(t,e){var i={url:t,id:e,type:s.TEXT};this.filesToLoad.push(i)},s.prototype.addJson=function(t,e){var i={url:t,id:e,type:s.JSON};this.filesToLoad.push(i)},s.prototype.addPixiAssets=function(t){this.pixiAssetsToLoad=this.pixiAssetsToLoad.concat(t)},s.prototype.addCSS=function(t){var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)},s.prototype.addCustom=function(t){var e={object:t,type:s.CUSTOM};this.filesToLoad.push(e)},s.prototype.load=function(){this._loadFonts()},s.prototype._loadFiles=function(){this.fileCount=0,this.filesToLoad.length?this._loadNextFile():this._loadPixiAssets()},s.prototype._loadNextFile=function(){var t=this.filesToLoad[this.fileCount];t.type===s.CUSTOM?(t.object.onLoaded.addOnce(this._onFileLoaded,this),t.object.load()):(this.ajaxRequest.open("GET",t.url,!0),this.ajaxRequest.send())},s.prototype._onFileLoaded=function(){var t=this.filesToLoad[this.fileCount];if(t.type===s.CUSTOM);else if(200!==this.ajaxRequest.status);else switch(t.type){case s.TEXT:var e=this.ajaxRequest.responseText;n.addText(e,t.id);break;case s.JSON:var i=JSON.parse(this.ajaxRequest.responseText);n.addJson(i,t.id)}this.fileCount++,this._onProgress(),this.fileCount===this.filesToLoad.length?this._loadPixiAssets():this._loadNextFile()},s.prototype._loadPixiAssets=function(){return 0===this.pixiAssetsToLoad.length?void this._onComplete():(this.pixiAssetLoader=new r.AssetLoader(this.pixiAssetsToLoad,!0),this.pixiAssetLoader.onComplete=this._onComplete.bind(this),this.pixiAssetLoader.onProgress=this._onProgress.bind(this),void this.pixiAssetLoader.load())},s.prototype._loadFonts=function(){return 0===this.fontsToLoad.length?void this._loadFiles():(WebFontConfig={google:{families:this.fontsToLoad},active:function(){this._loadFiles()}.bind(this)},void function(){var t=document.createElement("script");t.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}())},s.prototype._onComplete=function(){this.onComplete.dispatch()},s.prototype._onProgress=function(){var t=this.filesToLoad.length+this.pixiAssetsToLoad.length,e=this.fileCount;this.pixiAssetLoader&&(e+=this.pixiAssetsToLoad.length-this.pixiAssetLoader.loadCount),this.onProgress.dispatch(e/t)},s.TEXT=0,s.JSON=1,s.CUSTOM=2,i.exports=s}),define("com/fido/app/transitions/AlphaTransition",["require","exports","module"],function(t,e,i){AlphaTransition=function(){},AlphaTransition.constructor=AlphaTransition,AlphaTransition.prototype.begin=function(t,e,i){this.screenManager=t,this.currentScreen=e,this.nextScreen=i,this.currentScreen?(this.currentScreen.onHide&&this.currentScreen.onHide(),TweenLite.to(this.currentScreen,0,{alpha:0,onComplete:this.onFadeout.bind(this)})):this.onFadeout()},AlphaTransition.prototype.onFadeout=function(){this.currentScreen&&(this.currentScreen.onHidden&&this.currentScreen.onHidden(),this.screenManager.container.removeChild(this.currentScreen),this.currentScreen.alpha=1),this.nextScreen.alpha=0,this.nextScreen.onShow&&this.nextScreen.onShow(),this.nextScreen.resize&&this.nextScreen.resize(this.screenManager.w,this.screenManager.h),TweenLite.to(this.nextScreen,0,{alpha:1,onComplete:this.onFadein.bind(this)}),this.screenManager.container.addChild(this.nextScreen)},AlphaTransition.prototype.onFadein=function(){this.nextScreen.onShown&&this.nextScreen.onShown(),this.screenManager.onTransitionComplete()},AlphaTransition.prototype.resize=function(t,e){this.w=t,this.h=e},i.exports=AlphaTransition}),define("com/fido/app/ScreenManager",["require","exports","module","PIXI","./transitions/AlphaTransition"],function(t,e,i){var r=t("PIXI"),o=t("./transitions/AlphaTransition");ScreenManager=function(t,e,i){this.container=t||new r.DisplayObjectContainer,this.screens={},this.currentScreen,this.fading=!1,this.w=e||400,this.h=i||400,this.history=[],this.defaultTransition=new o,this.transition=this.defaultTransition,this.active=!1},ScreenManager.constructor=ScreenManager,ScreenManager.prototype.gotoScreenByID=function(t,e){var i=this.screens[t];if(!i)throw new Error("screen not found with id : ",t);this.gotoScreen(i,e)},ScreenManager.prototype.addScreen=function(t,e){this.screens[e]=t,t._screenID=e,t.screenManager=this},ScreenManager.prototype.goBack=function(){this.history.pop();var t=this.history.pop();t&&this.gotoScreen(t)},ScreenManager.prototype.getScreenId=function(t){for(var e in this.screens)if(this.screens[e]===t)return e;return null},ScreenManager.prototype.gotoScreen=function(t){if(this.currentScreen!==t&&(this.history.push(t),this.nextScreen=t,!this.active)){this.active=!0,this.transition=t.transition||this.defaultTransition,this.transition.onResize&&this.transition.onResize(this.w,this.h);var e=this.currentScreen;this.nextScreen&&this.nextScreen.resize&&this.nextScreen.resize(this.w,this.h),this.currentScreen=t,this.transition.begin(this,e,this.nextScreen)}},ScreenManager.prototype.onTransitionComplete=function(){this.active=!1,this.currentScreen!=this.nextScreen&&this.gotoScreen(this.nextScreen)},ScreenManager.prototype.resize=function(t,e){this.w=t,this.h=e,this.transition.onResize&&this.transition.onResize(t,e),this.currentScreen&&this.currentScreen.resize&&this.currentScreen.resize(t,e)},i.exports=ScreenManager}),define("com/fido/system/Ticker",["require","exports","module","signals"],function(t,e,i){var r=t("signals"),o=function(){this.onUpdate=new r,this.updateBind=this.update.bind(this),this.active=!1,this.deltaTime=1,this.timeElapsed=0,this.lastTime=0,this.speed=1};o.prototype.start=function(){this.active||(this.active=!0,requestAnimationFrame(this.updateBind))},o.prototype.stop=function(){this.active&&(this.active=!1)},o.prototype.update=function(){if(this.active){requestAnimationFrame(this.updateBind);var t=(new Date).getTime(),e=t-this.lastTime;e>100&&(e=100),this.deltaTime=.06*e,this.deltaTime*=this.speed,this.onUpdate.dispatch(this.deltaTime),this.lastTime=t}},o.prototype.add=function(t,e){this.onUpdate.add(t,e)},o.prototype.remove=function(t,e){this.onUpdate.remove(t,e)},o.instance=new o,i.exports=o}),define("com/fido/system/Device",["require","exports","module"],function(t,e,i){Device=function(){this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.mobileSafari=!1,this.ie=!1,this.ieVersion=0,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.cocoonJS=!1,this.android=!1,this.chromeOS=!1,this.iOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.desktop=!1,this.pixelRatio=0,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.blob=!1,this.canvas=!1,this.localStorage=!1,this.file=!1,this.fileSystem=!1,this.webGL=!1,this.worker=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1;var t=navigator.userAgent;this._checkBrowser(t),this._checkOS(t),this._checkDevice(t),this._checkAudio(),this._checkFeatures(),this._checkIsMobile()},Device.prototype._checkBrowser=function(t){/Arora/.test(t)?this.arora=!0:/Chrome/.test(t)?this.chrome=!0:/Epiphany/.test(t)?this.epiphany=!0:/Firefox/.test(t)?this.firefox=!0:/Mobile Safari/.test(t)?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)||navigator.userAgent.match(/Trident.*rv[ :]*11\./)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(t)?this.midori=!0:/Opera/.test(t)?this.opera=!0:/Safari/.test(t)&&(this.safari=!0),navigator.standalone&&(this.webApp=!0),navigator.isCocoonJS&&(this.cocoonJS=!0)},Device.prototype._checkOS=function(t){/Android/.test(t)?this.android=!0:/CrOS/.test(t)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?(this.iOS=!0,this.iOS_version=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1):/Linux/.test(t)?this.linux=!0:/Mac OS/.test(t)?this.macOS=!0:/Windows/.test(t)&&(this.windows=!0),(this.windows||this.macOS||this.linux)&&(this.desktop=!0)},Device.prototype._checkDevice=function(){this.pixelRatio=window.devicePixelRatio||1,this.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone"),this.iPhone4=2===this.pixelRatio&&this.iPhone,this.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad")},Device.prototype._checkFeatures=function(){"undefined"!=typeof window.Blob&&(this.blob=!0),this.canvas=!!window.CanvasRenderingContext2D;try{this.localStorage=!!localStorage.getItem}catch(t){this.localStorage=!1}this.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),this.fileSystem=!!window.requestFileSystem,this.webGL=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(e){return!1}}(),(this.android||this.ie)&&(this.webGL=!1),this.worker=!!window.Worker,("ontouchstart"in document.documentElement||window.navigator.msPointerEnabled)&&(this.touch=!0)},Device.prototype._checkAudio=function(){this.audioData=!!window.Audio,this.webaudio=!(!window.webkitAudioContext&&!window.AudioContext);var t=document.createElement("audio"),e=!1;try{(e=!!t.canPlayType)&&(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0))}catch(i){}},Device.prototype._checkIsMobile=function(){var t=!1;!function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),this.isMobile=t},Device.prototype.getInfo=function(){var t="DEVICE OUTPUT\n\n";return t+="---\n",t+="Browser Info :: \n",t+="Arora : "+this.arora+"\n",t+="Chrome : "+this.chrome+"\n",t+="Epiphany : "+this.epiphany+"\n",t+="Firefox : "+this.firefox+"\n",t+="Mobile Safari : "+this.mobileSafari+"\n",t+="IE : "+this.ie,t+=this.ie?" (Version "+this.ieVersion+")\n":"\n",t+="Midori : "+this.midori+"\n",t+="Opera : "+this.opera+"\n",t+="Safari : "+this.safari+"\n",t+="Web App : "+this.webApp+"\n",t+="CocoonJS : "+this.cocoonJS+"\n",t+="Android : "+this.android+"\n",t+="---\n",t+="Operating System :: \n",t+="Chrome OS : "+this.chromeOS+"\n",t+="iOS : "+this.iOS+"\n",t+="Linux : "+this.linux+"\n",t+="Mac OS : "+this.macOS+"\n",t+="Windows : "+this.windows+"\n",t+="Desktop : "+this.desktop+"\n",t+="---\n",t+="Device Type : \n",t+="Pixel Ratio : "+this.pixelRatio+"\n",t+="iPhone : "+this.iPhone+"\n",t+="iPhone 4 : "+this.iPhone4+"\n",t+="iPad : "+this.iPad+"\n",t+="---\n",t+="Features :: \n",t+="Blob : "+this.blob+"\n",t+="Canvas : "+this.canvas+"\n",t+="LocalStorage : "+this.localStorage+"\n",t+="File : "+this.file+"\n",t+="File System : "+this.fileSystem+"\n",t+="WebGL : "+this.webGL+"\n",t+="Workers : "+this.worker+"\n",t+="---\n",t+="Audio :: \n",t+="AudioData : "+this.audioData+"\n",t+="WebAudio : "+this.webAudio+"\n",t+="Supports .ogg : "+this.ogg+"\n",t+="Supports Opus : "+this.opus+"\n",t+="Supports .mp3 : "+this.mp3+"\n",t+="Supports .wav : "+this.wav+"\n",t+="Supports .m4a : "+this.m4a+"\n",t+="Supports .webm : "+this.webm},Device.instance=new Device,i.exports=Device}),define("com/fido/utils/FrameWait",["require","exports","module"],function(t,e,i){var r=function(){this.updateBind=this.update.bind(this),this.waits=[]};r.prototype.wait=function(t,e){var i={callback:t,count:e||2};this.waits.push(i),requestAnimationFrame(this.updateBind)},r.prototype.update=function(){for(var t=this.waits.length-1;t>=0;t--){var e=this.waits[t];e.count--,e.count<=0&&(e.callback(),this.waits.splice(t,1))}this.waits.length>0&&requestAnimationFrame(this.updateBind)},i.exports=new r}),define("com/fido/app/LoaderScreen",["require","exports","module","PIXI","com/fido/system/Ticker","com/fido/utils/FrameWait","signals"],function(t,e,i){var r=t("PIXI"),o=t("com/fido/system/Ticker"),n=t("com/fido/utils/FrameWait"),s=t("signals"),a=function(t){r.DisplayObjectContainer.call(this),this.app=t,this.easeLoad=0,this.targetLoad=0,this.onReady=new s,this.onComplete=new s,this.initLoader()};a.prototype=Object.create(r.DisplayObjectContainer.prototype),a.prototype.initLoader=function(){this.barBg=(new r.Graphics).beginFill(3554156).drawRect(0,0,100,100),this.bar=(new r.Graphics).beginFill(16729508).drawRect(0,0,100,100),o.instance.add(this.update,this),this.resize(this.w,this.h),n.wait(this.showLoader.bind(this))},a.prototype.showLoader=function(){this.onReady.dispatch()},a.prototype.update=function(){this.easeLoad+=.3*(this.targetLoad-this.easeLoad),this.easeLoad>.99&&(this.easeLoad=1,o.instance.remove(this.update,this),this.onComplete.dispatch()),this.bar.scale.x=this.easeLoad},a.prototype.updateProgress=function(t){this.targetLoad=t},a.prototype.onHide=function(){o.instance.remove(this.update,this)},a.prototype.resize=function(t,e){this.w=t,this.h=e,this.barBg&&(this.barBg.scale.x=t/100,this.barBg.y=e/2-50)},i.exports=a}),define("com/fido/app/OrientationManager",["require","exports","module","com/fido/system/Ticker"],function(t,e,i){var r=t("com/fido/system/Ticker");OrientationManager=function(t){this.mode=t,this.rotateScreen=new Image,this.rotateScreen.src=ASSET_URL+"img/rotate-device.png",this.rotateScreen.style.position="absolute",this.rotateScreen.style.top="0",this.rotateScreen.style.left="0",this.rotateScreen.style.zIndex=1e7,this.rotateScreen.style.display="none",this.rotateScreen.width=446,this.rotateScreen.height=288,document.body.appendChild(this.rotateScreen),this.supportsOrientationChange="onorientationchange"in window,this.supportsOrientationChange&&window.addEventListener("orientationchange",this.checkOrientation.bind(this),!1)},OrientationManager.constructor=OrientationManager,OrientationManager.prototype.checkOrientation=function(){90===window.orientation||-90===window.orientation?(r.instance.stop(),this.rotateScreen.style.display="block"):(r.instance.start(),this.rotateScreen.style.display="none")},OrientationManager.prototype.check=function(t,e){var i=0===this.mode?!(e>t):e>t,o=t/892,n=e/576,s=Math.max(o,n);this.rotateScreen.width=892*s,this.rotateScreen.height=576*s,this.rotateScreen.style.left=t/2-this.rotateScreen.width/2+"px",this.rotateScreen.style.top=e/2-this.rotateScreen.height/2+"px",this.supportsOrientationChange||(i?(r.instance.stop(),this.rotateScreen.style.display="block"):(r.instance.start(),this.rotateScreen.style.display="none"))},i.exports=OrientationManager}),define("com/fido/app/App",["require","exports","module","PIXI","com/fido/loader/Loader","com/fido/app/ScreenManager","com/fido/system/Ticker","com/fido/system/Device","com/fido/app/LoaderScreen","com/fido/app/OrientationManager","signals"],function(t,e,i){var r=t("PIXI"),o=t("com/fido/loader/Loader"),n=t("com/fido/app/ScreenManager"),s=t("com/fido/system/Ticker"),a=t("com/fido/system/Device"),h=t("com/fido/app/LoaderScreen"),l=t("com/fido/app/OrientationManager"),u=t("signals"),c=function(t){t=t||c.defaultOptions,this.options={};for(var e in c.defaultOptions)this.options[e]=t[e]||c.defaultOptions[e];this.setupPixi(),s.instance.start(),s.instance.add(this.update,this),this.options.orientationMode!==c.orientationModes.BOTH&&(this.orientationManager=new l(this.options.orientationMode)),this.screenManager=new n(null,300,300),this.stage.addChild(this.screenManager.container),this.loader=new o,this.onReady=new u};c.prototype.setupPixi=function(){var t=this.options;t.forceCanvas||a.instance.android&&!a.instance.chrome?(this.renderer=new r.CanvasRenderer(t.width,t.height),this.renderer.clearBeforeRender=!1):this.renderer=r.autoDetectRenderer(t.width,t.height),this.renderer.view.imageSmoothingEnabled=!1,this.renderer.view.webkitImageSmoothingEnabled=!1,this.renderer.view.mozImageSmoothingEnabled=!1,this.renderer.renderSession.roundPixels=!0,r.scaleModes.DEFAULT=1,window.WEBGL=r.isWebGL=this.renderer instanceof r.WebGLRenderer,this.view=this.renderer.view,this.view.style.position="absolute",this.stage=new r.Stage(t.backgroundColor),r.stage=this.stage},c.prototype.update=function(){this.renderer.render(this.stage)},c.prototype.startup=function(){this.loaderScreen=new this.options.loaderScreen(this),this.loaderScreen.onReady.addOnce(this.onLoaderScreenReady,this),this.loaderScreen.onComplete.addOnce(this.onLoaderScreenComplete,this),this.screenManager.addScreen(this.loaderScreen,"loader"),this.screenManager.gotoScreenByID("loader")},c.prototype.onLoaderScreenReady=function(){this.loader.onComplete.addOnce(this.onAssetsLoaded,this),this.loader.onProgress.add(this.onProgresss,this),this.loader.load()},c.prototype.onAssetsLoaded=function(){},c.prototype.onProgresss=function(t){this.loaderScreen.updateProgress(t)},c.prototype.onLoaderScreenComplete=function(){this.onReady.dispatch()},c.prototype.resize=function(t,e){this.orientationManager&&this.orientationManager.check(t,e),this.options.resizeMode===c.resizeModes.DEFUALT?(this.renderer.resize(t,e),this.view.style.width="auto",this.view.style.height="auto"):this.this.options.resizeMode===c.resizeModes.CSS_RESIZE_PRESERVE_RATIO||this.options.resizeMode===c.resizeModes.CSS_RESIZE&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},c.resizeModes={DEFUALT:0,CSS_RESIZE_PRESERVE_RATIO:1,CSS_RESIZE:2},c.orientationModes={LANDSCAPE:0,PORTRAIT:1,BOTH:2},c.defaultOptions={width:800,height:600,forceCanvas:!1,backgroundColor:725538,resizeMode:c.resizeModes.DEFUALT,orientationMode:c.orientationModes.BOTH,loaderScreen:h},i.exports=c}),define("com/fido/system/VisibilityChecker",["require","exports","module","signals"],function(t,e,i){var r=t("signals"),o=function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.onHide=new r,this.onShow=new r,this.init()};o.prototype.handleVisibilityChange=function(){document[this.hidden]?this.onHide.dispatch():this.onShow.dispatch()},o.prototype.init=function(){document.addEventListener(this.visibilityChange,this.handleVisibilityChange.bind(this),!1)},i.exports=new o}),define("com/fido/sound/SoundManager",["require","exports","module","signals","com/fido/system/VisibilityChecker"],function(t,e,i){var r=t("signals"),o=t("com/fido/system/VisibilityChecker"),n=function(){this.disabled=!1,this.preload=!0,this.sounds={},this.groups={},this.globalVolume=1,this.isMuted=!1,this.onMuteToggle=new r};n.prototype.addSound=function(t,e,i){if(!this.disabled&&!this.sounds[e]){i=i||{};var r=new Howl({urls:[t+".mp3",t+".ogg"],autoplay:i.autoplay||!1,loop:i.loop||!1,volume:i.volume||1});r.realVolume=i.volume||1,this.sounds[e]=r}},n.prototype.addGroup=function(t,e){if(!this.disabled&&!this.groups[e]){var i={index:0,type:0,sounds:t};this.groups[e]=i}},n.prototype.play=function(t){this.disabled||this.sounds[t].play()},n.prototype.playGroup=function(t){if(!this.disabled){var e=this.groups[t],i=Math.random()*e.sounds.length|0;this.sounds[e.sounds[i]].play()}},n.prototype.setVolume=function(t,e){if(!this.disabled){var i=this.sounds[t];i.realVolume=e,i.volume(e*this.globalVolume)}},n.prototype.stop=function(t){this.disabled||this.sounds[t].stop()},n.prototype.setPlaybackSpeed=function(t,e){if(!this.disabled){var i=this.sounds[t];i._playbackSpeed=e;var r="music"==t?0:1;i._webAudio&&Howler._howls[r]._audioNode[0]&&(Howler._howls[r]._audioNode[0].bufferSource.playbackRate.value=e)}},n.prototype.getPlaybackSpeed=function(t){if(!this.disabled){var e=this.sounds[t];return e._playbackSpeed||1}},n.prototype.setGlobalVolume=function(t){this.globalVolume=t;for(var e in this.sounds){var i=this.sounds[e];i.volume(i.realVolume*t)}},n.prototype.mute=function(){this.isMuted=!0,this.setGlobalVolume(0),this.onMuteToggle.dispatch(!0)},n.prototype.unmute=function(){this.isMuted=!1,this.setGlobalVolume(1),this.onMuteToggle.dispatch(!1)},n.prototype.check=function(){this.lastSeen=Date.now();var t=function(){lastSeen=Date.now(),setTimeout(t,50)};t();var i=document.getElementById("music");i.addEventListener("timeupdate",function(){Date.now()-e.lastSeen>100&&this.pause()},!1)},n.sfx=new n,n.music=new n,n.sfx.disabled=!Howler.usingWebAudio,o.onHide.add(Howler.mute,Howler),o.onShow.add(Howler.unmute,Howler),i.exports=n}),define("com/boxy/app/LoaderScreen",["require","exports","module","PIXI","com/fido/system/Ticker","com/fido/utils/FrameWait","signals","com/fido/system/Device","com/fido/sound/SoundManager"],function(t,e,i){var r=t("PIXI"),o=t("com/fido/system/Ticker"),n=t("com/fido/utils/FrameWait"),s=t("signals"),a=(t("com/fido/system/Device"),t("com/fido/sound/SoundManager")),h=function(t){r.DisplayObjectContainer.call(this),this.app=t,this.easeLoad=0,this.targetLoad=0,this.onReady=new s,this.onComplete=new s,this.bg=(new r.Graphics).beginFill(725538).drawRect(0,0,100,100),this.addChild(this.bg),this.initLoader(),a.music.addSound(ASSET_URL+"snd/bigRockCandy","tunage",{autoplay:!0,loop:!0,volume:1}),a.music.play("tunage")};h.prototype=Object.create(r.DisplayObjectContainer.prototype),h.prototype.initLoader=function(){this.onAssetsLoaded(),this.resize(this.w,this.h)},h.prototype.showLoader=function(){this.onReady.dispatch()},h.prototype.onAssetsLoaded=function(){o.instance.add(this.update,this),this.resize(this.w,this.h),n.wait(this.showLoader.bind(this)),this.label=document.createElement("div"),this.label.innerHTML="FUTURE, PRESENT, PAST",this.label.className="title",this.label.style.opacity=0,document.body.appendChild(this.label),this.loader=document.createElement("div"),this.loader.innerHTML="100%",this.loader.className="loader",this.loader.style.opacity=0,document.body.appendChild(this.loader),this.instructions=document.createElement("img"),this.instructions.src=ASSET_URL+"img/instructions.png",this.instructions.style.position="absolute",this.instructions.style.opacity=0,document.body.appendChild(this.instructions),TweenLite.to(this.loader,.5,{alpha:1,delay:.1}),TweenLite.to(this.label,.5,{alpha:1,delay:.2})},h.prototype.update=function(){var t=.1*(this.targetLoad-this.easeLoad);t>.01&&(t=.01),this.easeLoad+=t;var e=(this.range,Math.round(100*this.easeLoad));this.easeLoad>.99?(this.loader.innerHTML="100%",o.instance.remove(this.update,this),TweenLite.to(this.loader,.5,{alpha:0}),TweenLite.to(this.label,1,{alpha:0,delay:1.5}),TweenLite.to(this.instructions,1,{alpha:1,delay:3,onComplete:function(){TweenLite.to(this.instructions,.5,{alpha:0,delay:2,onComplete:this.finishLoad.bind(this)})}.bind(this)})):this.loader.innerHTML=e+"%"},h.prototype.finishLoad=function(){this.easeLoad=1,this.onComplete.dispatch()},h.prototype.updateProgress=function(t){this.targetLoad=t},h.prototype.onHide=function(){this.label.style.display="none",this.loader.style.display="none",this.instructions.style.display="none",o.instance.remove(this.update,this)},h.prototype.resize=function(t,e){t=window.innerWidth,e=window.innerHeight,this.w=t,this.h=e,this.bg.scale.x=t/100,this.bg.scale.y=e/100,this.label&&(this.label.style.top=e/2-30+"px",this.loader.style.top=e/2+90-30+"px",this.instructions.style.left=t/2-116.5+"px",this.instructions.style.top=e/2-144+"px")},i.exports=h}),define("com/boxy/app/Light",["require","exports","module"],function(t,e,i){function r(t,e){var i=t.a.x,r=t.a.y,o=t.b.x-t.a.x,n=t.b.y-t.a.y,s=e.a.x,a=e.a.y,h=e.b.x-e.a.x,l=e.b.y-e.a.y,u=Math.sqrt(o*o+n*n),c=Math.sqrt(h*h+l*l);if(o/u==h/c&&n/u==l/c)return null;var p=(o*(a-r)+n*(i-s))/(h*n-l*o),d=(s+h*p-i)/o;return 0>d?null:0>p||p>1?null:{x:i+o*d,y:r+n*d,param:d}}function o(t,e,i){for(var o=[],n=[],s=0;s<i.length;s++){var a=i[s],h=a.points[0],l=a.points[1],u=a.points[2],c=a.points[3];o.push(h,l,u,c);var p=a.segments;n.push(p[0],p[1],p[2],p[3])}for(var d=[],f={},s=0;s<o.length;s++){var m=o[s],v=(0|m.x)+","+(0|m.y);f[v]||(f[v]=!0,d.push(m))}for(var g=[],s=0;s<d.length;s++){var y=d[s],x=Math.atan2(y.y-e,y.x-t);y.angle=x,g.push(x-1e-5,x,x+1e-5)}for(var b=[],w=0;w<g.length;w++){for(var x=g[w],_=Math.cos(x),T=Math.sin(x),S={a:{x:t,y:e},b:{x:t+_,y:e+T}},A=null,s=0;s<n.length;s++){var C=r(S,n[s]);C&&(!A||C.param<A.param)&&(A=C)}A&&(A.angle=x,b.push(A))}return b=b.sort(function(t,e){return t.angle-e.angle})}var n=function(){this.light=new PIXI.Point(300,300),this.view=new PIXI.Graphics,this.county=0};n.prototype.update=function(t){var e=o(this.light.x,this.light.y,t);this.view.clear(),this.view.beginFill(16777215,.5);var i=e[0];if(0!==e.length){this.view.moveTo(i.x,i.y);for(var r=1;r<e.length;r++){var i=e[r];this.view.lineTo(i.x,i.y)}this.county++}},n.prototype.buildSegments=function(){},i.exports=n}),define("com/fido/utils/Utils",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI"),o={};o.getTexturesFromFrames=function(t){for(var e=[],i=0;i<t.length;i++)e.push(new r.Texture.fromFrame(t[i]));return e},o.getTexturesFromImages=function(t){for(var e=[],i=0;i<t.length;i++)e.push(new r.Texture.fromImage(t[i]));return e},o.getTexturesFromFramesWithPrefix=function(t,e,i){var o=[];void 0==i&&(i=0);for(var n=0;e>n;n++){var s=n+i,a=t.replace("%%",10>s?"0"+s:s);o.push(new r.Texture.fromFrame(a))}return o},o.getTexturesFromImagesWithPrefix=function(t,e,i){var o=[];void 0==i&&(i=0);for(var n=0;e>n;n++){var s=n+i,a=t.replace("%%",10>s?"0"+s:s);o.push(new r.Texture.fromImage(a))}return o},o.formatScore=function(t){for(var e=t.toString().split(""),i="",r=e.length,o=r%3-1,n=0;r>n;n++)i+=e[n],(n-o)%3==0&&n!=r-1&&(i+=",");return i},o.formatName=function(t){for(var e=t.split(" "),i=e.length-1;i>=0;i--)0!==e[i].length&&(wordArray=e[i].split(""),wordArray[0]=wordArray[0].toUpperCase(),e[i]=wordArray.join(""));return word=e.join(" ")},window.console||(window.console={log:function(){}}),o.get_query=function(t){for(var e=location.href,i=e.substring(e.indexOf("?")+1).split("&"),r=0,o={};r<i.length;r++)i[r]=i[r].split("="),o[i[r][0]]=decodeURIComponent(i[r][1]);return o.hasOwnProperty(t)?o[t]:!1},i.exports=o}),define("com/boxy/app/Box",["require","exports","module","PIXI","./Light","com/fido/utils/Utils"],function(t,e,i){var r=t("PIXI"),o=(t("./Light"),t("com/fido/utils/Utils")),n=function(t,e){5+3*Math.random()*.3;r.DisplayObjectContainer.call(this);var i=window.p2;this.rotationSpeed=0,this.fallSpeed=4+3*Math.random(),this.fallSpeed*=.4,this.currentFrame=100*Math.random(),this.diffuseClips=o.getTexturesFromFramesWithPrefix("box_diff%%.png",10,0),this.normalClips=o.getTexturesFromFramesWithPrefix("box_norm%%.png",10,0),this.sprite=new r.Sprite(this.diffuseClips[0]),this.sprite.normalMap=this.normalClips[0],this.sprite.texture=this.diffuseClips[(0|this.currentFrame)%this.diffuseClips.length],this.sprite.normalMap=this.normalClips[(0|this.currentFrame)%this.normalClips.length];var n=this.sprite.texture.crop.width-10,s=this.sprite.texture.crop.height-10;if(t=t||new r.Rectangle(-n/2,-s/2,n,s),e){this.p2Body=new i.Body({mass:1,position:[1700*Math.random(),0],angularVelocity:1});var a=new i.Rectangle(t.width,t.height);this.p2Body.owner=this,this.p2Body.addShape(a)}this.rect=t,this.sprite.anchor.set(.5),this.addChild(this.sprite),this.sprite.tint=16777215*Math.random(),this.sprite.scale.set(1),this.points=[];for(var h=0;4>h;h++)this.points.push(new r.Point);var l=this.points[0],u=this.points[1],i=this.points[2],c=this.points[3];this.segments=[{a:l,b:u},{a:u,b:i},{a:i,b:c},{a:c,b:l}],this.rotty=0};n.prototype=Object.create(r.DisplayObjectContainer.prototype),n.prototype.reset=function(){this.currentFrame=100*Math.random();var t=.5+.5*Math.random();this.sprite.texture=this.diffuseClips[(0|this.currentFrame)%this.diffuseClips.length],this.sprite.normalMap=this.normalClips[(0|this.currentFrame)%this.normalClips.length];var e=this.sprite.texture.crop.width-10,i=this.sprite.texture.crop.height-10;this.rect=new r.Rectangle(-e/2,-i/2,e,i),this.scale.set(t);var o=new window.p2.Rectangle(this.rect.width*t,this.rect.height*t);this.p2Body.shapes[0]=o,this.update()},n.prototype.update=function(){if(this.p2Body){var t=this.p2Body.velocity[1];t>n.maxSpeed&&(this.p2Body.velocity[1]=n.maxSpeed),this.position.x=this.p2Body.position[0],this.position.y=this.p2Body.position[1],this.p2Body.velocity[0]*=.95,this.rotation=this.p2Body.angle}},n.prototype.updateTransform=function(){this.rotation+=this.rotationSpeed,r.DisplayObjectContainer.prototype.updateTransform.call(this),this.currentFrame+=0;var t=this.points[0],e=this.points[1],i=this.points[2],o=this.points[3],n=this.rect;this.updatePoint(n.x,n.y,t),this.updatePoint(n.x+n.width,n.y,e),this.updatePoint(n.x+n.width,n.y+n.height,i),this.updatePoint(n.x,n.y+n.height,o)},n.prototype.updatePoint=function(t,e,i){var r=this.worldTransform.a,o=this.worldTransform.b,n=this.worldTransform.c,s=this.worldTransform.d,a=this.worldTransform.tx,h=this.worldTransform.ty;
i.x=r*t+n*e+a,i.y=o*t+s*e+h},n.maxSpeed=300,i.exports=n}),define("com/boxy/app/Snow",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI"),o=function(){r.DisplayObjectContainer.call(this),this.snowContainer=new r.DisplayObjectContainer,this.addChild(this.snowContainer),this.snowContainer.x=-185,this.snowContainer.y=-35,this.range=new r.Rectangle(0,0,370,200);for(var t=0;1e3>t;t++){if(t%2)var e=new r.Sprite.fromFrame("sharpSnow.png");else var e=new r.Sprite.fromFrame("blurSnow.png");this.snowContainer.addChild(e),e.position.x=370*Math.random(),e.position.y=Math.random()*this.range.height,e.scale.set(.1*Math.random()*2*.6),e.alpha=.5,e.speed=.1+Math.random(),e.speedx=.3*Math.random()}this.snowContainer.scale.set(1024/370*2),this.trSprite=new r.Sprite(this.renderTexture),this.trSprite.scale.set(this.snowContainer.scale.x)};o.prototype=Object.create(r.DisplayObjectContainer.prototype),o.prototype.update=function(){for(var t=this.snowContainer.children,e=this.range,i=0;i<t.length;i++){var r=t[i];r.position.y+=r.speed,r.position.x+=r.speedx,r.alpha=r.position.y>100?1-(r.position.y-100)/100:1,r.position.y>e.height?(r.position.y=0,r.position.x=Math.random()*e.width):r.position.x<0?r.position.x=e.width:r.position.x>e.width+300&&(r.position.x=0)}},i.exports=o}),define("com/boxy/app/Scores",["require","exports","module","PIXI","./Light","com/fido/utils/Utils"],function(t,e,i){var r=t("PIXI"),o=(t("./Light"),t("com/fido/utils/Utils")),n=function(){r.DisplayObjectContainer.call(this),this.label=document.createElement("div"),this.label.innerHTML="0",this.label.className="score",this.label.style.opacity=0,document.body.appendChild(this.label),this.pbLabel=document.createElement("div"),this.pbLabel.innerHTML="PB: 000,000",this.pbLabel.className="pbscore",this.pbLabel.style.opacity=0,document.body.appendChild(this.pbLabel),this.logo=document.createElement("img"),this.logo.src=ASSET_URL+"img/goodboy.png",this.logo.className="logo",this.logo.style.opacity=0,this.logo.onclick=function(){window.open("http://www.goodboydigital.com/","_blank")},document.body.appendChild(this.logo),this.pb=-1,this.save(0),TweenLite.to(this.pbLabel,.5,{alpha:1,delay:.1}),TweenLite.to(this.label,.5,{alpha:1}),TweenLite.to(this.logo,.5,{alpha:1})};n.prototype=Object.create(r.DisplayObjectContainer.prototype),n.prototype.update=function(t){this.label.innerHTML=o.formatScore(t)},n.prototype.save=function(t){t>this.pb&&(this.pb=t,this.pbLabel.innerHTML="Best: "+o.formatScore(t))},i.exports=n}),define("com/boxy/app/Fairy",["require","exports","module","PIXI","./Light","com/fido/utils/Utils"],function(t,e,i){var r=t("PIXI"),o=(t("./Light"),t("com/fido/utils/Utils")),n=function(){r.DisplayObjectContainer.call(this);var t=window.p2,e=o.getTexturesFromFramesWithPrefix("sprite00%%.png",40,1);this.main=new r.MovieClip(e),this.main.play(),this.main.animationSpeed=.5,this.main.anchor.set(.5),this.main.alpha=.9,this.main.blendMode=r.blendModes.ADD,this.addChild(this.main),this.count=0,this.p2Body=new t.Body({mass:0,position:[0,0],angularVelocity:0}),this.p2Body.owner=this;var i=new t.Circle(15);this.p2Body.addShape(i),this.p2Body.motionState=t.Body.KINEMATIC};n.prototype=Object.create(r.DisplayObjectContainer.prototype),n.prototype.update=function(t){this.rotation+=.05,this.count+=.1,this.alpha=1,this.p2Body.position[0]=t.x,this.p2Body.position[1]=t.y,this.position.x=this.p2Body.position[0],this.position.y=this.p2Body.position[1],this.p2Body.velocity[0]*=.95},i.exports=n}),define("com/boxy/app/Background",["require","exports","module","PIXI","./Light","com/fido/utils/Utils"],function(t,e,i){var r=t("PIXI"),o=(t("./Light"),t("com/fido/utils/Utils"),function(){r.DisplayObjectContainer.call(this);var t=window.p2;this.main=new r.Sprite.fromImage(ASSET_URL+"img/spriteBlob.png"),this.main.anchor.set(.5),this.main.alpha=.5,this.main.blendMode=r.blendModes.ADD,this.addChild(this.main),this.p2Body=new t.Body({mass:0,position:[0,0],angularVelocity:0});var e=new t.Circle(30);this.p2Body.addShape(e),this.p2Body.motionState=t.Body.KINEMATIC});o.prototype=Object.create(r.DisplayObjectContainer.prototype),o.prototype.update=function(t){this.p2Body.position[0]=t.x,this.p2Body.position[1]=t.y,this.position.x=this.p2Body.position[0],this.position.y=this.p2Body.position[1],this.p2Body.velocity[0]*=.95},i.exports=o}),define("com/awesome/BloomFilter",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI");r.BloomFilter=function(t){this.width=1024,this.height=640,this.texture1=null,this.texture2=null,this.outSprite=new r.Sprite,this.outSprite2=new r.Sprite,this.mat=new r.Matrix,this.count=0,this.zoom=1,this.game=t,this.shake=0},r.BloomFilter.prototype.init=function(t){this.gl=t,this.renderTexture=new r.RenderTexture(this.width,this.height),this.renderTexture2=new r.RenderTexture(this.width,this.height),this.original=this.renderTexture.textureBuffer,this.texture1=this.renderTexture2.textureBuffer,this.texture2=new r.FilterTexture(t,this.width,this.height),this.outSprite.setTexture(this.renderTexture),this.outSprite2.setTexture(this.renderTexture2),this.initShaderBuffers(),this.blurXFilter=new r.BlurXFilter,this.blurYFilter=new r.BlurYFilter,this.outSprite2.blendMode=r.blendModes.ADD,this.outSprite2.alpha=.9},r.BloomFilter.prototype.apply=function(t){var e=r.defaultRenderer.gl;this.renderTexture||this.init(e),this.count++,this.renderSession=r.defaultRenderer.renderSession,this.renderTexture.textureBuffer=this.original,this.renderTexture.baseTexture._glTextures[e.id]=this.original.texture,this.mat.identity(),this.mat.translate(-512,-320);var i=this.zoom;this.mat.scale(i,i);var o=2*(Math.sin(1.2*this.count)+(Math.random()-.5))*this.shake;this.mat.translate(512+o,320+o),this.renderTexture.render(t,this.mat),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.original.texture),this.applyFilterPass(this.blurXFilter,this.texture1.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture1.texture),this.applyFilterPass(this.blurYFilter,this.texture2.frameBuffer),this.renderTexture2.textureBuffer=this.texture2,this.renderTexture2.baseTexture._glTextures[e.id]=this.texture2.texture},r.BloomFilter.prototype.applyFilterPass=function(t,e){var i=this.gl,o=t.shaders[i.id];o||(o=new r.PixiShader(i),o.fragmentSrc=t.fragmentSrc,o.uniforms=t.uniforms,o.init(),t.shaders[i.id]=o),this.renderSession.shaderManager.setShader(o),i.bindFramebuffer(i.FRAMEBUFFER,e),i.clear(i.COLOR_BUFFER_BIT),i.uniform2f(o.projectionVector,this.width/2,-this.height/2),i.uniform2f(o.offsetVector,0,0),i.uniform1f(o.flipY,e?-1:1),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.vertexAttribPointer(o.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),i.vertexAttribPointer(o.aTextureCoord,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.vertexAttribPointer(o.colorAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)},r.BloomFilter.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new r.Float32Array([0,0,this.width,0,0,this.height,this.width,this.height]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new r.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new r.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},r.BloomFilter.prototype.constructor=r.BloomFilter,i.exports=r.BloomFilter}),define("com/boxy/app/Spawner",["require","exports","module","PIXI","./Light","com/fido/utils/Utils","./Box"],function(t,e,i){var r=t("PIXI"),o=(t("./Light"),t("com/fido/utils/Utils"),t("./Box")),n=function(t){this.pool=[],this.boxes=[];var e=new o(new r.Rectangle(0,0,800,600));e.alpha=0,e.fallSpeed=0,this.boundBox=e,t.container.addChild(e),this.boxes.push(e),this.spawnRate=20,this.spawnCount=0,this.padding=100,this.game=t};n.prototype=Object.create(r.DisplayObjectContainer.prototype),n.prototype.reset=function(){o.maxSpeed=300},n.prototype.update=function(){this.spawnCount++;for(var t=this.boxes.length-1;t>=1;t--){var e=this.boxes[t];e.update(),e.position.x>this.w+this.padding||e.position.x<-this.padding?(this.removeBox(t),t--):(e.position.y>this.h+this.padding||e.position.y<-this.padding)&&(this.removeBox(t),t--)}this.boxes.length<40&&this.spawnCount>this.spawnRate&&(this.spawnRate=10,this.spawnCount=0,this.addBox())},n.prototype.removeBox=function(t){var e=this.boxes[t];this.boxes.splice(t,1),this.pool.push(e),this.game.boxContainer.removeChild(e),this.game.p2World.removeBody(e.p2Body),e.position.set(-3e3)},n.prototype.addBox=function(){var t=this.pool.pop();t||(t=new o(null,!0)),this.game.boxContainer.addChild(t),t.p2Body.position[0]=this.padding+(Math.random()*this.w-2*this.padding),t.p2Body.position[1]=-this.padding,t.p2Body.velocity[0]=0,t.p2Body.velocity[1]=0,this.boxes.push(t),t.reset(),this.game.p2World.addBody(t.p2Body)},n.prototype.resize=function(t,e){this.w=t,this.h=e,this.boundBox.rect.width=t,this.boundBox.rect.height=e},i.exports=n}),define("com/fido/utils/Math2",["require","exports","module"],function(t,e,i){var r={};r.random=function(t,e){return t=t||0,e=void 0===e?1:e,t+Math.random()*(e-t)},r.randomInt=function(t,e){return t+Math.random()*(e-t)|0},r.randomSeed=function(t,e,i){min=t,max=e,i=i||1,i=(9301*i+49297)%233280;var r=i/233280;return min+r*(max-min)},r.randomChance=function(t,e){return r.randomSeed(0,1,e)>t},r.smallestAngle=function(t,e){var i=e-t,r=e+2*Math.PI-t,o=e-2*Math.PI-t,n=Math.abs(i),s=Math.abs(r),a=Math.abs(o),h=i;return n>s&&a>s?h=r:n>a&&s>a&&(h=o),h},r.map=function(t,e,i,r,o){var n=(t-e)/(i-e);return r+(o-r)*n},i.exports=r}),define("com/fido/Flash",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI"),o=function(t,e){r.Graphics.call(this),this.beginFill(16777215).drawRect(0,0,100,100),this.resize(t,e),this.alpha=0};o.prototype=Object.create(r.Graphics.prototype),o.prototype.flash=function(t,e){this.alpha=1,TweenLite.to(this,e||.5,{alpha:0,delay:t||0,ease:Expo.easeOut})},o.prototype.resize=function(t){this.scale.x=t/100,this.scale.y=t/100},i.exports=o}),define("com/boxy/app/NormalMapFilterBg",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI");r.NormalMapFilter=function(t){r.AbstractFilter.call(this),this.passes=[this],this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:1,y:1}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:1}},zoomScale:{type:"2f",value:{x:1,y:1}},dimensions:{type:"4fv",value:[0,0,0,0]},LightPos:{type:"3fv",value:[0,1,0]}},t.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=t.width,this.uniforms.mapDimensions.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D displacementMap;","uniform vec4 dimensions;","const vec2 Resolution = vec2(1.0,1.0);","uniform vec3 LightPos;","const vec4 LightColor = vec4(1.0, 1.0, 1.0, 1.0);","const vec4 AmbientColor = vec4(1.0, 1.0, 1.0, 0.9);","const vec3 Falloff = vec3(0.0, 0.1, 0.4);","uniform vec3 LightDir;","uniform vec2 mapDimensions;","uniform vec2 zoomScale;","void main(void) {","vec2 mapCords = vTextureCoord.xy;","vec4 color = texture2D(uSampler, vTextureCoord.st);","vec4 nColor = texture2D(displacementMap, vTextureCoord.st);","gl_FragColor = nColor ;","}"]},r.NormalMapFilter.prototype=Object.create(r.AbstractFilter.prototype),r.NormalMapFilter.prototype.constructor=r.NormalMapFilter,r.NormalMapFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(r.NormalMapFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(r.NormalMapFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),Object.defineProperty(r.NormalMapFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}),i.exports=r.NormalMapFilter}),define("com/pixilight/LightShader",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI");r.LightShader=function(t){r.PixiShader.call(this,t)},r.LightShader.prototype=Object.create(r.PixiShader.prototype),r.LightShader.prototype.constructor=r.LightShader,r.LightShader.prototype.init=function(){var t=this.gl;this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aRotation;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float flipY;","varying vec2 vTextureCoord;","varying float vRotation;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 finalV = aVertexPosition + offsetVector;","   gl_Position = vec4( finalV.x / projectionVector.x -1.0, (finalV.y / projectionVector.y * +flipY ) + flipY , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vRotation = aRotation;","   vColor = aColor;","}"],this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vRotation;","uniform sampler2D uSampler;","#define M_PI 3.1415926535897932384626433832795","void main(void) {","vec4 color =  texture2D(uSampler, vTextureCoord);","vec3 NormalMap = color.rgb;","vec3 N = normalize(NormalMap * 2.0 - 1.0);","float angle = vRotation;","vec2 rotatedN;","rotatedN.r = (N.r)*sin(angle) - (N.g)*cos(angle);","rotatedN.g = (N.r)*cos(angle) + (N.g)*sin(angle);","N.r = rotatedN.g;","N.g = rotatedN.r;","NormalMap = N;","   NormalMap = (NormalMap + 1.0) / 2.0;","   gl_FragColor = vec4(NormalMap * color.a, color.a);","}"];var e=r.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aRotation=t.getAttribLocation(e,"aRotation"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aRotation];for(var i in this.uniforms)this.uniforms[i].uniformLocation=t.getUniformLocation(e,i);this.initUniforms(),this.program=e},i.exports=r.LightShader}),define("com/pixilight/DiffuseShader",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI");r.DiffuseShader=function(t){r.PixiShader.call(this,t)},r.DiffuseShader.prototype=Object.create(r.PixiShader.prototype),r.DiffuseShader.prototype.constructor=r.DiffuseShader,r.DiffuseShader.prototype.init=function(){var t=this.gl;this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aRotation;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float flipY;","varying vec2 vTextureCoord;","varying float vRotation;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 finalV = aVertexPosition + offsetVector;","   gl_Position = vec4( finalV.x / projectionVector.x -1.0, (finalV.y / projectionVector.y * +flipY ) + flipY , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vRotation = aRotation;","   vColor = aColor;","}"],this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vRotation;","uniform sampler2D uSampler;","#define M_PI 3.1415926535897932384626433832795","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"];var e=r.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aRotation=t.getAttribLocation(e,"aRotation"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aRotation];for(var i in this.uniforms)this.uniforms[i].uniformLocation=t.getUniformLocation(e,i);this.initUniforms(),this.program=e},i.exports=r.DiffuseShader}),define("com/pixilight/LightSpriteBatch",["require","exports","module","PIXI","./LightShader","./DiffuseShader"],function(t,e,i){var r=t("PIXI"),o=t("./LightShader"),n=t("./DiffuseShader");r.LightSpriteBatch=function(t,e){this.diffuseTexture=t,this.normalTexture=e,this.vertSize=6,this.size=1e4;var i=4*this.size*4*this.vertSize,o=6*this.size;this.vertices=new r.ArrayBuffer(i),this.positions=new r.Float32Array(this.vertices),this.colors=new r.Uint32Array(this.vertices),this.indices=new r.Uint16Array(o),this.lastIndexCount=0;for(var n=0,s=0;o>n;n+=6,s+=4)this.indices[n+0]=s+0,this.indices[n+1]=s+1,this.indices[n+2]=s+2,this.indices[n+3]=s+0,this.indices[n+4]=s+2,this.indices[n+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new r.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},r.LightSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999,this.lightShader=new o(t),this.diffuseShader=new n(t)},r.LightSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},r.LightSpriteBatch.prototype.end=function(){this.flush()},r.LightSpriteBatch.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var i=e._uvs;if(i){var r,o,n,s,a=t.anchor.x,h=t.anchor.y;if(e.trim){var l=e.trim;o=l.x-a*l.width,r=o+e.crop.width,s=l.y-h*l.height,n=s+e.crop.height}else r=e.frame.width*(1-a),o=e.frame.width*-a,n=e.frame.height*(1-h),s=e.frame.height*-h;var u=4*this.currentBatchSize*this.vertSize,c=e.baseTexture.resolution,p=t.worldTransform,d=p.a/c,f=p.b/c,m=p.c/c,v=p.d/c,g=p.tx,y=p.ty,x=this.colors,b=this.positions,w=t.tint,_=(w>>16)+(65280&w)+((255&w)<<16)+(255*t.alpha<<24),T=Math.atan2(f,d);b[u++]=d*o+m*s+g,b[u++]=v*s+f*o+y,b[u++]=i.x0,b[u++]=i.y0,x[u++]=_,this.positions[u++]=T,b[u++]=d*r+m*s+g,b[u++]=v*s+f*r+y,b[u++]=i.x1,b[u++]=i.y1,x[u++]=_,this.positions[u++]=T,b[u++]=d*r+m*n+g,b[u++]=v*n+f*r+y,b[u++]=i.x2,b[u++]=i.y2,x[u++]=_,this.positions[u++]=T,b[u++]=d*o+m*n+g,b[u++]=v*n+f*o+y,b[u++]=i.x3,b[u++]=i.y3,x[u++]=_,this.positions[u++]=T,this.sprites[this.currentBatchSize++]=t}},r.LightSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture),t._uvs||(t._uvs=new r.TextureUvs);var i=t._uvs;t.tilePosition.x%=e.baseTexture.width*t.tileScaleOffset.x,t.tilePosition.y%=e.baseTexture.height*t.tileScaleOffset.y;var o=t.tilePosition.x/(e.baseTexture.width*t.tileScaleOffset.x),n=t.tilePosition.y/(e.baseTexture.height*t.tileScaleOffset.y),s=t.width/e.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),a=t.height/e.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);i.x0=0-o,i.y0=0-n,i.x1=1*s-o,i.y1=0-n,i.x2=1*s-o,i.y2=1*a-n,i.x3=0-o,i.y3=1*a-n;var h=t.tint,l=(h>>16)+(65280&h)+((255&h)<<16)+(255*t.alpha<<24),u=this.positions,c=this.colors,p=t.width,d=t.height,f=t.anchor.x,m=t.anchor.y,v=p*(1-f),g=p*-f,y=d*(1-m),x=d*-m,b=4*this.currentBatchSize*this.vertSize,w=e.baseTexture.resolution,_=t.worldTransform,T=_.a/w,S=_.b/w,A=_.c/w,C=_.d/w,E=_.tx,M=_.ty;u[b++]=T*g+A*x+E,u[b++]=C*x+S*g+M,u[b++]=i.x0,u[b++]=i.y0,c[b++]=l,u[b++]=T*v+A*x+E,u[b++]=C*x+S*v+M,u[b++]=i.x1,u[b++]=i.y1,c[b++]=l,u[b++]=T*v+A*y+E,u[b++]=C*y+S*v+M,u[b++]=i.x2,u[b++]=i.y2,c[b++]=l,u[b++]=T*g+A*y+E,u[b++]=C*y+S*g+M,u[b++]=i.x3,u[b++]=i.y3,c[b++]=l,this.sprites[this.currentBatchSize++]=t},r.LightSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e=this.gl;if(this.dirty){this.dirty=!1,t=this.lightShader,e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=4*this.vertSize;e.vertexAttribPointer(t.aVertexPosition,2,e.FLOAT,!1,i,0),e.vertexAttribPointer(t.aTextureCoord,2,e.FLOAT,!1,i,8),e.vertexAttribPointer(t.colorAttribute,4,e.UNSIGNED_BYTE,!0,i,16),e.vertexAttribPointer(t.aRotation,1,e.FLOAT,!1,i,20)}if(this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var r=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,r)}e.bindFramebuffer(e.FRAMEBUFFER,this.normalTexture.frameBuffer),e.clearColor(.5,.5,1,1),e.clear(e.COLOR_BUFFER_BIT),this.renderSprite(this.lightShader,!0),e.bindFramebuffer(e.FRAMEBUFFER,this.diffuseTexture.frameBuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this.renderSprite(this.diffuseShader,!1),e.bindFramebuffer(e.FRAMEBUFFER,this.renderSession.buffer),this.currentBatchSize=0}},r.LightSpriteBatch.prototype.renderSprite=function(t,e){var i,r,o,n,s=this.gl,a=0,h=0,l=null,u=this.renderSession.blendModeManager.currentBlendMode,c=t,p=!1,d=!1;this.renderSession.shaderManager.setShader(c),c.dirty&&c.syncUniforms();var f=this.renderSession.projection;s.uniform2f(c.projectionVector,f.x,f.y);var m=this.renderSession.offset;s.uniform2f(c.offsetVector,m.x,m.y),s.uniform1f(c.flipY,-1);for(var v=0,g=this.currentBatchSize;g>v;v++)n=this.sprites[v],i=e?n.normalMap.baseTexture:n.texture.baseTexture,p=u!==r,d=c!==o,l!==i&&(this.renderBatch(l,a,h),h=v,a=0,l=i),a++;this.renderBatch(l,a,h)},r.LightSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;t._dirty[r.id]?this.renderSession.renderer.updateTexture(t):(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id])),r.drawElements(r.TRIANGLES,6*e,r.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},r.LightSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},r.LightSpriteBatch.prototype.start=function(){this.dirty=!0},r.LightSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},i.exports=r.LightSpriteBatch}),define("com/pixilight/NormalMapFilter",["require","exports","module","PIXI"],function(t,e,i){var r=t("PIXI");r.NormalMapFilter=function(t){r.AbstractFilter.call(this),this.passes=[this],this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:1,y:1}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:1}},zoomScale:{type:"2f",value:{x:1,y:1}},dimensions:{type:"4fv",value:[0,0,0,0]},LightPos:{type:"3fv",value:[1,1,.1]}},t.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=t.width,this.uniforms.mapDimensions.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D displacementMap;","uniform vec4 dimensions;","const vec2 Resolution = vec2(1.0,1.0);","uniform vec3 LightPos;","const vec4 LightColor = vec4(0.9, 241.0/255.0, 224.0/255.0, 1.0);","const vec4 AmbientColor = vec4(0.9, 241.0/255.0, 224.0/255.0, 0.3);","const vec3 Falloff = vec3(0.0, 0.1, 0.4);","uniform vec3 LightDir;","uniform vec2 mapDimensions;","uniform vec2 zoomScale;","void main(void) {","vec2 mapCords = vTextureCoord.xy;","vec4 color = texture2D(uSampler, vTextureCoord.st);","vec3 nColor = texture2D(displacementMap, vTextureCoord.st).rgb;","mapCords *= dimensions.xy/mapDimensions;","vec4 DiffuseColor = texture2D(displacementMap, vTextureCoord);","vec3 NormalMap = texture2D(uSampler, vTextureCoord).rgb;","vec3 LightDir = vec3((LightPos.xy/mapDimensions) - (vTextureCoord.xy), LightPos.z);","float D = length(LightDir);","vec3 N = normalize(NormalMap * 2.0 - 1.0);","vec3 L = normalize(LightDir);","vec3 Diffuse = (LightColor.rgb * LightColor.a) * max(dot(N, L), 0.0) * 1.0;","vec3 Ambient = AmbientColor.rgb * AmbientColor.a;","float Attenuation = 0.2/D;"," Attenuation = min(Attenuation, 1.0);","vec3 Intensity = (Diffuse * Attenuation) + Ambient;","vec3 FinalColor = DiffuseColor.rgb * Intensity;","gl_FragColor = vColor * vec4(FinalColor, DiffuseColor.a);","}"]},r.NormalMapFilter.prototype=Object.create(r.AbstractFilter.prototype),r.NormalMapFilter.prototype.constructor=r.NormalMapFilter,r.NormalMapFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(r.NormalMapFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(r.NormalMapFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),Object.defineProperty(r.NormalMapFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}),i.exports=r.NormalMapFilter}),define("com/pixilight/LightContainer",["require","exports","module","PIXI","./LightSpriteBatch","./NormalMapFilter"],function(t,e,i){var r=t("PIXI"),o=t("./LightSpriteBatch"),n=t("./NormalMapFilter");r.LightContainer=function(){r.DisplayObjectContainer.call(this),this.size={width:1024,height:768},this.diffuseTexture=new r.RenderTexture(this.size.width,this.size.height),this.normalTexture=new r.RenderTexture(this.size.width,this.size.height),this.spritebatch=new o(this.diffuseTexture.textureBuffer,this.normalTexture.textureBuffer),this.sp2=new r.Sprite(this.diffuseTexture),this.sp1=new r.Sprite(this.normalTexture),this.sp1.x=2505},r.LightContainer.prototype=Object.create(r.DisplayObjectContainer.prototype),r.LightContainer.prototype.constructor=r.LightContainer,r.LightContainer.prototype._renderWebGL=function(t){this.spritebatch.gl||(this.spritebatch.setContext(t.gl),this.sp2.shader=new n(this.normalTexture)),t.shaderManager.setShader(t.shaderManager.defaultShader);var e=t.spriteBatch;e.stop();var i=[];this.collectSprites(this,i),this.spritebatch.begin(t);for(var r=0;r<i.length;r++)this.spritebatch.render(i[r]);this.spritebatch.end(),e.start()},r.LightContainer.prototype.collectSprites=function(t,e){t.anchor&&e.push(t);for(var i=0;i<t.children.length;i++)this.collectSprites(t.children[i],e)},r.LightContainer.prototype.resize=function(t,e){this.size.width=t,this.size.height=e,this.diffuseTexture.resize(t,e),this.normalTexture.resize(t,e)},i.exports=r.LightContainer}),define("com/boxy/app/BoxScreen",["require","exports","module","PIXI","./Light","./Box","./Snow","./Scores","./Fairy","com/fido/utils/FrameWait","./Background","com/awesome/BloomFilter","./Spawner","com/fido/utils/Math2","com/fido/Flash","./NormalMapFilterBg","com/fido/sound/SoundManager","com/pixilight/LightContainer"],function(t,e,i){var r=t("PIXI"),o=t("./Light"),n=t("./Box"),s=t("./Snow"),a=t("./Scores"),h=t("./Fairy"),l=t("com/fido/utils/FrameWait"),u=(t("./Background"),t("com/awesome/BloomFilter")),c=t("./Spawner"),p=t("com/fido/utils/Math2"),d=t("com/fido/Flash"),f=(t("./NormalMapFilterBg"),t("com/fido/sound/SoundManager")),m=(t("com/pixilight/LightContainer"),function(t){this.app=t,r.DisplayObjectContainer.call(this),this.container=new r.DisplayObjectContainer,this.count=0,this.p2World=new p2.World({gravity:[0,200],broadphase:new p2.SAPBroadphase}),this.p2World.solver.iterations=10,this.p2World.solver.tolerance=1e-5,this.p2World.solver.relaxation=4,this.p2World.setGlobalStiffness(1e6),this.soundCount=0,this.light=new o,this.res=1,this.counter=0,this.score=0,this.interactive=!0,this.hitArea=new r.Rectangle(0,0,1024,690),this.filterArea=new r.Rectangle(0,0,1024,690),this.defaultCursor="none",this.buttonMode=!0,this.boxs=[],this.boxes=[];var e=new n(new r.Rectangle(0,0,800,600));e.alpha=0,e.fallSpeed=0,this.container.addChild(e),this.boxes.push(e),this.target=new r.Point(512,320),this.bgTexture=r.Texture.fromImage(ASSET_URL+"img/BGTextureTest.jpg"),this.bg=new r.DisplayObjectContainer,this.realBg=r.Sprite.fromImage(ASSET_URL+"img/BGTextureTest.jpg"),this.bg.addChild(this.realBg),this.bg2=new r.Sprite.fromImage(ASSET_URL+"img/BGTextureTest.jpg"),this.darkSpot=new r.Sprite.fromImage(ASSET_URL+"img/centralDarkPatchFade.png"),this.bg2.addChild(this.darkSpot),this.darkSpot.blendMode=r.blendModes.MULTIPLY,this.darkSpot.anchor.set(.5),this.darkSpot.scale.set(2.5/1.4),this.bg3=new r.Sprite.fromImage(ASSET_URL+"img/BGTextureTest.jpg"),this.lastPoint=new r.Point,this.container.addChild(this.bg2),this.container.addChild(this.bg),this.bg.mask=this.light.view,this.boxContainer=new r.LightContainer;{var i=Math.pow(2,0);Math.pow(2,1)}this.container.addChild(this.boxContainer.sp1),this.container.addChild(this.boxContainer.sp2),this.container.addChild(this.boxContainer),this.container.addChild(this.light.view),this.snow=new s,this.container.addChild(this.snow),this.normalClear=(new r.Graphics).beginFill(8421631).drawRect(0,0,3e3,3e3),this.scores=new a,this.hitArea=new r.Rectangle(0,0,4e3,4e3),this.interactive=!0,this.glowBlob=new r.Sprite.fromImage(ASSET_URL+"img/glowBlob.png"),this.bg.addChild(this.glowBlob),this.glowBlob.scale.set(1/this.bg.scale.x),this.glowBlob.anchor.set(.5),this.glowBlob.alpha=.7,this.glowBlob.blendMode=r.blendModes.ADD,this.touchstart=function(){},this.mousemove=this.touchmove=function(t){var e=t.getLocalPosition(this.bg2);this.darkSpot.x=e.x,this.darkSpot.y=e.y,this.target.x=e.x,this.target.y=e.y}.bind(this),this.fairy=new h,this.container.addChild(this.fairy),this.fairy.p2Body.collisionGroup=i,this.p2World.addBody(this.fairy.p2Body),this.bloom=new u,this.addChild(this.bloom.outSprite),this.addChild(this.bloom.outSprite2),this.vignette=new r.Sprite.fromImage(ASSET_URL+"img/vignetteFrame.png"),this.addChild(this.vignette),this.vignette.width=1024,this.vignette.height=640,this.vignette.blendMode=r.blendModes.SCREEN,this.pushCount=0,this.p2World.on("beginContact",this.onCollision.bind(this)),this.spawner=new c(this),this.flash=new d(1024,640),this.flash.blendMode=r.blendModes.ADD,this.addChild(this.flash),f.sfx.play("twinkle"),this.bg=(new r.Graphics).beginFill(725538).drawRect(0,0,1024,640),this.addChild(this.bg)
});m.prototype=Object.create(r.DisplayObjectContainer.prototype),m.prototype.onShown=function(){l.wait(function(){TweenLite.to(this.bg,.5,{alpha:0})}.bind(this),3)},m.prototype.onCollision=function(t){this.pulling&&(this.soundCount%3===0&&f.sfx.playGroup("bump"),this.soundCount++),this.pushCount>0||(t.bodyA.owner===this.fairy||t.bodyB.owner===this.fairy)&&(this.pushBoxes(0),this.pushCount=0,this.pulling=!0)},m.prototype.pushBoxes=function(t){for(var e=1;e<this.spawner.boxes.length;e++){var i=this.spawner.boxes[e],r=i.position.x-this.fairy.position.x,o=i.position.y-this.fairy.position.y,n=Math.sqrt(r*r+o*o);r/=n,o/=n,i.p2Body.angularVelocity=3*(Math.random()-.5),i.p2Body.velocity[0]-=r*t,i.p2Body.velocity[1]-=o*t}},m.prototype.updateTransform=function(){if(this.spawner.update(),this.pulling){this.pushCount++;var t=p.map(this.pushCount,50,100,1,1.1);1>t&&(t=1),this.bloom.zoom+=.1*(t-this.bloom.zoom),this.pushCount>50&&(this.bloom.shake+=.01*(5-this.bloom.shake)),100===this.pushCount?(this.flash.flash(.1,3),this.bloom.zoom=1,this.pushBoxes(-2e3),this.pulling=!1,this.spawner.reset(),this.scores.save(this.score),this.score=0,f.sfx.play("explode")):this.pushBoxes(3*this.pushCount)}else this.bloom.shake*=.9,this.pushCount--,this.counter+=1;if(this.count++,this.darkSpot.alpha=.7+.05*(1+Math.sin(.05*this.count)/2),this.glowBlob.alpha=.7-.05*(1+Math.sin(.05*this.count)/2),this.bgTexture._uvs){this.bgTexture.frame.height=640;var e=-.004;this.bgTexture._uvs.y0+=e,this.bgTexture._uvs.y1+=e,this.bgTexture._uvs.y2+=e,this.bgTexture._uvs.y3+=e}for(var i=this.boxes.length-1;i>=0;i--){var o=this.boxes[i];o.update()}this.glowBlob.x+=.1*(this.target.x-this.glowBlob.x),this.glowBlob.y+=.1*(this.target.y-this.glowBlob.y);var n=this.glowBlob.x-this.lastPoint.x,s=this.glowBlob.y-this.lastPoint.y,a=Math.sqrt(n*n+s*s);a>10&&(a=10),f.sfx.setVolume("twinkle",.2+a/10*.8),this.lastPoint.x=this.glowBlob.x,this.lastPoint.y=this.glowBlob.y,this.fairy.update(this.glowBlob.position),this.p2World.step(1/60),this.light.light.x=this.fairy.position.x,this.light.light.y=this.fairy.position.y,r.DisplayObjectContainer.prototype.updateTransform.call(this),this.light.update(this.spawner.boxes),this.boxContainer.sp2.shader&&(this.boxContainer.sp2.shader.uniforms.LightPos.value[0]=this.light.light.x/this.res,this.boxContainer.sp2.shader.uniforms.LightPos.value[1]=this.light.light.y/this.res),this.snow.update(),this.counter>1&&(this.counter=0,this.score+=10,this.scores.update(this.score)),this.bloom.apply(this.container)},m.prototype.onShow=function(){var t=new r.PixelateFilter;t.size.x=t.size.y=4},m.prototype.resize=function(t,e){var i=this.res;this.scale.set(i),t/=i,e/=i,this.w=t,this.h=e,this.filterArea.width=t,this.filterArea.height=e,this.boxContainer.resize(t,e),this.spawner.resize(t,e)},i.exports=m}),define("APP_root",["require","exports","module","PIXI","com/fido/app/App","com/fido/system/Ticker","com/fido/system/Device","com/fido/sound/SoundManager","com/boxy/app/LoaderScreen","com/boxy/app/BoxScreen"],function(t,e,i){var r=t("PIXI");window.PIXI=r;var o=t("com/fido/app/App"),n=(t("com/fido/system/Ticker"),t("com/fido/system/Device")),s=t("com/fido/sound/SoundManager"),a=t("com/boxy/app/LoaderScreen"),h=t("com/boxy/app/BoxScreen"),l=function(){var t={loaderScreen:a};if(o.call(this,t),this.loader.addPixiAssets([ASSET_URL+"img/game/leaderboard.json",ASSET_URL+"img/presentColours.json",ASSET_URL+"img/presentNormals.json",ASSET_URL+"img/snowFlakes.json",ASSET_URL+"img/displace.jpg",ASSET_URL+"img/vignetteFrame.png",ASSET_URL+"img/glowBlob.png",ASSET_URL+"img/BGTextureTest.jpg",ASSET_URL+"img/centralDarkPatchFade.png",ASSET_URL+"img/glowBlob.png",ASSET_URL+"img/vignetteFrame.png",ASSET_URL+"img/sprite/spriteSeq.json"]),this.loader.addCSS(ASSET_URL+"css/fonts.css"),s.sfx.addSound(ASSET_URL+"snd/clusterGroup","cluster"),s.sfx.addSound(ASSET_URL+"snd/magicSplode","explode"),s.sfx.addSound(ASSET_URL+"snd/boxBump1","boxBump1"),s.sfx.addSound(ASSET_URL+"snd/boxBump2","boxBump2"),s.sfx.addSound(ASSET_URL+"snd/boxBump3","boxBump3"),s.sfx.addSound(ASSET_URL+"snd/boxBump4","boxBump4"),s.sfx.addSound(ASSET_URL+"snd/boxBump5","boxBump5"),s.sfx.addSound(ASSET_URL+"snd/boxBump6","boxBump6"),s.sfx.addGroup(["boxBump1","boxBump2","boxBump3","boxBump4","boxBump5","boxBump6"],"bump"),s.sfx.addSound(ASSET_URL+"snd/magicTwinkle","twinkle",{autoplay:!1,loop:!0,volume:0}),this.onReady.add(this.onAppReady,this),this.startup(),n.instance.isMobile){var e=document.createElement("meta");e.id="viewport",e.name="viewport",e.content="width=320; initial-scale=0.5; maximum-scale=0.5; user-scalable=0;",document.getElementsByTagName("head")[0].appendChild(e)}};l.prototype=Object.create(o.prototype),l.prototype.onAppReady=function(){this.boxy=new h(this),this.screenManager.addScreen(this.boxy,"boxy"),this.screenManager.gotoScreenByID("boxy");var t=new r.Texture.fromImage(ASSET_URL+"img/displace.jpg"),e=new r.DisplacementFilter(t);e.scale=new r.Point(50),this.stage.filters=[e],this.resize(window.innerWidth,window.innerHeight)},l.prototype.resize=function(t,e){var i=t/1024,r=e/640,o=Math.max(i,r);this.view.style.width=1024*o+"px",this.view.style.height=640*o+"px",this.view.style.width.left=t/2-1024*o/2+"px",this.view.style.width.top=e/2-640*o/2+"px",t=1024,e=640,this.w=t,this.h=e,this.screenManager.resize(t,e),this.renderer.resize(t,e)},i.exports=l});var Stats=function(){var t=Date.now(),e=t,i=0,r=1/0,o=0,n=0,s=1/0,a=0,h=0,l=0,u=document.createElement("div");u.id="stats",u.addEventListener("mousedown",function(t){t.preventDefault(),y(++l%2)},!1),u.style.cssText="width:80px;opacity:0.9;cursor:pointer";var c=document.createElement("div");c.id="fps",c.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",u.appendChild(c);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",p.innerHTML="FPS",c.appendChild(p);var d=document.createElement("div");for(d.id="fpsGraph",d.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",c.appendChild(d);74>d.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",d.appendChild(f)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",u.appendChild(m);var v=document.createElement("div");v.id="msText",v.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",v.innerHTML="MS",m.appendChild(v);var g=document.createElement("div");for(g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(g);74>g.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(f);var y=function(t){switch(l=t){case 0:c.style.display="block",m.style.display="none";break;case 1:c.style.display="none",m.style.display="block"}};return{REVISION:11,domElement:u,setMode:y,begin:function(){t=Date.now()},end:function(){var l=Date.now();i=l-t,r=Math.min(r,i),o=Math.max(o,i),v.textContent=i+" MS ("+r+"-"+o+")";var u=Math.min(30,30-30*(i/200));return g.appendChild(g.firstChild).style.height=u+"px",h++,l>e+1e3&&(n=Math.round(1e3*h/(l-e)),s=Math.min(s,n),a=Math.max(a,n),p.textContent=n+" FPS ("+s+"-"+a+")",u=Math.min(30,30-30*(n/100)),d.appendChild(d.firstChild).style.height=u+"px",e=l,h=0),l},update:function(){t=this.end()}}};define("stats",function(){}),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define("libs/p2",t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}}(function(){return function t(e,i,r){function o(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(n)return n(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return o(i?i:t)},l,l.exports,t,e,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,i){if(!r)var r=1e-6;if(!o)var o="undefined"!=typeof Float32Array?Float32Array:Array;var n={};n.setMatrixArrayType=function(t){o=t},"undefined"!=typeof i&&(i.glMatrix=n);var s={};s.create=function(){var t=new o(2);return t[0]=0,t[1]=0,t},s.clone=function(t){var e=new o(2);return e[0]=t[0],e[1]=t[1],e},s.fromValues=function(t,e){var i=new o(2);return i[0]=t,i[1]=e,i},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},s.set=function(t,e,i){return t[0]=e,t[1]=i,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},s.div=s.divide,s.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},s.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},s.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.normalize=function(t,e){var i=e[0],r=e[1],o=i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},s.lerp=function(t,e,i,r){var o=e[0],n=e[1];return t[0]=o+r*(i[0]-o),t[1]=n+r*(i[1]-n),t},s.transformMat2=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o,t[1]=i[1]*r+i[3]*o,t},s.transformMat2d=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o+i[4],t[1]=i[1]*r+i[3]*o+i[5],t},s.transformMat3=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[3]*o+i[6],t[1]=i[1]*r+i[4]*o+i[7],t},s.transformMat4=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[4]*o+i[12],t[1]=i[1]*r+i[5]*o+i[13],t},s.forEach=function(){var t=s.create();return function(e,i,r,o,n,s){var a,h;for(i||(i=2),r||(r=0),h=o?Math.min(o*i+r,e.length):e.length,a=r;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],n(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}(),s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof i&&(i.vec2=s)},{}],2:[function(t,e){function i(){}var r=t("./Scalar");e.exports=i,i.lineInt=function(t,e,i){i=i||0;var o,n,s,a,h,l,u,c=[0,0];return o=t[1][1]-t[0][1],n=t[0][0]-t[1][0],s=o*t[0][0]+n*t[0][1],a=e[1][1]-e[0][1],h=e[0][0]-e[1][0],l=a*e[0][0]+h*e[0][1],u=o*h-a*n,r.eq(u,0,i)||(c[0]=(h*s-n*l)/u,c[1]=(o*l-a*s)/u),c},i.segmentsIntersect=function(t,e,i,r){var o=e[0]-t[0],n=e[1]-t[1],s=r[0]-i[0],a=r[1]-i[1];if(s*n-a*o==0)return!1;var h=(o*(i[1]-t[1])+n*(t[0]-i[0]))/(s*n-a*o),l=(s*(t[1]-i[1])+a*(i[0]-t[0]))/(a*o-s*n);return h>=0&&1>=h&&l>=0&&1>=l}},{"./Scalar":5}],3:[function(t,e){function i(){}e.exports=i,i.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},i.left=function(t,e,r){return i.area(t,e,r)>0},i.leftOn=function(t,e,r){return i.area(t,e,r)>=0},i.right=function(t,e,r){return i.area(t,e,r)<0},i.rightOn=function(t,e,r){return i.area(t,e,r)<=0};var r=[],o=[];i.collinear=function(t,e,n,s){if(s){var a=r,h=o;a[0]=e[0]-t[0],a[1]=e[1]-t[1],h[0]=n[0]-e[0],h[1]=n[1]-e[1];var l=a[0]*h[0]+a[1]*h[1],u=Math.sqrt(a[0]*a[0]+a[1]*a[1]),c=Math.sqrt(h[0]*h[0]+h[1]*h[1]),p=Math.acos(l/(u*c));return s>p}return 0==i.area(t,e,n)},i.sqdist=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}},{}],4:[function(t,e){function i(){this.vertices=[]}function r(t,e,i,r,o){o=o||0;var n=e[1]-t[1],a=t[0]-e[0],h=n*t[0]+a*t[1],l=r[1]-i[1],u=i[0]-r[0],c=l*i[0]+u*i[1],p=n*u-l*a;return s.eq(p,0,o)?[0,0]:[(u*h-a*c)/p,(n*c-l*h)/p]}var o=t("./Line"),n=t("./Point"),s=t("./Scalar");e.exports=i,i.prototype.at=function(t){var e=this.vertices,i=e.length;return e[0>t?t%i+i:t%i]},i.prototype.first=function(){return this.vertices[0]},i.prototype.last=function(){return this.vertices[this.vertices.length-1]},i.prototype.clear=function(){this.vertices.length=0},i.prototype.append=function(t,e,i){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof i)throw new Error("To is not given!");if(e>i-1)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var r=e;i>r;r++)this.vertices.push(t.vertices[r])},i.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);n.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},i.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},i.prototype.isReflex=function(t){return n.right(this.at(t-1),this.at(t),this.at(t+1))};var a=[],h=[];i.prototype.canSee=function(t,e){var i,r,s=a,l=h;if(n.leftOn(this.at(t+1),this.at(t),this.at(e))&&n.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;r=n.sqdist(this.at(t),this.at(e));for(var u=0;u!==this.vertices.length;++u)if((u+1)%this.vertices.length!==t&&u!==t&&n.leftOn(this.at(t),this.at(e),this.at(u+1))&&n.rightOn(this.at(t),this.at(e),this.at(u))&&(s[0]=this.at(t),s[1]=this.at(e),l[0]=this.at(u),l[1]=this.at(u+1),i=o.lineInt(s,l),n.sqdist(this.at(t),i)<r))return!1;return!0},i.prototype.copy=function(t,e,r){var o=r||new i;if(o.clear(),e>t)for(var n=t;e>=n;n++)o.vertices.push(this.vertices[n]);else{for(var n=0;e>=n;n++)o.vertices.push(this.vertices[n]);for(var n=t;n<this.vertices.length;n++)o.vertices.push(this.vertices[n])}return o},i.prototype.getCutEdges=function(){for(var t=[],e=[],r=[],o=new i,n=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var a=0;a<this.vertices.length;++a)if(this.canSee(s,a)){e=this.copy(s,a,o).getCutEdges(),r=this.copy(a,s,o).getCutEdges();for(var h=0;h<r.length;h++)e.push(r[h]);e.length<n&&(t=e,n=e.length,t.push([this.at(s),this.at(a)]))}return t},i.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},i.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var r=t[i],o=0;o<e.length;o++){var n=e[o],s=n.slice(r);if(s){e.splice(o,1),e.push(s[0],s[1]);break}}return e}var r=t,i=this.vertices.indexOf(r[0]),o=this.vertices.indexOf(r[1]);return-1!=i&&-1!=o?[this.copy(i,o),this.copy(o,i)]:!1},i.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;e-1>i;i++)if(o.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(var e=1;e<t.length-2;e++)if(o.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},i.prototype.quickDecomp=function(t,e,o,s,a,h){a=a||100,h=h||0,s=s||25,t="undefined"!=typeof t?t:[],e=e||[],o=o||[];var l=[0,0],u=[0,0],c=[0,0],p=0,d=0,f=0,m=0,v=0,g=0,y=0,x=new i,b=new i,w=this,_=this.vertices;if(_.length<3)return t;if(h++,h>a)return t;for(var T=0;T<this.vertices.length;++T)if(w.isReflex(T)){e.push(w.vertices[T]),p=d=Number.MAX_VALUE;for(var S=0;S<this.vertices.length;++S)n.left(w.at(T-1),w.at(T),w.at(S))&&n.rightOn(w.at(T-1),w.at(T),w.at(S-1))&&(c=r(w.at(T-1),w.at(T),w.at(S),w.at(S-1)),n.right(w.at(T+1),w.at(T),c)&&(f=n.sqdist(w.vertices[T],c),d>f&&(d=f,u=c,g=S))),n.left(w.at(T+1),w.at(T),w.at(S+1))&&n.rightOn(w.at(T+1),w.at(T),w.at(S))&&(c=r(w.at(T+1),w.at(T),w.at(S),w.at(S+1)),n.left(w.at(T-1),w.at(T),c)&&(f=n.sqdist(w.vertices[T],c),p>f&&(p=f,l=c,v=S)));if(g==(v+1)%this.vertices.length)c[0]=(u[0]+l[0])/2,c[1]=(u[1]+l[1])/2,o.push(c),v>T?(x.append(w,T,v+1),x.vertices.push(c),b.vertices.push(c),0!=g&&b.append(w,g,w.vertices.length),b.append(w,0,T+1)):(0!=T&&x.append(w,T,w.vertices.length),x.append(w,0,v+1),x.vertices.push(c),b.vertices.push(c),b.append(w,g,T+1));else{if(g>v&&(v+=this.vertices.length),m=Number.MAX_VALUE,g>v)return t;for(var S=g;v>=S;++S)n.leftOn(w.at(T-1),w.at(T),w.at(S))&&n.rightOn(w.at(T+1),w.at(T),w.at(S))&&(f=n.sqdist(w.at(T),w.at(S)),m>f&&(m=f,y=S%this.vertices.length));y>T?(x.append(w,T,y+1),0!=y&&b.append(w,y,_.length),b.append(w,0,T+1)):(0!=T&&x.append(w,T,_.length),x.append(w,0,y+1),b.append(w,y,T+1))}return x.vertices.length<b.vertices.length?(x.quickDecomp(t,e,o,s,a,h),b.quickDecomp(t,e,o,s,a,h)):(b.quickDecomp(t,e,o,s,a,h),x.quickDecomp(t,e,o,s,a,h)),t}return t.push(this),t},i.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)n.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":2,"./Point":3,"./Scalar":5}],5:[function(t,e){function i(){}e.exports=i,i.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],6:[function(t,e){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":3,"./Polygon":4}],7:[function(t,e){e.exports={name:"p2",version:"0.5.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-browserify":"~2.0.1","z-schema":"~2.4.6"},dependencies:{"poly-decomp":"git://github.com/schteppe/poly-decomp.js","gl-matrix":"2.1.0"}}},{}],8:[function(t,e){function i(t){this.lowerBound=r.create(),t&&t.lowerBound&&r.copy(this.lowerBound,t.lowerBound),this.upperBound=r.create(),t&&t.upperBound&&r.copy(this.upperBound,t.upperBound)}{var r=t("../math/vec2");t("../utils/Utils")}e.exports=i;var o=r.create();i.prototype.setFromPoints=function(t,e,i){var n=this.lowerBound,s=this.upperBound;r.set(n,Number.MAX_VALUE,Number.MAX_VALUE),r.set(s,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=0;a<t.length;a++){var h=t[a];"number"==typeof i&&(r.rotate(o,h,i),h=o);for(var l=0;2>l;l++)h[l]>s[l]&&(s[l]=h[l]),h[l]<n[l]&&(n[l]=h[l])}e&&(r.add(this.lowerBound,this.lowerBound,e),r.add(this.upperBound,this.upperBound,e))},i.prototype.copy=function(t){r.copy(this.lowerBound,t.lowerBound),r.copy(this.upperBound,t.upperBound)},i.prototype.extend=function(t){for(var e=0;2>e;e++)t.lowerBound[e]<this.lowerBound[e]&&(this.lowerBound[e]=t.lowerBound[e]),t.upperBound[e]>this.upperBound[e]&&(this.upperBound[e]=t.upperBound[e])},i.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,r=t.lowerBound,o=t.upperBound;return(r[0]<=i[0]&&i[0]<=o[0]||e[0]<=o[0]&&o[0]<=i[0])&&(r[1]<=i[1]&&i[1]<=o[1]||e[1]<=o[1]&&o[1]<=i[1])}},{"../math/vec2":30,"../utils/Utils":45}],9:[function(t,e){function i(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=i.AABB}var r=t("../math/vec2"),o=t("../objects/Body");e.exports=i,i.AABB=1,i.BOUNDING_CIRCLE=2,i.prototype.setWorld=function(t){this.world=t},i.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")};var n=r.create();i.boundingRadiusCheck=function(t,e){r.sub(n,t.position,e.position);var i=r.squaredLength(n),o=t.boundingRadius+e.boundingRadius;return o*o>=i},i.aabbCheck=function(t,e){return t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)},i.prototype.boundingVolumeCheck=function(t,e){var r;switch(this.boundingVolumeType){case i.BOUNDING_CIRCLE:r=i.boundingRadiusCheck(t,e);break;case i.AABB:r=i.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return r},i.canCollide=function(t,e){return t.motionState===o.STATIC&&e.motionState===o.STATIC?!1:t.motionState===o.KINEMATIC&&e.motionState===o.STATIC||t.motionState===o.STATIC&&e.motionState===o.KINEMATIC?!1:t.motionState===o.KINEMATIC&&e.motionState===o.KINEMATIC?!1:t.sleepState===o.SLEEPING&&e.sleepState===o.SLEEPING?!1:t.sleepState===o.SLEEPING&&e.motionState===o.STATIC||e.sleepState===o.SLEEPING&&t.motionState===o.STATIC?!1:!0},i.NAIVE=1,i.SAP=2},{"../math/vec2":30,"../objects/Body":31}],10:[function(t,e){function i(t){t=t||{},r.apply(this),o.extend(t,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10}),this.xmin=t.xmin,this.ymin=t.ymin,this.xmax=t.xmax,this.ymax=t.ymax,this.nx=t.nx,this.ny=t.ny,this.binsizeX=(this.xmax-this.xmin)/this.nx,this.binsizeY=(this.ymax-this.ymin)/this.ny}var r=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Particle"),t("../collision/Broadphase")),o=(t("../math/vec2"),t("../utils/Utils"));e.exports=i,i.prototype=new r,i.prototype.getCollisionPairs=function(t){for(var e=[],i=t.bodies,o=i.length,n=(this.binsizeX,this.binsizeY,this.nx),s=this.ny,a=this.xmin,h=this.ymin,l=this.xmax,u=this.ymax,c=[],p=n*s,d=0;p>d;d++)c.push([]);for(var f=n/(l-a),m=s/(u-h),d=0;d!==o;d++)for(var v=i[d],g=v.aabb,y=Math.max(g.lowerBound[0],a),x=Math.max(g.lowerBound[1],h),b=Math.min(g.upperBound[0],l),w=Math.min(g.upperBound[1],u),_=Math.floor(f*(y-a)),T=Math.floor(m*(x-h)),S=Math.floor(f*(b-a)),A=Math.floor(m*(w-h)),C=_;S>=C;C++)for(var E=T;A>=E;E++){var M=C,B=E,L=M*(s-1)+B;L>=0&&p>L&&c[L].push(v)}for(var d=0;d!==p;d++)for(var P=c[d],C=0,R=P.length;C!==R;C++)for(var v=P[C],E=0;E!==C;E++){var F=P[E];r.canCollide(v,F)&&this.boundingVolumeCheck(v,F)&&e.push(v,F)}return e}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../utils/Utils":45}],11:[function(t,e){function i(){r.call(this,r.NAIVE)}{var r=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2")}e.exports=i,i.prototype=new r,i.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var o=0,n=e.length;o!==n;o++)for(var s=e[o],a=0;o>a;a++){var h=e[a];r.canCollide(s,h)&&this.boundingVolumeCheck(s,h)&&i.push(s,h)}return i}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Shape":42}],12:[function(t,e){function i(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[],this.restitution=0,this.stiffness=1e7,this.relaxation=3,this.frictionStiffness=1e7,this.frictionRelaxation=3,this.collidingBodiesLastStep={keys:[]}}function r(t){for(var e=0,i=t.keys.length;i>e;e++)delete t[t.keys[e]];t.keys.length=0}function o(t,e){s.set(t.vertices[0],.5*-e.length,-e.radius),s.set(t.vertices[1],.5*e.length,-e.radius),s.set(t.vertices[2],.5*e.length,e.radius),s.set(t.vertices[3],.5*-e.length,e.radius)}function n(t,e,i,r){for(var o=q,n=V,l=j,u=X,c=t,p=e.vertices,d=null,f=0;f!==p.length+1;f++){var m=p[f%p.length],v=p[(f+1)%p.length];s.rotate(o,m,r),s.rotate(n,v,r),h(o,o,i),h(n,n,i),a(l,o,c),a(u,n,c);var g=s.crossLength(l,u);if(null===d&&(d=g),0>=g*d)return!1;d=g}return!0}var s=t("../math/vec2"),a=s.sub,h=s.add,l=s.dot,u=t("../utils/Utils"),c=t("../equations/ContactEquation"),p=t("../equations/FrictionEquation"),d=t("../shapes/Circle"),f=t("../shapes/Shape"),m=(t("../objects/Body"),t("../shapes/Rectangle"));e.exports=i;var v=s.fromValues(0,1),g=s.fromValues(0,0),y=s.fromValues(0,0),x=s.fromValues(0,0),b=s.fromValues(0,0),w=s.fromValues(0,0),_=s.fromValues(0,0),T=s.fromValues(0,0),S=s.fromValues(0,0),A=s.fromValues(0,0),C=s.fromValues(0,0),E=s.fromValues(0,0),M=s.fromValues(0,0),B=s.fromValues(0,0),L=s.fromValues(0,0),P=s.fromValues(0,0),R=s.fromValues(0,0),F=s.fromValues(0,0),I=s.fromValues(0,0),O=[];i.prototype.collidedLastStep=function(t,e){var i=t.id,r=e.id;if(i>r){var o=i;i=r,r=o}return!!this.collidingBodiesLastStep[i+" "+r]},i.prototype.reset=function(){r(this.collidingBodiesLastStep);for(var t=0;t!==this.contactEquations.length;t++){var e=this.contactEquations[t],i=e.bodyA.id,o=e.bodyB.id;if(i>o){var n=i;i=o,o=n}var s=i+" "+o;this.collidingBodiesLastStep[s]||(this.collidingBodiesLastStep[s]=!0,this.collidingBodiesLastStep.keys.push(s))}if(this.reuseObjects){var a=this.contactEquations,h=this.frictionEquations,l=this.reusableFrictionEquations,c=this.reusableContactEquations;u.appendArray(c,a),u.appendArray(l,h)}this.contactEquations.length=this.frictionEquations.length=0},i.prototype.createContactEquation=function(t,e,i,r){var o=this.reusableContactEquations.length?this.reusableContactEquations.pop():new c(t,e);return o.bodyA=t,o.bodyB=e,o.shapeA=i,o.shapeB=r,o.restitution=this.restitution,o.firstImpact=!this.collidedLastStep(t,e),o.stiffness=this.stiffness,o.relaxation=this.relaxation,o.needsUpdate=!0,o.enabled=!0,o},i.prototype.createFrictionEquation=function(t,e,i,r){var o=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new p(t,e);return o.bodyA=t,o.bodyB=e,o.shapeA=i,o.shapeB=r,o.setSlipForce(this.slipForce),o.frictionCoefficient=this.frictionCoefficient,o.relativeVelocity=this.surfaceVelocity,o.enabled=!0,o.needsUpdate=!0,o.stiffness=this.frictionStiffness,o.relaxation=this.frictionRelaxation,o},i.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return s.copy(e.contactPointA,t.contactPointA),s.copy(e.contactPointB,t.contactPointB),s.rotate(e.t,t.normalA,-Math.PI/2),e.contactEquation=t,e},i.prototype[f.LINE|f.CONVEX]=i.prototype.convexLine=function(t,e,i,r,o,n,s,a,h){return h?!1:0},i.prototype[f.LINE|f.RECTANGLE]=i.prototype.lineRectangle=function(t,e,i,r,o,n,s,a,h){return h?!1:0};var D=new m(1,1),k=s.create();i.prototype[f.CAPSULE|f.CONVEX]=i.prototype[f.CAPSULE|f.RECTANGLE]=i.prototype.convexCapsule=function(t,e,i,r,n,a,h,l,u){var c=k;s.set(c,a.length/2,0),s.rotate(c,c,l),s.add(c,c,h);var p=this.circleConvex(n,a,c,l,t,e,i,r,u,a.radius);s.set(c,-a.length/2,0),s.rotate(c,c,l),s.add(c,c,h);var d=this.circleConvex(n,a,c,l,t,e,i,r,u,a.radius);if(u&&(p||d))return!0;var f=D;o(f,a);var m=this.convexConvex(t,e,i,r,n,f,h,l,u);return m+p+d},i.prototype[f.CAPSULE|f.LINE]=i.prototype.lineCapsule=function(t,e,i,r,o,n,s,a,h){return h?!1:0};var N=s.create(),U=s.create(),G=new m(1,1);i.prototype[f.CAPSULE|f.CAPSULE]=i.prototype.capsuleCapsule=function(t,e,i,r,n,a,h,l,u){for(var c=N,p=U,d=0,f=0;2>f;f++){s.set(c,(0==f?-1:1)*e.length/2,0),s.rotate(c,c,r),s.add(c,c,i);for(var m=0;2>m;m++){s.set(p,(0==m?-1:1)*a.length/2,0),s.rotate(p,p,l),s.add(p,p,h);var v=this.circleCircle(t,e,c,r,n,a,p,l,u,e.radius,a.radius);if(u&&v)return!0;d+=v}}var g=G;o(g,e);var y=this.convexCapsule(t,g,i,r,n,a,h,l,u);if(u&&y)return!0;d+=y,o(g,a);var x=this.convexCapsule(n,g,h,l,t,e,i,r,u);return u&&x?!0:d+=x},i.prototype[f.LINE|f.LINE]=i.prototype.lineLine=function(t,e,i,r,o,n,s,a,h){return h?!1:0},i.prototype[f.PLANE|f.LINE]=i.prototype.planeLine=function(t,e,i,r,o,n,u,c,p){var d=g,f=y,m=x,C=b,E=w,M=_,B=T,L=S,P=A,R=O;numContacts=0,s.set(d,-n.length/2,0),s.set(f,n.length/2,0),s.rotate(m,d,c),s.rotate(C,f,c),h(m,m,u),h(C,C,u),s.copy(d,m),s.copy(f,C),a(E,f,d),s.normalize(M,E),s.rotate(P,M,-Math.PI/2),s.rotate(L,v,r),R[0]=d,R[1]=f;for(var F=0;F<R.length;F++){var I=R[F];a(B,I,i);var D=l(B,L);if(0>D){if(p)return!0;var k=this.createContactEquation(t,o,e,n);numContacts++,s.copy(k.normalA,L),s.normalize(k.normalA,k.normalA),s.scale(B,L,D),a(k.contactPointA,I,B),a(k.contactPointA,k.contactPointA,t.position),a(k.contactPointB,I,u),h(k.contactPointB,k.contactPointB,u),a(k.contactPointB,k.contactPointB,o.position),this.contactEquations.push(k),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(k))}}return numContacts},i.prototype[f.PARTICLE|f.CAPSULE]=i.prototype.particleCapsule=function(t,e,i,r,o,n,s,a,h){return this.circleLine(t,e,i,r,o,n,s,a,h,n.radius,0)},i.prototype[f.CIRCLE|f.LINE]=i.prototype.circleLine=function(t,e,i,r,o,n,u,c,p,d,f){var m=n,v=c,P=o,R=u,F=i,I=t,D=e,d=d||0,f="undefined"!=typeof f?f:D.radius,k=g,N=y,U=x,G=b,q=w,V=_,j=T,X=S,W=A,Y=C,z=E,H=M,K=B,J=L,Z=O;s.set(X,-m.length/2,0),s.set(W,m.length/2,0),s.rotate(Y,X,v),s.rotate(z,W,v),h(Y,Y,R),h(z,z,R),s.copy(X,Y),s.copy(W,z),a(V,W,X),s.normalize(j,V),s.rotate(q,j,-Math.PI/2),a(H,F,X);var $=l(H,q);if(a(G,X,R),a(K,F,R),Math.abs($)<f+d){s.scale(k,q,$),a(U,F,k),s.scale(N,q,l(q,K)),s.normalize(N,N),s.scale(N,N,d),h(U,U,N);var Q=l(j,U),te=l(j,X),ee=l(j,W);if(Q>te&&ee>Q){if(p)return!0;var ie=this.createContactEquation(I,P,e,n);return s.scale(ie.normalA,k,-1),s.normalize(ie.normalA,ie.normalA),s.scale(ie.contactPointA,ie.normalA,f),h(ie.contactPointA,ie.contactPointA,F),a(ie.contactPointA,ie.contactPointA,I.position),a(ie.contactPointB,U,R),h(ie.contactPointB,ie.contactPointB,R),a(ie.contactPointB,ie.contactPointB,P.position),this.contactEquations.push(ie),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ie)),1}}Z[0]=X,Z[1]=W;for(var re=0;re<Z.length;re++){var oe=Z[re];if(a(H,oe,F),s.squaredLength(H)<(f+d)*(f+d)){if(p)return!0;var ie=this.createContactEquation(I,P,e,n);return s.copy(ie.normalA,H),s.normalize(ie.normalA,ie.normalA),s.scale(ie.contactPointA,ie.normalA,f),h(ie.contactPointA,ie.contactPointA,F),a(ie.contactPointA,ie.contactPointA,I.position),a(ie.contactPointB,oe,R),s.scale(J,ie.normalA,-d),h(ie.contactPointB,ie.contactPointB,J),h(ie.contactPointB,ie.contactPointB,R),a(ie.contactPointB,ie.contactPointB,P.position),this.contactEquations.push(ie),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ie)),1}}return 0},i.prototype[f.CIRCLE|f.CAPSULE]=i.prototype.circleCapsule=function(t,e,i,r,o,n,s,a,h){return this.circleLine(t,e,i,r,o,n,s,a,h,n.radius)},i.prototype[f.CIRCLE|f.CONVEX]=i.prototype[f.CIRCLE|f.RECTANGLE]=i.prototype.circleConvex=function(t,e,i,r,o,l,u,c,p,d){var f=l,m=c,v=o,_=u,T=i,S=t,A=e,d="number"==typeof d?d:A.radius,M=g,F=y,I=x,O=b,D=w,k=C,N=E,U=B,G=L,q=P,V=R,j=!1,X=Number.MAX_VALUE;verts=f.vertices;for(var W=0;W!==verts.length+1;W++){var Y=verts[W%verts.length],z=verts[(W+1)%verts.length];if(s.rotate(M,Y,m),s.rotate(F,z,m),h(M,M,_),h(F,F,_),a(I,F,M),s.normalize(O,I),s.rotate(D,O,-Math.PI/2),s.scale(G,D,-A.radius),h(G,G,T),n(G,f,_,m)){s.sub(q,M,G);var H=Math.abs(s.dot(q,D));X>H&&(s.copy(V,G),X=H,s.scale(U,D,H),s.add(U,U,G),j=!0)}}if(j){if(p)return!0;var K=this.createContactEquation(S,v,e,l);return s.sub(K.normalA,V,T),s.normalize(K.normalA,K.normalA),s.scale(K.contactPointA,K.normalA,d),h(K.contactPointA,K.contactPointA,T),a(K.contactPointA,K.contactPointA,S.position),a(K.contactPointB,U,_),h(K.contactPointB,K.contactPointB,_),a(K.contactPointB,K.contactPointB,v.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}if(d>0)for(var W=0;W<verts.length;W++){var J=verts[W];if(s.rotate(N,J,m),h(N,N,_),a(k,N,T),s.squaredLength(k)<d*d){if(p)return!0;var K=this.createContactEquation(S,v,e,l);return s.copy(K.normalA,k),s.normalize(K.normalA,K.normalA),s.scale(K.contactPointA,K.normalA,d),h(K.contactPointA,K.contactPointA,T),a(K.contactPointA,K.contactPointA,S.position),a(K.contactPointB,N,_),h(K.contactPointB,K.contactPointB,_),a(K.contactPointB,K.contactPointB,v.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}}return 0};var q=s.create(),V=s.create(),j=s.create(),X=s.create();i.prototype[f.PARTICLE|f.CONVEX]=i.prototype[f.PARTICLE|f.RECTANGLE]=i.prototype.particleConvex=function(t,e,i,r,o,u,c,p,d){var f=u,m=p,v=o,S=c,A=i,E=t,M=g,L=y,P=x,R=b,O=w,D=_,k=T,N=C,U=B,G=F,q=I,V=Number.MAX_VALUE,j=!1,X=f.vertices;
if(!n(A,f,S,m))return 0;if(d)return!0;for(var W=0;W!==X.length+1;W++){var Y=X[W%X.length],z=X[(W+1)%X.length];s.rotate(M,Y,m),s.rotate(L,z,m),h(M,M,S),h(L,L,S),a(P,L,M),s.normalize(R,P),s.rotate(O,R,-Math.PI/2),a(N,A,M);{l(N,O)}a(D,M,S),a(k,A,S),s.sub(G,M,A);var H=Math.abs(s.dot(G,O));V>H&&(V=H,s.scale(U,O,H),s.add(U,U,A),s.copy(q,O),j=!0)}if(j){var K=this.createContactEquation(E,v,e,u);return s.scale(K.normalA,q,-1),s.normalize(K.normalA,K.normalA),s.set(K.contactPointA,0,0),h(K.contactPointA,K.contactPointA,A),a(K.contactPointA,K.contactPointA,E.position),a(K.contactPointB,U,S),h(K.contactPointB,K.contactPointB,S),a(K.contactPointB,K.contactPointB,v.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}return 0},i.prototype[f.CIRCLE]=i.prototype.circleCircle=function(t,e,i,r,o,n,l,u,c,p,d){var f=t,m=e,v=i,y=o,x=n,b=l,w=g,p=p||m.radius,d=d||x.radius;a(w,i,l);var _=p+d;if(s.squaredLength(w)>_*_)return 0;if(c)return!0;var T=this.createContactEquation(f,y,e,n);return a(T.normalA,b,v),s.normalize(T.normalA,T.normalA),s.scale(T.contactPointA,T.normalA,p),s.scale(T.contactPointB,T.normalA,-d),h(T.contactPointA,T.contactPointA,v),a(T.contactPointA,T.contactPointA,f.position),h(T.contactPointB,T.contactPointB,b),a(T.contactPointB,T.contactPointB,y.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T)),1},i.prototype[f.PLANE|f.CONVEX]=i.prototype[f.PLANE|f.RECTANGLE]=i.prototype.planeConvex=function(t,e,r,o,n,u,c,p,d){var f=n,m=c,b=u,w=p,_=t,T=e,S=r,A=o,C=g,E=y,M=x,B=0;s.rotate(E,v,A);for(var L=0;L<b.vertices.length;L++){var P=b.vertices[L];if(s.rotate(C,P,w),h(C,C,m),a(M,C,S),l(M,E)<=i.convexPrecision){if(d)return!0;B++;var R=this.createContactEquation(_,f,T,b);a(M,C,S),s.copy(R.normalA,E);var F=l(M,R.normalA);s.scale(M,R.normalA,F),a(R.contactPointB,C,f.position),a(R.contactPointA,C,M),a(R.contactPointA,R.contactPointA,_.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R))}}return B},i.prototype.convexPlane=function(t,e,i,r,o,n,s,a,h){return this.planeConvex(o,n,s,a,t,e,i,r,h)},i.prototype[f.PARTICLE|f.PLANE]=i.prototype.particlePlane=function(t,e,i,r,o,n,h,u,c){var p=t,d=i,f=o,m=h,x=u,b=g,w=y;x=x||0,a(b,d,m),s.rotate(w,v,x);var _=l(b,w);if(_>0)return 0;if(c)return!0;var T=this.createContactEquation(f,p,n,e);return s.copy(T.normalA,w),s.scale(b,T.normalA,_),a(T.contactPointA,d,b),a(T.contactPointA,T.contactPointA,f.position),a(T.contactPointB,d,p.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T)),1},i.prototype[f.CIRCLE|f.PARTICLE]=i.prototype.circleParticle=function(t,e,i,r,o,n,l,u,c){var p=t,d=e,f=i,m=o,v=l,y=g;if(a(y,v,f),s.squaredLength(y)>d.radius*d.radius)return 0;if(c)return!0;var x=this.createContactEquation(p,m,e,n);return s.copy(x.normalA,y),s.normalize(x.normalA,x.normalA),s.scale(x.contactPointA,x.normalA,d.radius),h(x.contactPointA,x.contactPointA,f),a(x.contactPointA,x.contactPointA,p.position),a(x.contactPointB,v,m.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),1};{var W=new d(1),Y=s.create(),z=s.create();s.create()}i.prototype[f.PLANE|f.CAPSULE]=i.prototype.planeCapsule=function(t,e,i,r,o,n,a,l,u){var c=Y,p=z,d=W;s.set(c,-n.length/2,0),s.rotate(c,c,l),h(c,c,a),s.set(p,n.length/2,0),s.rotate(p,p,l),h(p,p,a),d.radius=n.radius;var f=this.circlePlane(o,d,c,0,t,e,i,r,u),m=this.circlePlane(o,d,p,0,t,e,i,r,u);return u?f||m:f+m},i.prototype.capsulePlane=function(t,e,i,r,o,n,s,a,h){return this.planeCapsule(o,n,s,a,t,e,i,r,h)},i.prototype[f.CIRCLE|f.PLANE]=i.prototype.circlePlane=function(t,e,i,r,o,n,u,c,p){var d=t,f=e,m=i,b=o,w=u,_=c;_=_||0;var T=g,S=y,A=x;a(T,m,w),s.rotate(S,v,_);var C=l(S,T);if(C>f.radius)return 0;if(p)return!0;var E=this.createContactEquation(b,d,n,e);return s.copy(E.normalA,S),s.scale(E.contactPointB,E.normalA,-f.radius),h(E.contactPointB,E.contactPointB,m),a(E.contactPointB,E.contactPointB,d.position),s.scale(A,E.normalA,C),a(E.contactPointA,T,A),h(E.contactPointA,E.contactPointA,w),a(E.contactPointA,E.contactPointA,b.position),this.contactEquations.push(E),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(E)),1},i.convexPrecision=1e-7,i.prototype[f.CONVEX]=i.prototype[f.CONVEX|f.RECTANGLE]=i.prototype[f.RECTANGLE]=i.prototype.convexConvex=function(t,e,r,o,n,u,c,p,d,f){var m=g,v=y,_=x,C=b,E=w,M=T,B=S,L=A,P=0,f=f||i.convexPrecision,R=i.findSeparatingAxis(e,r,o,u,c,p,m);if(!R)return 0;a(B,c,r),l(m,B)>0&&s.scale(m,m,-1);var F=i.getClosestEdge(e,o,m,!0),I=i.getClosestEdge(u,p,m);if(-1===F||-1===I)return 0;for(var O=0;2>O;O++){var D=F,k=I,N=e,U=u,G=r,q=c,V=o,j=p,X=t,W=n;if(0===O){var Y;Y=D,D=k,k=Y,Y=N,N=U,U=Y,Y=G,G=q,q=Y,Y=V,V=j,j=Y,Y=X,X=W,W=Y}for(var z=k;k+2>z;z++){var H=U.vertices[(z+U.vertices.length)%U.vertices.length];s.rotate(v,H,j),h(v,v,q);for(var K=0,J=D-1;D+2>J;J++){var Z=N.vertices[(J+N.vertices.length)%N.vertices.length],$=N.vertices[(J+1+N.vertices.length)%N.vertices.length];s.rotate(_,Z,V),s.rotate(C,$,V),h(_,_,G),h(C,C,G),a(E,C,_),s.rotate(L,E,-Math.PI/2),s.normalize(L,L),a(B,v,_);var Q=l(L,B);f>=Q&&K++}if(K>=3){if(d)return!0;var te=this.createContactEquation(X,W,N,U);P++;var Z=N.vertices[D%N.vertices.length],$=N.vertices[(D+1)%N.vertices.length];s.rotate(_,Z,V),s.rotate(C,$,V),h(_,_,G),h(C,C,G),a(E,C,_),s.rotate(te.normalA,E,-Math.PI/2),s.normalize(te.normalA,te.normalA),a(B,v,_);var Q=l(te.normalA,B);s.scale(M,te.normalA,Q),a(te.contactPointA,v,G),a(te.contactPointA,te.contactPointA,M),h(te.contactPointA,te.contactPointA,G),a(te.contactPointA,te.contactPointA,X.position),a(te.contactPointB,v,q),h(te.contactPointB,te.contactPointB,q),a(te.contactPointB,te.contactPointB,W.position),this.contactEquations.push(te),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(te))}}}return P};var H=s.fromValues(0,0);i.projectConvexOntoAxis=function(t,e,i,r,o){var n,a,h=null,u=null,c=H;s.rotate(c,r,-i);for(var p=0;p<t.vertices.length;p++)n=t.vertices[p],a=l(n,c),(null===h||a>h)&&(h=a),(null===u||u>a)&&(u=a);if(u>h){var d=u;u=h,h=d}var f=l(e,r);s.set(o,u+f,h+f)};var K=s.fromValues(0,0),J=s.fromValues(0,0),Z=s.fromValues(0,0),$=s.fromValues(0,0),Q=s.fromValues(0,0),te=s.fromValues(0,0);i.findSeparatingAxis=function(t,e,r,o,n,h,l){for(var u=null,c=!1,p=!1,d=K,f=J,m=Z,v=$,g=Q,y=te,x=0;2!==x;x++){var b=t,w=r;1===x&&(b=o,w=h);for(var _=0;_!==b.vertices.length;_++){s.rotate(f,b.vertices[_],w),s.rotate(m,b.vertices[(_+1)%b.vertices.length],w),a(d,m,f),s.rotate(v,d,-Math.PI/2),s.normalize(v,v),i.projectConvexOntoAxis(t,e,r,v,g),i.projectConvexOntoAxis(o,n,h,v,y);var T=g,S=y,A=!1;g[0]>y[0]&&(S=g,T=y,A=!0);var C=S[0]-T[1];c=C<=i.convexPrecision,(null===u||C>u)&&(s.copy(l,v),u=C,p=c)}}return p};var ee=s.fromValues(0,0),ie=s.fromValues(0,0),re=s.fromValues(0,0);i.getClosestEdge=function(t,e,i,r){var o=ee,n=ie,h=re;s.rotate(o,i,-e),r&&s.scale(o,o,-1);for(var u=-1,c=t.vertices.length,p=Math.PI/2,d=0;d!==c;d++){a(n,t.vertices[(d+1)%c],t.vertices[d%c]),s.rotate(h,n,-p),s.normalize(h,h);var f=l(h,o);(-1==u||f>maxDot)&&(u=d%c,maxDot=f)}return u};var oe=s.create(),ne=s.create(),se=s.create(),ae=s.create(),he=s.create(),le=s.create(),ue=s.create();i.prototype[f.CIRCLE|f.HEIGHTFIELD]=i.prototype.circleHeightfield=function(t,e,i,r,o,n,l,u,c,p){var d=n.data,p=p||e.radius,f=n.elementWidth,m=ne,v=oe,g=he,y=ue,x=le,b=se,w=ae,_=Math.floor((i[0]-p-l[0])/f),T=Math.ceil((i[0]+p-l[0])/f);0>_&&(_=0),T>=d.length&&(T=d.length-1);for(var S=d[_],A=d[T],C=_;T>C;C++)d[C]<A&&(A=d[C]),d[C]>S&&(S=d[C]);if(i[1]-p>S)return c?!1:0;i[1]+p<A;for(var E=!1,M=!1,C=_;T>C;C++){s.set(b,C*f,d[C]),s.set(w,(C+1)*f,d[C+1]),s.add(b,b,l),s.add(w,w,l),s.sub(x,w,b),s.rotate(x,x,Math.PI/2),s.normalize(x,x),s.scale(v,x,-p),s.add(v,v,i),s.sub(m,v,b);var B=s.dot(m,x);if(v[0]>=b[0]&&v[0]<w[0]&&0>=B&&(M===!1||Math.abs(B)<M)&&(s.scale(m,x,-B),s.add(g,v,m),s.copy(y,x),E=!0,M=Math.abs(B),c))return!0}if(E){var L=this.createContactEquation(o,t,n,e);return s.copy(L.normalA,y),s.scale(L.contactPointB,L.normalA,-p),h(L.contactPointB,L.contactPointB,i),a(L.contactPointB,L.contactPointB,t.position),s.copy(L.contactPointA,g),s.sub(L.contactPointA,L.contactPointA,o.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L)),1}if(p>0)for(var C=_;T>=C;C++)if(s.set(b,C*f,d[C]),s.add(b,b,l),s.sub(m,i,b),s.squaredLength(m)<p*p){if(c)return!0;var L=this.createContactEquation(o,t,n,e);return s.copy(L.normalA,m),s.normalize(L.normalA,L.normalA),s.scale(L.contactPointB,L.normalA,-p),h(L.contactPointB,L.contactPointB,i),a(L.contactPointB,L.contactPointB,t.position),a(L.contactPointA,b,l),h(L.contactPointA,L.contactPointA,l),a(L.contactPointA,L.contactPointA,o.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L)),1}return 0}},{"../equations/ContactEquation":21,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Circle":35,"../shapes/Rectangle":41,"../shapes/Shape":42,"../utils/Utils":45}],13:[function(t,e){function i(){o.call(this,o.SAP),this.axisListX=[],this.axisListY=[],this.world=null;var t=this.axisListX,e=this.axisListY;this._addBodyHandler=function(i){t.push(i.body),e.push(i.body)},this._removeBodyHandler=function(i){var r=t.indexOf(i.body);-1!==r&&t.splice(r,1),r=e.indexOf(i.body),-1!==r&&e.splice(r,1)}}{var r=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../utils/Utils")),o=t("../collision/Broadphase");t("../math/vec2")}e.exports=i,i.prototype=new o,i.prototype.setWorld=function(t){this.axisListX.length=this.axisListY.length=0,r.appendArray(this.axisListX,t.bodies),r.appendArray(this.axisListY,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},i.sortAxisListX=function(t){for(var e=1,i=t.length;i>e;e++){for(var r=t[e],o=e-1;o>=0&&!(t[o].aabb.lowerBound[0]<=r.aabb.lowerBound[0]);o--)t[o+1]=t[o];t[o+1]=r}return t},i.sortAxisListY=function(t){for(var e=1,i=t.length;i>e;e++){for(var r=t[e],o=e-1;o>=0&&!(t[o].aabb.lowerBound[1]<=r.aabb.lowerBound[1]);o--)t[o+1]=t[o];t[o+1]=r}return t};var n={keys:[]};i.prototype.getCollisionPairs=function(){{var t=this.axisListX,e=this.axisListY,r=this.result;this.axisIndex}r.length=0;for(var s=0;s!==t.length;s++){var a=t[s];a.aabbNeedsUpdate&&a.updateAABB()}i.sortAxisListX(t),i.sortAxisListY(e);for(var s=0,h=t.length;s!==h;s++)for(var l=t[s],u=s+1;h>u;u++){var c=t[u];if(!i.checkBounds(l,c,0))break;if(o.canCollide(l,c)){var p=l.id<c.id?l.id+" "+c.id:c.id+" "+l.id;n[p]=!0,n.keys.push(p)}}for(var s=0,h=e.length;s!==h;s++)for(var l=e[s],u=s+1;h>u;u++){var c=e[u];if(!i.checkBounds(l,c,1))break;if(o.canCollide(l,c)){var p=l.id<c.id?l.id+" "+c.id:c.id+" "+l.id;n[p]&&this.boundingVolumeCheck(l,c)&&r.push(l,c)}}for(var d=n.keys,s=0,h=d.length;s!==h;s++)delete n[d[s]];return d.length=0,r},i.checkBounds=function(t,e,i){return e.aabb.lowerBound[i]<=t.aabb.upperBound[i]}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Shape":42,"../utils/Utils":45}],14:[function(t,e){function i(t,e,i,r){r=r||{},this.type=i,this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected="undefined"!=typeof r.collideConnected?r.collideConnected:!0,t&&t.wakeUp(),e&&e.wakeUp()}e.exports=i,i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.DISTANCE=1,i.GEAR=2,i.LOCK=3,i.PRISMATIC=4,i.REVOLUTE=5,i.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var r=e[i];r.stiffness=t,r.needsUpdate=!0}},i.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var r=e[i];r.relaxation=t,r.needsUpdate=!0}}},{}],15:[function(t,e){function i(t,e,i,s){s=s||{},r.call(this,t,e,r.DISTANCE,s),this.distance=i;var a;a="undefined"==typeof s.maxForce?Number.MAX_VALUE:s.maxForce;var h=new o(t,e,-a,a);this.equations=[h];var l=n.create();h.computeGq=function(){return n.sub(l,e.position,t.position),n.length(l)-i},this.setMaxForce(a)}var r=t("./Constraint"),o=t("../equations/Equation"),n=t("../math/vec2");e.exports=i,i.prototype=new r;var s=n.create();i.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,r=(this.distance,t.G);n.sub(s,i.position,e.position),n.normalize(s,s),r[0]=-s[0],r[1]=-s[1],r[3]=s[0],r[4]=s[1]},i.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},i.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],16:[function(t,e){function i(t,e,i){i=i||{},r.call(this,t,e,r.GEAR,i),this.equations=[new o(t,e,i)],this.angle="number"==typeof i.angle?i.angle:0,this.ratio="number"==typeof i.ratio?i.ratio:1,"number"==typeof i.maxTorque&&this.setMaxTorque(i.maxTorque)}{var r=t("./Constraint"),o=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2")}e.exports=i,i.prototype=new r,i.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},i.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},i.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e){function i(t,e,i){i=i||{},r.call(this,t,e,r.LOCK,i);var s="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce,a=i.localOffsetB||o.fromValues(0,0);a=o.fromValues(a[0],a[1]);var h=i.localAngleB||0,l=new n(t,e,-s,s),u=new n(t,e,-s,s),c=new n(t,e,-s,s),p=o.create(),d=o.create(),f=this;l.computeGq=function(){return o.rotate(p,f.localOffsetB,t.angle),o.sub(d,e.position,t.position),o.sub(d,d,p),d[0]},u.computeGq=function(){return o.rotate(p,f.localOffsetB,t.angle),o.sub(d,e.position,t.position),o.sub(d,d,p),d[1]};var m=o.create(),v=o.create();c.computeGq=function(){return o.rotate(m,f.localOffsetB,e.angle-f.localAngleB),o.scale(m,m,-1),o.sub(d,t.position,e.position),o.add(d,d,m),o.rotate(v,m,-Math.PI/2),o.normalize(v,v),o.dot(d,v)},this.localOffsetB=a,this.localAngleB=h,this.equations.push(l,u,c),this.setMaxForce(s)}var r=t("./Constraint"),o=t("../math/vec2"),n=t("../equations/Equation");e.exports=i,i.prototype=new r,i.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},i.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=o.create(),a=o.create(),h=o.create(),l=o.fromValues(1,0),u=o.fromValues(0,1);i.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],r=this.bodyA,n=this.bodyB;o.rotate(s,this.localOffsetB,r.angle),o.rotate(a,this.localOffsetB,n.angle-this.localAngleB),o.scale(a,a,-1),o.rotate(h,a,Math.PI/2),o.normalize(h,h),t.G[0]=-1,t.G[1]=0,t.G[2]=-o.crossLength(s,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-o.crossLength(s,u),e.G[4]=1,i.G[0]=-h[0],i.G[1]=-h[1],i.G[3]=h[0],i.G[4]=h[1],i.G[5]=o.crossLength(a,h)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e){function i(t,e,i){i=i||{},r.call(this,t,e,r.PRISMATIC,i);var h=s.fromValues(0,0),l=s.fromValues(1,0),u=s.fromValues(0,0);i.localAnchorA&&s.copy(h,i.localAnchorA),i.localAxisA&&s.copy(l,i.localAxisA),i.localAnchorB&&s.copy(u,i.localAnchorB),this.localAnchorA=h,this.localAnchorB=u,this.localAxisA=l;var c=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE,p=new n(t,e,-c,c),d=new s.create,f=new s.create,m=new s.create,v=new s.create;if(p.computeGq=function(){return s.dot(m,v)},p.updateJacobian=function(){var i=this.G,r=t.position,o=e.position;s.rotate(d,h,t.angle),s.rotate(f,u,e.angle),s.add(m,o,f),s.sub(m,m,r),s.sub(m,m,d),s.rotate(v,l,t.angle+Math.PI/2),i[0]=-v[0],i[1]=-v[1],i[2]=-s.crossLength(d,v)+s.crossLength(v,m),i[3]=v[0],i[4]=v[1],i[5]=s.crossLength(f,v)},this.equations.push(p),!i.disableRotationalLock){var g=new a(t,e,-c,c);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof i.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof i.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof i.lowerLimit?i.lowerLimit:0,this.upperLimit="undefined"!=typeof i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new o(t,e),this.lowerLimitEquation=new o(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=c,this.motorEquation=new n(t,e),this.motorEnabled=!1,this.motorSpeed=0;{var y=this,x=this.motorEquation;x.computeGW}x.computeGq=function(){return 0},x.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.velocity,o=i.velocity,n=e.angularVelocity,s=i.angularVelocity;return this.transformedGmult(t,r,n,o,s)+y.motorSpeed}}var r=t("./Constraint"),o=t("../equations/ContactEquation"),n=t("../equations/Equation"),s=t("../math/vec2"),a=t("../equations/RotationalLockEquation");e.exports=i,i.prototype=new r;var h=s.create(),l=s.create(),u=s.create(),c=s.create(),p=s.create(),d=s.create();i.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,r=this.lowerLimit,o=this.upperLimitEquation,n=this.lowerLimitEquation,a=this.bodyA,f=this.bodyB,m=this.localAxisA,v=this.localAnchorA,g=this.localAnchorB;e.updateJacobian(),s.rotate(h,m,a.angle),s.rotate(c,v,a.angle),s.add(l,c,a.position),s.rotate(p,g,f.angle),s.add(u,p,f.position);var y=this.position=s.dot(u,h)-s.dot(l,h);if(this.motorEnabled){var x=this.motorEquation.G;x[0]=h[0],x[1]=h[1],x[2]=s.crossLength(h,p),x[3]=-h[0],x[4]=-h[1],x[5]=-s.crossLength(h,c)}if(this.upperLimitEnabled&&y>i)s.scale(o.normalA,h,-1),s.sub(o.contactPointA,l,a.position),s.sub(o.contactPointB,u,f.position),s.scale(d,h,i),s.add(o.contactPointA,o.contactPointA,d),-1==t.indexOf(o)&&t.push(o);else{var b=t.indexOf(o);-1!=b&&t.splice(b,1)}if(this.lowerLimitEnabled&&r>y)s.scale(n.normalA,h,1),s.sub(n.contactPointA,l,a.position),s.sub(n.contactPointB,u,f.position),s.scale(d,h,r),s.sub(n.contactPointB,n.contactPointB,d),-1==t.indexOf(n)&&t.push(n);else{var b=t.indexOf(n);-1!=b&&t.splice(b,1)}},i.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},i.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e){function i(t,e,i,d,f){f=f||{},r.call(this,t,i,r.REVOLUTE,f);var m=this.maxForce="undefined"!=typeof f.maxForce?f.maxForce:Number.MAX_VALUE;this.pivotA=e,this.pivotB=d;var v=this.equations=[new o(t,i,-m,m),new o(t,i,-m,m)],g=v[0],y=v[1],x=this;g.computeGq=function(){return a.rotate(h,x.pivotA,t.angle),a.rotate(l,x.pivotB,i.angle),a.add(p,i.position,l),a.sub(p,p,t.position),a.sub(p,p,h),a.dot(p,u)},y.computeGq=function(){return a.rotate(h,x.pivotA,t.angle),a.rotate(l,x.pivotB,i.angle),a.add(p,i.position,l),a.sub(p,p,t.position),a.sub(p,p,h),a.dot(p,c)},y.minForce=g.minForce=-m,y.maxForce=g.maxForce=m,this.motorEquation=new n(t,i),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new s(t,i),this.lowerLimitEquation=new s(t,i),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var r=t("./Constraint"),o=t("../equations/Equation"),n=t("../equations/RotationalVelocityEquation"),s=t("../equations/RotationalLockEquation"),a=t("../math/vec2");e.exports=i;var h=a.create(),l=a.create(),u=a.fromValues(1,0),c=a.fromValues(0,1),p=a.create();i.prototype=new r,i.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,r=this.pivotB,o=this.equations,n=(o[0],o[1],o[0]),s=o[1],p=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,m=this.lowerLimitEquation,v=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&v>p)f.angle=p,-1==o.indexOf(f)&&o.push(f);else{var g=o.indexOf(f);-1!=g&&o.splice(g,1)}if(this.lowerLimitEnabled&&d>v)m.angle=d,-1==o.indexOf(m)&&o.push(m);else{var g=o.indexOf(m);-1!=g&&o.splice(g,1)}a.rotate(h,i,t.angle),a.rotate(l,r,e.angle),n.G[0]=-1,n.G[1]=0,n.G[2]=-a.crossLength(h,u),n.G[3]=1,n.G[4]=0,n.G[5]=a.crossLength(l,u),s.G[0]=0,s.G[1]=-1,s.G[2]=-a.crossLength(h,c),s.G[3]=0,s.G[4]=1,s.G[5]=a.crossLength(l,c)},i.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},i.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},i.prototype.motorIsEnabled=function(){return!!this.motorEnabled},i.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},i.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e){function i(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}{var r=t("./Equation");t("../math/vec2")}e.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},i.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},i.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e){function i(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=o.create(),this.penetrationVec=o.create(),this.contactPointB=o.create(),this.normalA=o.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var r=t("./Equation"),o=t("../math/vec2");e.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.computeB=function(t,e,i){var r=this.bodyA,n=this.bodyB,s=this.contactPointA,a=this.contactPointB,h=r.position,l=n.position,u=this.penetrationVec,c=this.normalA,p=this.G,d=o.crossLength(s,c),f=o.crossLength(a,c);p[0]=-c[0],p[1]=-c[1],p[2]=-d,p[3]=c[0],p[4]=c[1],p[5]=f,o.add(u,l,a),o.sub(u,u,h),o.sub(u,u,s);var m,v;this.firstImpact&&0!==this.restitution?(v=0,m=1/e*(1+this.restitution)*this.computeGW()):(v=o.dot(c,u),m=this.computeGW());var g=this.computeGiMf(),y=-v*t-m*e-i*g;return y}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e){function i(t,e,r,o){this.minForce="undefined"==typeof r?-Number.MAX_VALUE:r,this.maxForce="undefined"==typeof o?Number.MAX_VALUE:o,this.bodyA=t,this.bodyB=e,this.stiffness=i.DEFAULT_STIFFNESS,this.relaxation=i.DEFAULT_RELAXATION,this.G=new a.ARRAY_TYPE(6);for(var n=0;6>n;n++)this.G[n]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}function r(t,e,i,r,o){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*r[0]+t[4]*r[1]+t[5]*o}function o(t){return t.sleepState===h.SLEEPING?0:t.invMass}function n(t){return t.sleepState===h.SLEEPING?0:t.invInertia}e.exports=i;var s=t("../math/vec2"),a=t("../utils/Utils"),h=t("../objects/Body");i.prototype.constructor=i,i.DEFAULT_STIFFNESS=1e6,i.DEFAULT_RELAXATION=4,i.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},i.prototype.computeB=function(t,e,i){var r=this.computeGW(),o=this.computeGq(),n=this.computeGiMf();return-o*t-r*e-n*i};var l=s.create(),u=s.create();i.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=(e.position,i.position,e.angle),n=i.angle;return r(t,l,o,u,n)+this.offset};s.create(),s.create();i.prototype.transformedGmult=function(t,e,i,o,n){return r(t,e,i,o,n)},i.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.velocity,o=i.velocity,n=e.angularVelocity,s=i.angularVelocity;return this.transformedGmult(t,r,n,o,s)+this.relativeVelocity},i.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.vlambda,n=i.vlambda,s=e.wlambda,a=i.wlambda;return r(t,o,s,n,a)};var c=s.create(),p=s.create();i.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,r=t.angularForce,a=e.force,h=e.angularForce,l=o(t),u=o(e),d=n(t),f=n(e),m=this.G;return s.scale(c,i,l),s.scale(p,a,u),this.transformedGmult(m,c,r*d,p,h*f)},i.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=o(t),r=o(e),s=n(t),a=n(e),h=this.G;return h[0]*h[0]*i+h[1]*h[1]*i+h[2]*h[2]*s+h[3]*h[3]*r+h[4]*h[4]*r+h[5]*h[5]*a};{var d=s.create(),f=s.create(),m=s.create();s.create(),s.create(),s.create()}i.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,r=d,a=f,h=m,l=o(e),u=o(i),c=n(e),p=n(i),v=this.G;a[0]=v[0],a[1]=v[1],h[0]=v[3],h[1]=v[4],s.scale(r,a,l*t),s.add(e.vlambda,e.vlambda,r),e.wlambda+=c*v[2]*t,s.scale(r,h,u*t),s.add(i.vlambda,i.vlambda,r),i.wlambda+=p*v[5]*t},i.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":45}],23:[function(t,e){function i(t,e,i){o.call(this,t,e,-i,i),this.contactPointA=r.create(),this.contactPointB=r.create(),this.t=r.create(),this.contactEquation=null,this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}{var r=t("../math/vec2"),o=t("./Equation");t("../utils/Utils")}e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},i.prototype.getSlipForce=function(){return this.maxForce},i.prototype.computeB=function(t,e,i){var o=(this.bodyA,this.bodyB,this.contactPointA),n=this.contactPointB,s=this.t,a=this.G;a[0]=-s[0],a[1]=-s[1],a[2]=-r.crossLength(o,s),a[3]=s[0],a[4]=s[1],a[5]=r.crossLength(n,s);var h=this.computeGW(),l=this.computeGiMf(),u=-h*e-i*l;return u}},{"../math/vec2":30,"../utils/Utils":45,"./Equation":22}],24:[function(t,e){function i(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var o=this.G;o[2]=1,o[5]=-1}var r=t("./Equation"),o=t("../math/vec2");e.exports=i,i.prototype=new r,i.prototype.constructor=i;var n=o.create(),s=o.create(),a=o.fromValues(1,0),h=o.fromValues(0,1);i.prototype.computeGq=function(){return o.rotate(n,a,this.bodyA.angle+this.angle),o.rotate(s,h,this.bodyB.angle),o.dot(n,s)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e){function i(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}{var r=t("./Equation");t("../math/vec2")}e.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.computeB=function(t,e,i){var r=this.G;r[2]=-1,r[5]=this.ratio;var o=this.computeGiMf(),n=this.computeGW(),s=-n*e-i*o;return s}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e){var i=function(){};e.exports=i,i.prototype={constructor:i,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)?!0:!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,r=i[t].indexOf(e);return-1!==r&&i[t].splice(r,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;for(var r=0,o=i.length;o>r;r++){var n=i[r];n.call(n.context,t)}}return this}}},{}],27:[function(t,e){function i(t,e,n){if(n=n||{},!(t instanceof r&&e instanceof r))throw new Error("First two arguments must be Material instances.");this.id=i.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof n.friction?Number(n.friction):.3,this.restitution="undefined"!=typeof n.restitution?Number(n.restitution):0,this.stiffness="undefined"!=typeof n.stiffness?Number(n.stiffness):o.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof n.relaxation?Number(n.relaxation):o.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof n.frictionStiffness?Number(n.frictionStiffness):o.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof n.frictionRelaxation?Number(n.frictionRelaxation):o.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof n.surfaceVelocity?Number(n.surfaceVelocity):0}var r=t("./Material"),o=t("../equations/Equation");e.exports=i,i.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e){function i(){this.id=i.idCounter++}e.exports=i,i.idCounter=0},{}],29:[function(t,e){var i={};i.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,r=0;e>r;r+=2)i+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return i+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-i},i.Triangulate=function(t){var e=t.length>>1;if(3>e)return[];for(var r=[],o=[],n=0;e>n;n++)o.push(n);for(var n=0,s=e;s>3;){var a=o[(n+0)%s],h=o[(n+1)%s],l=o[(n+2)%s],u=t[2*a],c=t[2*a+1],p=t[2*h],d=t[2*h+1],f=t[2*l],m=t[2*l+1],v=!1;if(i._convex(u,c,p,d,f,m)){v=!0;for(var g=0;s>g;g++){var y=o[g];if(y!=a&&y!=h&&y!=l&&i._PointInTriangle(t[2*y],t[2*y+1],u,c,p,d,f,m)){v=!1;break}}}if(v)r.push(a,h,l),o.splice((n+1)%s,1),s--,n=0;else if(n++>3*s)break}return r.push(o[0],o[1],o[2]),r},i._PointInTriangle=function(t,e,i,r,o,n,s,a){var h=s-i,l=a-r,u=o-i,c=n-r,p=t-i,d=e-r,f=h*h+l*l,m=h*u+l*c,v=h*p+l*d,g=u*u+c*c,y=u*p+c*d,x=1/(f*g-m*m),b=(g*v-m*y)*x,w=(f*y-m*v)*x;return b>=0&&w>=0&&1>b+w},i._convex=function(t,e,i,r,o,n){return(e-r)*(o-i)+(i-t)*(n-r)>=0},e.exports=i},{}],30:[function(t,e){var i=t("../../build/vec2").vec2;i.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},i.crossVZ=function(t,e,r){return i.rotate(t,e,-Math.PI/2),i.scale(t,t,r),t},i.crossZV=function(t,e,r){return i.rotate(t,r,Math.PI/2),i.scale(t,t,e),t},i.rotate=function(t,e,i){var r=Math.cos(i),o=Math.sin(i),n=e[0],s=e[1];t[0]=r*n-o*s,t[1]=o*n+r*s},i.toLocalFrame=function(t,e,r,o){i.copy(t,e),i.sub(t,t,r),i.rotate(t,t,-o)},i.toGlobalFrame=function(t,e,r,o){i.copy(t,e),i.rotate(t,t,o),i.add(t,t,r)},i.centroid=function(t,e,r,o){return i.add(t,e,r),i.add(t,t,o),i.scale(t,t,1/3),t},e.exports=i},{"../../build/vec2":1}],31:[function(t,e){function i(t){t=t||{},a.call(this),this.id=++i._idCounter,this.world=null,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.fixedRotation=!!t.fixedRotation||!1,this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.interpolatedPosition=r.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=r.fromValues(0,0),this.previousAngle=0,this.velocity=r.fromValues(0,0),t.velocity&&r.copy(this.velocity,t.velocity),this.vlambda=r.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=r.create(),t.force&&r.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.motionState=0===this.mass?i.STATIC:i.DYNAMIC,this.boundingRadius=0,this.aabb=new s,this.aabbNeedsUpdate=!0,this.allowSleep=!0,this.wantsToSleep=!1,this.sleepState=i.AWAKE,this.sleepSpeedLimit=.2,this.sleepTimeLimit=1,this.gravityScale=1,this.timeLastSleepy=0,this.concavePath=null,this.lastDampingScale=1,this.lastAngularDampingScale=1,this.lastDampingTimeStep=-1,this.updateMassProperties()}var r=t("../math/vec2"),o=t("poly-decomp"),n=t("../shapes/Convex"),s=t("../collision/AABB"),a=t("../events/EventEmitter");
e.exports=i,i.prototype=new a,i._idCounter=0,i.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},i.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t};var h=new s,l=r.create();i.prototype.updateAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,i=this.shapeAngles,o=t.length,n=0;n!==o;n++){var s=t[n],a=l,u=i[n]+this.angle;r.rotate(a,e[n],this.angle),r.add(a,a,this.position),s.computeAABB(h,a,u),0===n?this.aabb.copy(h):this.aabb.extend(h)}this.aabbNeedsUpdate=!1},i.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,i=t.length,o=0,n=0;n!==i;n++){var s=t[n],a=r.length(e[n]),h=s.boundingRadius;a+h>o&&(o=a+h)}this.boundingRadius=o},i.prototype.addShape=function(t,e,i){i=i||0,e=e?r.fromValues(e[0],e[1]):r.fromValues(0,0),this.shapes.push(t),this.shapeOffsets.push(e),this.shapeAngles.push(i),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},i.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e?(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeAngles.splice(e,1),this.aabbNeedsUpdate=!0,!0):!1},i.prototype.updateMassProperties=function(){if(this.motionState===i.STATIC||this.motionState===i.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,o=this.mass/e,n=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var s=0;e>s;s++){var a=t[s],h=r.squaredLength(this.shapeOffsets[s]),l=a.computeMomentOfInertia(o);n+=l+o*h}this.inertia=n,this.invInertia=n>0?1/n:0}this.invMass=1/this.mass}};var u=r.create();i.prototype.applyForce=function(t,e){var i=u;r.sub(i,e,this.position),r.add(this.force,this.force,t);var o=r.crossLength(i,t);this.angularForce+=o},i.prototype.toLocalFrame=function(t,e){r.toLocalFrame(t,e,this.position,this.angle)},i.prototype.toWorldFrame=function(t,e){r.toGlobalFrame(t,e,this.position,this.angle)},i.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var s=new o.Polygon;if(s.vertices=t,s.makeCCW(),"number"==typeof e.removeCollinearPoints&&s.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!s.isSimple())return!1;this.concavePath=s.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var a=[0,0];r.copy(a,this.concavePath[i]),this.concavePath[i]=a}var h;h=e.optimalDecomp?s.decomp():s.quickDecomp();for(var l=r.create(),i=0;i!==h.length;i++){for(var u=new n(h[i].vertices),c=0;c!==u.vertices.length;c++){var a=u.vertices[c];r.sub(a,a,u.centerOfMass)}r.scale(l,u.centerOfMass,1),u.updateTriangles(),u.updateCenterOfMass(),u.updateBoundingRadius(),this.addShape(u,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var c=(r.fromValues(0,0),r.fromValues(0,0)),p=r.fromValues(0,0),d=r.fromValues(0,0);i.prototype.adjustCenterOfMass=function(){var t=c,e=p,i=d,o=0;r.set(e,0,0);for(var n=0;n!==this.shapes.length;n++){var s=this.shapes[n],a=this.shapeOffsets[n];r.scale(t,a,s.area),r.add(e,e,t),o+=s.area}r.scale(i,e,1/o);for(var n=0;n!==this.shapes.length;n++){var s=this.shapes[n],a=this.shapeOffsets[n];a||(a=this.shapeOffsets[n]=r.create()),r.sub(a,a,i)}r.add(this.position,this.position,i);for(var n=0;this.concavePath&&n<this.concavePath.length;n++)r.sub(this.concavePath[n],this.concavePath[n],i);this.updateMassProperties(),this.updateBoundingRadius()},i.prototype.setZeroForce=function(){r.set(this.force,0,0),this.angularForce=0},i.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;r.set(e,0,0),t.wlambda=0},i.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;r.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},i.prototype.applyDamping=function(t){if(this.motionState===i.DYNAMIC){t!==this.lastDampingTimeStep&&(this.lastDampingScale=Math.pow(1-this.damping,t),this.lastAngularDampingScale=Math.pow(1-this.angularDamping,t),this.lastDampingTimeStep=t);var e=this.velocity;r.scale(e,e,this.lastDampingScale),this.angularVelocity*=this.lastAngularDampingScale}},i.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=i.AWAKE,this.idleTime=0,t!==i.AWAKE&&this.emit(i.wakeUpEvent)},i.prototype.sleep=function(){this.sleepState=i.SLEEPING,this.angularVelocity=0,this.angularForce=0,r.set(this.velocity,0,0),r.set(this.force,0,0),this.emit(i.sleepEvent)},i.prototype.sleepTick=function(t,e,o){if(this.allowSleep&&this.motionState!==i.SLEEPING){this.wantsToSleep=!1;var n=(this.sleepState,r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),s=Math.pow(this.sleepSpeedLimit,2);n>=s?(this.idleTime=0,this.sleepState=i.AWAKE):(this.idleTime+=o,this.sleepState=i.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},i.prototype.getVelocityFromPosition=function(t,e){return t=t||r.create(),r.sub(t,this.position,this.previousPosition),r.scale(t,t,1/e),t},i.prototype.getAngularVelocityFromPosition=function(t){return(this.angle-this.previousAngle)/t},i.sleepyEvent={type:"sleepy"},i.sleepEvent={type:"sleep"},i.wakeUpEvent={type:"wakeup"},i.DYNAMIC=1,i.STATIC=2,i.KINEMATIC=4,i.AWAKE=0,i.SLEEPY=1,i.SLEEPING=2},{"../collision/AABB":8,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":36,"poly-decomp":6}],32:[function(t,e){function i(t,e,i){i=i||{},this.restLength="number"==typeof i.restLength?i.restLength:1,this.stiffness=i.stiffness||100,this.damping=i.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=r.fromValues(0,0),this.localAnchorB=r.fromValues(0,0),i.localAnchorA&&r.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&r.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB)}var r=t("../math/vec2");e.exports=i,i.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},i.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},i.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},i.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var o=r.create(),n=r.create(),s=r.create(),a=r.create(),h=r.create(),l=r.create(),u=r.create(),c=r.create(),p=r.create();i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,d=this.bodyA,f=this.bodyB,m=o,v=n,g=s,y=a,x=p,b=h,w=l,_=u,T=c;this.getWorldAnchorA(b),this.getWorldAnchorB(w),r.sub(_,b,d.position),r.sub(T,w,f.position),r.sub(m,w,b);var S=r.len(m);r.normalize(v,m),r.sub(g,f.velocity,d.velocity),r.crossZV(x,f.angularVelocity,T),r.add(g,g,x),r.crossZV(x,d.angularVelocity,_),r.sub(g,g,x),r.scale(y,v,-t*(S-i)-e*r.dot(g,v)),r.sub(d.force,d.force,y),r.add(f.force,f.force,y);var A=r.crossLength(_,y),C=r.crossLength(T,y);d.angularForce-=A,f.angularForce+=C}},{"../math/vec2":30}],33:[function(t,e){e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),GearConstraint:t("./constraints/GearConstraint"),GridBroadphase:t("./collision/GridBroadphase"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Rectangle:t("./shapes/Rectangle"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version}},{"../package.json":7,"./collision/AABB":8,"./collision/Broadphase":9,"./collision/GridBroadphase":10,"./collision/NaiveBroadphase":11,"./collision/Narrowphase":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/Spring":32,"./shapes/Capsule":34,"./shapes/Circle":35,"./shapes/Convex":36,"./shapes/Heightfield":37,"./shapes/Line":38,"./shapes/Particle":39,"./shapes/Plane":40,"./shapes/Rectangle":41,"./shapes/Shape":42,"./solver/GSSolver":43,"./solver/Solver":44,"./utils/Utils":45,"./world/World":49}],34:[function(t,e){function i(t,e){this.length=t||1,this.radius=e||1,r.call(this,r.CAPSULE)}var r=t("./Shape"),o=t("../math/vec2");e.exports=i,i.prototype=new r,i.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,r=2*e;return t*(r*r+i*i)/12},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var n=o.create();i.prototype.computeAABB=function(t,e,i){var r=this.radius;o.set(n,this.length,0),o.rotate(n,n,i),o.set(t.upperBound,Math.max(n[0]+r,-n[0]+r),Math.max(n[1]+r,-n[1]+r)),o.set(t.lowerBound,Math.min(n[0]-r,-n[0]-r),Math.min(n[1]-r,-n[1]-r)),o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e)}},{"../math/vec2":30,"./Shape":42}],35:[function(t,e){function i(t){this.radius=t||1,r.call(this,r.CIRCLE)}var r=t("./Shape"),o=t("../math/vec2");e.exports=i,i.prototype=new r,i.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},i.prototype.computeAABB=function(t,e){var i=this.radius;o.set(t.upperBound,i,i),o.set(t.lowerBound,-i,-i),e&&(o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e))}},{"../math/vec2":30,"./Shape":42}],36:[function(t,e){function i(t){this.vertices=[];for(var e=0;e<t.length;e++){var i=o.create();o.copy(i,t[e]),this.vertices.push(i)}if(this.centerOfMass=o.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,r.call(this,r.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}{var r=t("./Shape"),o=t("../math/vec2"),n=t("../math/polyk");t("poly-decomp")}e.exports=i,i.prototype=new r,i.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var r=n.Triangulate(t),e=0;e<r.length;e+=3){var o=r[e],s=r[e+1],a=r[e+2];this.triangles.push([o,s,a])}};{var s=o.create(),a=o.create(),h=o.create(),l=o.create(),u=o.create();o.create(),o.create(),o.create(),o.create()}i.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,r=this.centerOfMass,n=s,c=h,p=l,d=u,f=a;o.set(r,0,0);for(var m=0,v=0;v!==t.length;v++){var g=t[v],c=e[g[0]],p=e[g[1]],d=e[g[2]];o.centroid(n,c,p,d);var y=i.triangleArea(c,p,d);m+=y,o.scale(f,n,y),o.add(r,r,f)}o.scale(r,r,1/m)},i.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,r=this.vertices.length,n=r-1,s=0;r>s;n=s,s++){var a=this.vertices[n],h=this.vertices[s],l=Math.abs(o.crossLength(a,h)),u=o.dot(h,h)+o.dot(h,a)+o.dot(a,a);e+=l*u,i+=l}return t/6*(e/i)},i.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var r=o.squaredLength(t[i]);r>e&&(e=r)}this.boundingRadius=Math.sqrt(e)},i.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},i.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,r=0;r!==t.length;r++){var o=t[r],n=e[o[0]],s=e[o[1]],a=e[o[2]],h=i.triangleArea(n,s,a);this.area+=h}},i.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i)}},{"../math/polyk":29,"../math/vec2":30,"./Shape":42,"poly-decomp":6}],37:[function(t,e){function i(t,e,i){this.data=t,this.maxValue=e,this.elementWidth=i,r.call(this,r.HEIGHTFIELD)}{var r=t("./Shape");t("../math/vec2")}e.exports=i,i.prototype=new r,i.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.updateArea=function(){for(var t=this.data,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e},i.prototype.computeAABB=function(t,e){t.upperBound[0]=this.elementWidth*this.data.length+e[0],t.upperBound[1]=this.maxValue+e[1],t.lowerBound[0]=e[0],t.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":30,"./Shape":42}],38:[function(t,e){function i(t){this.length=t,r.call(this,r.LINE)}var r=t("./Shape"),o=t("../math/vec2");e.exports=i,i.prototype=new r,i.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var n=[o.create(),o.create()];i.prototype.computeAABB=function(t,e,i){var r=this.length;o.set(n[0],-r/2,0),o.set(n[1],r/2,0),t.setFromPoints(n,e,i)}},{"../math/vec2":30,"./Shape":42}],39:[function(t,e){function i(){r.call(this,r.PARTICLE)}var r=t("./Shape"),o=t("../math/vec2");e.exports=i,i.prototype=new r,i.prototype.computeMomentOfInertia=function(){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=0},i.prototype.computeAABB=function(t,e){this.length;o.copy(t.lowerBound,e),o.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":42}],40:[function(t,e){function i(){r.call(this,r.PLANE)}{var r=t("./Shape"),o=t("../math/vec2");t("../utils/Utils")}e.exports=i,i.prototype=new r,i.prototype.computeMomentOfInertia=function(){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.computeAABB=function(t,e,i){var r=0,n=o.set;"number"==typeof i&&(r=i%(2*Math.PI)),0==r?(n(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),n(t.upperBound,Number.MAX_VALUE,0)):r==Math.PI/2?(n(t.lowerBound,0,-Number.MAX_VALUE),n(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):r==Math.PI?(n(t.lowerBound,-Number.MAX_VALUE,0),n(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):r==3*Math.PI/2?(n(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),n(t.upperBound,0,Number.MAX_VALUE)):(n(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),n(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)),o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e)},i.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":45,"./Shape":42}],41:[function(t,e){function i(t,e){var i=[r.fromValues(-t/2,-e/2),r.fromValues(t/2,-e/2),r.fromValues(t/2,e/2),r.fromValues(-t/2,e/2)];this.width=t,this.height=e,n.call(this,i),this.type=o.RECTANGLE}var r=t("../math/vec2"),o=t("./Shape"),n=t("./Convex");e.exports=i,i.prototype=new n([]),i.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},i.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};r.create(),r.create(),r.create(),r.create();i.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i)},i.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":36,"./Shape":42}],42:[function(t,e){function i(t){this.type=t,this.id=i.idCounter++,this.boundingRadius=0,this.collisionGroup=1,this.collisionMask=1,t&&this.updateBoundingRadius(),this.material=null,this.area=0,this.sensor=!1,this.updateArea()}e.exports=i,i.idCounter=0,i.CIRCLE=1,i.PARTICLE=2,i.PLANE=4,i.CONVEX=8,i.LINE=16,i.RECTANGLE=32,i.CAPSULE=64,i.HEIGHTFIELD=128,i.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},i.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")},i.prototype.updateArea=function(){},i.prototype.computeAABB=function(){}},{}],43:[function(t,e){function i(t){n.call(this,t,n.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-10,this.arrayStep=30,this.lambda=new s.ARRAY_TYPE(this.arrayStep),this.Bs=new s.ARRAY_TYPE(this.arrayStep),this.invCs=new s.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function r(t){for(var e=0;e!==t.length;e++)t[e]=0}var o=t("../math/vec2"),n=t("./Solver"),s=t("../utils/Utils"),a=t("../equations/FrictionEquation");e.exports=i,i.prototype=new n,i.prototype.solve=function(t,e){this.sortEquations();var n=0,h=this.iterations,l=this.frictionIterations,u=this.equations,c=u.length,p=Math.pow(this.tolerance*c,2),d=e.bodies,f=e.bodies.length,m=(o.add,o.set,this.useZeroRHS),v=this.lambda;this.usedIterations=0,v.length<c&&(v=this.lambda=new s.ARRAY_TYPE(c+this.arrayStep),this.Bs=new s.ARRAY_TYPE(c+this.arrayStep),this.invCs=new s.ARRAY_TYPE(c+this.arrayStep)),r(v);for(var g=this.invCs,y=this.Bs,v=this.lambda,x=0;x!==u.length;x++){var b=u[x];(b.timeStep!==t||b.needsUpdate)&&(b.timeStep=t,b.update()),y[x]=b.computeB(b.a,b.b,t),g[x]=b.computeInvC(b.epsilon)}var b,w,x,_;if(0!==c){for(x=0;x!==f;x++)d[x].resetConstraintVelocity();if(l){for(n=0;n!==l;n++){for(w=0,_=0;_!==c;_++){b=u[_];var T=i.iterateEquation(_,b,b.epsilon,y,g,v,m,t,n);w+=Math.abs(T)}if(this.usedIterations++,p>=w*w)break}for(_=0;_!==c;_++){var S=u[_];if(S instanceof a){var A=S.contactEquation.multiplier*S.frictionCoefficient;S.maxForce=A,S.minForce=-A}}}for(n=0;n!==h;n++){for(w=0,_=0;_!==c;_++){b=u[_];var T=i.iterateEquation(_,b,b.epsilon,y,g,v,m,t,n);w+=Math.abs(T)}if(this.usedIterations++,p>=w*w)break}for(x=0;x!==f;x++)d[x].addConstraintVelocity()}},i.iterateEquation=function(t,e,i,r,o,n,s,a){var h=r[t],l=o[t],u=n[t],c=e.computeGWlambda(),p=e.maxForce,d=e.minForce;s&&(h=0);var f=l*(h-c-i*u),m=u+f;return d*a>m?f=d*a-u:m>p*a&&(f=p*a-u),n[t]+=f,e.multiplier=n[t]/a,e.addToWlambda(f),f}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":45,"./Solver":44}],44:[function(t,e){function i(t,e){t=t||{},r.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var r=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=i,i.prototype=new r,i.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};i.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),o.bodies.length=0,e.getBodies(o.bodies),o.bodies.length&&this.solve(t,o))},i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var r=t[e];r.enabled&&this.equations.push(r)}},i.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},i.prototype.removeAllEquations=function(){this.equations.length=0},i.GS=1,i.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":45}],45:[function(t,e){function i(){}e.exports=i,i.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,r=e.length;i!==r;++i)t.push(e[i])},i.splice=function(t,e,i){i=i||1;for(var r=e,o=t.length-i;o>r;r++)t[r]=t[r+i];t.length=o},i.ARRAY_TYPE=Float32Array||Array,i.extend=function(t,e){for(var i in e)t[i]=e[i]}},{}],46:[function(t,e){function i(){this.equations=[],this.bodies=[]}var r=t("../objects/Body");e.exports=i,i.prototype.reset=function(){this.equations.length=this.bodies.length=0};var o=[];i.prototype.getBodies=function(t){var e=t||[],i=this.equations;o.length=0;for(var r=0;r!==i.length;r++){var n=i[r];-1===o.indexOf(n.bodyA.id)&&(e.push(n.bodyA),o.push(n.bodyA.id)),-1===o.indexOf(n.bodyB.id)&&(e.push(n.bodyB),o.push(n.bodyB.id))}return e},i.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.motionState===r.DYNAMIC&&!e.wantsToSleep)return!1}return!0},i.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}},{"../objects/Body":31}],47:[function(t,e){function i(){this._nodePool=[],this._islandPool=[],this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var r=(t("../math/vec2"),t("./Island")),o=t("./IslandNode"),n=t("../objects/Body");e.exports=i,i.getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var r=t[i];if(!r.visited&&r.body.motionState===n.DYNAMIC)return r}return!1},i.prototype.visit=function(t,e,i){e.push(t.body);for(var r=t.equations.length,o=0;o!==r;o++){var n=t.equations[o];-1===i.indexOf(n)&&i.push(n)}},i.prototype.bfs=function(t,e,r){var o=this.queue;for(o.length=0,o.push(t),t.visited=!0,this.visit(t,e,r);o.length;)for(var s,a=o.pop();s=i.getUnvisitedNode(a.neighbors);)s.visited=!0,this.visit(s,e,r),s.body.motionState===n.DYNAMIC&&o.push(s)},i.prototype.split=function(t){for(var e=t.bodies,n=this.nodes,s=this.equations;n.length;)this._nodePool.push(n.pop());for(var a=0;a!==e.length;a++)if(this._nodePool.length){var h=this._nodePool.pop();h.reset(),h.body=e[a],n.push(h)}else n.push(new o(e[a]));for(var l=0;l!==s.length;l++){var u=s[l],a=e.indexOf(u.bodyA),c=e.indexOf(u.bodyB),p=n[a],d=n[c];p.neighbors.push(d),d.neighbors.push(p),p.equations.push(u),d.equations.push(u)}for(var f=this.islands;f.length;){var m=f.pop();m.reset(),this._islandPool.push(m)}for(var v;v=i.getUnvisitedNode(n);){var m=this._islandPool.length?this._islandPool.pop():new r;this.bfs(v,m.bodies,m.equations),f.push(m)}return f}},{"../math/vec2":30,"../objects/Body":31,"./Island":46,"./IslandNode":48}],48:[function(t,e){function i(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=i,i.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],49:[function(t,e){function i(t){g.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new s,this.narrowphase=new R(this),this.islandManager=new I,this.gravity=t.gravity||l.fromValues(0,-9.78),this.frictionGravity=l.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new h,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new w,this.defaultContactMaterial=new _(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.fixedStepTime=0,this.islandSplit="undefined"!=typeof t.islandSplit?!!t.islandSplit:!1,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.enableBodySleeping=!1,this.enableIslandSleeping=!1,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlappingShapeLookup={keys:[]}}function r(t){return t?[t[0],t[1]]:t}function o(t,e){for(var i in e)t[i]=e[i]}function n(t){return{id:t.id,materialA:t.materialA.id,materialB:t.materialB.id,friction:t.friction,restitution:t.restitution,stiffness:t.stiffness,relaxation:t.relaxation,frictionStiffness:t.frictionStiffness,frictionRelaxation:t.frictionRelaxation}}var s=t("../solver/GSSolver"),a=t("../solver/Solver"),h=t("../collision/NaiveBroadphase"),l=t("../math/vec2"),u=t("../shapes/Circle"),c=t("../shapes/Rectangle"),p=t("../shapes/Convex"),d=t("../shapes/Line"),f=t("../shapes/Plane"),m=t("../shapes/Capsule"),v=t("../shapes/Particle"),g=t("../events/EventEmitter"),y=t("../objects/Body"),x=t("../shapes/Shape"),b=t("../objects/Spring"),w=t("../material/Material"),_=t("../material/ContactMaterial"),T=t("../constraints/DistanceConstraint"),S=t("../constraints/Constraint"),A=t("../constraints/LockConstraint"),C=t("../constraints/RevoluteConstraint"),E=t("../constraints/PrismaticConstraint"),M=t("../constraints/GearConstraint"),B=t("../../package.json"),L=t("../collision/Broadphase"),P=t("../collision/SAPBroadphase"),R=t("../collision/Narrowphase"),F=t("../utils/Utils"),I=t("./IslandManager");if(e.exports=i,"undefined"==typeof performance&&(performance={}),!performance.now){var O=Date.now();performance.timing&&performance.timing.navigationStart&&(O=performance.timing.navigationStart),performance.now=function(){return Date.now()-O}}i.prototype=new Object(g.prototype),i.prototype.addConstraint=function(t){this.constraints.push(t)},i.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},i.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&F.splice(this.contactMaterials,e,1)},i.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,r=0,o=i.length;r!==o;r++){var n=i[r];if(n.materialA===t&&n.materialB===e||n.materialA===e&&n.materialB===t)return n}return!1},i.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&F.splice(this.constraints,e,1)};var D=(l.create(),l.create(),l.create(),l.create(),l.create(),l.create(),l.create()),k=l.fromValues(0,0),N=l.fromValues(0,0),U=(l.fromValues(0,0),l.fromValues(0,0));i.prototype.step=function(t,e,i){if(i=i||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{var r=Math.floor((this.time+e)/t)-Math.floor(this.time/t);r=Math.min(r,i);for(var o=0;r>o;o++)this.internalStep(t);this.time+=e;for(var n=this.time%t,s=0;s!==this.bodies.length;s++){var a=this.bodies[s];a.motionState!==y.STATIC&&a.sleepState!==y.SLEEPING?(l.sub(U,a.position,a.previousPosition),l.scale(U,U,n/t),l.add(a.interpolatedPosition,a.position,U),a.interpolatedAngle=a.angle+(a.angle-a.previousAngle)*n/t):(l.copy(a.interpolatedPosition,a.position),a.interpolatedAngle=a.angle)}}},i.prototype.internalStep=function(t){this.stepping=!0;var e,r,o=this,n=this.doProfiling,s=this.springs.length,a=this.springs,h=this.bodies,u=this.gravity,c=this.solver,p=this.bodies.length,d=this.broadphase,f=this.narrowphase,m=this.constraints,v=D,g=(l.scale,l.add),x=(l.rotate,this.islandManager);if(this.lastTimeStep=t,n&&(e=performance.now()),this.useWorldGravityAsFrictionGravity){var b=l.length(this.gravity);0===b&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=b)}if(this.applyGravity)for(var w=0;w!==p;w++){var _=h[w],T=_.force;_.motionState===y.DYNAMIC&&_.sleepState!==y.SLEEPING&&(l.scale(v,u,_.mass*_.gravityScale),g(T,T,v))}if(this.applySpringForces)for(var w=0;w!==s;w++){var S=a[w];S.applyForce()}if(this.applyDamping)for(var w=0;w!==p;w++){var _=h[w];_.motionState===y.DYNAMIC&&_.applyDamping(t)}for(var A=d.getCollisionPairs(this),C=this.disabledBodyCollisionPairs,w=C.length-2;w>=0;w-=2)for(var E=A.length-2;E>=0;E-=2)(C[w]===A[E]&&C[w+1]===A[E+1]||C[w+1]===A[E]&&C[w]===A[E+1])&&A.splice(E,2);var M=m.length;for(w=0;w!==M;w++){var B=m[w];if(!B.collideConnected)for(var E=A.length-2;E>=0;E-=2)(B.bodyA===A[E]&&B.bodyB===A[E+1]||B.bodyB===A[E]&&B.bodyA===A[E+1])&&A.splice(E,2)}this.postBroadphaseEvent.pairs=A,this.emit(this.postBroadphaseEvent),f.reset(this);for(var w=0,L=A.length;w!==L;w+=2)for(var P=A[w],R=A[w+1],I=0,O=P.shapes.length;I!==O;I++)for(var k=P.shapes[I],N=P.shapeOffsets[I],U=P.shapeAngles[I],G=0,q=R.shapes.length;G!==q;G++){var V=R.shapes[G],j=R.shapeOffsets[G],X=R.shapeAngles[G],W=this.defaultContactMaterial;if(k.material&&V.material){var Y=this.getContactMaterial(k.material,V.material);Y&&(W=Y)}this.runNarrowphase(f,P,k,N,U,R,V,j,X,W,this.frictionGravity)}for(var z=this.overlappingShapesLastState,w=0;w!==z.keys.length;w++){var H=z.keys[w];if(z[H]===!0&&!this.overlappingShapesCurrentState[H]){var K=this.endContactEvent;K.shapeA=z[H+"_shapeA"],K.shapeB=z[H+"_shapeB"],K.bodyA=z[H+"_bodyA"],K.bodyB=z[H+"_bodyB"],this.emit(K)}}for(var w=0;w!==z.keys.length;w++)delete z[z.keys[w]];z.keys.length=0;for(var J=this.overlappingShapesCurrentState,w=0;w!==J.keys.length;w++)z[J.keys[w]]=J[J.keys[w]],z.keys.push(J.keys[w]);for(var w=0;w!==J.keys.length;w++)delete J[J.keys[w]];J.keys.length=0;var Z=this.preSolveEvent;Z.contactEquations=f.contactEquations,Z.frictionEquations=f.frictionEquations,this.emit(Z);var M=m.length;for(w=0;w!==M;w++)m[w].update();if(f.contactEquations.length||f.frictionEquations.length||m.length)if(this.islandSplit){for(x.equations.length=0,F.appendArray(x.equations,f.contactEquations),F.appendArray(x.equations,f.frictionEquations),w=0;w!==M;w++)F.appendArray(x.equations,m[w].equations);x.split(this);for(var w=0;w!==x.islands.length;w++){var $=x.islands[w];$.equations.length&&c.solveIsland(t,$)}}else{for(c.addEquations(f.contactEquations),c.addEquations(f.frictionEquations),w=0;w!==M;w++)c.addEquations(m[w].equations);this.solveConstraints&&c.solve(t,this),c.removeAllEquations()}for(var w=0;w!==p;w++){var Q=h[w];Q.sleepState!==y.SLEEPING&&Q.motionState!==y.STATIC&&i.integrateBody(Q,t)}for(var w=0;w!==p;w++)h[w].setZeroForce();if(n&&(r=performance.now(),o.lastStepTime=r-e),this.emitImpactEvent)for(var te=this.impactEvent,w=0;w!==f.contactEquations.length;w++){var ee=f.contactEquations[w];ee.firstImpact&&(te.bodyA=ee.bodyA,te.bodyB=ee.bodyB,te.shapeA=ee.shapeA,te.shapeB=ee.shapeB,te.contactEquation=ee,this.emit(te))}if(this.enableBodySleeping)for(w=0;w!==p;w++)h[w].sleepTick(this.time,!1,t);else if(this.enableIslandSleeping&&this.islandSplit){for(w=0;w!==p;w++)h[w].sleepTick(this.time,!0,t);for(var w=0;w<this.islandManager.islands.length;w++){var $=this.islandManager.islands[w];$.wantsToSleep()&&$.sleep()}}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(var w=0;w!==this.bodiesToBeRemoved.length;w++)this.removeBody(this.bodiesToBeRemoved[w]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var G=l.create(),q=l.create();i.integrateBody=function(t,e){var i=t.invMass,r=t.force,o=t.position,n=t.velocity;l.copy(t.previousPosition,t.position),t.previousAngle=t.angle,t.fixedRotation||(t.angularVelocity+=t.angularForce*t.invInertia*e,t.angle+=t.angularVelocity*e),l.scale(G,r,e*i),l.add(n,G,n),l.scale(q,n,e),l.add(o,o,q),t.aabbNeedsUpdate=!0},i.prototype.runNarrowphase=function(t,e,i,r,o,n,s,a,h,u,c){if(0!==(i.collisionGroup&s.collisionMask)&&0!==(s.collisionGroup&i.collisionMask)){l.rotate(k,r,e.angle),l.rotate(N,a,n.angle),l.add(k,k,e.position),l.add(N,N,n.position);var p=o+e.angle,d=h+n.angle;t.enableFriction=u.friction>0,t.frictionCoefficient=u.friction;
var f;f=e.motionState===y.STATIC||e.motionState===y.KINEMATIC?n.mass:n.motionState===y.STATIC||n.motionState===y.KINEMATIC?e.mass:e.mass*n.mass/(e.mass+n.mass),t.slipForce=u.friction*c*f,t.restitution=u.restitution,t.surfaceVelocity=u.surfaceVelocity,t.frictionStiffness=u.frictionStiffness,t.frictionRelaxation=u.frictionRelaxation,t.stiffness=u.stiffness,t.relaxation=u.relaxation;var m=t[i.type|s.type],v=0;if(m){var g=i.sensor||s.sensor,x=t.frictionEquations.length;v=i.type<s.type?m.call(t,e,i,k,p,n,s,N,d,g):m.call(t,n,s,N,d,e,i,k,p,g);var b=t.frictionEquations.length-x;if(v){var w=!1,_=!1,T=l.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),S=Math.pow(e.sleepSpeedLimit,2),A=l.squaredLength(n.velocity)+Math.pow(n.angularVelocity,2),C=Math.pow(n.sleepSpeedLimit,2);e.allowSleep&&e.motionState===y.DYNAMIC&&e.sleepState===y.SLEEPING&&n.sleepState===y.AWAKE&&n.motionState!==y.STATIC&&A>=2*C&&(w=!0),n.allowSleep&&n.motionState===y.DYNAMIC&&n.sleepState===y.SLEEPING&&e.sleepState===y.AWAKE&&e.motionState!==y.STATIC&&T>=2*S&&(_=!0),w&&e.wakeUp(),_&&n.wakeUp();var E=i.id<s.id?i.id+" "+s.id:s.id+" "+i.id;if(!this.overlappingShapesLastState[E]){var M=this.beginContactEvent;if(M.shapeA=i,M.shapeB=s,M.bodyA=e,M.bodyB=n,M.contactEquations.length=0,"number"==typeof v)for(var B=t.contactEquations.length-v;B<t.contactEquations.length;B++)M.contactEquations.push(t.contactEquations[B]);this.emit(M)}var L=this.overlappingShapesCurrentState;if(L[E]||(L[E]=!0,L.keys.push(E),L[E+"_shapeA"]=i,L.keys.push(E+"_shapeA"),L[E+"_shapeB"]=s,L.keys.push(E+"_shapeB"),L[E+"_bodyA"]=e,L.keys.push(E+"_bodyA"),L[E+"_bodyB"]=n,L.keys.push(E+"_bodyB")),"number"==typeof v&&b>1)for(var B=t.frictionEquations.length-b;B<t.frictionEquations.length;B++){var P=t.frictionEquations[B];P.setSlipForce(P.getSlipForce()/b)}}}}},i.prototype.addSpring=function(t){this.springs.push(t),this.addSpringEvent.spring=t,this.emit(this.addSpringEvent)},i.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1===e&&F.splice(this.springs,e,1)},i.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(this.bodies.push(t),t.world=this,this.addBodyEvent.body=t,this.emit(this.addBodyEvent))},i.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(F.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}},i.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var r=e[i];if(r.id===t)return r}return!1},i.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},i.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,r=0;r<i.length;r+=2)if(i[r]===t&&i[r+1]===e||i[r+1]===t&&i[r]===e)return void i.splice(r,2)},i.prototype.toJSON=function(){var t=this,e={p2:B.version,bodies:[],springs:[],solver:{},gravity:r(t.gravity),broadphase:{},distanceConstraints:[],revoluteConstraints:[],prismaticConstraints:[],lockConstraints:[],gearConstraints:[],contactMaterials:[],materials:[],defaultContactMaterial:n(t.defaultContactMaterial),islandSplit:t.islandSplit,enableIslandSleeping:t.enableIslandSleeping,enableBodySleeping:t.enableBodySleeping},i=e.solver,s=t.solver;s.type===a.GS&&(i.type="GSSolver",i.iterations=s.iterations);var h=e.broadphase,l=t.broadphase;l.type===L.NAIVE?h.type="NaiveBroadphase":l.type===L.SAP&&(h.type="SAPBroadphase");for(var u=0;u!==t.springs.length;u++){var s=t.springs[u];e.springs.push({bodyA:t.bodies.indexOf(s.bodyA),bodyB:t.bodies.indexOf(s.bodyB),stiffness:s.stiffness,damping:s.damping,restLength:s.restLength,localAnchorA:r(s.localAnchorA),localAnchorB:r(s.localAnchorB)})}for(var u=0;u<t.constraints.length;u++){var c=t.constraints[u],p={bodyA:t.bodies.indexOf(c.bodyA),bodyB:t.bodies.indexOf(c.bodyB),collideConnected:c.collideConnected};switch(c.type){case S.DISTANCE:o(p,{distance:c.distance,maxForce:c.getMaxForce()}),e.distanceConstraints.push(p);break;case S.REVOLUTE:o(p,{pivotA:r(c.pivotA),pivotB:r(c.pivotB),maxForce:c.maxForce,motorSpeed:c.getMotorSpeed()||0,motorEnabled:!!c.getMotorSpeed(),lowerLimit:c.lowerLimit,lowerLimitEnabled:c.lowerLimitEnabled,upperLimit:c.upperLimit,upperLimitEnabled:c.upperLimitEnabled}),e.revoluteConstraints.push(p);break;case S.PRISMATIC:o(p,{localAxisA:r(c.localAxisA),localAnchorA:r(c.localAnchorA),localAnchorB:r(c.localAnchorB),maxForce:c.maxForce,upperLimitEnabled:c.upperLimitEnabled,lowerLimitEnabled:c.lowerLimitEnabled,upperLimit:c.upperLimit,lowerLimit:c.lowerLimit,motorEnabled:c.motorEnabled,motorSpeed:c.motorSpeed}),e.prismaticConstraints.push(p);break;case S.LOCK:o(p,{localOffsetB:r(c.localOffsetB),localAngleB:c.localAngleB,maxForce:c.getMaxForce()}),e.lockConstraints.push(p);break;case S.GEAR:o(p,{angle:c.angle,ratio:c.ratio,maxForce:c.maxForce||1e6}),e.gearConstraints.push(p)}}for(var u=0;u!==t.bodies.length;u++){var d=t.bodies[u],f=d.shapes,m={id:d.id,mass:d.mass,angle:d.angle,position:r(d.position),velocity:r(d.velocity),angularVelocity:d.angularVelocity,force:r(d.force),motionState:d.motionState,fixedRotation:d.fixedRotation,circleShapes:[],planeShapes:[],particleShapes:[],lineShapes:[],rectangleShapes:[],convexShapes:[],capsuleShapes:[]};d.concavePath&&(m.concavePath=d.concavePath);for(var v=0;v<f.length;v++){var s=f[v],g={};switch(g.offset=r(d.shapeOffsets[v]),g.angle=d.shapeAngles[v],g.collisionGroup=s.collisionGroup,g.collisionMask=s.collisionMask,g.material=s.material?s.material.id:null,s.type){case x.CIRCLE:o(g,{radius:s.radius}),m.circleShapes.push(g);break;case x.PLANE:m.planeShapes.push(g);break;case x.PARTICLE:m.particleShapes.push(g);break;case x.LINE:g.length=s.length,m.lineShapes.push(g);break;case x.RECTANGLE:o(g,{width:s.width,height:s.height}),m.rectangleShapes.push(g);break;case x.CONVEX:for(var y=[],b=0;b<s.vertices.length;b++)y.push(r(s.vertices[b]));o(g,{vertices:y}),m.convexShapes.push(g);break;case x.CAPSULE:o(g,{length:s.length,radius:s.radius}),m.capsuleShapes.push(g)}}e.bodies.push(m)}for(var u=0;u<t.contactMaterials.length;u++){var w=t.contactMaterials[u];e.contactMaterials.push(n(w))}for(var _={},u=0;u<t.contactMaterials.length;u++){var w=t.contactMaterials[u];_[w.materialA.id+""]=w.materialA,_[w.materialB.id+""]=w.materialB}for(var T in _){var A=_[parseInt(T)];e.materials.push({id:A.id})}return e},i.prototype.fromJSON=function(t){function e(t,e,i){e.collisionMask=i.collisionMask,e.collisionGroup=i.collisionGroup,i.material&&(e.material=a[i.material+""]),t.addShape(e,i.offset,i.angle)}if(this.clear(),!t.p2)return!1;var i=this;switch(l.copy(i.gravity,t.gravity),i.islandSplit=t.islandSplit,i.enableIslandSleeping=t.enableIslandSleeping,i.enableBodySleeping=t.enableBodySleeping,t.solver.type){case"GSSolver":var r=t.solver,o=new s;i.solver=o,o.iterations=r.iterations;break;default:throw new Error("Solver type not recognized: "+t.solver.type)}switch(t.broadphase.type){case"NaiveBroadphase":i.broadphase=new h;break;case"SAPBroadphase":i.broadphase=new P}i.broadphase.setWorld(i);for(var n=i.bodies,a={},g=0;g!==t.materials.length;g++){var x=t.materials[g],S=new w;a[x.id+""]=S,S.id=x.id}i.defaultMaterial.id=t.defaultContactMaterial.materialA;for(var g=0;g!==t.bodies.length;g++){var B=t.bodies[g],L=new y({mass:B.mass,position:B.position,angle:B.angle,velocity:B.velocity,angularVelocity:B.angularVelocity,force:B.force,fixedRotation:B.fixedRotation});L.id=B.id,L.motionState=B.motionState;for(var R=0;R<B.circleShapes.length;R++){var o=B.circleShapes[R];e(L,new u(o.radius),o)}for(var R=0;R<B.planeShapes.length;R++){var o=B.planeShapes[R];e(L,new f,o)}for(var R=0;R<B.particleShapes.length;R++){var o=B.particleShapes[R];e(L,new v,o)}for(var R=0;R<B.lineShapes.length;R++){var o=B.lineShapes[R];e(L,new d(o.length),o)}for(var R=0;R<B.rectangleShapes.length;R++){var o=B.rectangleShapes[R];e(L,new c(o.width,o.height),o)}for(var R=0;R<B.convexShapes.length;R++){var o=B.convexShapes[R];e(L,new p(o.vertices),o)}for(var R=0;R<B.capsuleShapes.length;R++){var o=B.capsuleShapes[R];e(L,new m(o.length,o.radius),o)}B.concavePath&&(L.concavePath=B.concavePath),i.addBody(L)}for(var g=0;g<t.springs.length;g++){var r=t.springs[g],F=n[r.bodyA],I=n[r.bodyB];if(!F)return this.error="instance.springs["+g+"] references instance.body["+r.bodyA+"], which does not exist.",!1;if(!I)return this.error="instance.springs["+g+"] references instance.body["+r.bodyB+"], which does not exist.",!1;var o=new b(F,I,{stiffness:r.stiffness,damping:r.damping,restLength:r.restLength,localAnchorA:r.localAnchorA,localAnchorB:r.localAnchorB});i.addSpring(o)}for(var g=0;g<t.contactMaterials.length;g++){var x=t.contactMaterials[g],O=a[x.materialA+""],D=a[x.materialB+""];if(!O)return this.error="Reference to material id "+x.materialA+": material not found",!1;if(!D)return this.error="Reference to material id "+x.materialB+": material not found",!1;var k=new _(O,D,{friction:x.friction,restitution:x.restitution,stiffness:x.stiffness,relaxation:x.relaxation,frictionStiffness:x.frictionStiffness,frictionRelaxation:x.frictionRelaxation});k.id=x.id,i.addContactMaterial(k)}var x=t.defaultContactMaterial,O=i.defaultMaterial,D=i.defaultMaterial,k=new _(O,D,{friction:x.friction,restitution:x.restitution,stiffness:x.stiffness,relaxation:x.relaxation,frictionStiffness:x.frictionStiffness,frictionRelaxation:x.frictionRelaxation});k.id=x.id,i.defaultContactMaterial=k;for(var g=0;g<t.distanceConstraints.length;g++){var N=t.distanceConstraints[g];i.addConstraint(new T(n[N.bodyA],n[N.bodyB],N.distance,{maxForce:N.maxForce,collideConnected:N.collideConnected}))}for(var g=0;g<t.revoluteConstraints.length;g++){var N=t.revoluteConstraints[g],U=new C(n[N.bodyA],N.pivotA,n[N.bodyB],N.pivotB,{maxForce:N.maxForce,collideConnected:N.collideConnected});N.motorEnabled&&U.enableMotor(),U.setMotorSpeed(N.motorSpeed),U.lowerLimit=N.lowerLimit,U.upperLimit=N.upperLimit,U.lowerLimitEnabled=N.lowerLimitEnabled,U.upperLimitEnabled=N.upperLimitEnabled,i.addConstraint(U)}for(var g=0;g<t.prismaticConstraints.length;g++){var N=t.prismaticConstraints[g],G=new E(n[N.bodyA],n[N.bodyB],{maxForce:N.maxForce,localAxisA:N.localAxisA,localAnchorA:N.localAnchorA,localAnchorB:N.localAnchorB,collideConnected:N.collideConnected});G.motorSpeed=N.motorSpeed,i.addConstraint(G)}for(var g=0;g<t.lockConstraints.length;g++){var N=t.lockConstraints[g];i.addConstraint(new A(n[N.bodyA],n[N.bodyB],{maxForce:N.maxForce,localOffsetB:N.localOffsetB,localAngleB:N.localAngleB,collideConnected:N.collideConnected}))}for(var g=0;g<t.gearConstraints.length;g++){var N=t.gearConstraints[g];i.addConstraint(new M(n[N.bodyA],n[N.bodyB],{maxForce:N.maxForce,angle:N.angle,ratio:N.ratio,collideConnected:N.collideConnected}))}return!0},i.prototype.clear=function(){this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var r=this.bodies,e=r.length-1;e>=0;e--)this.removeBody(r[e]);for(var o=this.springs,e=o.length-1;e>=0;e--)this.removeSpring(o[e]);for(var n=this.contactMaterials,e=n.length-1;e>=0;e--)this.removeContactMaterial(n[e]);i.apply(this)},i.prototype.clone=function(){var t=new i;return t.fromJSON(this.toJSON()),t};var V=l.create(),j=l.fromValues(0,0),X=l.fromValues(0,0);i.prototype.hitTest=function(t,e,i){i=i||0;var r=new y({position:t}),o=new v,n=t,s=0,a=V,h=j,c=X;r.addShape(o);for(var d=this.narrowphase,g=[],x=0,b=e.length;x!==b;x++)for(var w=e[x],_=0,T=w.shapes.length;_!==T;_++){var S=w.shapes[_],A=w.shapeOffsets[_]||h,C=w.shapeAngles[_]||0;l.rotate(a,A,w.angle),l.add(a,a,w.position);var E=C+w.angle;(S instanceof u&&d.circleParticle(w,S,a,E,r,o,n,s,!0)||S instanceof p&&d.particleConvex(r,o,n,s,w,S,a,E,!0)||S instanceof f&&d.particlePlane(r,o,n,s,w,S,a,E,!0)||S instanceof m&&d.particleCapsule(r,o,n,s,w,S,a,E,!0)||S instanceof v&&l.squaredLength(l.sub(c,a,t))<i*i)&&g.push(w)}return g},i.prototype.setGlobalEquationParameters=function(t){t=t||{};for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],r=0;r!==i.equations.length;r++){var o=i.equations[r];"undefined"!=typeof t.stiffness&&(o.stiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(o.relaxation=t.relaxation),o.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];"undefined"!=typeof t.stiffness&&(i.stiffness=t.stiffness,i.frictionStiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(i.relaxation=t.relaxation,i.frictionRelaxation=t.relaxation)}var i=this.defaultContactMaterial;"undefined"!=typeof t.stiffness&&(i.stiffness=t.stiffness,i.frictionStiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(i.relaxation=t.relaxation,i.frictionRelaxation=t.relaxation)},i.prototype.setGlobalStiffness=function(t){this.setGlobalEquationParameters({stiffness:t})},i.prototype.setGlobalRelaxation=function(t){this.setGlobalEquationParameters({relaxation:t})}},{"../../package.json":7,"../collision/Broadphase":9,"../collision/NaiveBroadphase":11,"../collision/Narrowphase":12,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/Spring":32,"../shapes/Capsule":34,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Line":38,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Rectangle":41,"../shapes/Shape":42,"../solver/GSSolver":43,"../solver/Solver":44,"../utils/Utils":45,"./IslandManager":47}]},{},[33])(33)}),window.ASSET_URL="assets/",config={app:"com/fortieth/FortiethApp"},window.console||(window.console={log:function(){}}),window.console.log||(window.console.log=function(){}),require.config({baseUrl:"./js",paths:{PIXI:"libs/pixi.dev",TWEEN:"libs/TweenLite.min",EASEPACK:"libs/EasePack.min",CSSPACK:"libs/CSSPlugin.min",HOWLER:"libs/howler.min",signals:"../node_modules/signals/dist/signals",APP_root:"com/boxy/app/BoxyApp",stats:"libs/stats.min"}}),window.DEVICE_SCALE=window.devicePixelRatio||1,hasCanvasSupport()?require(["TWEEN","EASEPACK","CSSPACK","HOWLER","PIXI","APP_root","stats","com/fido/system/Device","libs/p2"],function(t,e,i,r,o,n,s,a,h){function l(){document.getElementById("container");a.instance.iOS&&a.instance.iOS_version<7||window.scrollTo(0,0),u.resize(window.innerWidth,window.innerHeight)}var u=new n;window.app=u,window.p2=h;var c=document.getElementById("container");c.appendChild(u.view),c.style.background="black",u.view.style.position="absolute",u.view.style.top=0,u.view.style.left=0,window.addEventListener("resize",function(){setTimeout(l,100),setTimeout(l,200)}),setTimeout(l,100),setTimeout(l,200)}):require(["com/fido/app/Fallback"],function(){new Fallback(document.body)}),define("Boot",function(){});