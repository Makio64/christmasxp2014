!function t(s,e,i){function n(a,r){if(!e[a]){if(!s[a]){var h="function"==typeof require&&require;if(!r&&h)return h(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var l=e[a]={exports:{}};s[a][0].call(l.exports,function(t){var e=s[a][1][t];return n(e?e:t)},l,l.exports,t,s,e,i)}return e[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({"../.././src/scripts/app.js":[function(t,s){var e=(t("./views/AppView"),t("./experiment/experiment")),i={appView:null,experiment:null,init:function(){this.experiment=new e,this.experiment.load(),window.addEventListener("touchstart",function(t){t.preventDefault()})}};i.init(),s.exports=i},{"./experiment/experiment":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/experiment.js","./views/AppView":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/views/AppView.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/beat-cube.js":[function(t,s){var e=(t("../utils/number-utils"),function(t,s,e){THREE.Object3D.apply(this,arguments),this.originSize=t,this.currentScale=.3,this.scaleEasing=.5,this.receiveShadow=!0,this.castShadow=!0,this.attractionPoint=null,this.physicsBody=null,this.addCube(),this.speed=s,this.layer=e,this.rotationSpeed=.005*Math.random()});e.prototype=Object.create(THREE.Object3D.prototype),e.prototype.constructor=e,e.prototype.addCube=function(){var t=new THREE.LoadingManager;t.onProgress=function(t,s,e){console.log(t,s,e)};new THREE.Texture;this.texture=new THREE.Texture;var s=(new THREE.OBJLoader(t),new THREE.BoxGeometry(this.originSize,this.originSize,this.originSize)),e=new THREE.MeshPhongMaterial({color:3355443,transparency:!1,opacity:1,wireframe:!1});this.cube=new THREE.Mesh(s,e),this.cube.receiveShadow=!0,this.cube.castShadow=!0,this.add(this.cube)},e.prototype.update=function(){this.position.x-=this.speed,this.rotation.y+=this.rotationSpeed},s.exports=e},{"../utils/number-utils":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/number-utils.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/experiment.js":[function(t,s){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}();var e=t("./scenes/scene"),i=t("../sound/sound-manager"),n=(t("./beat-cube"),t("./gift"));t("./santa/santa");var o=(t("../utils/dat-gui"),t("../utils/number-utils")),a=function(){this.width=window.innerWidth,this.height=window.innerHeight,this.scene=null,this.soundManager=null,this.santa=null,this.beatCubes=[],this.physicsBodies=[],this.deltaTime=0,this.startTime=Date.now(),this.lastTime=Date.now(),this.loading=document.querySelector(".loading"),this.soundBtn=document.querySelector(".mute"),this.restartContainer=document.querySelector(".restart.no-mobile"),this.restartContainerMobile=document.querySelector(".restart.mobile"),this.infoContainer=document.querySelector(".info"),this.bestTimeContainer=document.querySelector(".besttime span"),this.timeContainer=document.querySelector(".time span"),this.windContainer=document.querySelector(".wind span"),this.instructionsContainer=document.querySelector(".instructions"),this.clock=new THREE.Clock,this.canUpdateTime=!1,this.canUpdateInfo=!1,this.bestScore=0};a.prototype.load=function(){this.soundManager=new i,this.soundManager.onLoaded=function(){this.init()}.bind(this)},a.prototype.init=function(){this.scene=new e,this.scene.init(this.width,this.height),this.animFrame=requestAnimationFrame(this.animate.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),window.top.addEventListener("resize",this.onResize.bind(this)),this.controls=new THREE.TrackballControls(this.scene.camera,this.scene.renderer.domElement),this.addSanta()},a.prototype.addSanta=function(){this.santa=new window.Santa,this.santa.onLoaded=function(){this.isLoaded||(this.isLoaded=!0,setTimeout(function(){this.instructionsContainer.classList.add("transitionOut"),this.loading.classList.add("transitionOut"),this.scene.renderer.domElement.classList.add("transitionIn"),this.soundBtn.classList.add("transitionIn"),this.infoContainer.classList.add("transitionIn"),this.santa.transitionIn(),window.top.addEventListener("keyup",this.onKeyUp.bind(this)),window.top.addEventListener("touchstart",this.onKeyUp.bind(this)),this.canUpdateTime=!0,this.soundManager.play(),this.scene.mainScene.add(this.santa.mesh),this.addBeatCubes();this.santa.mesh.geometry.clone();this.scene.oclScene.addSanta(this.santa),this.santa.getHurt=this.updateSantaLife.bind(this),this.santa.onTransitionInCompleteCallback=this.allowSantaToRun.bind(this)}.bind(this),12e3))}.bind(this)},a.prototype.allowSantaToRun=function(){console.log("lalal"),this.restartContainer.classList.add("transitionIn"),this.restartContainerMobile.classList.add("transitionIn"),this.isListeningToUser=!0},a.prototype.onKeyUp=function(t){this.isListeningToUser&&(this.isListeningToUser=!1,this.santa.isWaiting=!1,32===t.keyCode&&(this.santa.canRun||(this.santa.canRun=!0),this.canUpdateInfo=!0,this.restartContainer.classList.remove("transitionIn"),this.restartContainerMobile.classList.remove("transitionIn"),this.scene.oclScene.transitionIn()))},a.prototype.onTouchStart=function(){this.isListeningToUser&&(this.isListeningToUser=!1,this.santa.isWaiting=!1,this.santa.canRun||(this.santa.canRun=!0),this.canUpdateInfo=!0,this.restartContainer.classList.remove("transitionIn"),this.restartContainerMobile.classList.remove("transitionIn"),this.scene.oclScene.transitionIn())},a.prototype.addBeatCubes=function(){for(var t=0;15>t;t++){var s=7,e=[Math.floor(201*Math.random())-100,50*Math.random()+10,50*-Math.random()],i=[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],o=this.speed=.5*Math.random()+.2,a=new n(s,o,0,!0);a.position.set(e[0],e[1],e[2]),a.rotation.set(i[0],i[1],i[2]),this.scene.add(a),this.beatCubes.push(a)}for(var t=0;3>t;t++){var s=20,e=[Math.floor(201*Math.random())-100,20*Math.random()+10,40*Math.random()+20],i=[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],o=this.speed=.7*Math.random()+.5,a=new n(s,o,1,!0);a.position.set(e[0],e[1],e[2]),a.rotation.set(i[0],i[1],i[2]),this.scene.add(a),this.beatCubes.push(a)}},a.prototype.animate=function(){this.animFrame=requestAnimationFrame(this.animate.bind(this)),this.deltaTime=Date.now()-this.lastTime,this.lastTime=Date.now(),this.delta=this.clock.getDelta(),this.t=.5*this.clock.getElapsedTime(),this.update(),this.render()},a.prototype.update=function(){this.santa.isLoaded&&(this.scene.update(this.santa),this.santa.isLoaded&&(this.santa.update(this.t),this.soundManager.update(),this.canUpdateTime&&this.canUpdateInfo&&(this.timeContainer.innerHTML=Math.floor(100*this.t)/100+"s",this.windContainer.innerHTML=Math.floor(o.map(this.santa.windForce,0,7,0,100))+" km/h")))},a.prototype.render=function(){this.scene.render()},a.prototype.updateScore=function(){this.scoreContainer.innerHTML=this.scores},a.prototype.onResize=function(){this.scene.camera.aspect=window.innerWidth/window.innerHeight,this.scene.camera.updateProjectionMatrix(),this.scene.renderer.setSize(window.innerWidth,window.innerHeight)},a.prototype.updateSantaLife=function(){this.santa.canRun=!1,this.scene.oclScene.transitionOut(),this.canUpdateInfo=!1,this.scene.activateGlitch(this.soundManager),this.santa.mesh.position.x=-60;var t=Math.floor(100*this.t)/100;this.clock=new THREE.Clock,this.clock.stop(),this.santa.reset(),this.santa.transitionIn(),t>this.bestScore&&(this.bestScore=t,this.bestTimeContainer.innerHTML=this.bestScore+"s")},s.exports=a},{"../sound/sound-manager":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/sound/sound-manager.js","../utils/dat-gui":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/dat-gui.js","../utils/number-utils":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/number-utils.js","./beat-cube":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/beat-cube.js","./gift":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/gift.js","./santa/santa":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/santa/santa.js","./scenes/scene":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/scenes/scene.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/gift.js":[function(t,s){var e=t("../utils/number-utils"),i=function(t){THREE.Object3D.apply(this,arguments),this.size=t,this.red=[214,40,34],this.green=[2,115,15],this.rgb={r:this.red[0],g:this.red[1],b:this.red[2]};var s=new THREE.PlaneBufferGeometry(1.5,this.size),e=new THREE.MeshPhongMaterial({color:"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")",side:THREE.DoubleSide}),i=new THREE.Mesh(s,e),n=new THREE.PlaneBufferGeometry(.5,this.size),o=new THREE.MeshPhongMaterial({color:16604755,side:THREE.DoubleSide}),a=new THREE.Mesh(n,o);a.position.set(-1,0,0);var r=new THREE.Mesh(n,o);r.position.set(1,0,0),this.add(i),this.add(a),this.add(r)};i.prototype=Object.create(THREE.Object3D.prototype),i.prototype.constructor=i;var n=function(t,s,e,n){THREE.Object3D.apply(this,arguments),this.size=t,this.canBeTaken=!0,this.red=[214,40,34],this.green=[2,115,15],this.rgb={r:this.green[0],g:this.green[1],b:this.green[2]},this.time=0,this.nextAvailabilitySwitch=90,this.rotationSpeed=.005,this.speed=s,this.layer=e,this.isGoing=!1,this.stripScale=1,this.updatable=n;var o=new THREE.BoxGeometry(this.size,this.size,this.size),a=new THREE.MeshLambertMaterial({color:16777215}),r=new THREE.Mesh(o,a);this.stripFront=new i(this.size),this.stripFront.position.set(0,0,this.size/2+.01),this.stripBack=new i(this.size),this.stripBack.position.set(0,0,-(this.size/2)-.01),this.stripLeft=new i(this.size),this.stripLeft.position.set(-(this.size/2)-.01,0,0),this.stripLeft.rotation.set(0,Math.PI/2,0),this.stripRight=new i(this.size),this.stripRight.position.set(this.size/2+.01,0,0),this.stripRight.rotation.set(0,Math.PI/2,0),this.stripTop1=new i(this.size),this.stripTop1.position.set(0,this.size/2+.01,0),this.stripTop1.rotation.set(Math.PI/2,0,0),this.stripTop2=new i(this.size),this.stripTop2.position.set(0,this.size/2+.01,0),this.stripTop2.rotation.set(Math.PI/2,0,Math.PI/2),this.stripBottom1=new i(this.size),this.stripBottom1.position.set(0,-(this.size/2)-.01,0),this.stripBottom1.rotation.set(Math.PI/2,0,0),this.stripBottom2=new i(this.size),this.stripBottom2.position.set(0,-(this.size/2)-.01,0),this.stripBottom2.rotation.set(Math.PI/2,0,Math.PI/2),this.add(r),this.add(this.stripFront),this.add(this.stripBack),this.add(this.stripLeft),this.add(this.stripRight),this.add(this.stripTop1),this.add(this.stripTop2),this.add(this.stripBottom1),this.add(this.stripBottom2)};n.prototype=Object.create(THREE.Object3D.prototype),n.prototype.constructor=n,n.prototype.update=function(t){this.position.x-=this.speed*t,this.rotation.y+=this.rotationSpeed},n.prototype.toggleAvailabily=function(){this.canBeTaken=!this.canBeTaken;var t=[],s=1;this.canBeTaken?t=this.green:(t=this.red,s=.7),this.sizeTween=new TweenMax(this.scale,1,{x:s,y:s,z:s,ease:Elastic.easeInOut}),this.stripFront.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")"),this.stripBack.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")"),this.stripLeft.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")"),this.stripRight.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")"),this.stripTop1.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")"),this.stripTop2.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")"),this.stripBottom1.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")"),this.stripBottom2.children[0].material.color.setStyle("rgb("+t[0]+","+t[1]+","+t[2]+")")},n.prototype.onColorUpdate=function(){e.map(this.rgb.r,0,255,0,1),e.map(this.rgb.g,0,255,0,1),e.map(this.rgb.b,0,255,0,1)},n.prototype.onCollision=function(t){t?(this.isGoing=!0,TweenMax.to(this.position,1.5,{y:15,ease:Power4.easeInOut}),TweenMax.to(this.scale,.3,{x:1e-4,y:1e-4,z:1e-4,delay:1.5,ease:Elastic.easeOut,delay:2}),TweenMax.to(this,1.5,{stripScale:1e-4,onUpdate:this.onStripScaleUpdate.bind(this),onComplete:this.onGone.bind(this),delay:1}),TweenMax.to(this.rotation,1.5,{x:6*Math.PI,y:Math.PI,z:Math.random()*Math.PI,ease:Power4.easeOut})):(this.isGoing=!0,this.onNopCallback(),this.isGoing=!1)},n.prototype.onStripScaleUpdate=function(){this.stripFront.scale.y=this.stripScale,this.stripBack.scale.y=this.stripScale,this.stripLeft.scale.y=this.stripScale,this.stripRight.scale.y=this.stripScale,this.stripTop1.scale.y=this.stripScale,this.stripTop2.scale.y=this.stripScale,this.stripBottom1.scale.y=this.stripScale,this.stripBottom2.scale.y=this.stripScale},n.prototype.onGone=function(){console.log("gone"),this.isGoing=!1;var t=(Math.random()<.5?-1:1,40*Math.random());this.position.set(t,5,0),TweenMax.to(this.scale,1,{x:1,y:1,z:1,delay:1,ease:Elastic.easeOut}),this.stripScale=1,this.onStripScaleUpdate(),this.onGoneCallback(this)},n.prototype.onNopCallback=function(){},s.exports=n},{"../utils/number-utils":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/number-utils.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/santa/santa.js":[function(t){var s=t("../../utils/dat-gui"),e=t("../../utils/number-utils");window.Santa,__bind=function(t,s){return function(){return t.apply(s,arguments)}},Santa=function(){function t(){this.update=__bind(this.update,this),this.load(),this.animStep=[],this.life=100,this.time=0,this.currentStep=0,this.wind=.3,this.impulsion=0,this.canBeTaken=!0,this.timerCanBeTaken=null,this.thighLTo=0,this.shinLTo=0,this.thighRTo=0,this.shinRTo=0,this.moveEasing=1.1,this.gravity=.4,this.canJump=!1,this.jumpTimeStart=0,this.jumpTimeEnd=0,this.windForce=.3,this.windLimit=-5}return t.prototype.dae=null,t.prototype.skin=null,t.prototype.mesh=null,t.prototype.hips=null,t.prototype.chest=null,t.prototype.neck=null,t.prototype.load=function(){var t;return t=new THREE.JSONLoader,t.load("./assets/models/santa/santa.js",function(t){return function(s,e){return t.mesh=new THREE.SkinnedMesh(s,new THREE.MeshFaceMaterial(e)),t.mesh.rotation.y=Math.PI,t.mesh.material.materials.forEach(function(s){s.skinning=!0,s.color.setRGB(2,2,2),t.mesh.traverse(function(t){return t.castShadow=!0,t.receiveShadow=!1}),t.mesh.position.set(-70,-7,0),t.mesh.rotation.set(0,Math.PI/2,0),t.mesh.scale.x=t.mesh.scale.y=t.mesh.scale.z=2.5,t.setBonesReferences(),t.onLoaded(),t.shadow=t.mesh.clone()})}}(this)),null},t.prototype.onLoaded=function(){return null},t.prototype.onKeyUp=function(t){32===t.keyCode?this.impulsion+=.4:16===t.keyCode&&(this.jumpTimeEnd=0,this.jumpTimeEnd=Date.now(),console.log(this.jumpTimeEnd-this.jumpTimeStart),this.canJump&&(this.canJump=!0))},t.prototype.initShadow=function(){this.shadow=this.mesh.clone();for(var t=0;t<this.shadow.material.materials.length;t++);},t.prototype.onKeyDown=function(t){32===t.keyCode&&(this.canUpdateWind=!1,this.wind+=.3,this.wind>=-.3&&(this.wind=-.3)),16===t.keyCode&&(this.jumpTimeStart=Date.now())},t.prototype.onTouchStart=function(){this.impulsion+=.4,this.canUpdateWind=!0},t.prototype.onTouchEnd=function(){this.canUpdateWind=!1,this.wind+=.3,this.wind>=-.3&&(this.wind=-.3)},t.prototype.setBonesReferences=function(){if(!this.isLoaded){window.addEventListener("keyup",this.onKeyUp.bind(this)),window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("touchstart",this.onTouchStart.bind(this)),window.addEventListener("touchend",this.onTouchEnd.bind(this)),this.isLoaded=!0,this.hips=this.mesh.children[0],this.spine=this.mesh.skeleton.bones[0].children[0],this.chest=this.mesh.skeleton.bones[1].children[0],this.neck=this.mesh.skeleton.bones[2].children[0],this.head=this.mesh.skeleton.bones[4],this.shoulderL=this.mesh.skeleton.bones[6],this.upperArmL=this.mesh.skeleton.bones[7],this.foreArmL=this.mesh.skeleton.bones[8],this.handL=this.mesh.skeleton.bones[9],this.shoulderR=this.mesh.skeleton.bones[29],this.upperArmR=this.mesh.skeleton.bones[30],this.foreArmR=this.mesh.skeleton.bones[31],this.handR=this.mesh.skeleton.bones[32],this.thighL=this.mesh.skeleton.bones[52],this.shinL=this.mesh.skeleton.bones[53],this.footL=this.mesh.skeleton.bones[54],this.toeL=this.mesh.skeleton.bones[55],this.heelL=this.mesh.skeleton.bones[56],this.thighR=this.mesh.skeleton.bones[58],this.shinR=this.mesh.skeleton.bones[59],this.footR=this.mesh.skeleton.bones[60],this.toeR=this.mesh.skeleton.bones[61],this.heelR=this.mesh.skeleton.bones[62],this.bodyPieces=[{name:"hips",el:this.hips,defaultEl:this.hips},{name:"spine",el:this.spine,defaultEl:this.spine},{name:"chest",el:this.chest,defaultEl:this.chest},{name:"neck",el:this.neck,defaultEl:this.neck},{name:"head",el:this.head,defaultEl:this.head},{name:"shoulderL",el:this.shoulderL,defaultEl:this.shoulderL},{name:"upperArmL",el:this.upperArmL,defaultEl:this.upperArmL},{name:"foreArmL",el:this.foreArmL,defaultEl:this.foreArmL},{name:"handL",el:this.handL,defaultEl:this.handL},{name:"shoulderR",el:this.shoulderR,defaultEl:this.shoulderR},{name:"upperArmR",el:this.upperArmR,defaultEl:this.upperArmR},{name:"foreArmR",el:this.foreArmR,defaultEl:this.foreArmR},{name:"handR",el:this.handR,defaultEl:this.handR},{name:"thighL",el:this.thighL,defaultEl:this.thighL},{name:"shinL",el:this.shinL,defaultEl:this.shinL},{name:"footL",el:this.footL,defaultEl:this.footL},{name:"toeL",el:this.toeL,defaultEl:this.toeL},{name:"heelL",el:this.heelL,defaultEl:this.heelL},{name:"thighR",el:this.thighR,defaultEl:this.thighR},{name:"shinR",el:this.shinR,defaultEl:this.shinR},{name:"footR",el:this.footR,defaultEl:this.footR},{name:"toeR",el:this.toeR,defaultEl:this.toeR},{name:"heelR",el:this.spheelRine,defaultEl:this.spheelRine}];for(var t=0;t<this.bodyPieces.length;t++){var e=this.bodyPieces[t];e.el&&(s.santaSettings[e.name]={position:{x:e.el.position.x,y:e.el.position.y,z:e.el.position.z},rotation:{x:e.el.rotation.x,y:e.el.rotation.y,z:e.el.rotation.z}})}s.santaSettings.hips.position.y=4.8,s.santaSettings.hips.rotation.x=1,s.santaSettings.head.rotation.x=-1,s.santaSettings.shoulderL.rotation.x=.7,s.santaSettings.shoulderL.rotation.z=-1,s.santaSettings.shoulderR.rotation.x=.7,s.santaSettings.shoulderR.rotation.z=1,s.santaSettings.thighL.rotation.x=0,s.santaSettings.shinL.rotation.x=1,s.santaSettings.thighR.rotation.x=-1,s.santaSettings.shinR.rotation.x=0,this.setAnimationSteps()}},t.prototype.setAnimationSteps=function(){this.animationSteps=[[{name:"hips"}]]},t.prototype.goToStep=function(t){0===t?(this.thighLTo=0,this.shinLTo=1,this.thighRTo=-1,this.shinRTo=0):1===t&&(this.thighLTo=-1,this.shinLTo=this.bodyPieces[14].defaultEl.rotation.x,this.thighRTo=-1,this.shinRTo=1)},t.prototype.update=function(){for(var t=0;t<this.bodyPieces.length;t++){var i=this.bodyPieces[t];i.el&&(i.el.position.x=s.santaSettings[i.name].position.x,i.el.position.y=s.santaSettings[i.name].position.y,i.el.position.z=s.santaSettings[i.name].position.z,i.el.rotation.x=s.santaSettings[i.name].rotation.x,i.el.rotation.y=s.santaSettings[i.name].rotation.y,i.el.rotation.z=s.santaSettings[i.name].rotation.z)}if(this.thighL.rotation.x+=(this.thighLTo-this.thighL.rotation.x)*this.moveEasing,this.shinL.rotation.x+=(this.shinLTo-this.shinL.rotation.x)*this.moveEasing,this.thighR.rotation.x+=(this.thighRTo-this.thighR.rotation.x)*this.moveEasing,this.shinR.rotation.x+=(this.shinRTo-this.shinR.rotation.x)*this.moveEasing,this.time+=16,this.time>=70){if(this.time=0,this.currentStep++,this.currentStep>1&&(this.currentStep=0),this.goToStep(this.currentStep),!this.canRun||this.isWaiting)return;this.impulsion-=e.map(this.wind+this.windForce,0,8,.18,.24),this.impulsion<=0&&(this.impulsion=0),this.canUpdateWind&&(this.wind-=0),this.wind<=this.windLimit&&(this.wind=this.windLimit)}this.canRun&&!this.isWaiting&&(this.mesh.position.x<=-50?(this.mesh.position.x=-50,this.getHurt(),this.wind=0):this.mesh.position.x>=35&&(this.mesh.position.x=35,this.getHurt(),this.wind=0),this.mesh.position.x-=this.wind+this.windForce,this.mesh.position.x+=this.impulsion,this.mesh.position.y-=this.gravity,this.mesh.position.y<=-7&&(this.mesh.position.y=-7),this.canJump&&(this.mesh.position.y+=1),this.windForce-=.005*this.wind)},t.prototype.getHurt=function(){console.log("plop")},t.prototype.reset=function(){this.wind=0,this.windForce=0,this.impulsion=0},t.prototype.transitionIn=function(){TweenMax.to(this.mesh.position,4,{x:-10,delay:1.5,onComplete:this.onTransitionInComplete.bind(this)})},t.prototype.onTransitionInComplete=function(){this.isWaiting=!0,this.onTransitionInCompleteCallback()},t.prototype.onTransitionInCompleteCallback=function(){},t}()},{"../../utils/dat-gui":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/dat-gui.js","../../utils/number-utils":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/number-utils.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/scenes/occlusion-scene.js":[function(t,s){var e=t("../../shaders/shaders"),i=t("../../utils/dat-gui"),n=t("../../utils/number-utils"),o=function(){this.width=0,this.height=0,this.scene=null,this.camera=null,this.renderTarget=null,this.renderer=null,this.composer=null,this.vLight=null,this.oclMeshes=[],this.santa=null,this.normalColor={r:254,g:91,b:53},this.glitchColor={r:215,g:0,b:0},this.rgb={}};o.prototype.init=function(t,s,e,i){this.width=t,this.height=s,this.scene=new THREE.Scene,this.camera=i,this.renderer=e;var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBufer:!1};this.renderTarget=new THREE.WebGLRenderTarget(this.width,this.height,n),this.addVLights(),this.initPostProcessing(),this.colorTween=new TweenMax(this.rgb,1e-4,{r:0,g:0,b:0})},o.prototype.addBox=function(t){this.scene.add(t)},o.prototype.addSanta=function(t){if(!this.santa){this.santa=t.mesh.clone();var s=new THREE.Mesh(this.santa.geometry,new THREE.MeshBasicMaterial({wireframe:!1,color:0,side:THREE.DoubleSide}));s.rotation.set(0,Math.PI/2,0),s.position.y=-4}},o.prototype.addShape=function(t,s){var e=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide}),i=new THREE.Mesh(t,e);i.position.set(s[0],s[1],s[2]),this.scene.add(i)},o.prototype.remove=function(){},o.prototype.addVLights=function(){var t=new THREE.SphereGeometry(60),s=new THREE.MeshBasicMaterial({color:16669493});this.vLight=new THREE.Mesh(t,s),this.vLight.position.set(0,0,-100),this.vLight.rotation.set(0,0,0),this.scene.add(this.vLight)},o.prototype.transitionIn=function(){TweenMax.to(i.shadersSettings.godray,1,{fWeight:.2})},o.prototype.transitionOut=function(){TweenMax.to(i.shadersSettings.godray,1,{fWeight:.1})},o.prototype.initPostProcessing=function(){i.shadersSettings.godray={color:"#fc6a3d",fX:.5,fY:.5,fExposure:.77,fDecay:.93,fDensity:.96,fWeight:.07,fClamp:1};var t=i.addFolder("God ray");t.addColor(i.shadersSettings.godray,"color").onChange(this.onColorChange.bind(this)),t.add(i.shadersSettings.godray,"fX",-1,1),t.add(i.shadersSettings.godray,"fY",0,1),t.add(i.shadersSettings.godray,"fExposure",0,1),t.add(i.shadersSettings.godray,"fDecay",0,1),t.add(i.shadersSettings.godray,"fDensity",0,1),t.add(i.shadersSettings.godray,"fWeight",0,1),t.add(i.shadersSettings.godray,"fClamp",0,1),this.composer=new THREE.EffectComposer(this.renderer,this.renderTarget);var s=new THREE.RenderPass(this.scene,this.camera);this.composer.addPass(s),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.composer.addPass(this.copyPass),this.grPass=new THREE.ShaderPass(e.godray),this.composer.addPass(this.grPass),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.composer.addPass(this.copyPass);var n=new THREE.ShaderPass(THREE.HorizontalBlurShader),o=new THREE.ShaderPass(THREE.VerticalBlurShader);n.uniforms.h.value=4/this.width,o.uniforms.v.value=4/this.height,this.composer.addPass(n),this.composer.addPass(o),this.composer.addPass(n),this.composer.addPass(o),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.composer.addPass(this.copyPass),this.copyPass.renderToScreen=!0},o.prototype.onColorChange=function(){this.vLight.material.color.setHex(i.shadersSettings.godray.color.replace("#","0x"))},o.prototype.resize=function(t,s){this.width=t,this.height=s,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix()},o.prototype.update=function(){this.grPass.uniforms.fX.value=i.shadersSettings.godray.fX,this.grPass.uniforms.fY.value=i.shadersSettings.godray.fY,this.grPass.uniforms.fExposure.value=i.shadersSettings.godray.fExposure,this.grPass.uniforms.fDecay.value=i.shadersSettings.godray.fDecay,this.grPass.uniforms.fDensity.value=i.shadersSettings.godray.fDensity,this.grPass.uniforms.fWeight.value=i.shadersSettings.godray.fWeight,this.grPass.uniforms.fClamp.value=i.shadersSettings.godray.fClamp},o.prototype.render=function(){this.renderer.setClearColor(0),this.composer.render()},o.prototype.changeColor=function(t){var s;console.log(t),0===t?(s=this.normalColor,this.vLight.material.color.setStyle(253,91,53)):(s=this.normalColor,this.vLight.material.color.setStyle(215,0,0))},o.prototype.onColorUpdate=function(){var t=n.map(this.rgb.r,0,255,0,1),s=n.map(this.rgb.g,0,255,0,1),e=n.map(this.rgb.b,0,255,0,1);this.vLight.material.color.setStyle(t,s,e),this.vLight.material.needsUpdate=!0},s.exports=o},{"../../shaders/shaders":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/shaders/shaders.js","../../utils/dat-gui":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/dat-gui.js","../../utils/number-utils":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/number-utils.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/scenes/scene.js":[function(t,s){var e=t("./occlusion-scene"),i=t("../../shaders/shaders"),n=t("../../utils/dat-gui"),o=t("../../utils/number-utils"),a=function(){this.width=0,this.height=0,this.mainScene=null,this.camera=null,this.renderer=null,this.oclScene=null,this.physicsScene=null,this.beatCubes=[],this.beatCubeOcl=[],this.oclMeshes=[],this.physicsBodys=[],this.backgroundColor=13421772,this.glitch={isActive:!1,timeout:null,pass:null},this.timer=0,this.windForce};a.prototype.init=function(t,s){this.width=t,this.height=s,this.mainScene=new THREE.Scene,this.mainScene.fog=new THREE.Fog(16542269,170,400),this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,.1,1e4),this.camera.position.set(0,20,170),this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(this.backgroundColor),this.renderer.shadowMapEnabled=!1,this.renderer.shadowMapType=THREE.PCFSoftShadowMap,document.querySelector("#app").appendChild(this.renderer.domElement),this.addLights(),this.oclScene=new e,this.oclScene.init(this.width,this.height,this.renderer,this.camera),this.initPostProcessing(),this.buildScene();for(var i=0;30>i;i++);this.renderer.shadowMapSoft=!0,this.renderer.shadowCameraNear=3,this.renderer.shadowCameraFar=this.camera.far,this.renderer.shadowCameraFov=50,this.renderer.shadowMapBias=.0039,this.renderer.shadowMapDarkness=.5,this.renderer.shadowMapWidth=2048,this.renderer.shadowMapHeight=2048,n.cameraSettings={position:{x:0,y:50,z:0},rotation:{x:0,y:0,z:0}}},a.prototype.addLights=function(){this.ambientLight=new THREE.AmbientLight(16777215),n.spotLightSettings={intensity:.7,position:{x:0,y:200,z:-50},rotation:{x:0,y:0,z:0}},this.spotLight=new THREE.SpotLight(16777215),this.spotLight.castShadow=!0,this.spotLight.position.set(0,105,-180),this.spotLight.shadowCameraVisible=!0,this.spotLight.shadowDarkness=.35,this.spotLight.shadowMapWidth=2048,this.spotLight.shadowMapHeight=2048,this.spotLight.intensity=1,this.dirLight=new THREE.DirectionalLight(16777215),this.mainScene.add(this.dirLight),this.dirLight.intensity=.5},a.prototype.add=function(t){this.mainScene.add(t),this.beatCubes.push(t);var s=t.children[0].geometry.clone(),e=new THREE.MeshBasicMaterial({wireframe:!1,color:0,side:THREE.DoubleSide}),i=new THREE.Mesh(s,e);i.position.set(t.position.x,t.position.y,t.position.z),i.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),this.oclScene.addBox(i),this.beatCubeOcl.push(i)},a.prototype.addCube=function(t){this.mainScene.add(t),this.beatCubes.push(t);var s=t.cube.geometry;this.oclScene.add(s,t.position,t.rotation)},a.prototype.removeCube=function(t){this.mainScene.remove(t),this.oclScene.remove(t)},a.prototype.buildScene=function(){var t=new THREE.CircleGeometry(320,100),s=new THREE.MeshBasicMaterial({wireframe:!1,color:0,side:THREE.DoubleSide,map:null}),e=[0,-321,10],i=[0,0,0];this.floor=new THREE.Mesh(t,s),this.floor.position.y=e[1],this.floor.position.z=e[2],this.floor.receiveShadow=!0,this.mainScene.add(this.floor),this.oclScene.addShape(t.clone(),e,i);var n=new THREE.CircleGeometry(60,100),o=new THREE.MeshBasicMaterial({wireframe:!1,color:16542269,side:THREE.DoubleSide,transparent:!0,opacity:.01}),a=new THREE.Mesh(n,o);a.position.set(0,0,-100),this.mainScene.add(a)},a.prototype.remove=function(t){this.mainScene.remove(t)},a.prototype.initPostProcessing=function(){this.composer=new THREE.EffectComposer(this.renderer),this.renderPass=new THREE.RenderPass(this.mainScene,this.camera),this.composer.addPass(this.renderPass),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.composer.addPass(this.copyPass),this.vignettePass=new THREE.ShaderPass(THREE.VignetteShader),this.composer.addPass(this.vignettePass),this.glowPass=new THREE.ShaderPass(i.additive),this.glowPass.uniforms.tDiffuse2.value=this.oclScene.renderTarget,this.composer.addPass(this.glowPass);var t={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};this.savedRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,t),this.savePass=new THREE.SavePass(this.savedRenderTarget),this.composer.addPass(this.savePass),this.glitch.pass=new THREE.GlitchPass,this.composer.addPass(this.glitch.pass),this.glitch.pass.randX=0,this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.composer.addPass(this.copyPass),this.copyPass.renderToScreen=!0},a.prototype.activateGlitch=function(t){this.glitch.isActive||(t.fade(0),t.playGlitch(),clearTimeout(this.glitch.timeout),this.glitch.isActive=!0,this.glitch.timeout=setTimeout(function(){this.glitch.isActive=!1,t.fade(1),t.stopGlitch()}.bind(this),800))},a.prototype.update=function(t){this.windForce=o.map(t.wind+t.windForce,0,7,.2,2);this.updateGUI(),this.oclScene.update();{var s;new THREE.Matrix4}this.glitch.pass.randX=this.glitch.isActive?5:0;for(var e=this.beatCubes.length;e--;)if(s=this.beatCubes[e],s.updatable){s.update(this.windForce);var i=this.beatCubeOcl[e];i.position.set(s.position.x,s.position.y,s.position.z),i.rotation.set(s.rotation.x,s.rotation.y,s.rotation.z),s.position.x<=-120&&(0===s.layer?(s.speed=.7*Math.random()+.6,s.position.y=50*Math.random()+10,s.position.z=50*-Math.random(),s.position.x=120,s.rotationSpeed=.005*Math.random()):1===s.layer&&(.1*Math.random()+.7,s.position.y=20*Math.random()+10,s.position.z=40*Math.random()+20,s.position.x=120+50*Math.random(),s.rotationSpeed=.05*Math.random()+.03))}},a.prototype.updateGUI=function(){this.spotLight.intensity=n.spotLightSettings.intensity,this.spotLight.position.set(n.spotLightSettings.position.x,n.spotLightSettings.position.y,n.spotLightSettings.position.z),this.spotLight.rotation.set(n.spotLightSettings.rotation.x,n.spotLightSettings.rotation.y,n.spotLightSettings.rotation.z)},a.prototype.render=function(){this.oclScene.render(),this.renderer.setClearColor(0),this.composer.render()},a.prototype.resize=function(t,s){this.width=t,this.height=s,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.composer.setSize(this.width,this.height),this.occlusion.resize(this.width,this.height)
},s.exports=a},{"../../shaders/shaders":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/shaders/shaders.js","../../utils/dat-gui":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/dat-gui.js","../../utils/number-utils":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/number-utils.js","./occlusion-scene":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/experiment/scenes/occlusion-scene.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/shaders/shaders.js":[function(t,s){var e={additive:{uniforms:{tDiffuse:{type:"t",value:null},tDiffuse2:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = texel1 + vec4(0.5, 0.75, 1.0, 1.0) * texel2 * 2.0;","}"].join("\n")},godray:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},fX:{type:"f",value:.5},fY:{type:"f",value:.5},fExposure:{type:"f",value:.6},fDecay:{type:"f",value:.93},fDensity:{type:"f",value:.96},fWeight:{type:"f",value:.4},fClamp:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tDiffuse;","uniform float fX;","uniform float fY;","uniform float fExposure;","uniform float fDecay;","uniform float fDensity;","uniform float fWeight;","uniform float fClamp;","const int iSamples = 20;","void main() {","vec2 deltaTextCoord = vec2(vUv - vec2(fX,fY));","deltaTextCoord *= 1.0 /  float(iSamples) * fDensity;","vec2 coord = vUv;","float illuminationDecay = 1.0;","vec4 FragColor = vec4(0.0);","for(int i=0; i < iSamples ; i++)","{","coord -= deltaTextCoord;","vec4 texel = texture2D(tDiffuse, coord);","texel *= illuminationDecay * fWeight;","FragColor += texel;","illuminationDecay *= fDecay;","}","FragColor *= fExposure;","FragColor = clamp(FragColor, 0.0, fClamp);","gl_FragColor = FragColor;","}"].join("\n")}};s.exports=e},{}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/sound/sound-manager.js":[function(t,s){var e=t("../utils/dat-gui"),i=function(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser(),this.muteBtn=document.querySelector(".mute"),this.mainBuffer=null,this.audioSource=null,this.channels=[],this.currentTime=0,this.isMuted=!0,this.isLoaded=!1,e.soundSettings={play:!0,loop:!0,playbackRate:1},this.muteBtn.addEventListener("click",this.toggleSound.bind(this)),this.audioNode=document.querySelector(".alice"),this.audioNode.addEventListener("canplaythrough",this.onCanPlay.bind(this)),this.glitchNode=document.querySelector(".glitch")};i.prototype.onCanPlay=function(){this.isLoaded=!0,this.onLoaded()},i.prototype.play=function(){this.audioNode.play()},i.prototype.toggleSound=function(){this.isMuted=!this.isMuted,TweenMax.killTweensOf(this.audioNode),TweenMax.killTweensOf(this.glitchNode),this.isMuted?(TweenMax.to(this.audioNode,.3,{volume:1}),TweenMax.to(this.audioNode,.3,{volume:1})):(TweenMax.to(this.audioNode,.3,{volume:0}),TweenMax.to(this.audioNode,.3,{volume:0}))},i.prototype.onLoaded=function(){},i.prototype.update=function(){this.audioNode.currentTime>=130&&(this.onEnded(),this.fade(0,.8))},i.prototype.onEnded=function(){this.fade(0)},i.prototype.fade=function(t,s){var e=s||.3;this.isMuted&&(TweenMax.killTweensOf(this.audioNode),TweenMax.to(this.audioNode,e,{volume:t}))},i.prototype.playGlitch=function(){this.isMuted&&this.glitchNode.play()},i.prototype.stopGlitch=function(){},i.prototype.stop=function(){this.audioNode.pause()},s.exports=i},{"../utils/dat-gui":"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/dat-gui.js"}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/dat-gui.js":[function(t,s){var e=new dat.GUI;e.spotLightSettings={},e.shadersSettings={},e.santaSettings={},e.domElement.style.display="none",s.exports=e},{}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/utils/number-utils.js":[function(t,s){var e={rgb2hex:function(t,s,e){var i=e|s<<8|t<<16;return"#"+(16777216+i).toString(16).slice(1)},map:function(t,s,e,i,n,o){var o=o||!1;return num1=(t-s)/(e-s),num2=num1*(n-i)+i,o?Math.round(num2):num2}};s.exports=e},{}],"/Users/william.mapan/Documents/perso/xmas14/src/scripts/views/AppView.js":[function(t,s){var e=function(){};s.exports=e},{}]},{},["../.././src/scripts/app.js"]);